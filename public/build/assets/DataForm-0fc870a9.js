import{I as ee,a as te,r as f,T as fe,K as ae,J as K,o as r,p as T,b as l,c as h,w as t,d as a,s as k,y as S,F as J,q as X,j as R,E as v,U as ye,k as O,W as de,X as he,Y as be,Z as ge,P as Ve,e as m,n as q,f as B,t as g,L as Z,_ as ce,H as ne,u as ke,V as je,$ as Q,a0 as H,i as ue,v as D,m as we,z as Se,A as De}from"./app-597e13ed.js";import{_ as Ce}from"./ApppageHeader-6530ab1b.js";import{_ as $e}from"./AppSnackBar-b90e58c4.js";import{c as Ie,a as z,F as Ae,b as G}from"./index.esm-083d1c7a.js";import{d as re}from"./dayjs.min-d6cbae57.js";import{u as P,a as xe}from"./formatDate-b9aad8c5.js";import{u as Re}from"./status-2229fbba.js";import{_ as Te}from"./Studio-7147eb58.js";import{_ as Ue}from"./_plugin-vue_export-helper-c27b6911.js";const Ee={class:"v-col-12 pt-5"},Ne={class:"v-col-12 pb-2"},Oe={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},qe={class:"v-col-12 pt-0 pb-2"},Fe={class:"v-col-12"},Le={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(C,{emit:L}){const i=C;ee();const y=te(),e=f(window.location.origin),u=d=>{let n=null;d.map(s=>{n=b.value.find(j=>j.id==s.id),n||b.value.push(s)})},I=f(y.user.profile.id),U=f(!1),_=f(1),M=d=>{_.value=d,U.value=!0},V=d=>{b.value=b.value.filter(n=>n.id!==d)},b=f([]),A=fe(()=>b.value.map(d=>d.id)),Y=()=>{let d={id:parseInt(i.incidentId),file_ids:A.value,profile_id:i.objectdata.profile_id};q(y.token).post("/api/incident/sync-images/store-update",d).then(n=>{let s="Attachment has been updated";A.value.length==0&&(s="Attachment has been deleted"),L("save",s)}).catch(n=>{})};return ae(()=>{b.value=i.attachment}),K(()=>i.objectdata.attachment,(d,n)=>{b.value=d},{deep:!0}),(d,n)=>(r(),T("div",null,[l("div",Ee,[i.objectdata.profile_id==I.value?(r(),h(k,{key:0},{default:t(()=>[l("div",Ne,[a(Te,{options:{multiSelect:!0,type:"maintenance"},onSelect:u})])]),_:1})):S("",!0),b.value.length>0?(r(),h(k,{key:1,class:"px-1"},{default:t(()=>[(r(!0),T(J,null,X(b.value,(s,j)=>(r(),T("div",{key:s.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[i.objectdata.profile_id==I.value?(r(),h(R,{key:0,style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:v(ye),size:"26px",color:"error",onClick:()=>V(s.id)},null,8,["icon","onClick"])):S("",!0),a(O,{onClick:()=>M(j)},{default:t(()=>[a(de,{src:e.value+"/file/"+s.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),a(he,{modelValue:U.value,"onUpdate:modelValue":n[1]||(n[1]=s=>U.value=s),width:"95%","max-width":"900"},{default:t(()=>[a(O,{class:"bg-black"},{default:t(()=>[a(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:_.value,"onUpdate:modelValue":n[0]||(n[0]=s=>_.value=s)},{default:t(()=>[(r(!0),T(J,null,X(b.value,(s,j)=>(r(),h(ge,{key:j,"reverse-transition":"fade",transition:"fade"},{default:t(()=>[l("div",Oe,[a(de,{src:e.value+"/file/"+s.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(r(),h(k,{key:2},{default:t(()=>[l("div",qe,[a(Ve,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:t(()=>[m(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),i.objectdata.profile_id==I.value?(r(),h(k,{key:3},{default:t(()=>[l("div",Fe,[a(R,{color:"primary",onClick:Y},{default:t(()=>[m("Save")]),_:1})])]),_:1})):S("",!0)])]))}},Me={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Ye={class:"font-weight-bold"},We={class:"reported-by"},Be={class:"reported-by"},Pe={class:"v-col-12"},He={class:"v-col-12 v-col-md-4 pb-0"},ze={class:"v-col-12 v-col-md-8"},Ge={class:"v-col-12"},Ke={class:"v-col-12"},Je={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Xe={class:"v-col-3"},Ze=l("br",null,null,-1),Qe={class:"v-col-9"},et={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(C,{emit:L}){const i=C,y=ee(),e=te(),u=f({}),I=f([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),U=f(y.query.v),_=f([]),M=async()=>{await q(e.token).get("/api/fetch/profile-facility/team").then(d=>{_.value=d.data}).catch(d=>{})},V=()=>{u.value.profile_id=e.user.profile.id,q(e.token).post("/api/incident/update-facility-team",u.value).then(d=>{u.value.remarks_data="",L("saved",d.data.message)}).catch(d=>{})},b=f([]),A=async()=>{await q(e.token).get("/api/fetch-global/incident-status/active").then(d=>{b.value=d.data}).catch(d=>{})},Y=(d,n=6)=>{let s="00000"+d;return s.substring(s.length-n)};return ae(()=>{M(),A(),u.value=i.objectdata,u.value.priority=i.objectdata.priority?parseInt(i.objectdata.priority):null}),K(()=>i.objectdata.remarks,(d,n)=>{u.value.remarks=d},{deep:!0}),(d,n)=>(r(),T("div",null,[a(O,null,{default:t(()=>[a(B,null,{default:t(()=>[a(k,null,{default:t(()=>{var s;return[l("div",Me,[l("div",Ye," SN: ISR-"+g(Y(u.value.id)),1),l("div",We," REPORTED BY: "+g((s=u.value.profile)==null?void 0:s.display_name),1),l("div",Be," DATE REPORTED: "+g(v(P)(u.value.created_at)),1)])]}),_:1}),a(k,null,{default:t(()=>[l("div",Pe,[a(k,null,{default:t(()=>[l("div",He,[a(Z,{items:I.value,modelValue:u.value.priority,"onUpdate:modelValue":n[0]||(n[0]=s=>u.value.priority=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*"},null,8,["items","modelValue"]),a(Z,{items:_.value,modelValue:u.value.handled_by,"onUpdate:modelValue":n[1]||(n[1]=s=>u.value.handled_by=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue"]),a(Z,{items:b.value,modelValue:u.value.status_id,"onUpdate:modelValue":n[2]||(n[2]=s=>u.value.status_id=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),l("div",ze,[a(ce,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:u.value.remarks_data,"onUpdate:modelValue":n[3]||(n[3]=s=>u.value.remarks_data=s)},null,8,["modelValue"])])]),_:1})]),a(ne,{class:"mt-3"}),l("div",Ge,[U.value?S("",!0):(r(),h(R,{key:0,class:"",size:"small",disabled:!u.value.priority||!u.value.handled_by||!u.value.status_id,onClick:V,color:"primary"},{default:t(()=>[m("Submit")]),_:1},8,["disabled"]))])]),_:1}),a(k,null,{default:t(()=>[l("div",Ke,[m(" Remarks "),a(ne)]),l("div",Je,[(r(!0),T(J,null,X(u.value.remarks,s=>(r(),h(k,{key:d.id},{default:t(()=>{var j;return[l("div",Xe,[m(g((j=s.profile)==null?void 0:j.display_name)+" ",1),Ze,m(),l("small",null,g(v(xe)(s.created_at)),1)]),l("div",Qe,g(s.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const F=C=>(Se("data-v-34d8f3d0"),C=C(),De(),C),tt={class:"v-col py-0"},at={class:"v-col py-0"},lt={class:"v-col-12 v-col-md-4"},st=F(()=>l("div",{class:"font-weight-bold"},"SN:",-1)),ot={class:"v-col-12 v-col-md-4"},it=F(()=>l("div",{class:"font-weight-bold"},"Reported by:",-1)),dt={class:"v-col-12 v-col-md-4"},nt=F(()=>l("div",{class:"font-weight-bold"},"Status",-1)),ut={class:"v-col-12 v-col-md-4"},rt=F(()=>l("div",{class:"font-weight-bold"},"Date Reported",-1)),ct={class:"v-col-12 v-col-md-4"},vt=F(()=>l("div",{class:"font-weight-bold"},"Date Closed",-1)),mt={class:"v-col-12 v-col-md-4"},pt={class:"v-col-12 v-col-md-8"},_t={class:"v-col-12"},ft={class:"v-col-12 v-col-md-6"},yt={class:"v-col-12 v-col-md-6"},ht={class:"v-col-12"},bt={class:"v-col-12"},gt={key:1},Vt=F(()=>l("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),kt={class:"v-col-12 v-col-md-12"},jt=F(()=>l("h5",{class:"headline mb-0 text-center"},[m("NO WARRANTY FOUND. "),l("br"),m("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),wt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(C,{emit:L}){const i=C,y=te(),e=f({}),u=f({}),I=c=>{u.value={status:!0,type:"success",text:c},L("saved")},U=f(y.user.profile.id),_=ee(),M=ke(),V=f(_.query.type);f(_.query.v);const b=Re(),A=f([]);A.value=Object.assign([],b.urgencies_active_list),b.list.length==0&&b.getStatuses(y.token).then(()=>{A.value=Object.assign([],b.urgencies_active_list)});let Y=Ie({Urgency:z().required(),Title:z().required(),Company:z().required(),Location:z().required()});const d=new URL(window.location),n=c=>{V.value=c,le("type",c)},s=f(!1),j=f(y.user.profile.role),ve=async()=>{s.value=!0,u.value={status:!0,type:"info",text:"Please wait..."},e.value.type_id=2,e.value.profile_id=y.user.profile.id,await q(y.token).post("/api/store-update/incident",e.value).then(c=>{u.value={status:!0,type:"success",text:c.data.message},_.params.id?s.value=!1:setTimeout(()=>{M.push({name:"EditMaintenance",params:{id:c.data.id},query:{type:"details"}}).catch(o=>{}),s.value=!1},800)}).catch(c=>{})},w=f(!1),le=(c,o)=>{d.searchParams.set(c,o),window.history.pushState({},"",d)},se=f([]),me=async()=>{await q(y.token).get("/api/fetch/companies").then(c=>{se.value=c.data}).catch(c=>{})},oe=f([]),pe=async()=>{await q(y.token).get("/api/fetch/locations/non-paginated/data").then(c=>{oe.value=c.data}).catch(c=>{})},_e=(c,o=5)=>{let $="0000"+c;return $.substring($.length-o)};return ae(()=>{var c;_.query.asset_code&&(e.value.asset_code=_.query.asset_code),_.query.title&&(e.value.title=_.query.title),_.query.asset_id&&(e.value.asset_id=parseInt(_.query.asset_id)),_.query.comp&&(e.value.company_id=parseInt(_.query.comp)),_.query.loc&&(e.value.location_id=parseInt(_.query.loc)),_.params.id&&(w.value=!0),V.value||(V.value="details",le("type","details")),me().then(()=>{pe()}),console.log("isEdit.value",w.value),w.value&&(e.value=i.objectdata,e.value.asset_code=(c=i.objectdata.asset)==null?void 0:c.asset_code,e.value.title=i.objectdata.asset?i.objectdata.asset.asset_name:i.objectdata.title,e.value.company_id=i.objectdata.company_id,e.value.location_id=i.objectdata.location_id,e.value.asset_id=i.objectdata.asset_id,e.value.profile_id=i.objectdata.profile_id,e.value.type_id=parseInt(i.objectdata.type_id),e.value.urgency=parseInt(i.objectdata.urgency),e.value.description=i.objectdata.description),console.log("objData.value",e.value)}),K(()=>i.objectdata.remarks,(c,o)=>{e.value=i.objectdata},{deep:!0}),K(()=>i.objectdata.attachment,(c,o)=>{e.value=i.objectdata,e.value.attachment=c},{deep:!0}),(c,o)=>(r(),h(we,null,{default:t(()=>[a(Ce,{title:"Maintenance detail page"}),a(k,{class:"mt-5"},{default:t(()=>[l("div",tt,[a(R,{onClick:o[0]||(o[0]=$=>n("details")),class:"mr-3 mb-3",color:`${V.value=="details"?"primary":"white"}`},{default:t(()=>[m("Details")]),_:1},8,["color"]),w.value?(r(),h(R,{key:0,class:"mr-3 mb-3",color:`${V.value=="attachment"?"primary":"white"}`,onClick:o[1]||(o[1]=$=>n("attachment"))},{default:t(()=>[m("Attachments")]),_:1},8,["color"])):S("",!0),w.value&&(v(y).user.profile.role=="facility"||v(y).user.profile.role=="admin"||v(y).user.profile.role=="superadmin"||v(y).user.profile.role=="technical-operation")?(r(),h(R,{key:1,class:"mr-3 mb-3",color:`${V.value=="warranty"?"primary":"white"}`,onClick:o[2]||(o[2]=$=>n("warranty"))},{default:t(()=>[m("Warranty")]),_:1},8,["color"])):S("",!0),w.value&&(v(y).user.profile.role=="facility"||v(y).user.profile.role=="admin"||v(y).user.profile.role=="superadmin"||v(y).user.profile.role=="technical-operation")?(r(),h(R,{key:2,class:"mr-3 mb-3",color:`${V.value=="facility"?"primary":"white"}`,onClick:o[3]||(o[3]=$=>n("facility"))},{default:t(()=>[m("Facility Team")]),_:1},8,["color"])):S("",!0)])]),_:1}),a(k,{class:"mb-10"},{default:t(()=>{var $,ie;return[l("div",at,[V.value=="details"?(r(),h(O,{key:0},{default:t(()=>[a(v(Ae),{as:"v-form","validation-schema":v(Y)},{default:t(({meta:x})=>[a(je,{class:"text-capitalize my-1"},{default:t(()=>[m(g(i.headertitle),1)]),_:1}),a(B,null,{default:t(()=>[w.value?(r(),h(k,{key:0,class:"bg-background-darken-1 ma-0 rounded"},{default:t(()=>{var W,p;return[l("div",lt,[st,l("div",null,"ISR-2"+g(_e(e.value.id)),1)]),l("div",ot,[it,l("div",null,g((W=e.value.profile)==null?void 0:W.display_name),1)]),l("div",dt,[nt,l("div",null,g((p=e.value.status)==null?void 0:p.title),1)]),l("div",ut,[rt,l("div",null,g(e.value.created_at?v(re)(e.value.created_at).format("MMM. DD, YYYY"):"-"),1)]),l("div",ct,[vt,l("div",null,g(e.value.date_closed?v(re)(e.value.date_closed).format("MMM. DD, YYYY"):"-"),1)])]}),_:1})):S("",!0),a(k,null,{default:t(()=>{var W;return[l("div",mt,[a(v(G),{name:"Urgency",modelValue:e.value.urgency_id,"onUpdate:modelValue":o[5]||(o[5]=p=>e.value.urgency_id=p)},{default:t(({field:p,errors:E})=>[a(Q,H({items:A.value,modelValue:e.value.urgency_id,"onUpdate:modelValue":o[4]||(o[4]=N=>e.value.urgency_id=N),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},p,{"error-messages":E}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),l("div",pt,[a(ue,{modelValue:e.value.asset_code,"onUpdate:modelValue":o[6]||(o[6]=p=>e.value.asset_code=p),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code","append-inner-icon":c.mdiMagnify,"onClick:appendInner":o[7]||(o[7]=p=>c.onDecode(e.value.asset_code))},null,8,["modelValue","append-inner-icon"])]),l("div",_t,[a(v(G),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":o[9]||(o[9]=p=>e.value.title=p)},{default:t(({field:p,errors:E})=>[a(ue,H({modelValue:e.value.title,"onUpdate:modelValue":o[8]||(o[8]=N=>e.value.title=N),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},p,{"error-messages":E}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),l("div",ft,[a(v(G),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":o[11]||(o[11]=p=>e.value.company_id=p)},{default:t(({field:p,errors:E})=>[a(Q,H({items:se.value,modelValue:e.value.company_id,"onUpdate:modelValue":o[10]||(o[10]=N=>e.value.company_id=N),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},p,{"error-messages":E}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),l("div",yt,[a(v(G),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":o[13]||(o[13]=p=>e.value.location_id=p)},{default:t(({field:p,errors:E})=>[a(Q,H({items:oe.value,modelValue:e.value.location_id,"onUpdate:modelValue":o[12]||(o[12]=N=>e.value.location_id=N),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},p,{"error-messages":E}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),l("div",ht,[a(ce,{rows:"3",variant:"outlined",density:"compact",label:"Incident Description","hide-details":"auto",modelValue:e.value.description,"onUpdate:modelValue":o[14]||(o[14]=p=>e.value.description=p)},null,8,["modelValue"])]),l("div",bt,[((W=e.value)==null?void 0:W.status_id)!=8&&(!w.value||w.value&&(i.objectdata.profile_id==U.value||j.value=="asset-supervisor"))?(r(),h(R,{key:0,color:"primary",onClick:ve,disabled:!x.valid,loading:s.value},{default:t(()=>[m(g(w.value?"update":"submit"),1)]),_:2},1032,["disabled","loading"])):S("",!0)])]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):S("",!0),V.value=="warranty"?(r(),T("div",gt,[a(O,null,{default:t(()=>[a(B,null,{default:t(()=>[Vt]),_:1})]),_:1}),((ie=($=e.value.asset)==null?void 0:$.pivot_warranties)==null?void 0:ie.length)>0?(r(),h(k,{key:0},{default:t(()=>[l("div",kt,[(r(!0),T(J,null,X(e.value.asset.pivot_warranties,x=>(r(),h(O,{class:"my-3 px-5",key:x.id},{default:t(()=>[a(B,null,{default:t(()=>[a(k,null,{default:t(()=>[a(D,{cols:"4"},{default:t(()=>[m("Vendor")]),_:1}),a(D,{cols:"8"},{default:t(()=>[m(g(x.vendor.title),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[m("Warranty Start Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[m(g(v(P)(x.warranty_start_date)),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[m("Warranty End Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[m(g(v(P)(x.warranty_end_date)),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[m("AMC Start Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[m(g(v(P)(x.amc_start_date)),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[m("AMC End Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[m(g(v(P)(x.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(r(),h(O,{key:1,class:"mt-2"},{default:t(()=>[a(B,null,{default:t(()=>[jt]),_:1})]),_:1}))])):w.value&&V.value=="attachment"?(r(),h(Le,{key:2,"incident-id":v(_).params.id,attachment:e.value.attachment,onSave:I,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(j.value=="superadmin"||j.value=="admin"||j.value=="technical-operation"||j.value=="facility")&&w.value&&V.value=="facility"?(r(),h(et,{key:3,objectdata:e.value,onSaved:I},null,8,["objectdata"])):S("",!0)])]}),_:1}),a($e,{options:u.value},null,8,["options"])]),_:1}))}},Ut=Ue(wt,[["__scopeId","data-v-34d8f3d0"]]);export{Ut as D};
