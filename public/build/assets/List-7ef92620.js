import{r as s,a as te,u as ae,I as le,J as se,K as oe,c as b,w as r,m as ne,n as R,o as f,d as o,b as l,k as ie,V as ue,i as re,h as de,s as F,L as k,x as ce,e as q,p as M,q as pe,t as d,M as me,E as g,D as O,N as ve,O as fe,y as z,F as ge,P as ye,Q as he}from"./app-f387ecc1.js";import{_ as xe}from"./ApppageHeader-72bbaec7.js";import{d as C,e as V}from"./encrypt-2306fdac.js";import{_ as Ce}from"./AppSnackBar-17f5c8e8.js";import{u as T}from"./formatDate-b9aad8c5.js";const Ve={class:"v-col-12"},Se=l("div",{class:"mr-auto"},"Asset Requests",-1),_e={class:"v-col-12 v-col-md"},be={class:"v-col-12 v-col-md"},ke={class:"v-col-12 v-col-md"},qe={class:"v-col-12 v-col-md"},we=l("th",{class:"text-left text-capitalize"},"SN No.",-1),Ie=l("br",null,null,-1),$e=l("small",null,"(DD/MM/YY)",-1),De=l("br",null,null,-1),Re=l("small",null,"(DD/MM/YY)",-1),ze=l("th",{class:"text-right text-capitalize"},null,-1),Ne={class:"d-flex align-center justify-end"},Fe={__name:"List",setup(je){const K=s({status:!1,type:"primary",text:null}),c=te(),N=ae(),w=le(),u=s({loading:!1,data:[]}),I=s(0),E=s(0),v=s(""),Y=s([10,20,50,100]),y=s(10),n=s({}),J=()=>{localStorage.setItem("request-filter-row",V(y.value)),m()},$=a=>{D.value="",i.value==1?(a=="company"?localStorage.setItem("request-filter-company",V(n.value.company_id)):a=="location"?localStorage.setItem("request-filter-location",V(n.value.location_id)):a=="status"&&localStorage.setItem("request-filter-status",V(n.value.status)),m()):i.value=1},j=()=>{localStorage.setItem("request-asset-search",V(v.value)),m()},S=a=>{a=="search"?(v.value="",localStorage.setItem("request-asset-search",""),m()):a=="company"?localStorage.setItem("request-filter-company",""):a=="location"?localStorage.setItem("request-filter-location",""):a=="status"&&localStorage.setItem("request-filter-status","")},i=s(w.params&&w.params.page?w.params.page:1),_=s([]),D=s(""),A=s(0),p=a=>{u.value.loading=!0,_.value[0]=a,A.value%2?_.value[1]="DESC":_.value[1]="ASC",A.value++,D.value=JSON.stringify(_.value),m()},L=s([]),Q=async()=>{await R(c.token).get("/api/fetch/companies").then(a=>{L.value=a.data}).catch(a=>{})},P=s([]),G=async()=>{await R(c.token).get("/api/fetch/locations/non-paginated/data").then(a=>{P.value=a.data}).catch(a=>{})},H=s([{id:"pending",title:"Pending"},{id:"awaiting-approval",title:"Awaiting Approval"},{id:"reject",title:"Rejected"},{id:"cancelled",title:"Cancelled"},{id:"complete",title:"Completed"}]),W=a=>a=="reject"?"Rejected":a=="complete"?"Completed":a,m=async()=>{u.value.loading=!0,await R(c.token).get("/api/fetch/request-assets/by-requestor/request?userid="+c.user.profile.id+"&role="+c.user.profile.role+"&page="+i.value+"&show="+y.value+"&search="+v.value+"&sort="+D.value+"&filter="+JSON.stringify(n.value)).then(a=>{console.log("dataobj.value",u.value),I.value=a.data.last_page?a.data.last_page:a.data.length,i.value=a.data.current_page?a.data.current_page:i.value,E.value=a.data.total?a.data.total:a.data.length,u.value.data=a.data.data?a.data.data:a.data,u.value.loading=!1}).catch(a=>{u.value.loading=!1,console.log(a)})};se(i,(a,e)=>{i.value&&a!=e&&(N.push({name:"PaginatedRequestAsset",params:{page:i.value}}).catch(t=>{}),m(i.value))});const X=a=>{N.push({name:"EditRequestAsset",params:{id:a}}).catch(e=>{console.log(e)})},Z=a=>{console.log("delete",a)},ee=(a,e=6)=>{let t="00000"+a;return t.substring(t.length-e)};return oe(()=>{let a=localStorage.getItem("request-asset-search"),e=localStorage.getItem("request-filter-company"),t=localStorage.getItem("request-filter-location"),h=localStorage.getItem("request-filter-status"),x=localStorage.getItem("request-filter-row");a&&(v.value=C(a)),e&&(n.value.company_id=C(e)),t&&(n.value.location_id=C(t)),h&&(n.value.status=C(h)),x&&(y.value=C(x)),m().then(()=>{Q().then(()=>{G()})})}),(a,e)=>(f(),b(ne,null,{default:r(()=>[o(xe,{title:"Asset request page"}),o(F,{class:"mb-3"},{default:r(()=>[l("div",Ve,[o(ie,{loading:u.value.loading},{default:r(()=>[o(ue,{class:"d-flex align-center mb-3 pa-3"},{default:r(()=>[Se,o(re,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. SN-5000035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":j,onKeydown:de(j,["enter"]),"onClick:clear":e[1]||(e[1]=t=>S("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(F,{class:"px-3"},{default:r(()=>[l("div",_e,[o(k,{items:L.value,modelValue:n.value.company_id,"onUpdate:modelValue":[e[2]||(e[2]=t=>n.value.company_id=t),e[3]||(e[3]=t=>$("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company","onClick:clear":e[4]||(e[4]=t=>S("company"))},null,8,["items","modelValue"])]),l("div",be,[o(k,{items:P.value,modelValue:n.value.location_id,"onUpdate:modelValue":[e[5]||(e[5]=t=>n.value.location_id=t),e[6]||(e[6]=t=>$("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title","onClick:clear":e[7]||(e[7]=t=>S("location"))},null,8,["items","modelValue"])]),l("div",ke,[o(k,{items:H.value,modelValue:n.value.status,"onUpdate:modelValue":[e[8]||(e[8]=t=>n.value.status=t),e[9]||(e[9]=t=>$("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status","onClick:clear":e[10]||(e[10]=t=>S("status"))},null,8,["items","modelValue"])]),l("div",qe,[o(k,{items:Y.value,modelValue:y.value,"onUpdate:modelValue":[e[11]||(e[11]=t=>y.value=t),J],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),o(ce,null,{default:r(()=>[l("thead",null,[l("tr",null,[we,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[12]||(e[12]=t=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[13]||(e[13]=t=>p("transferred_to"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[14]||(e[14]=t=>p("subject"))}," Subject "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[15]||(e[15]=t=>p("profile_id"))}," Requestor "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[16]||(e[16]=t=>p("status"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[17]||(e[17]=t=>p("created_at"))},[q(" D.Requested"),Ie,$e]),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[18]||(e[18]=t=>p("date_closed"))},[q(" D.Closed"),De,Re]),ze])]),l("tbody",null,[(f(!0),M(ge,null,pe(u.value.data,t=>{var h,x,B,U;return f(),M("tr",{key:t.id},[l("td",null,"SN-5"+d(ee(t.id)),1),l("td",null,d((h=t.company)==null?void 0:h.title),1),l("td",null,d((x=t.transfer_to)==null?void 0:x.title),1),l("td",null,d(t.subject),1),l("td",null,d((B=t.profile)==null?void 0:B.display_name),1),l("td",null,[o(me,{class:"text-uppercase",size:"small",color:`${t.status.toLowerCase()=="complete"?"success":"error"}`},{default:r(()=>[q(d(W(t.status)),1)]),_:2},1032,["color"])]),l("td",null,d(g(T)(t.created_at)),1),l("td",null,d(t.date_closed&&t.date_closed!="0000-00-00"?g(T)(t.date_closed):""),1),l("td",null,[l("div",Ne,[o(O,{size:"small",onClick:()=>X(t.id),icon:g(ve),class:"mx-1"},null,8,["onClick","icon"]),g(c).user.role=="superadmin"||(U=g(c).capabilities)!=null&&U.includes("delete")?(f(),b(O,{key:0,size:"small",onClick:()=>Z(t.id),icon:g(fe),class:"mx-1"},null,8,["onClick","icon"])):z("",!0)])])])}),128))])]),_:1}),u.value.data.length==0?(f(),b(ye,{key:0,class:"pa-3 text-center w-100"},{default:r(()=>[q("No records found")]),_:1})):z("",!0)]),_:1},8,["loading"]),I.value>1?(f(),b(he,{key:0,modelValue:i.value,"onUpdate:modelValue":e[19]||(e[19]=t=>i.value=t),class:"my-4",length:I.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:u.value.loading},null,8,["modelValue","length","disabled"])):z("",!0)])]),_:1}),o(Ce,{options:K.value},null,8,["options"])]),_:1}))}};export{Fe as default};
