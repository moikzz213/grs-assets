import{i as ue,r as v,L as ie,u as ne,o as re,M as G,b as i,j as _,k as o,l as a,N as ce,A as N,V as pe,e as d,t as h,c as C,a0 as Y,I as V,G as n,J as B,q as z,D as f,z as O,m as k,O as S,y as A,d as K,E as Q,T as ve,F,ay as me,az as _e,aA as fe,aB as ye,aC as he,C as Ve,K as j}from"./app-edab498a.js";import{_ as ge}from"./ApppageHeader-bc7f800f.js";import{_ as be}from"./AppSnackBar-ba9e6af0.js";import{u as J}from"./formatDate-e2fbee14.js";const Ae={key:1,class:"v-col-8 text-right"},ke={class:"v-col-12 v-col-md-6"},qe={class:"v-col-12 v-col-md-6"},Te={class:"v-col-12 v-col-md-6"},Ce={class:"v-col-12 v-col-md-6"},je={class:"v-col-12"},we={class:"v-col-12"},Ue=d("div",{class:"v-col-12 v-col-md-1"},null,-1),Oe={class:"v-col-12 v-col-md-3"},Se={class:"v-col-12 v-col-md-2"},xe={class:"v-col-12 v-col-md-1"},Ee={class:"v-col-12 v-col-md-1"},De={class:"v-col-12 v-col-md-1"},Re={class:"v-col-12 v-col-md-3 d-flex"},Le=d("div",{class:"v-col-12 font-weight-bold text-uppercase"}," APPROVAL SETUP ",-1),Ne=d("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),Be={class:"v-col-12 v-col-md-6"},ze={class:"v-col-12 v-col-md-2"},Fe={class:"v-col-12 v-col-md-7 d-flex"},Ie={class:"my-auto"},Pe={class:"v-col-12"},Me=d("div",{class:"v-col-12 text-error"}," Administrator needs to setup signatories first. ",-1),$e=d("div",{class:"v-col-12 v-col-md-12 text-info"},[k(" Note: Once submitted and approval is on-going, you will no longer allowed to update the request."),d("br"),k(" Only Asset Supervisor - Projects can update the data specially the asset code. ")],-1),Je={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(H,{emit:W}){const y=H,r=ue(),E=v(!1),q=ie(),X=ne(),s=v({}),b=v(!1),g=v([{qty:1}]),Z=v(new Date),I=t=>{if(t=="approve")return"Approval By";if(t=="reviewer")return"Review By";if(t=="receiver")return"Receiver";if(t=="verify")return"Verify By"},D=v([]),ee=async()=>{let t="request";console.log("props.headertitle",y.headertitle),y.headertitle=="Transfer Assets"&&(t="transfer"),await j(r.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(l=>{D.value=l.data,console.log("requestTypeList.value",D.value)}).catch(l=>{})},x=v({}),P=v([]),te=async()=>{await j(r.token).get("/api/fetch/companies").then(t=>{P.value=t.data}).catch(t=>{})},R=v([]),ae=async()=>{await j(r.token).get("/api/fetch/locations/non-paginated/data").then(t=>{R.value=t.data}).catch(t=>{})},le=()=>{g.value.push({qty:1}),w()},se=(t,l)=>{g.value.splice(l,1),w()},oe=()=>{x.value={status:!0,type:"info",text:"Please wait..."};let t=g.value.map((e,u)=>(delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,e)),l={data:s.value,assets:t,approval:T.value,profile_id:r.user.profile.id,type:"transfer"};j(r.token).post("/api/request-asset/store-update/data",l).then(e=>{let u="",p="";e.data.message?(u=e.data.message,p="success"):e.data.error&&(u=e.data.error,p="error"),x.value={status:!0,type:p,text:u},q.params.id||setTimeout(()=>{X.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(m=>{})},800)}).catch(e=>{console.log(e)})},T=v([]),L=v(!0),M=async()=>{await j(r.token).get("/api/fetch/request-asset/approval-setup-fetch/"+s.value.request_type_id).then(t=>{var l,e;T.value=(l=t.data)==null?void 0:l.stages,q.params.id&&T.value.length>0&&T.value.map((u,p)=>(u.profile_id=U.value[p].profile_id,u.status=U.value[p].status,u.date_approved=U.value[p].date_approved,u.reason_rejected=U.value[p].reason_rejected,u)),((e=t.data)==null?void 0:e.stages.length)>0?L.value=!0:L.value=!1}).catch(t=>{})},w=()=>{let t=!1;E.value=!1,s.value.company_id&&s.value.request_type_id&&s.value.subject&&s.value.transferred_from&&s.value.transferred_to&&(t=!0);let l=!0;g.value.map(u=>{u.item_description||(l=!1)});let e=!0;T.value.map(u=>{u.profile_id||(e=!1)}),e&&l&&t&&(E.value=!0)},$=t=>{let l={status:t,profile_id:r.user.profile.id,ID:c.value.id};j(r.token).post("/api/request-asset/change-request/data",l).then(e=>{x.value={status:!0,type:"success",text:e.data.message},W("saved",e.data.message)}).catch(e=>{})},de=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},U=v([]),c=v({});return re(()=>{if(ee().then(()=>{te().then(()=>{ae()})}),q.params.id){b.value=!0;let t=y.objectdata;c.value=t,s.value.company_id=t.company_id,s.value.request_type_id=t.request_type_id,s.value.subject=t.subject,s.value.transferred_from=t.transferred_from,s.value.transferred_to=t.transferred_to,s.value.id=t.id,s.value.requestor_id=t.profile_id,U.value=t.request_approvals,g.value=t.items,console.log("assetDataObj.value ",g.value),M()}else s.value.company_id=r.user.profile.company_id}),G(s.value,async(t,l)=>{w()}),G(g.value,async(t,l)=>{w()}),(t,l)=>(i(),_(Ve,null,{default:o(()=>[a(ge,{title:y.headertitle},null,8,["title"]),a(f,{class:"mb-3"},{default:o(()=>[a(ce,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:o(()=>[a(N,null,{default:o(()=>[a(pe,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:o(()=>[d("div",null,h(y.headertitle),1),b.value?(i(),C("div",{key:0,class:Y(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+h(c.value.status)+") ",3)):V("",!0),d("div",null,"DATE: "+h(n(J)(Z.value)),1)]),_:1}),a(B),a(z,null,{default:o(()=>[a(f,null,{default:o(()=>[b.value?(i(),C("div",{key:0,class:Y(`${c.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+h(de(c.value.id)),3)):V("",!0),b.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(i(),C("div",Ae,[c.value.status=="pending"?(i(),_(O,{key:0,onClick:l[0]||(l[0]=e=>$("cancelled")),size:"small",color:"warning"},{default:o(()=>[k("Cancel request")]),_:1})):V("",!0),c.value.status=="cancelled"?(i(),_(O,{key:1,onClick:l[1]||(l[1]=e=>$("pending")),size:"small",color:"info"},{default:o(()=>[k("Change status to Pending")]),_:1})):V("",!0)])):V("",!0),d("div",ke,[a(S,{items:D.value,modelValue:s.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>s.value.request_type_id=e),M],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:b.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),d("div",qe,[a(S,{items:P.value,modelValue:s.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),d("div",Te,[a(S,{items:R.value,modelValue:s.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),d("div",Ce,[a(S,{items:R.value,modelValue:s.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),d("div",je,[a(A,{modelValue:s.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(N,{class:"my-2"},{default:o(()=>[a(z,null,{default:o(()=>[a(f,null,{default:o(()=>{var e;return[d("div",we,[!n(q).params.id||((e=y.objectdata)==null?void 0:e.status)=="pending"||n(r).user.profile.role=="superadmin"||n(r).user.profile.role=="administrator"?(i(),_(O,{key:0,size:"small",color:"primary",onClick:le},{default:o(()=>[k("Add")]),_:1})):V("",!0)])]}),_:1}),(i(!0),C(F,null,K(g.value,(e,u)=>(i(),_(f,{key:u},{default:o(()=>{var p;return[Ue,d("div",Oe,[a(A,{modelValue:e.item_description,"onUpdate:modelValue":m=>e.item_description=m,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Se,[a(A,{modelValue:e.asset_code,"onUpdate:modelValue":m=>e.asset_code=m,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",xe,[a(A,{type:"number",modelValue:e.qty,"onUpdate:modelValue":m=>e.qty=m,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Ee,[a(A,{type:"number",modelValue:e.weight,"onUpdate:modelValue":m=>e.weight=m,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",De,[a(A,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":m=>e.item_value=m,variant:"outlined",density:"compact","hide-details":"",label:"ITEM VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Re,[a(A,{modelValue:e.reason_for_request,"onUpdate:modelValue":m=>e.reason_for_request=m,variant:"outlined",density:"compact","hide-details":"",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!b.value||b.value&&n(r).user.profile.id==y.objectdata.profile_id&&((p=y.objectdata)==null?void 0:p.status)=="pending"?(i(),_(Q,{key:0,size:"small",onClick:()=>se(e.id,u),icon:n(ve),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):V("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(N,{class:"my-2"},{default:o(()=>[a(z,null,{default:o(()=>[a(f,null,{default:o(()=>[Le,a(B)]),_:1}),a(f,null,{default:o(()=>{var e,u;return[Ne,d("div",Be,h((u=(e=c.value)==null?void 0:e.profile)==null?void 0:u.display_name),1)]}),_:1}),L.value?(i(),C(F,{key:0},[(i(!0),C(F,null,K(T.value,(e,u)=>(i(),_(f,{key:e.id},{default:o(()=>[d("div",ze,h(e.types?I(e.types):I(e.approval_type)),1),d("div",Fe,[a(S,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[p=>e.profile_id=p,w],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(O,{variant:"text",size:"x-small"},{default:o(()=>[e.status?(i(),_(Q,{key:0,class:"mx-2 my-auto",icon:e.status=="awaiting-approval"?n(me):e.status=="pending"?n(_e):e.status=="reject"?n(fe):n(ye),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):V("",!0),a(he,{activator:"parent",location:"top","max-width":"400"},{default:o(()=>[k(h(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),d("div",Ie,h(e.date_approved?n(J)(e.date_approved):""),1)]),_:2},1024))),128)),a(f,null,{default:o(()=>{var e;return[a(B),d("div",Pe,[(!n(q).params.id||((e=y.objectdata)==null?void 0:e.status)=="pending"||n(r).user.profile.role=="asset-supervisor"||n(r).user.profile.role=="superadmin"||n(r).user.profile.role=="administrator")&&c.value.status!="complete"?(i(),_(O,{key:0,size:"small",disabled:!E.value,onClick:oe,color:"primary"},{default:o(()=>[k(h(n(q).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):V("",!0)])]}),_:1})],64)):(i(),_(f,{key:1},{default:o(()=>[Me]),_:1})),a(f,null,{default:o(()=>[$e]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(be,{options:x.value},null,8,["options"])]),_:1}))}};export{Je as _};
