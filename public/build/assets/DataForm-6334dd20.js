import{e as oe,d as p,R as we,K as de,J as Q,o as u,c as L,b as s,f as y,w as a,g as t,z as V,C as j,F as ee,y as te,m as $,E as c,S as je,q as U,T as ve,U as _e,W as Se,X as Ce,P as De,h as m,x as A,i as F,t as h,L as le,Y as fe,H as se,I as xe,u as Ie,V as $e,Z,_ as H,l as me,D as Ae,G as Re,A as S,$ as Te,a0 as Ue,v as Le,p as Ne,a as Ee}from"./app-96caf3da.js";import{_ as Fe}from"./AppPageHeader-dbda4c03.js";import{_ as Oe}from"./AppSnackBar-bd4002fc.js";import{c as Ye,a as G,F as Be,b as K}from"./index.esm-6cebadde.js";import{S as Me}from"./StreamBarcodeReader-47979b1f.js";import{_ as Pe}from"./_plugin-vue_export-helper-c27b6911.js";import{u as J,a as We}from"./formatDate-b9aad8c5.js";import{u as qe}from"./status-84c68e1a.js";import{_ as ze}from"./Studio-dc2380a2.js";import{d as pe}from"./dayjs.min-8c72eb67.js";const He={class:"v-col-12 pt-5"},Ge={class:"v-col-12 pb-2"},Ke={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Je={class:"v-col-12 pt-0 pb-2"},Xe={class:"v-col-12"},Ze={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(C,{emit:P}){const o=C,v=oe(),e=p(window.location.origin),R=d=>{let g=null;d.map(_=>{g=b.value.find(E=>E.id==_.id),g||b.value.push(_)})},D=p(!1),N=p(1),Y=d=>{N.value=d,D.value=!0},B=d=>{b.value=b.value.filter(g=>g.id!==d)},b=p([]),M=we(()=>b.value.map(d=>d.id)),n=()=>{let d={id:parseInt(o.incidentId),file_ids:M.value,profile_id:o.objectdata.profile_id};A(v.token).post("/api/incident/sync-images/store-update",d).then(g=>{let _="Attachment has been updated";M.value.length==0&&(_="Attachment has been deleted"),P("save",_)}).catch(g=>{})},f=p(v.user.profile.id);return de(()=>{b.value=o.attachment}),Q(()=>o.objectdata.attachment,(d,g)=>{b.value=d},{deep:!0}),(d,g)=>(u(),L("div",null,[s("div",He,[o.objectdata.profile_id==f.value?(u(),y(V,{key:0},{default:a(()=>[s("div",Ge,[t(ze,{options:{multiSelect:!0,type:"incident"},onSelect:R})])]),_:1})):j("",!0),b.value.length>0?(u(),y(V,{key:1,class:"px-1"},{default:a(()=>[(u(!0),L(ee,null,te(b.value,(_,E)=>(u(),L("div",{key:_.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[o.objectdata.profile_id==f.value?(u(),y($,{key:0,style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:c(je),size:"26px",color:"error",onClick:()=>B(_.id)},null,8,["icon","onClick"])):j("",!0),t(U,{onClick:()=>Y(E)},{default:a(()=>[t(ve,{src:e.value+"/file/"+_.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(_e,{modelValue:D.value,"onUpdate:modelValue":g[1]||(g[1]=_=>D.value=_),width:"95%","max-width":"900"},{default:a(()=>[t(U,{class:"bg-black"},{default:a(()=>[t(Se,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:N.value,"onUpdate:modelValue":g[0]||(g[0]=_=>N.value=_)},{default:a(()=>[(u(!0),L(ee,null,te(b.value,(_,E)=>(u(),y(Ce,{key:E,"reverse-transition":"fade",transition:"fade"},{default:a(()=>[s("div",Ke,[t(ve,{src:e.value+"/file/"+_.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(u(),y(V,{key:2},{default:a(()=>[s("div",Je,[t(De,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:a(()=>[m(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),o.objectdata.profile_id==f.value?(u(),y(V,{key:3},{default:a(()=>[s("div",Xe,[t($,{color:"primary",onClick:n},{default:a(()=>[m("Save")]),_:1})])]),_:1})):j("",!0)])]))}},Qe={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},et={class:"font-weight-bold"},tt={class:"reported-by"},at={class:"reported-by"},lt={class:"v-col-12"},st={class:"v-col-12 v-col-md-4 pb-0"},ot={class:"v-col-12 v-col-md-8"},dt={class:"v-col-12"},it={class:"v-col-12"},nt={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},ut={class:"v-col-12 d-flex justify-space-between"},ct={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(C,{emit:P}){const o=C,v=oe(),e=p({}),R=p([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),D=p([]),N=async()=>{await A(v.token).get("/api/fetch/profile-facility/team").then(n=>{D.value=n.data}).catch(n=>{})},Y=()=>{e.value.profile_id=v.user.profile.id,A(v.token).post("/api/incident/update-facility-team",e.value).then(n=>{e.value.remarks_data="",P("saved",n.data.message)}).catch(n=>{})},B=p([]),b=async()=>{await A(v.token).get("/api/fetch-global/incident-status/active").then(n=>{B.value=n.data}).catch(n=>{})},M=(n,f=6)=>{let d="00000"+n;return d.substring(d.length-f)};return de(()=>{N(),b(),e.value=o.objectdata,e.value.prev_handled_by=o.objectdata.handled_by,e.value.priority=o.objectdata.priority?parseInt(o.objectdata.priority):null}),Q(()=>o.objectdata.remarks,(n,f)=>{e.value.remarks=n},{deep:!0}),(n,f)=>(u(),L("div",null,[t(U,null,{default:a(()=>[t(F,null,{default:a(()=>[t(V,null,{default:a(()=>{var d;return[s("div",Qe,[s("div",et," SN: ISR-"+h(M(e.value.id)),1),s("div",tt," REPORTED BY: "+h((d=e.value.profile)==null?void 0:d.display_name),1),s("div",at," DATE REPORTED: "+h(c(J)(e.value.created_at)),1)])]}),_:1}),t(V,null,{default:a(()=>[s("div",lt,[t(V,null,{default:a(()=>[s("div",st,[t(le,{items:R.value,modelValue:e.value.priority,"onUpdate:modelValue":f[0]||(f[0]=d=>e.value.priority=d),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*"},null,8,["items","modelValue"]),t(le,{items:D.value,modelValue:e.value.handled_by,"onUpdate:modelValue":f[1]||(f[1]=d=>e.value.handled_by=d),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue"]),t(le,{items:B.value,modelValue:e.value.status_id,"onUpdate:modelValue":f[2]||(f[2]=d=>e.value.status_id=d),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",ot,[t(fe,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:e.value.remarks_data,"onUpdate:modelValue":f[3]||(f[3]=d=>e.value.remarks_data=d)},null,8,["modelValue"])])]),_:1})]),t(se,{class:"mt-3"}),s("div",dt,[t($,{class:"",size:"small",disabled:!e.value.priority||!e.value.handled_by||!e.value.status_id,onClick:Y,color:"primary"},{default:a(()=>[m("Submit")]),_:1},8,["disabled"])])]),_:1}),t(V,null,{default:a(()=>[s("div",it,[m(" Remarks "),t(se)]),s("div",nt,[(u(!0),L(ee,null,te(e.value.remarks,d=>(u(),y(V,{key:n.id},{default:a(()=>{var g;return[s("div",ut,[s("div",null,[s("pre",null,h(d.remarks),1)]),s("div",null,[m(h((g=d.profile)==null?void 0:g.display_name)+" - ",1),s("small",null,h(c(We)(d.created_at)),1)])]),t(se)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const O=C=>(Ne("data-v-245b838e"),C=C(),Ee(),C),rt={class:"v-col py-0"},vt={class:"v-col py-0"},mt={class:"v-col-12 v-col-md-4"},pt=O(()=>s("div",{class:"font-weight-bold"},"SN:",-1)),_t={class:"v-col-12 v-col-md-4"},ft=O(()=>s("div",{class:"font-weight-bold"},"Reported by:",-1)),yt={class:"v-col-12 v-col-md-4"},ht=O(()=>s("div",{class:"font-weight-bold"},"Status",-1)),bt={class:"v-col-12 v-col-md-4"},gt=O(()=>s("div",{class:"font-weight-bold"},"Date Reported",-1)),Vt={class:"v-col-12 v-col-md-4"},kt=O(()=>s("div",{class:"font-weight-bold"},"Date Closed",-1)),wt={class:"v-col-12 v-col-md-4"},jt={class:"v-col-12 v-col-md-4"},St={class:"v-col-12 v-col-md-4 d-flex"},Ct={class:"v-col-12"},Dt={class:"v-col-12 v-col-md-6"},xt={class:"v-col-12 v-col-md-6"},It={class:"v-col-12"},$t={class:"v-col-12"},At={key:1},Rt=O(()=>s("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),Tt={class:"v-col-12 v-col-md-12"},Ut=O(()=>s("h5",{class:"headline mb-0 text-center"},[m(" NO WARRANTY FOUND. "),s("br"),m("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),Lt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(C,{emit:P}){const o=C,v=oe(),e=p({}),R=p({}),D=i=>{R.value={status:!0,type:"success",text:i},P("saved")},N=p(v.user.profile.id),Y=p([]),B=async()=>{await A(v.token).get("/api/fetch-global/incident-types/active").then(i=>{Y.value=i.data}).catch(i=>{})},b=xe(),M=Ie(),n=p(b.query.type),f=qe(),d=p([]);d.value=Object.assign([],f.urgencies_active_list),f.list.length==0&&f.getStatuses(v.token).then(()=>{d.value=Object.assign([],f.urgencies_active_list)});let g=Ye({Type:G().required(),Urgency:G().required(),Title:G().required(),Company:G().required(),Location:G().required()});const _=p(!1),E=()=>{ae.value=!1,_.value=!0},ye=async i=>{e.value.asset_code=i,await A(v.token).get("/api/fetch/asset-info/by/asset-code/"+i).then(l=>{e.value.title=l.data.asset_name,e.value.company_id=l.data.company_id,e.value.location_id=l.data.location_id,e.value.asset_id=l.data.id,_.value=!1}).catch(l=>{})},ae=p(!1),he=()=>{ae.value=!0},ie=new URL(window.location),X=i=>{n.value=i,ne("type",i)},W=p(!1),q=p(v.user.profile.role),be=async()=>{W.value=!0,R.value={status:!0,type:"info",text:"Please wait..."},e.value.profile_id=v.user.profile.id,await A(v.token).post("/api/store-update/incident",e.value).then(i=>{R.value={status:!0,type:"success",text:i.data.message},b.params.id?W.value=!1:setTimeout(()=>{M.push({name:"EditIncident",params:{id:i.data.id},query:{type:"details"}}).catch(l=>{}),W.value=!1},800)}).catch(i=>{console.log("save incident error: ",i),W.value=!1})},w=p(!1),ne=(i,l)=>{ie.searchParams.set(i,l),window.history.pushState({},"",ie)},ue=p([]),ge=async()=>{await A(v.token).get("/api/fetch/companies").then(i=>{ue.value=i.data}).catch(i=>{})},ce=p([]),Ve=async()=>{await A(v.token).get("/api/fetch/locations/non-paginated/data").then(i=>{ce.value=i.data}).catch(i=>{})},ke=(i,l=5)=>{let k="0000"+i;return k.substring(k.length-l)};return de(()=>{b.params.id&&(w.value=!0),n.value||(n.value="details",ne("type","details")),B().then(()=>{ge().then(()=>{Ve()})}),w.value&&(e.value=o.objectdata,e.value.asset_code=o.objectdata.asset?o.objectdata.asset.asset_code:o.objectdata.asset_code,e.value.title=o.objectdata.asset?o.objectdata.asset.asset_name:o.objectdata.title,e.value.company_id=o.objectdata.company_id,e.value.location_id=o.objectdata.location_id,e.value.asset_id=o.objectdata.asset_id,e.value.profile_id=o.objectdata.profile_id,e.value.type_id=parseInt(o.objectdata.type_id),e.value.urgency=parseInt(o.objectdata.urgency),e.value.description=o.objectdata.description)}),Q(()=>o.objectdata.remarks,(i,l)=>{e.value=o.objectdata},{deep:!0}),Q(()=>o.objectdata.attachment,(i,l)=>{e.value=o.objectdata,e.value.attachment=i},{deep:!0}),(i,l)=>(u(),y(Le,null,{default:a(()=>[t(Fe,{title:"Incident detail page"}),t(V,{class:"mt-5"},{default:a(()=>[s("div",rt,[t($,{onClick:l[0]||(l[0]=k=>X("details")),class:"mr-3 mb-3",color:`${n.value=="details"?"primary":"white"}`},{default:a(()=>[m("Details")]),_:1},8,["color"]),w.value?(u(),y($,{key:0,class:"mr-3 mb-3",color:`${n.value=="attachment"?"primary":"white"}`,onClick:l[1]||(l[1]=k=>X("attachment"))},{default:a(()=>[m("Attachments")]),_:1},8,["color"])):j("",!0),w.value&&(c(v).user.profile.role=="facility"||c(v).user.profile.role=="admin"||c(v).user.profile.role=="superadmin"||c(v).user.profile.role=="technical-operation")?(u(),y($,{key:1,class:"mr-3 mb-3",color:`${n.value=="warranty"?"primary":"white"}`,onClick:l[2]||(l[2]=k=>X("warranty"))},{default:a(()=>[m("Warranty")]),_:1},8,["color"])):j("",!0),w.value&&(c(v).user.profile.role=="facility"||c(v).user.profile.role=="admin"||c(v).user.profile.role=="superadmin"||c(v).user.profile.role=="technical-operation")?(u(),y($,{key:2,class:"mr-3 mb-3",color:`${n.value=="facility"?"primary":"white"}`,onClick:l[3]||(l[3]=k=>X("facility"))},{default:a(()=>[m("Facility Team")]),_:1},8,["color"])):j("",!0)])]),_:1}),t(V,{class:"mb-10"},{default:a(()=>{var k,re;return[s("div",vt,[n.value=="details"?(u(),y(U,{key:0},{default:a(()=>[t(c(Be),{as:"v-form","validation-schema":c(g)},{default:a(({meta:T})=>[t($e,{class:"text-capitalize my-1"},{default:a(()=>[m(h(o.headertitle),1)]),_:1}),t(F,null,{default:a(()=>[w.value?(u(),y(V,{key:0,class:"bg-background-darken-1 ma-0 rounded"},{default:a(()=>{var z,r;return[s("div",mt,[pt,s("div",null,"ISR-2"+h(ke(e.value.id)),1)]),s("div",_t,[ft,s("div",null,h((z=e.value.profile)==null?void 0:z.display_name),1)]),s("div",yt,[ht,s("div",null,h((r=e.value.status)==null?void 0:r.title),1)]),s("div",bt,[gt,s("div",null,h(e.value.created_at?c(pe)(e.value.created_at).format("MMM. DD, YYYY"):"-"),1)]),s("div",Vt,[kt,s("div",null,h(e.value.date_closed?c(pe)(e.value.date_closed).format("MMM. DD, YYYY"):"-"),1)])]}),_:1})):j("",!0),t(V,null,{default:a(()=>{var z;return[s("div",wt,[t(c(K),{name:"Type",modelValue:e.value.type_id,"onUpdate:modelValue":l[5]||(l[5]=r=>e.value.type_id=r)},{default:a(({field:r,errors:x})=>[t(Z,H({items:Y.value,modelValue:e.value.type_id,"onUpdate:modelValue":l[4]||(l[4]=I=>e.value.type_id=I),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},r,{"error-messages":x}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",jt,[t(c(K),{name:"Urgency",modelValue:e.value.urgency_id,"onUpdate:modelValue":l[7]||(l[7]=r=>e.value.urgency_id=r)},{default:a(({field:r,errors:x})=>[t(Z,H({items:d.value,modelValue:e.value.urgency_id,"onUpdate:modelValue":l[6]||(l[6]=I=>e.value.urgency_id=I),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},r,{"error-messages":x}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",St,[t(me,{modelValue:e.value.asset_code,"onUpdate:modelValue":l[8]||(l[8]=r=>e.value.asset_code=r),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),t(Ae,{onClick:E,class:"ml-2 my-auto",size:"large",icon:c(Re)},null,8,["icon"])]),s("div",Ct,[t(c(K),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":l[10]||(l[10]=r=>e.value.title=r)},{default:a(({field:r,errors:x})=>[t(me,H({modelValue:e.value.title,"onUpdate:modelValue":l[9]||(l[9]=I=>e.value.title=I),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},r,{"error-messages":x}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Dt,[t(c(K),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":l[12]||(l[12]=r=>e.value.company_id=r)},{default:a(({field:r,errors:x})=>[t(Z,H({items:ue.value,modelValue:e.value.company_id,"onUpdate:modelValue":l[11]||(l[11]=I=>e.value.company_id=I),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},r,{"error-messages":x}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",xt,[t(c(K),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":l[14]||(l[14]=r=>e.value.location_id=r)},{default:a(({field:r,errors:x})=>[t(Z,H({items:ce.value,modelValue:e.value.location_id,"onUpdate:modelValue":l[13]||(l[13]=I=>e.value.location_id=I),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},r,{"error-messages":x}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",It,[t(fe,{rows:"3",variant:"outlined",density:"compact",label:"Incident Description","hide-details":"auto",modelValue:e.value.description,"onUpdate:modelValue":l[15]||(l[15]=r=>e.value.description=r)},null,8,["modelValue"])]),s("div",$t,[((z=e.value)==null?void 0:z.status_id)!=8&&(!w.value||w.value&&(o.objectdata.profile_id==N.value||q.value=="asset-supervisor"))?(u(),y($,{key:0,color:"primary",onClick:be,disabled:!T.valid,loading:W.value},{default:a(()=>[m(h(w.value?"update":"submit"),1)]),_:2},1032,["disabled","loading"])):j("",!0)])]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):j("",!0),n.value=="warranty"?(u(),L("div",At,[t(U,null,{default:a(()=>[t(F,null,{default:a(()=>[Rt]),_:1})]),_:1}),((re=(k=e.value.asset)==null?void 0:k.pivot_warranties)==null?void 0:re.length)>0?(u(),y(V,{key:0},{default:a(()=>[s("div",Tt,[(u(!0),L(ee,null,te(e.value.asset.pivot_warranties,T=>(u(),y(U,{class:"my-3 px-5",key:T.id},{default:a(()=>[t(F,null,{default:a(()=>[t(V,null,{default:a(()=>[t(S,{cols:"4"},{default:a(()=>[m("Vendor")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(T.vendor.title),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("Warranty Start Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(c(J)(T.warranty_start_date)),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("Warranty End Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(c(J)(T.warranty_end_date)),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("AMC Start Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(c(J)(T.amc_start_date)),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("AMC End Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(c(J)(T.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(u(),y(U,{key:1,class:"mt-2"},{default:a(()=>[t(F,null,{default:a(()=>[Ut]),_:1})]),_:1}))])):w.value&&n.value=="attachment"?(u(),y(Ze,{key:2,"incident-id":parseInt(c(b).params.id),attachment:e.value.attachment,onSave:D,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(q.value=="superadmin"||q.value=="admin"||q.value=="technical-operation"||q.value=="facility")&&w.value&&n.value=="facility"?(u(),y(ct,{key:3,objectdata:e.value,onSaved:D},null,8,["objectdata"])):j("",!0)])]}),_:1}),t(Oe,{options:R.value},null,8,["options"]),t(_e,{width:"500",modelValue:_.value,"onUpdate:modelValue":l[17]||(l[17]=k=>_.value=k)},{default:a(()=>[t(U,null,{default:a(()=>[t(F,null,{default:a(()=>[t(c(Me),{onDecode:ye,onLoaded:he})]),_:1}),ae.value?j("",!0):(u(),y(F,{key:0},{default:a(()=>[m("Please wait...")]),_:1})),t(Te,null,{default:a(()=>[t(Ue),t($,{text:"Close",onClick:l[16]||(l[16]=k=>_.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},zt=Pe(Lt,[["__scopeId","data-v-245b838e"]]);export{zt as D};
