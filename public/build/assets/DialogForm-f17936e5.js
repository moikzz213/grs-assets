import{i as ne,r as i,W as re,O as K,aW as ie,b as r,c as p,l as a,k as o,A as q,E as _,e as f,aq as ce,K as g,V as ve,m as V,t as S,a4 as z,q as B,F as A,d as j,j as D,y as me,a2 as J,x as X,I as k,P as Y,M as pe,z as O,G as fe,J as he,S as ye,X as _e,Y as Z,Z as H,_ as be,$ as ge,D as T}from"./app-4c5f7781.js";import{a as Ve,c as ke,F as we,b as xe}from"./index.esm-05fa7bf7.js";import{_ as Ce}from"./Studio-4014835b.js";const Fe={class:"text-error"},Se={class:"d-flex pa-3"},Ae={key:0,class:"v-col-4",style:{"border-left":"1px solid #ccc","border-right":"1px solid #ccc"}},je=f("h5",null,"LINK ASSET",-1),De={key:1,class:"v-col-4 text-center",style:{"border-left":"1px solid #ccc","background-color":"#e0e0e0"}},Oe={class:"d-flex mb-5 justify-center"},Ue={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ne=f("div",{class:"mb-5",style:{position:"absolute",bottom:"0"}}," Note: Dont forget to click the save button at the top ",-1),qe={__name:"DialogForm",props:{dataObject:{type:Object,default:{}},addNewDialog:{type:Boolean,default:!1},title:{type:String,default:""},freeForm:{type:Array,default:[]}},emits:["savedResponse","fileSave","save"],setup(Q,{emit:U}){const m=Q,w=ne(),N=i(""),c=i([]),ee=e=>{let t=null;e.map(d=>{t=c.value.find(u=>u.id==d.id),t||c.value.push(d)})},R=i([]),x=i(""),I=i(!1),$=i(1),ae=e=>{$.value=e,I.value=!0},te=e=>{c.value=c.value.filter(t=>t.id!==e)},W=re(()=>c.value.map(e=>e.id)),le=()=>{let e={id:parseInt(G.value),file_ids:W.value,profile_id:w.user.profile.id};T(w.token).post("/api/warranty/sync-images/store-update",e).then(t=>{let d="Attachment has been updated";W.value.length==0&&(d="Attachment has been deleted"),U("fileSave",d)}).catch(t=>{})},se=e=>{let t=s.value.display_assets,d=s.value.assets;t.splice(e,1),s.value.display_assets=[...t],d.splice(e,1),console.log("index",e),s.value.assets=[...d],console.log("dataObj.value",s.value)},h=i(!1),s=i({}),C=i(m.freeForm);K(()=>m.freeForm,e=>{C.value=[...e],console.log("props.freeForm",m.freeForm),console.log("freeForm.value",C.value)});const E=()=>{h.value=!1,s.value={},U("cancelled",h.value)},L=()=>{h.value=!1,U("save",s.value),s.value={}},M=i({});C.value.map((e,t)=>{e.required&&(M.value[e.name]=Ve().required())});let oe=ke(M.value);const y=i(!1),ue=e=>{c.value=[],e&&T(w.token).post("/api/fetch/warranty/by/id/"+e).then(t=>{var d,u,l,n,v;((l=(u=(d=t==null?void 0:t.data)==null?void 0:d.data)==null?void 0:u.pivot_assets)==null?void 0:l.length)>0&&t.data.data.pivot_assets.map((b,F)=>{s.value.assets.push(b.id),s.value.display_assets.push(b)}),c.value=(v=(n=t.data)==null?void 0:n.data)==null?void 0:v.attachment}).catch(t=>{})},P=i(window.location.origin),G=i(0);K(()=>m.addNewDialog,e=>{y.value=!1,s.value={},h.value=e,N.value="New "+m.title,m.dataObject.type&&(s.value=m.dataObject,N.value="Edit "+m.title),m.title=="Warranty"&&(s.value.assets=[],s.value.display_assets=[],s.value.pivot_assets=[],ue(s.value.id),G.value=s.value.id,y.value=!0)});const de=e=>{e.length<4||T(w.token).get("/api/search-assets/warranty/"+e).then(t=>{let d=[];t.data&&t.data.length>0&&t.data.map((u,l)=>{d[l]=u,d[l].new_title=u.asset_name+" ("+u.asset_code+")"}),R.value=d}).catch(t=>{})};return K(()=>x.value,e=>{e&&(s.value.assets.includes(e.id)||(s.value.assets.push(e.id),s.value.display_assets.push(e)),x.value=""),console.log("dataObj.value",e)}),(e,t)=>{const d=ie("v-card-action");return r(),p("div",null,[a(H,{width:y.value?1200:600,persistent:"",modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=u=>h.value=u),onKeydown:X(E,["esc"]),class:"d-flex",style:{overflow:"auto"}},{default:o(()=>[a(q,{class:"py-3"},{default:o(()=>[a(_,null,{default:o(()=>[f("div",{class:ce(`${y.value?"v-col-4":"v-col-12"}`)},[a(g(we),{as:"v-form","validation-schema":g(oe)},{default:o(({meta:u})=>[a(ve,{class:"text-h6 d-flex"},{default:o(()=>[V(S(N.value),1),a(z),f("small",Fe,S(e.errorMessage),1),a(z)]),_:1}),a(B,null,{default:o(()=>[a(_,null,{default:o(()=>[(r(!0),p(A,null,j(C.value,(l,n)=>(r(),p("div",{class:"v-col-12",key:n},[a(g(xe),{name:l.name,modelValue:s.value[l.name],"onUpdate:modelValue":v=>s.value[l.name]=v},{default:o(({field:v,errors:b})=>[l.type=="text"||l.type=="number"||l.type=="date"||l.type=="email"?(r(),D(me,J({key:0,type:l.type,autofocus:n===0,modelValue:s.value[l.name],"onUpdate:modelValue":F=>s.value[l.name]=F,density:"compact",variant:"outlined",label:`${l.label}${l.required?"*":" (Optional)"}`,"hide-details":""},v,{onKeydown:X(L,["enter"]),"error-messages":b}),null,16,["type","autofocus","modelValue","onUpdate:modelValue","label","onKeydown","error-messages"])):k("",!0),l.type=="select"?(r(),D(Y,J({key:1,autofocus:n===0,modelValue:s.value[l.name],"onUpdate:modelValue":F=>s.value[l.name]=F,density:"compact",variant:"outlined",label:`${l.label}${l.required?"*":""}`,items:l.data,"hide-details":"","item-value":"id","item-title":"title"},v,{"error-messages":b}),null,16,["autofocus","modelValue","onUpdate:modelValue","label","items","error-messages"])):k("",!0)]),_:2},1032,["name","modelValue","onUpdate:modelValue"])]))),128))]),_:1})]),_:1}),a(pe,{class:"mt-2"}),f("div",Se,[a(z),a(O,{size:"small",text:"cancel",onClick:E,class:"mx-1"}),a(O,{size:"small",color:"primary",onClick:L,disabled:!u.valid},{default:o(()=>[V("Save")]),_:2},1032,["disabled"])])]),_:1},8,["validation-schema"])],2),y.value?(r(),p("div",Ae,[a(B,null,{default:o(()=>[je,a(_,{class:"mt-1"},{default:o(()=>[a(fe,null,{default:o(()=>[a(Y,{density:"compact",label:"Search asset name or code",variant:"outlined",items:R.value,"onUpdate:search":de,"item-value":"id","item-title":"new_title",modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=u=>x.value=u),"hide-details":"",clearable:"","return-object":""},null,8,["items","modelValue"])]),_:1})]),_:1}),a(_,{style:{"max-height":"460px",overflow:"auto"}},{default:o(()=>[(r(!0),p(A,null,j(s.value.display_assets,(u,l)=>(r(),p("div",{class:"v-col-12 v-col-md-12 text-caption py-1",key:l},[V(" - "+S(u.asset_name)+" ",1),f("b",null,"("+S(u.asset_code)+")",1),a(he,{onClick:n=>se(l),class:"ml-2 cursor-pointer",color:"error",icon:g(ye)},null,8,["onClick","icon"])]))),128))]),_:1})]),_:1}),a(d,{class:"mb-5",style:{position:"absolute",bottom:"0"}},{default:o(()=>[V(" Note: Dont forget to click the save button ")]),_:1})])):k("",!0),y.value&&m.dataObject.type?(r(),p("div",De,[a(B,null,{default:o(()=>{var u,l;return[f("div",Oe,[a(Ce,{options:{multiSelect:!0,type:"warranty"},onSelect:ee}),a(O,{color:"primary",onClick:le,disabled:((u=c.value)==null?void 0:u.length)==0},{default:o(()=>[V("Save Images")]),_:1},8,["disabled"])]),((l=c.value)==null?void 0:l.length)>0?(r(),D(_,{key:0,class:"px-1"},{default:o(()=>[(r(!0),p(A,null,j(c.value,(n,v)=>(r(),p("div",{key:n.id,class:"v-col-12 v-col-md-4 pa-2",style:{position:"relative"}},[a(O,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:g(_e),size:"20px",color:"error",onClick:()=>te(n.id)},null,8,["icon","onClick"]),a(q,{onClick:()=>ae(v)},{default:o(()=>[a(Z,{src:P.value+"/file/"+n.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),a(H,{modelValue:I.value,"onUpdate:modelValue":t[2]||(t[2]=n=>I.value=n),width:"95%","max-width":"900"},{default:o(()=>[a(q,{class:"bg-black"},{default:o(()=>[a(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=n=>$.value=n)},{default:o(()=>[(r(!0),p(A,null,j(c.value,(n,v)=>(r(),D(ge,{key:v,"reverse-transition":"fade",transition:"fade"},{default:o(()=>[f("div",Ue,[a(Z,{src:P.value+"/file/"+n.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):k("",!0),a(_,null,{default:o(()=>[Ne]),_:1})]}),_:1})])):k("",!0)]),_:1})]),_:1})]),_:1},8,["width","modelValue","onKeydown"])])}}};export{qe as _};
