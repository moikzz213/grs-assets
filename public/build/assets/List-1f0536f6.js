import{r as o,d as se,u as oe,G as ie,H as ne,I as re,e as I,w as m,q as ue,s as $,o as g,f as i,b as a,m as de,V as ce,k as me,j as pe,x as O,J as b,z as ve,g as q,c as E,v as fe,ad as ge,A as v,t as u,K as ye,C as Y,L as xe,l as he,af as Ce,B as j,F as Se,M as Ve,N as _e}from"./app-188d3cc9.js";import{_ as be}from"./AppPageHeader-5f706d9c.js";import{d as y,e as x}from"./encrypt-36df0bd2.js";import{_ as qe}from"./AppSnackBar-8afa082f.js";import{u as J}from"./formatDate-559e9d83.js";const ke={class:"v-col-12"},we=a("div",{class:"mr-auto"},"Asset Requests",-1),Ie={class:"v-col-12 v-col-md"},$e={class:"v-col-12 v-col-md"},ze={class:"v-col-12 v-col-md"},De={class:"v-col-12 v-col-md-2"},Ne={class:"v-col-12 v-col-md-2"},Re=a("th",{class:"text-left text-capitalize"},"SN No.",-1),Le=a("br",null,null,-1),Ae=a("small",null,"PENDING",-1),je=a("br",null,null,-1),Be=a("small",null,"(DD/MM/YY)",-1),Pe=a("br",null,null,-1),Fe=a("small",null,"(DD/MM/YY)",-1),Te=a("th",{class:"text-right text-capitalize last-child-action"},null,-1),Ue={class:"last-child-action"},Me={class:"d-flex align-center justify-end"},He={__name:"List",setup(Ke){const z=o({status:!1,type:"primary",text:null}),d=se(),B=oe(),D=ie(),r=o({loading:!1,data:[]}),N=o(0),G=o(0),f=o(""),H=o([10,20,50,100]),h=o(10),s=o({}),Q=()=>{localStorage.setItem("request-filter-row",x(h.value)),p()},k=l=>{R.value="",n.value==1?(l=="company"?localStorage.setItem("request-filter-company",x(s.value.company_id)):l=="location"?localStorage.setItem("request-filter-location",x(s.value.location_id)):l=="from"?localStorage.setItem("request-filter-from",x(s.value.from)):l=="status"&&localStorage.setItem("request-filter-status",x(s.value.status)),p()):n.value=1},P=()=>{localStorage.setItem("request-asset-search",x(f.value)),p()},C=l=>{l=="search"?(f.value="",localStorage.setItem("request-asset-search",""),p()):l=="company"?localStorage.setItem("request-filter-company",""):l=="location"?localStorage.setItem("request-filter-location",""):l=="from"?localStorage.setItem("request-filter-from",""):l=="status"&&localStorage.setItem("request-filter-status","")},n=o(D.params&&D.params.page?D.params.page:1),w=o([]),R=o(""),F=o(0),c=l=>{r.value.loading=!0,w.value[0]=l,F.value%2?w.value[1]="DESC":w.value[1]="ASC",F.value++,R.value=JSON.stringify(w.value),p()},T=o([]),W=async()=>{await $(d.token).get("/api/fetch/companies").then(l=>{T.value=l.data}).catch(l=>{})},L=o([]),X=async()=>{await $(d.token).get("/api/fetch/locations/non-paginated/data").then(l=>{L.value=l.data}).catch(l=>{})},Z=o([{id:"pending",title:"Pending"},{id:"awaiting-approval",title:"Awaiting Approval"},{id:"reject",title:"Rejected"},{id:"cancelled",title:"Cancelled"},{id:"complete",title:"Completed"}]),ee=l=>l=="reject"?"Rejected":l=="complete"?"Completed":l,p=async()=>{r.value.loading=!0,await $(d.token).get("/api/fetch/request-assets/by-requestor/request?userid="+d.user.profile.id+"&role="+d.user.profile.role+"&page="+n.value+"&show="+h.value+"&search="+f.value+"&sort="+R.value+"&filter="+JSON.stringify(s.value)).then(l=>{N.value=l.data.last_page?l.data.last_page:l.data.length,n.value=l.data.current_page?l.data.current_page:n.value,G.value=l.data.total?l.data.total:l.data.length,r.value.data=l.data.data?l.data.data:l.data,r.value.loading=!1}).catch(l=>{r.value.loading=!1,localStorage.setItem("request-filter-company",null),localStorage.setItem("request-filter-location",null),localStorage.setItem("request-filter-from",null),localStorage.setItem("request-filter-status",null),localStorage.setItem("request-filter-row",10)})};ne(n,(l,e)=>{n.value&&l!=e&&(B.push({name:"PaginatedRequestAsset",params:{page:n.value}}).catch(t=>{}),p(n.value))});const te=l=>{B.push({name:"EditRequestAsset",params:{id:l}}).catch(e=>{console.log(e)})},A=o(!1),le=async l=>{z.value={status:!0,type:"info",text:"Removing data...Please wait."},A.value=!0,await $(d.token).put("/api/remove/asset/"+l).then(e=>{p().then(()=>{A.value=!1,z.value={status:!0,type:"success",text:"Data has been deleted."}})}).catch(e=>{r.value.loading=!1})},ae=(l,e=6)=>{let t="00000"+l;return t.substring(t.length-e)};return re(()=>{let l=localStorage.getItem("request-asset-search"),e=localStorage.getItem("request-filter-company"),t=localStorage.getItem("request-filter-location"),S=localStorage.getItem("request-filter-from"),V=localStorage.getItem("request-filter-status"),_=localStorage.getItem("request-filter-row");l&&(f.value=y(l)),e&&(s.value.company_id=y(e)),t&&(s.value.location_id=y(t)),S&&(s.value.from=y(S)),V&&(s.value.status=y(V)),_&&(h.value=y(_)),p().then(()=>{W().then(()=>{X()})})}),(l,e)=>(g(),I(ue,null,{default:m(()=>[i(be,{title:"Asset request page"}),i(O,{class:"mb-3"},{default:m(()=>[a("div",ke,[i(de,{loading:r.value.loading},{default:m(()=>[i(ce,{class:"d-flex align-center mb-3 pa-3"},{default:m(()=>[we,i(me,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. SN-5000035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":P,onKeydown:pe(P,["enter"]),"onClick:clear":e[1]||(e[1]=t=>C("search"))},null,8,["modelValue","onKeydown"])]),_:1}),i(O,{class:"px-3"},{default:m(()=>[a("div",Ie,[i(b,{items:T.value,modelValue:s.value.company_id,"onUpdate:modelValue":[e[2]||(e[2]=t=>s.value.company_id=t),e[3]||(e[3]=t=>k("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company","onClick:clear":e[4]||(e[4]=t=>C("company"))},null,8,["items","modelValue"])]),a("div",$e,[i(b,{items:L.value,modelValue:s.value.from,"onUpdate:modelValue":[e[5]||(e[5]=t=>s.value.from=t),e[6]||(e[6]=t=>k("from"))],variant:"outlined",density:"compact","hide-details":"",label:"Location From","item-value":"id",clearable:"","item-title":"title","onClick:clear":e[7]||(e[7]=t=>C("from"))},null,8,["items","modelValue"])]),a("div",ze,[i(b,{items:L.value,modelValue:s.value.location_id,"onUpdate:modelValue":[e[8]||(e[8]=t=>s.value.location_id=t),e[9]||(e[9]=t=>k("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location To","item-value":"id",clearable:"","item-title":"title","onClick:clear":e[10]||(e[10]=t=>C("location"))},null,8,["items","modelValue"])]),a("div",De,[i(b,{items:Z.value,modelValue:s.value.status,"onUpdate:modelValue":[e[11]||(e[11]=t=>s.value.status=t),e[12]||(e[12]=t=>k("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status","onClick:clear":e[13]||(e[13]=t=>C("status"))},null,8,["items","modelValue"])]),a("div",Ne,[i(b,{items:H.value,modelValue:h.value,"onUpdate:modelValue":[e[14]||(e[14]=t=>h.value=t),Q],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),i(ve,null,{default:m(()=>[a("thead",null,[a("tr",null,[Re,a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[15]||(e[15]=t=>c("company_id"))}," Company "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[16]||(e[16]=t=>c("transferred_from"))}," From "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[17]||(e[17]=t=>c("transferred_to"))}," To "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[18]||(e[18]=t=>c("subject"))}," Subject "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[19]||(e[19]=t=>c("profile_id"))}," Requestor "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[20]||(e[20]=t=>c("reminder_profile_id"))},[q(" Approval"),Le,Ae]),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[21]||(e[21]=t=>c("status"))}," Status "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[22]||(e[22]=t=>c("created_at"))},[q(" D.Requested"),je,Be]),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[23]||(e[23]=t=>c("date_closed"))},[q(" D.Closed"),Pe,Fe]),Te])]),a("tbody",null,[(g(!0),E(Se,null,fe(r.value.data,t=>{var S,V,_,U,M,K;return g(),E("tr",{key:t.id,class:ge(`${v(d).user.profile.id==t.reminder_profile_id?"bg-blue-lighten-5":""} `)},[a("td",null,"SN-5"+u(ae(t.id)),1),a("td",null,u((S=t.company)==null?void 0:S.title),1),a("td",null,u((V=t.transfer_from)==null?void 0:V.title),1),a("td",null,u((_=t.transfer_to)==null?void 0:_.title),1),a("td",null,u(t.subject),1),a("td",null,u((U=t.profile)==null?void 0:U.display_name),1),a("td",null,u((M=t.reminder_profile)==null?void 0:M.display_name),1),a("td",null,[i(ye,{class:"text-uppercase",size:"small",color:`${t.status.toLowerCase()=="complete"?"success":t.status.toLowerCase()=="pending"||t.status.toLowerCase()=="awaiting-approval"?"warning":"error"}`},{default:m(()=>[q(u(ee(t.status)),1)]),_:2},1032,["color"])]),a("td",null,u(v(J)(t.created_at)),1),a("td",null,u(t.date_closed&&t.date_closed!="0000-00-00"?v(J)(t.date_closed):""),1),a("td",Ue,[a("div",Me,[i(Y,{size:"small",onClick:()=>te(t.id),icon:v(xe),class:"mx-1"},null,8,["onClick","icon"]),v(d).user.role=="superadmin"||(K=v(d).capabilities)!=null&&K.includes("delete")?(g(),I(he,{key:0,size:"small",loading:A.value,text:"",variant:"text",onClick:()=>le(t.id)},{default:m(()=>[i(Y,{icon:v(Ce),class:"mx-1"},null,8,["icon"])]),_:2},1032,["loading","onClick"])):j("",!0)])])],2)}),128))])]),_:1}),r.value.data.length==0?(g(),I(Ve,{key:0,class:"pa-3 text-center w-100"},{default:m(()=>[q("No records found")]),_:1})):j("",!0)]),_:1},8,["loading"]),N.value>1?(g(),I(_e,{key:0,modelValue:n.value,"onUpdate:modelValue":e[24]||(e[24]=t=>n.value=t),class:"my-4",length:N.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:r.value.loading},null,8,["modelValue","length","disabled"])):j("",!0)])]),_:1}),i(qe,{options:z.value},null,8,["options"])]),_:1}))}};export{He as default};
