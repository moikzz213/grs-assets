import{G as te,r as _,a as ae,P as fe,I as le,H as J,o as c,p as E,b as s,d as t,w as a,c as h,y as A,s as g,F as K,q as Q,j as I,C as m,Q as ye,k as N,R as ue,S as he,T as be,U as ge,N as Ve,e as p,n as q,f as M,t as V,J as X,W as ce,E as ee,u as ke,v as x,as as z,V as Se,X as Z,Y as H,i as ne,m as je,z as we,A as xe}from"./app-d1935eb8.js";import{_ as Ce}from"./ApppageHeader-f49c0e20.js";import{_ as Ae}from"./AppSnackBar-2c62fc3c.js";import{c as De,a as Y,F as $e,b as G}from"./index.esm-3264aad7.js";import{u as O,a as Te}from"./formatDate-b9aad8c5.js";import{u as Re}from"./status-1e468e42.js";import{_ as Ie}from"./Studio-94553438.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";const Ue={class:"v-col-12 pt-5"},Oe={class:"v-col-12 pb-2"},Ne={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},qe={class:"v-col-12 pt-0 pb-2"},Fe={class:"v-col-12"},Le={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(D,{emit:F}){const u=D,y=te(),e=_(y.query.v),$=ae(),n=_(window.location.origin),L=i=>{let d=null;i.map(l=>{d=b.value.find(S=>S.id==l.id),d||b.value.push(l)})},f=_(!1),T=_(1),k=i=>{T.value=i,f.value=!0},B=i=>{b.value=b.value.filter(d=>d.id!==i)},b=_([]),R=fe(()=>b.value.map(i=>i.id)),P=()=>{let i={id:parseInt(u.incidentId),file_ids:R.value,profile_id:u.objectdata.profile_id};q($.token).post("/api/incident/sync-images/store-update",i).then(d=>{let l="Attachment has been updated";R.value.length==0&&(l="Attachment has been deleted"),F("save",l)}).catch(d=>{})};return le(()=>{b.value=u.attachment}),J(()=>u.objectdata.attachment,(i,d)=>{b.value=i},{deep:!0}),(i,d)=>(c(),E("div",null,[s("div",Ue,[t(g,null,{default:a(()=>[s("div",Oe,[e.value?A("",!0):(c(),h(Ie,{key:0,options:{multiSelect:!0,type:"maintenance"},onSelect:L}))])]),_:1}),b.value.length>0?(c(),h(g,{key:0,class:"px-1"},{default:a(()=>[(c(!0),E(K,null,Q(b.value,(l,S)=>(c(),E("div",{key:l.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[t(I,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:m(ye),size:"26px",color:"error",onClick:()=>B(l.id)},null,8,["icon","onClick"]),t(N,{onClick:()=>k(S)},{default:a(()=>[t(ue,{src:n.value+"/file/"+l.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(he,{modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=l=>f.value=l),width:"95%","max-width":"900"},{default:a(()=>[t(N,{class:"bg-black"},{default:a(()=>[t(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:T.value,"onUpdate:modelValue":d[0]||(d[0]=l=>T.value=l)},{default:a(()=>[(c(!0),E(K,null,Q(b.value,(l,S)=>(c(),h(ge,{key:S,"reverse-transition":"fade",transition:"fade"},{default:a(()=>[s("div",Ne,[t(ue,{src:n.value+"/file/"+l.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(c(),h(g,{key:1},{default:a(()=>[s("div",qe,[t(Ve,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:a(()=>[p(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),e.value?A("",!0):(c(),h(g,{key:2},{default:a(()=>[s("div",Fe,[t(I,{color:"primary",onClick:P},{default:a(()=>[p("Save")]),_:1})])]),_:1}))])]))}},Be={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Pe={class:"font-weight-bold"},We={class:"reported-by"},Me={class:"reported-by"},ze={class:"v-col-12"},He={class:"v-col-12 v-col-md-4 pb-0"},Ye={class:"v-col-12 v-col-md-8"},Ge={class:"v-col-12"},Je={class:"v-col-12"},Ke={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Qe={class:"v-col-3"},Xe=s("br",null,null,-1),Ze={class:"v-col-9"},et={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(D,{emit:F}){const u=D,y=te(),e=ae(),$=_(e.user.profile.role),n=_({}),L=_([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),f=_(y.query.v),T=_([]),k=async()=>{await q(e.token).get("/api/fetch/profile-facility/team").then(i=>{T.value=i.data}).catch(i=>{})},B=()=>{n.value.profile_id=e.user.profile.id,q(e.token).post("/api/incident/update-facility-team",n.value).then(i=>{n.value.remarks_data="",F("saved",i.data.message)}).catch(i=>{})},b=_([]),R=async()=>{await q(e.token).get("/api/fetch-global/incident-status/active").then(i=>{b.value=i.data}).catch(i=>{})},P=(i,d=6)=>{let l="00000"+i;return l.substring(l.length-d)};return le(()=>{k(),R(),n.value=u.objectdata,n.value.priority=u.objectdata.priority?parseInt(u.objectdata.priority):null}),J(()=>u.objectdata.remarks,(i,d)=>{n.value.remarks=i},{deep:!0}),(i,d)=>(c(),E("div",null,[t(N,null,{default:a(()=>[t(M,null,{default:a(()=>[t(g,null,{default:a(()=>{var l;return[s("div",Be,[s("div",Pe," SN: ISR-"+V(P(n.value.id)),1),s("div",We," REPORTED BY: "+V((l=n.value.profile)==null?void 0:l.display_name),1),s("div",Me," DATE REPORTED: "+V(m(O)(n.value.created_at)),1)])]}),_:1}),t(g,null,{default:a(()=>[s("div",ze,[t(g,null,{default:a(()=>[s("div",He,[t(X,{items:L.value,modelValue:n.value.priority,"onUpdate:modelValue":d[0]||(d[0]=l=>n.value.priority=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:$.value=="facility"},null,8,["items","modelValue","disabled"]),t(X,{items:T.value,modelValue:n.value.handled_by,"onUpdate:modelValue":d[1]||(d[1]=l=>n.value.handled_by=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:$.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),t(X,{items:b.value,modelValue:n.value.status_id,"onUpdate:modelValue":d[2]||(d[2]=l=>n.value.status_id=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",Ye,[t(ce,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:n.value.remarks_data,"onUpdate:modelValue":d[3]||(d[3]=l=>n.value.remarks_data=l)},null,8,["modelValue"])])]),_:1})]),t(ee,{class:"mt-3"}),s("div",Ge,[f.value?A("",!0):(c(),h(I,{key:0,class:"",size:"small",disabled:!n.value.priority||!n.value.handled_by||!n.value.status_id,onClick:B,color:"primary"},{default:a(()=>[p("Submit")]),_:1},8,["disabled"]))])]),_:1}),t(g,null,{default:a(()=>[s("div",Je,[p(" Remarks "),t(ee)]),s("div",Ke,[(c(!0),E(K,null,Q(n.value.remarks,l=>(c(),h(g,{key:i.id},{default:a(()=>{var S;return[s("div",Qe,[p(V((S=l.profile)==null?void 0:S.display_name)+" ",1),Xe,p(),s("small",null,V(m(Te)(l.created_at)),1)]),s("div",Ze,V(l.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const re=D=>(we("data-v-025daf7d"),D=D(),xe(),D),tt={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},at={class:"font-weight-bold"},lt={class:"reported-by"},st={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},ot={class:"v-col-12 v-col-md-3"},it={class:"v-col-12 v-col-md-6 d-flex"},dt={class:"v-col-12"},ut={class:"v-col-12 v-col-md-12"},nt={class:"v-col-12 v-col-md-3"},ct={class:"v-col-12"},rt={class:"v-col-12"},vt={class:"v-col-12 v-col-md-9"},mt={class:"v-col-12 v-col-md-6"},pt={class:"v-col-12 v-col-md-3"},_t={class:"v-col-12 v-col-md-3"},ft={key:1},yt=re(()=>s("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),ht={class:"v-col-12 v-col-md-12"},bt=re(()=>s("h5",{class:"headline mb-0 text-center"},[p("NO WARRANTY FOUND. "),s("br"),p("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),gt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(D,{emit:F}){const u=D,y=ae(),e=_({}),$=_({}),n=r=>{$.value={status:!0,type:"success",text:r},F("saved")},L=_(y.user.profile.id),f=te(),T=ke(),k=_(f.query.type),B=_(f.query.v),b=Re(),R=_([]);R.value=Object.assign([],b.urgencies_active_list),b.list.length==0&&b.getStatuses(y.token).then(()=>{R.value=Object.assign([],b.urgencies_active_list)});let P=De({Urgency:Y().required(),Title:Y().required(),Company:Y().required(),Location:Y().required()});const i=new URL(window.location),d=r=>{k.value=r,se("type",r)},l=_(!1),S=_(y.user.profile.role),ve=async()=>{l.value=!0,$.value={status:!0,type:"info",text:"Please wait..."},e.value.type_id=2,e.value.profile_id=y.user.profile.id,await q(y.token).post("/api/store-update/incident",e.value).then(r=>{$.value={status:!0,type:"success",text:r.data.message},f.params.id?l.value=!1:setTimeout(()=>{T.push({name:"EditMaintenance",params:{id:r.data.id},query:{type:"details"}}).catch(o=>{}),l.value=!1},800)}).catch(r=>{})},w=_(!1),se=(r,o)=>{i.searchParams.set(r,o),window.history.pushState({},"",i)},oe=_([]),me=async()=>{await q(y.token).get("/api/fetch/companies").then(r=>{oe.value=r.data}).catch(r=>{})},ie=_([]),pe=async()=>{await q(y.token).get("/api/fetch/locations/non-paginated/data").then(r=>{ie.value=r.data}).catch(r=>{})},_e=(r,o=5)=>{let W="0000"+r;return W.substring(W.length-o)};return le(()=>{var r;f.query.asset_code&&(e.value.asset_code=f.query.asset_code),f.query.title&&(e.value.title=f.query.title),f.query.asset_id&&(e.value.asset_id=parseInt(f.query.asset_id)),f.query.comp&&(e.value.company_id=parseInt(f.query.comp)),f.query.loc&&(e.value.location_id=parseInt(f.query.loc)),f.params.id&&(w.value=!0),k.value||(k.value="details",se("type","details")),me().then(()=>{pe()}),console.log("isEdit.value",w.value),w.value&&(e.value=u.objectdata,e.value.asset_code=(r=u.objectdata.asset)==null?void 0:r.asset_code,e.value.title=u.objectdata.asset?u.objectdata.asset.asset_name:u.objectdata.title,e.value.company_id=u.objectdata.company_id,e.value.location_id=u.objectdata.location_id,e.value.asset_id=u.objectdata.asset_id,e.value.profile_id=u.objectdata.profile_id,e.value.type_id=parseInt(u.objectdata.type_id),e.value.urgency=parseInt(u.objectdata.urgency),e.value.description=u.objectdata.description),console.log("objData.value",e.value)}),J(()=>u.objectdata.remarks,(r,o)=>{e.value=u.objectdata},{deep:!0}),J(()=>u.objectdata.attachment,(r,o)=>{e.value=u.objectdata,e.value.attachment=r},{deep:!0}),(r,o)=>(c(),h(je,null,{default:a(()=>[t(Ce,{title:"Maintenance detail page"}),t(g,{class:"mb-3"},{default:a(()=>[t(x,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:a(()=>{var W,de;return[t(g,{class:"mb-3"},{default:a(()=>[t(I,{class:z(`${k.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:o[0]||(o[0]=j=>d("details"))},{default:a(()=>[p("Details")]),_:1},8,["class"]),w.value?(c(),h(I,{key:0,class:z(`${k.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[1]||(o[1]=j=>d("attachment"))},{default:a(()=>[p("Attachments")]),_:1},8,["class"])):A("",!0),w.value&&(m(y).user.profile.role=="facility"||m(y).user.profile.role=="admin"||m(y).user.profile.role=="superadmin"||m(y).user.profile.role=="technical-operation")?(c(),h(I,{key:1,class:z(`${k.value=="warranty"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[2]||(o[2]=j=>d("warranty"))},{default:a(()=>[p("Warranty")]),_:1},8,["class"])):A("",!0),w.value&&(m(y).user.profile.role=="facility"||m(y).user.profile.role=="admin"||m(y).user.profile.role=="superadmin"||m(y).user.profile.role=="technical-operation")?(c(),h(I,{key:2,class:z(`${k.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[3]||(o[3]=j=>d("facility"))},{default:a(()=>[p("Facility Team")]),_:1},8,["class"])):A("",!0)]),_:1}),k.value=="details"?(c(),h(N,{key:0},{default:a(()=>[t(m($e),{as:"v-form","validation-schema":m(P)},{default:a(({meta:j})=>[t(Se,{class:"my-3 ml-3 text-uppercase text-h6"},{default:a(()=>[p(V(u.headertitle),1)]),_:1}),t(M,null,{default:a(()=>[w.value?(c(),h(g,{key:0},{default:a(()=>{var v,C;return[s("div",tt,[s("div",at," SN: ISR-2"+V(_e(e.value.id)),1),s("div",lt," REPORTED BY: "+V((v=e.value.profile)==null?void 0:v.display_name),1)]),s("div",st," STATUS: "+V((C=e.value.status)==null?void 0:C.title),1)]}),_:1})):A("",!0),t(g,null,{default:a(()=>[s("div",ot,[t(m(G),{name:"Urgency",modelValue:e.value.urgency_id,"onUpdate:modelValue":o[5]||(o[5]=v=>e.value.urgency_id=v)},{default:a(({field:v,errors:C})=>[t(Z,H({items:R.value,modelValue:e.value.urgency_id,"onUpdate:modelValue":o[4]||(o[4]=U=>e.value.urgency_id=U),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},v,{"error-messages":C}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",it,[t(ne,{modelValue:e.value.asset_code,"onUpdate:modelValue":o[6]||(o[6]=v=>e.value.asset_code=v),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"])]),s("div",dt,[t(m(G),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":o[8]||(o[8]=v=>e.value.title=v)},{default:a(({field:v,errors:C})=>[t(ne,H({modelValue:e.value.title,"onUpdate:modelValue":o[7]||(o[7]=U=>e.value.title=U),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},v,{"error-messages":C}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",ut,[t(g,null,{default:a(()=>[s("div",nt,[t(g,null,{default:a(()=>[s("div",ct,[t(m(G),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":o[10]||(o[10]=v=>e.value.company_id=v)},{default:a(({field:v,errors:C})=>[t(Z,H({items:oe.value,modelValue:e.value.company_id,"onUpdate:modelValue":o[9]||(o[9]=U=>e.value.company_id=U),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},v,{"error-messages":C}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",rt,[t(m(G),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":o[12]||(o[12]=v=>e.value.location_id=v)},{default:a(({field:v,errors:C})=>[t(Z,H({items:ie.value,modelValue:e.value.location_id,"onUpdate:modelValue":o[11]||(o[11]=U=>e.value.location_id=U),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},v,{"error-messages":C}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",vt,[t(ce,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":o[13]||(o[13]=v=>e.value.description=v)},null,8,["modelValue"])])]),_:1})])]),_:1}),t(ee,{class:"my-3"}),t(g,null,{default:a(()=>{var v;return[s("div",mt,[!B.value&&((v=e.value)==null?void 0:v.status_id)!=8&&(!w.value||w.value&&(u.objectdata.profile_id==L.value||S.value=="asset-supervisor"))?(c(),h(I,{key:0,size:"small",color:"primary",onClick:ve,disabled:!j.valid,loading:l.value},{default:a(()=>[p("Submit")]),_:2},1032,["disabled","loading"])):A("",!0)]),s("div",pt," DATE CREATED: "+V(e.value.created_at?m(O)(e.value.created_at):""),1),s("div",_t," DATE CLOSED: "+V(r.date_closed?m(O)(e.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):A("",!0),k.value=="warranty"?(c(),E("div",ft,[t(N,null,{default:a(()=>[t(M,null,{default:a(()=>[yt]),_:1})]),_:1}),((de=(W=e.value.asset)==null?void 0:W.pivot_warranties)==null?void 0:de.length)>0?(c(),h(g,{key:0},{default:a(()=>[s("div",ht,[(c(!0),E(K,null,Q(e.value.asset.pivot_warranties,j=>(c(),h(N,{class:"my-3 px-5",key:j.id},{default:a(()=>[t(M,null,{default:a(()=>[t(g,null,{default:a(()=>[t(x,{cols:"4"},{default:a(()=>[p("Vendor")]),_:1}),t(x,{cols:"8"},{default:a(()=>[p(V(j.vendor.title),1)]),_:2},1024),t(x,{cols:"4"},{default:a(()=>[p("Warranty Start Date")]),_:1}),t(x,{cols:"8"},{default:a(()=>[p(V(m(O)(j.warranty_start_date)),1)]),_:2},1024),t(x,{cols:"4"},{default:a(()=>[p("Warranty End Date")]),_:1}),t(x,{cols:"8"},{default:a(()=>[p(V(m(O)(j.warranty_end_date)),1)]),_:2},1024),t(x,{cols:"4"},{default:a(()=>[p("AMC Start Date")]),_:1}),t(x,{cols:"8"},{default:a(()=>[p(V(m(O)(j.amc_start_date)),1)]),_:2},1024),t(x,{cols:"4"},{default:a(()=>[p("AMC End Date")]),_:1}),t(x,{cols:"8"},{default:a(()=>[p(V(m(O)(j.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(c(),h(N,{key:1,class:"mt-2"},{default:a(()=>[t(M,null,{default:a(()=>[bt]),_:1})]),_:1}))])):w.value&&k.value=="attachment"?(c(),h(Le,{key:2,"incident-id":m(f).params.id,attachment:e.value.attachment,onSave:n,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(S.value=="superadmin"||S.value=="admin"||S.value=="technical-operation"||S.value=="facility")&&w.value&&k.value=="facility"?(c(),h(et,{key:3,objectdata:e.value,onSaved:n},null,8,["objectdata"])):A("",!0)]}),_:1})]),_:1}),t(Ae,{options:$.value},null,8,["options"])]),_:1}))}},Dt=Ee(gt,[["__scopeId","data-v-025daf7d"]]);export{Dt as D};
