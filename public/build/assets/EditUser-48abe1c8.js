import{r as i,o as g,e as C,w as s,f as a,l as m,a0 as G,m as P,h as R,L as H,a2 as Q,a3 as Y,g as _,X as Z,I as ee,u as ae,d as le,K as se,s as z,q as te,b as o,x as V,R as B,S as D,ae as T,A as I,H as N,c as q,v as ie,F as oe}from"./app-0ef32caf.js";import{_ as ue}from"./ApppageHeader-55fe2a10.js";import{_ as ce,a as de,b as ne}from"./ChangePassword-aac183e8.js";import{_ as re}from"./AppSnackBar-b8c306df.js";import"./index.esm-585cdc29.js";const pe={__name:"Capability",props:["item"],emits:["saved"],setup(E,{emit:k}){const h=E,c=i(!1),n=i(h.item.capabilities),d=i(h.item.capabilities),$=i(["add","edit","delete"]),y=async()=>{c.value=!1,k("saved",{id:h.item.id,capabilities:n.value})},x=()=>{c.value=!1,n.value=d.value};return(r,p)=>(g(),C(Z,{width:"500",persistent:"",modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=u=>c.value=u)},{activator:s(({props:u})=>[a(m,G(u,{text:"Capability",size:"small",color:"primary"}),null,16)]),default:s(({isActive:u})=>[a(P,{title:"Capabilities"},{default:s(()=>[a(R,null,{default:s(()=>[a(H,{variant:"outlined",density:"compact","hide-details":"",multiple:"","item-title":"name","item-value":"name",label:"- Select -",modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=f=>n.value=f),items:$.value},null,8,["modelValue","items"])]),_:1}),a(Q,null,{default:s(()=>[a(Y),a(m,{size:"small",text:"cancel",onClick:x}),a(m,{size:"small",color:"secondary",onClick:y},{default:s(()=>[_("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ve={class:"v-col-12"},me={class:"v-col-12"},fe={class:"d-flex flex-wrap"},ge={class:"v-col-12 v-col-md-5"},_e={class:"v-col-12"},be={class:"v-col-12 v-col-md-4"},he={class:"v-col-12 v-col-md-12 d-flex"},ye={class:"v-col-12 v-col-md-12 py-0 d-flex"},Se={class:"my-auto"},Ve={key:0,class:"v-col-12 v-col-md-3"},Ce=o("div",{class:"v-col-12 v-col-md-12"},[_(" Capabilities "),o("br"),o("small",{class:"text-error"},"Warning: it will override the capabilities of all page."),o("br"),o("small",{class:"text-error"},"Select only here if all pages have same capabilities")],-1),ke={class:"v-col-12 v-col-md-12 my-auto"},ze={__name:"EditUser",setup(E){var L,O;const k=ee(),h=ae(),c=le(),n=i(!0),d=i({loading:!1,data:{}}),$=()=>{h.back()},y=async()=>{n.value=!0,await z(c.token).get("/api/admin/user/single/"+k.params.id).then(e=>{d.value.data=e.data,n.value=!1}).catch(e=>{d.value.loading=!1,n.value=!1})},x=e=>{y().then(()=>{F.value={status:!0,type:"success",text:e}})};se(()=>{y().then(()=>{K()})});const r=i("profile"),p=async e=>{r.value=e},u=i([]),f=i(!1),K=()=>{z(c.token).get("/api/fetch/pages-slug").then(e=>{var t;u.value=e.data,((t=d.value.data)==null?void 0:t.access.length)>0&&d.value.data.access.map((l,w)=>{u.value.map((A,xe)=>{l.slug==A.slug&&(A.isSelected=l.slug,A.capabilities=l.capabilities?JSON.parse(l.capabilities):[],v.value.push(l.slug),b.value=!0)})})}).catch(e=>{})},b=i(!1),J=()=>{u.value.map((e,t)=>(e.capabilities||(e.capabilities=[]),f.value?(e.isSelected=e.slug,v.value.push(e.slug),b.value=!0):(e.isSelected="",v.value=[],b.value=!1),e))},U=i(!1),v=i([]),M=e=>{e.isSelected?(v.value.splice(v.value.findIndex(l=>l===e.isSelected),1),e.isSelected="",e.capabilities=""):(!e.isSelected||e.isSelected==null||e.isSelected=="")&&(v.value.push(e.slug),e.isSelected=e.slug),b.value=!0,u.value.filter((l,w)=>!l.isSelected).length>0?f.value=!1:f.value=!0},S=i([]),W=i(["add","edit","delete"]),F=i({status:!0,type:"info",text:null}),X=e=>{u.value.map((t,l)=>{t.id==e.id&&(t.capabilities=e.capabilities)})};i((O=(L=c==null?void 0:c.user)==null?void 0:L.profile)==null?void 0:O.id);const j=()=>{U.value=!0,S.value.length>0&&u.value.map((l,w)=>{l.isSelected?l.capabilities=S.value:l.capabilities=[]});let e=u.value.filter(l=>l.isSelected),t={profileID:k.params.id,data:e,profile_id:c.user.profile.id};z(c.token).post("/api/store-page/settings-capabilities/profile",t).then(l=>{v.value=[],S.value=[],F.value={status:!0,type:"success",text:l.data.message},U.value=!1,y().then(()=>{K()})})};return(e,t)=>(g(),C(te,null,{default:s(()=>[a(ue,{title:"Edit User"}),a(V,{class:"mb-3",disabled:n.value},{default:s(()=>[o("div",ve,[a(m,{color:"primary",class:"mr-4",loading:e.loadingAsset,onClick:$},{default:s(()=>[_("Back")]),_:1},8,["loading"])]),o("div",me,[o("div",fe,[a(m,{color:`${r.value=="profile"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:d.value.loading,onClick:t[0]||(t[0]=()=>p("profile"))},{default:s(()=>[_("profile")]),_:1},8,["color","loading"]),a(m,{color:`${r.value=="account"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:d.value.loading,onClick:t[1]||(t[1]=()=>p("account"))},{default:s(()=>[_("Account")]),_:1},8,["color","loading"]),a(m,{color:`${r.value=="change_password"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:d.value.loading,onClick:t[2]||(t[2]=()=>p("change_password"))},{default:s(()=>[_("Change Password")]),_:1},8,["color","loading"])])]),o("div",ge,[a(V,null,{default:s(()=>[o("div",_e,[B(a(ce,{user:d.value.data,onSaved:x},null,8,["user"]),[[D,r.value=="account"]]),B(a(de,{user:d.value.data,onSaved:x},null,8,["user"]),[[D,r.value=="profile"]]),B(a(ne,{user:d.value.data},null,8,["user"]),[[D,r.value=="change_password"]])])]),_:1})]),o("div",be,[a(P,null,{default:s(()=>[a(R,null,{default:s(()=>[a(V,null,{default:s(()=>[o("div",he,[a(T,{modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>f.value=l),J],"hide-details":"",variant:"outlined",density:"compact",label:" Access / View Pages"},null,8,["modelValue"]),b.value?(g(),C(m,{key:0,class:"ml-5",size:"small",loading:U.value,color:"secondary",onClick:j},{default:s(()=>[_("Save")]),_:1},8,["loading"])):I("",!0)])]),_:1}),a(N,{class:"mb-3"}),(g(!0),q(oe,null,ie(u.value,(l,w)=>(g(),C(V,{key:l.id},{default:s(()=>[o("div",ye,[a(T,{"model-value":v.value.includes(l.slug),"hide-details":"",variant:"outlined","onUpdate:modelValue":A=>M(l,w),label:l.title,density:"compact"},null,8,["model-value","onUpdate:modelValue","label"]),o("div",Se,[l.isSelected?(g(),C(pe,{key:0,item:l,onSaved:X},null,8,["item"])):I("",!0)])]),a(N)]),_:2},1024))),128))]),_:1})]),_:1})]),b.value?(g(),q("div",Ve,[a(P,null,{default:s(()=>[a(R,null,{default:s(()=>[a(V,null,{default:s(()=>[Ce,a(N),o("div",ke,[a(H,{variant:"outlined",density:"compact","hide-details":"",multiple:"",label:"- Select -",modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l),items:W.value},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})])):I("",!0)]),_:1},8,["disabled"]),a(re,{options:F.value},null,8,["options"])]),_:1}))}};export{ze as default};
