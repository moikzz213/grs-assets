import{d as i,o as g,f as C,w as s,g as a,m as _,_ as j,q as N,i as P,L as T,$ as G,a0 as Q,h as b,U as X,I as Y,e as Z,K as ee,x as z,v as ae,b as u,z as V,a1 as D,a2 as F,ad as L,C as B,H as I,c as O,y as le,F as te}from"./app-8ce6e96b.js";import{_ as se}from"./AppPageHeader-38b6237f.js";import{_ as ie,a as oe,b as ue}from"./ChangePassword-9278bf69.js";import{_ as de}from"./AppSnackBar-bc57ffdf.js";import"./index.esm-68a7cf85.js";const ce={__name:"Capability",props:["item"],emits:["saved"],setup(E,{emit:x}){const d=E,n=i(!1),o=i(d.item.capabilities),h=i(d.item.capabilities),k=i(["add","edit","delete"]),r=async()=>{n.value=!1,x("saved",{id:d.item.id,capabilities:o.value})},y=()=>{n.value=!1,o.value=h.value};return(p,c)=>(g(),C(X,{width:"500",persistent:"",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=f=>n.value=f)},{activator:s(({props:f})=>[a(_,j(f,{text:"Capability",size:"small",color:"primary"}),null,16)]),default:s(({isActive:f})=>[a(N,{title:"Capabilities"},{default:s(()=>[a(P,null,{default:s(()=>[a(T,{variant:"outlined",density:"compact","hide-details":"",multiple:"","item-title":"name","item-value":"name",label:"- Select -",modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=v=>o.value=v),items:k.value},null,8,["modelValue","items"])]),_:1}),a(G,null,{default:s(()=>[a(Q),a(_,{size:"small",text:"cancel",onClick:y}),a(_,{size:"small",color:"secondary",onClick:r},{default:s(()=>[b("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ne={class:"v-col-12"},re={class:"d-flex flex-wrap"},pe={class:"v-col-12 v-col-md-5"},ve={class:"v-col-12"},me={class:"v-col-12 v-col-md-4"},fe={class:"v-col-12 v-col-md-12 d-flex"},ge={class:"v-col-12 v-col-md-12 py-0 d-flex"},_e={class:"my-auto"},be={key:0,class:"v-col-12 v-col-md-3"},he=u("div",{class:"v-col-12 v-col-md-12"},[b(" Capabilities "),u("br"),u("small",{class:"text-error"},"Warning: it will override the capabilities of all page."),u("br"),u("small",{class:"text-error"},"Select only here if all pages have same capabilities")],-1),ye={class:"v-col-12 v-col-md-12 my-auto"},$e={__name:"EditUser",setup(E){var R,K;const x=Y(),d=Z(),n=i(!0),o=i({loading:!1,data:{}}),h=async()=>{n.value=!0,await z(d.token).get("/api/admin/user/single/"+x.params.id).then(e=>{o.value.data=e.data,n.value=!1}).catch(e=>{o.value.loading=!1,n.value=!1})},k=e=>{h().then(()=>{A.value={status:!0,type:"success",text:e}})};ee(()=>{h().then(()=>{f()})});const r=i("profile"),y=async e=>{r.value=e},p=i([]),c=i(!1),f=()=>{z(d.token).get("/api/fetch/pages-slug").then(e=>{var t;p.value=e.data,((t=o.value.data)==null?void 0:t.access.length)>0&&o.value.data.access.map((l,w)=>{p.value.map(($,Se)=>{l.slug==$.slug&&($.isSelected=l.slug,$.capabilities=l.capabilities?JSON.parse(l.capabilities):[],m.value.push(l.slug),v.value=!0)})})}).catch(e=>{})},v=i(!1),q=()=>{p.value.map((e,t)=>(e.capabilities||(e.capabilities=[]),c.value?(e.isSelected=e.slug,m.value.push(e.slug),v.value=!0):(e.isSelected="",m.value=[],v.value=!1),e))},U=i(!1),m=i([]),H=e=>{e.isSelected?(m.value.splice(m.value.findIndex(l=>l===e.isSelected),1),e.isSelected="",e.capabilities=""):(!e.isSelected||e.isSelected==null||e.isSelected=="")&&(m.value.push(e.slug),e.isSelected=e.slug),v.value=!0,p.value.filter((l,w)=>!l.isSelected).length>0?c.value=!1:c.value=!0},S=i([]),J=i(["add","edit","delete"]),A=i({status:!0,type:"info",text:null}),M=e=>{p.value.map((t,l)=>{t.id==e.id&&(t.capabilities=e.capabilities)})};i((K=(R=d==null?void 0:d.user)==null?void 0:R.profile)==null?void 0:K.id);const W=()=>{U.value=!0,S.value.length>0&&p.value.map((l,w)=>{l.isSelected?l.capabilities=S.value:l.capabilities=[]});let e=p.value.filter(l=>l.isSelected),t={profileID:x.params.id,data:e,profile_id:d.user.profile.id};z(d.token).post("/api/store-page/settings-capabilities/profile",t).then(l=>{m.value=[],S.value=[],A.value={status:!0,type:"success",text:l.data.message},U.value=!1,h().then(()=>{f()})})};return(e,t)=>(g(),C(ae,null,{default:s(()=>[a(se,{title:"Edit User"}),a(V,{class:"mb-3",disabled:n.value},{default:s(()=>[u("div",ne,[u("div",re,[a(_,{color:`${r.value=="profile"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[0]||(t[0]=()=>y("profile"))},{default:s(()=>[b("profile")]),_:1},8,["color","loading"]),a(_,{color:`${r.value=="account"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[1]||(t[1]=()=>y("account"))},{default:s(()=>[b("Account")]),_:1},8,["color","loading"]),a(_,{color:`${r.value=="change_password"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[2]||(t[2]=()=>y("change_password"))},{default:s(()=>[b("Change Password")]),_:1},8,["color","loading"])])]),u("div",pe,[a(V,null,{default:s(()=>[u("div",ve,[D(a(ie,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,r.value=="account"]]),D(a(oe,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,r.value=="profile"]]),D(a(ue,{user:o.value.data},null,8,["user"]),[[F,r.value=="change_password"]])])]),_:1})]),u("div",me,[a(N,null,{default:s(()=>[a(P,null,{default:s(()=>[a(V,null,{default:s(()=>[u("div",fe,[a(L,{modelValue:c.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>c.value=l),q],"hide-details":"",variant:"outlined",density:"compact",label:" Access / View Pages"},null,8,["modelValue"]),v.value?(g(),C(_,{key:0,class:"ml-5",size:"small",loading:U.value,color:"secondary",onClick:W},{default:s(()=>[b("Save")]),_:1},8,["loading"])):B("",!0)])]),_:1}),a(I,{class:"mb-3"}),(g(!0),O(te,null,le(p.value,(l,w)=>(g(),C(V,{key:l.id},{default:s(()=>[u("div",ge,[a(L,{"model-value":m.value.includes(l.slug),"hide-details":"",variant:"outlined","onUpdate:modelValue":$=>H(l,w),label:l.title,density:"compact"},null,8,["model-value","onUpdate:modelValue","label"]),u("div",_e,[l.isSelected?(g(),C(ce,{key:0,item:l,onSaved:M},null,8,["item"])):B("",!0)])]),a(I)]),_:2},1024))),128))]),_:1})]),_:1})]),v.value?(g(),O("div",be,[a(N,null,{default:s(()=>[a(P,null,{default:s(()=>[a(V,null,{default:s(()=>[he,a(I),u("div",ye,[a(T,{variant:"outlined",density:"compact","hide-details":"",multiple:"",label:"- Select -",modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l),items:J.value},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})])):B("",!0)]),_:1},8,["disabled"]),a(de,{options:A.value},null,8,["options"])]),_:1}))}};export{$e as default};
