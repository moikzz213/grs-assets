import{a as _e,r,I as fe,u as he,K as ye,J as K,o as u,c as _,w as s,d as a,v as Ve,k as T,V as ge,b as o,t as h,p as b,y,as as J,E as p,H as z,f as I,s as f,j as x,e as j,L as E,i as k,q as W,X as be,Y as ke,Z as Ae,W as we,P as Ce,D as X,O as xe,F as P,aC as Ue,aD as Se,aE as qe,aF as Te,aG as je,m as Ee,n as U}from"./app-00dba68a.js";import{_ as Oe}from"./AppPageHeader-3c2b85de.js";import{_ as De}from"./Studio-955f7571.js";import{_ as Re}from"./AppSnackBar-5b63c416.js";import{u as Z}from"./formatDate-b9aad8c5.js";const Le={key:0,class:"text-error text-h6"},Ne={class:"v-col-8 text-right"},Be={key:0},Fe={key:1,class:"v-col-8 text-right"},ze={class:"v-col-12 v-col-md-6"},Ie={class:"v-col-12 v-col-md-6"},Pe={class:"v-col-12 v-col-md-6"},$e={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12"},Ye={class:"v-col-12"},Ge={class:"v-col-12 v-col-md-1 px-1"},Qe={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},He={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ke={class:"v-col-12 pt-0 pb-0"},Je={class:"v-col-12 v-col-md-3"},We={class:"v-col-12 v-col-md-2"},Xe={class:"v-col-12 v-col-md-1"},Ze={class:"v-col-12 v-col-md-1"},et={class:"v-col-12 v-col-md-1"},tt={class:"v-col-12 v-col-md-3 d-flex"},at=o("div",{class:"v-col-12 font-weight-bold text-uppercase"}," APPROVAL SETUP ",-1),lt=o("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),st={class:"v-col-12 v-col-md-6"},ot=o("div",{class:"v-col-12 v-col-md-1"},"Status",-1),dt=o("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),it={class:"v-col-12 v-col-md-2"},ut={class:"v-col-12 v-col-md-7 d-flex"},nt={class:"my-auto"},rt={class:"v-col-12"},ct={class:"v-col-12 text-error"},pt=o("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),yt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(ee,{emit:te}){const g=ee,c=_e(),$=r("Note: Administrator needs to setup signatories first."),R=r(!1),w=fe(),ae=he(),d=r({}),A=r(!1),V=r([{qty:1,attachment:{}}]),le=r(new Date),M=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},se=r(window.location.origin),oe=(t,l)=>{V.value[t].attachment=l[0]},L=r(!1),N=r(1),de=t=>{N.value=t,L.value=!0},ie=t=>{V.value[t].attachment=""},Y=r([]),ue=async()=>{let t="request";g.headertitle=="Transfer Assets"&&(t="transfer"),await U(c.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(l=>{Y.value=l.data}).catch(l=>{})},O=r({}),G=r([]),ne=async()=>{await U(c.token).get("/api/fetch/companies").then(t=>{G.value=t.data}).catch(t=>{})},B=r([]),re=async()=>{await U(c.token).get("/api/fetch/locations/non-paginated/data").then(t=>{B.value=t.data}).catch(t=>{})},ce=()=>{V.value.push({qty:1,attachment:{}}),S()},pe=(t,l)=>{V.value.splice(l,1),S()},ve=()=>{O.value={status:!0,type:"info",text:"Please wait..."};let t=V.value.map((e,i)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:d.value,assets:t,approval:C.value,profile_id:c.user.profile.id,role:c.user.profile.role,type:"transfer"};U(c.token).post("/api/request-asset/store-update/data",l).then(e=>{let i="",m="";e.data.message?(i=e.data.message,m="success"):e.data.error&&(i=e.data.error,m="error"),O.value={status:!0,type:m,text:i},w.params.id||setTimeout(()=>{ae.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(F=>{})},800)}).catch(e=>{console.log(e)})},C=r([]),D=r(!0),Q=async()=>{await U(c.token).get("/api/fetch/request-asset/approval-setup-fetch/"+d.value.request_type_id).then(t=>{var l,e;C.value=(l=t.data)==null?void 0:l.stages,w.params.id&&C.value.length>0&&C.value.map((i,m)=>(i.profile_id=q.value[m].profile_id,i.status=q.value[m].status,i.date_approved=q.value[m].date_approved,i.reason_rejected=q.value[m].reason_rejected,i)),((e=t.data)==null?void 0:e.stages.length)>0?D.value=!0:D.value=!1}).catch(t=>{})},S=()=>{let t=!1;R.value=!1,d.value.company_id&&d.value.request_type_id&&d.value.subject&&d.value.transferred_from&&d.value.transferred_to&&(t=!0);let l=!0;V.value.map(i=>{i.item_description&&i.reason_for_request||(l=!1)});let e=!0;C.value.map(i=>{i.profile_id||(e=!1)}),e&&l&&t&&(R.value=!0)},H=t=>{let l={status:t,profile_id:c.user.profile.id,ID:v.value.id};U(c.token).post("/api/request-asset/change-request/data",l).then(e=>{O.value={status:!0,type:"success",text:e.data.message},v.value.status=t,te("saved",e.data.message)}).catch(e=>{})},me=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},q=r([]),v=r({});return ye(()=>{if(ue().then(()=>{ne().then(()=>{re()})}),w.params.id){A.value=!0;let t=g.objectdata;v.value=t,d.value.company_id=t.company_id,d.value.request_type_id=t.request_type_id,d.value.subject=t.subject,d.value.transferred_from=t.transferred_from,d.value.transferred_to=t.transferred_to,d.value.id=t.id,d.value.requestor_id=t.profile_id,q.value=t.request_approvals,V.value=t.items,Q()}else d.value.company_id=c.user.profile.company_id}),K(d.value,async(t,l)=>{S()}),K(V.value,async(t,l)=>{S()}),(t,l)=>(u(),_(Ee,null,{default:s(()=>[a(Oe,{title:g.headertitle},null,8,["title"]),a(f,{class:"mb-3"},{default:s(()=>[a(Ve,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[a(T,null,{default:s(()=>[a(ge,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:s(()=>[o("div",null,h(g.headertitle),1),D.value?y("",!0):(u(),b("div",Le,h($.value),1)),A.value?(u(),b("div",{key:1,class:J(v.value.status=="cancelled"?"text-error":v.value.status=="complete"?"text-success":"")}," STATUS ("+h(v.value.status)+") ",3)):y("",!0),o("div",null,"DATE: "+h(p(Z)(le.value)),1)]),_:1}),a(z),a(I,null,{default:s(()=>[a(f,null,{default:s(()=>[A.value?(u(),b("div",{key:0,class:J(`${v.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+h(me(v.value.id)),3)):y("",!0),o("div",Ne,[A.value&&(v.value.status=="pending"||v.value.status=="cancelled")?(u(),b("div",Be,[v.value.status=="pending"?(u(),_(x,{key:0,onClick:l[0]||(l[0]=e=>H("cancelled")),size:"small",color:"warning"},{default:s(()=>[j("Cancel request")]),_:1})):y("",!0),v.value.status=="cancelled"?(u(),_(x,{key:1,onClick:l[1]||(l[1]=e=>H("pending")),size:"small",color:"info"},{default:s(()=>[j("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)]),v.value.status=="complete"?(u(),b("div",Fe)):y("",!0),o("div",ze,[a(E,{items:Y.value,modelValue:d.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>d.value.request_type_id=e),Q],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:A.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),o("div",Ie,[a(E,{items:G.value,modelValue:d.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),o("div",Pe,[a(E,{items:B.value,modelValue:d.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),o("div",$e,[a(E,{items:B.value,modelValue:d.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),o("div",Me,[a(k,{modelValue:d.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>d.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(T,{class:"my-2"},{default:s(()=>[a(I,null,{default:s(()=>[a(f,null,{default:s(()=>{var e;return[o("div",Ye,[!p(w).params.id||((e=g.objectdata)==null?void 0:e.status)=="pending"||p(c).user.profile.role=="superadmin"||p(c).user.profile.role=="administrator"?(u(),_(x,{key:0,size:"small",color:"primary",onClick:ce},{default:s(()=>[j("Add")]),_:1})):y("",!0)])]}),_:1}),(u(!0),b(P,null,W(V.value,(e,i)=>(u(),_(f,{key:i},{default:s(()=>{var m,F;return[o("div",Ge,[(m=e.attachment)!=null&&m.id?(u(),_(f,{key:0,class:"px-1"},{default:s(()=>[o("div",Qe,[a(k,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":n=>e.attachment.id=n},null,8,["modelValue","onUpdate:modelValue"]),a(x,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:t.mdiClose,size:"16px",color:"error",onClick:()=>ie(i,e.attachment.id)},null,8,["icon","onClick"]),a(T,{onClick:()=>de(i),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(be,{modelValue:L.value,"onUpdate:modelValue":l[8]||(l[8]=n=>L.value=n),width:"95%","max-width":"900"},{default:s(()=>[a(T,{class:"bg-black"},{default:s(()=>[a(ke,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:N.value,"onUpdate:modelValue":l[7]||(l[7]=n=>N.value=n)},{default:s(()=>[a(Ae,{"reverse-transition":"fade",transition:"fade"},{default:s(()=>[o("div",He,[a(we,{src:se.value+"/file/"+e.attachment.path},null,8,["src"])])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)):(u(),_(f,{key:1,class:"mt-0"},{default:s(()=>[o("div",Ke,[a(Ce,{color:"grey-lighten-4",class:"text-center"},{default:s(()=>[a(De,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:n=>oe(i,n)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),o("div",Je,[a(k,{modelValue:e.item_description,"onUpdate:modelValue":n=>e.item_description=n,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",We,[a(k,{modelValue:e.asset_code,"onUpdate:modelValue":n=>e.asset_code=n,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Xe,[a(k,{type:"number",modelValue:e.qty,"onUpdate:modelValue":n=>e.qty=n,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ze,[a(k,{type:"number",modelValue:e.weight,"onUpdate:modelValue":n=>e.weight=n,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",et,[a(k,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":n=>e.item_value=n,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",tt,[a(k,{modelValue:e.reason_for_request,"onUpdate:modelValue":n=>e.reason_for_request=n,variant:"outlined",density:"compact","hide-details":"",label:"REASON FOR REQUEST*"},null,8,["modelValue","onUpdate:modelValue"]),!A.value||A.value&&p(c).user.profile.id==g.objectdata.profile_id&&((F=g.objectdata)==null?void 0:F.status)=="pending"?(u(),_(X,{key:0,size:"small",onClick:()=>pe(e.id,i),icon:p(xe),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(T,{class:"my-2"},{default:s(()=>[a(I,null,{default:s(()=>[a(f,null,{default:s(()=>[at,a(z)]),_:1}),a(f,null,{default:s(()=>{var e,i;return[lt,o("div",st,h((i=(e=v.value)==null?void 0:e.profile)==null?void 0:i.display_name),1),ot,dt]}),_:1}),D.value?(u(),b(P,{key:0},[(u(!0),b(P,null,W(C.value,(e,i)=>(u(),_(f,{key:e.id},{default:s(()=>[o("div",it,h(e.types?M(e.types):M(e.approval_type)),1),o("div",ut,[a(E,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[m=>e.profile_id=m,S],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(x,{variant:"text",size:"x-small"},{default:s(()=>[e.status?(u(),_(X,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?p(Ue):e.status=="pending"?p(Se):e.status=="reject"?p(qe):p(Te),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),a(je,{activator:"parent",location:"top","max-width":"400"},{default:s(()=>[j(h(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),o("div",nt,h(e.date_approved?p(Z)(e.date_approved):""),1)]),_:2},1024))),128)),a(f,null,{default:s(()=>{var e;return[a(z),o("div",rt,[(!p(w).params.id||((e=g.objectdata)==null?void 0:e.status)=="pending"||p(c).user.profile.role=="asset-supervisor"||p(c).user.profile.role=="superadmin"||p(c).user.profile.role=="administrator")&&v.value.status!="complete"?(u(),_(x,{key:0,size:"small",disabled:!R.value,onClick:ve,color:"primary"},{default:s(()=>[j(h(p(w).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)])]}),_:1})],64)):(u(),_(f,{key:1},{default:s(()=>[o("div",ct,h($.value),1)]),_:1})),a(f,null,{default:s(()=>[pt]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Re,{options:O.value},null,8,["options"])]),_:1}))}};export{yt as _};
