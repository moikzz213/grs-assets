import{N as te,r as _,i as ae,W as _e,o as le,O as K,b as c,c as R,e as s,l as t,k as a,j as y,I as A,E as b,F as X,d as Z,z as I,K as m,X as fe,A as N,Y as ue,Z as ye,_ as he,$ as be,T as Ve,m as p,D as O,q as W,t as V,P as J,a0 as ce,M as ee,u as ge,G as w,aq as z,V as ke,a1 as Q,a2 as H,y as ne,C as je,p as Se,g as we}from"./app-4c5f7781.js";import{_ as xe}from"./AppPageHeader-afb9bcae.js";import{_ as Ce}from"./AppSnackBar-8d458700.js";import{c as Ae,a as Y,F as De,b as G}from"./index.esm-05fa7bf7.js";import{u as U,a as $e}from"./formatDate-b9aad8c5.js";import{_ as Te}from"./Studio-4014835b.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";const Re={class:"v-col-12 pt-5"},Ee={class:"v-col-12 pb-2"},Ue={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ne={class:"v-col-12 pt-0 pb-2"},Oe={class:"v-col-12"},qe={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(D,{emit:L}){const u=D,h=te(),e=_(h.query.v),$=ae(),n=_(window.location.origin),B=i=>{let d=null;i.map(l=>{d=k.value.find(x=>x.id==l.id),d||k.value.push(l)})},f=_(!1),T=_(1),g=i=>{T.value=i,f.value=!0},M=i=>{k.value=k.value.filter(d=>d.id!==i)},k=_([]),q=_e(()=>k.value.map(i=>i.id)),F=()=>{let i={id:parseInt(u.incidentId),file_ids:q.value,profile_id:u.objectdata.profile_id};O($.token).post("/api/incident/sync-images/store-update",i).then(d=>{let l="Attachment has been updated";q.value.length==0&&(l="Attachment has been deleted"),L("save",l)}).catch(d=>{})};return le(()=>{k.value=u.attachment}),K(()=>u.objectdata.attachment,(i,d)=>{k.value=i},{deep:!0}),(i,d)=>(c(),R("div",null,[s("div",Re,[t(b,null,{default:a(()=>[s("div",Ee,[e.value?A("",!0):(c(),y(Te,{key:0,options:{multiSelect:!0,type:"maintenance"},onSelect:B}))])]),_:1}),k.value.length>0?(c(),y(b,{key:0,class:"px-1"},{default:a(()=>[(c(!0),R(X,null,Z(k.value,(l,x)=>(c(),R("div",{key:l.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[t(I,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:m(fe),size:"26px",color:"error",onClick:()=>M(l.id)},null,8,["icon","onClick"]),t(N,{onClick:()=>g(x)},{default:a(()=>[t(ue,{src:n.value+"/file/"+l.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(ye,{modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=l=>f.value=l),width:"95%","max-width":"900"},{default:a(()=>[t(N,{class:"bg-black"},{default:a(()=>[t(he,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:T.value,"onUpdate:modelValue":d[0]||(d[0]=l=>T.value=l)},{default:a(()=>[(c(!0),R(X,null,Z(k.value,(l,x)=>(c(),y(be,{key:x,"reverse-transition":"fade",transition:"fade"},{default:a(()=>[s("div",Ue,[t(ue,{src:n.value+"/file/"+l.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(c(),y(b,{key:1},{default:a(()=>[s("div",Ne,[t(Ve,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:a(()=>[p(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),e.value?A("",!0):(c(),y(b,{key:2},{default:a(()=>[s("div",Oe,[t(I,{color:"primary",onClick:F},{default:a(()=>[p("Save")]),_:1})])]),_:1}))])]))}},Fe={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Le={class:"font-weight-bold"},Be={class:"reported-by"},Me={class:"reported-by"},Pe={class:"v-col-12"},We={class:"v-col-12 v-col-md-4 pb-0"},ze={class:"v-col-12 v-col-md-8"},He={class:"v-col-12"},Ye={class:"v-col-12"},Ge={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Ke={class:"v-col-3"},Xe=s("br",null,null,-1),Ze={class:"v-col-9"},Je={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(D,{emit:L}){const u=D,h=te(),e=ae(),$=_(e.user.profile.role),n=_({}),B=_([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),f=_(h.query.v),T=_([]),g=async()=>{await O(e.token).get("/api/fetch/profile-facility/team").then(i=>{T.value=i.data}).catch(i=>{})},M=()=>{n.value.profile_id=e.user.profile.id,O(e.token).post("/api/incident/update-facility-team",n.value).then(i=>{n.value.remarks_data="",L("saved",i.data.message)}).catch(i=>{})},k=_([]),q=async()=>{await O(e.token).get("/api/fetch-global/incident-status/active").then(i=>{k.value=i.data}).catch(i=>{})},F=(i,d=6)=>{let l="00000"+i;return l.substring(l.length-d)};return le(()=>{g(),q(),n.value=u.objectdata,n.value.priority=u.objectdata.priority?parseInt(u.objectdata.priority):null}),K(()=>u.objectdata.remarks,(i,d)=>{n.value.remarks=i},{deep:!0}),(i,d)=>(c(),R("div",null,[t(N,null,{default:a(()=>[t(W,null,{default:a(()=>[t(b,null,{default:a(()=>{var l;return[s("div",Fe,[s("div",Le," SN: ISR-"+V(F(n.value.id)),1),s("div",Be," REPORTED BY: "+V((l=n.value.profile)==null?void 0:l.display_name),1),s("div",Me," DATE REPORTED: "+V(m(U)(n.value.created_at)),1)])]}),_:1}),t(b,null,{default:a(()=>[s("div",Pe,[t(b,null,{default:a(()=>[s("div",We,[t(J,{items:B.value,modelValue:n.value.priority,"onUpdate:modelValue":d[0]||(d[0]=l=>n.value.priority=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:$.value=="facility"},null,8,["items","modelValue","disabled"]),t(J,{items:T.value,modelValue:n.value.handled_by,"onUpdate:modelValue":d[1]||(d[1]=l=>n.value.handled_by=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:$.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),t(J,{items:k.value,modelValue:n.value.status_id,"onUpdate:modelValue":d[2]||(d[2]=l=>n.value.status_id=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",ze,[t(ce,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:n.value.remarks_data,"onUpdate:modelValue":d[3]||(d[3]=l=>n.value.remarks_data=l)},null,8,["modelValue"])])]),_:1})]),t(ee,{class:"mt-3"}),s("div",He,[f.value?A("",!0):(c(),y(I,{key:0,class:"",size:"small",disabled:!n.value.priority||!n.value.handled_by||!n.value.status_id,onClick:M,color:"primary"},{default:a(()=>[p("Submit")]),_:1},8,["disabled"]))])]),_:1}),t(b,null,{default:a(()=>[s("div",Ye,[p(" Remarks "),t(ee)]),s("div",Ge,[(c(!0),R(X,null,Z(n.value.remarks,l=>(c(),y(b,{key:i.id},{default:a(()=>{var x;return[s("div",Ke,[p(V((x=l.profile)==null?void 0:x.display_name)+" ",1),Xe,p(),s("small",null,V(m($e)(l.created_at)),1)]),s("div",Ze,V(l.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const re=D=>(Se("data-v-2cf2be2d"),D=D(),we(),D),Qe={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},et={class:"font-weight-bold"},tt={class:"reported-by"},at={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},lt={class:"v-col-12 v-col-md-3"},st={class:"v-col-12 v-col-md-6 d-flex"},ot={class:"v-col-12"},it={class:"v-col-12 v-col-md-12"},dt={class:"v-col-12 v-col-md-3"},ut={class:"v-col-12"},nt={class:"v-col-12"},ct={class:"v-col-12 v-col-md-9"},rt={class:"v-col-12 v-col-md-6"},vt={class:"v-col-12 v-col-md-3"},mt={class:"v-col-12 v-col-md-3"},pt={key:1},_t=re(()=>s("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),ft={class:"v-col-12 v-col-md-12"},yt=re(()=>s("h5",{class:"headline mb-0 text-center"},[p("NO WARRANTY FOUND. "),s("br"),p("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),ht={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(D,{emit:L}){const u=D,h=ae(),e=_({}),$=_({}),n=r=>{$.value={status:!0,type:"success",text:r},L("saved")},B=_(h.user.profile.id),f=te(),T=ge(),g=_(f.query.type),M=_(f.query.v),k=_([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let q=Ae({Urgency:Y().required(),Title:Y().required(),Company:Y().required(),Location:Y().required()});const F=new URL(window.location),i=r=>{g.value=r,se("type",r)},d=_(!1),l=_(h.user.profile.role),x=async()=>{d.value=!0,$.value={status:!0,type:"info",text:"Please wait..."},e.value.type_id=2,e.value.profile_id=h.user.profile.id,await O(h.token).post("/api/store-update/incident",e.value).then(r=>{$.value={status:!0,type:"success",text:r.data.message},f.params.id?d.value=!1:setTimeout(()=>{T.push({name:"EditMaintenance",params:{id:r.data.id},query:{type:"details"}}).catch(o=>{}),d.value=!1},800)}).catch(r=>{})},S=_(!1),se=(r,o)=>{F.searchParams.set(r,o),window.history.pushState({},"",F)},oe=_([]),ve=async()=>{await O(h.token).get("/api/fetch/companies").then(r=>{oe.value=r.data}).catch(r=>{})},ie=_([]),me=async()=>{await O(h.token).get("/api/fetch/locations/non-paginated/data").then(r=>{ie.value=r.data}).catch(r=>{})},pe=(r,o=5)=>{let P="0000"+r;return P.substring(P.length-o)};return le(()=>{var r;f.query.asset_code&&(e.value.asset_code=f.query.asset_code),f.query.title&&(e.value.title=f.query.title),f.query.asset_id&&(e.value.asset_id=parseInt(f.query.asset_id)),f.query.comp&&(e.value.company_id=parseInt(f.query.comp)),f.query.loc&&(e.value.location_id=parseInt(f.query.loc)),f.params.id&&(S.value=!0),g.value||(g.value="details",se("type","details")),ve().then(()=>{me()}),console.log("isEdit.value",S.value),S.value&&(e.value=u.objectdata,e.value.asset_code=(r=u.objectdata.asset)==null?void 0:r.asset_code,e.value.title=u.objectdata.asset?u.objectdata.asset.asset_name:u.objectdata.title,e.value.company_id=u.objectdata.company_id,e.value.location_id=u.objectdata.location_id,e.value.asset_id=u.objectdata.asset_id,e.value.profile_id=u.objectdata.profile_id,e.value.type_id=parseInt(u.objectdata.type_id),e.value.urgency=parseInt(u.objectdata.urgency),e.value.description=u.objectdata.description),console.log("objData.value",e.value)}),K(()=>u.objectdata.remarks,(r,o)=>{e.value=u.objectdata},{deep:!0}),K(()=>u.objectdata.attachment,(r,o)=>{e.value=u.objectdata,e.value.attachment=r},{deep:!0}),(r,o)=>(c(),y(je,null,{default:a(()=>[t(xe,{title:"Maintenance detail page"}),t(b,{class:"mb-3"},{default:a(()=>[t(w,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:a(()=>{var P,de;return[t(b,{class:"mb-3"},{default:a(()=>[t(I,{class:z(`${g.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:o[0]||(o[0]=j=>i("details"))},{default:a(()=>[p("Details")]),_:1},8,["class"]),S.value?(c(),y(I,{key:0,class:z(`${g.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[1]||(o[1]=j=>i("attachment"))},{default:a(()=>[p("Attachments")]),_:1},8,["class"])):A("",!0),S.value&&(m(h).user.profile.role=="facility"||m(h).user.profile.role=="admin"||m(h).user.profile.role=="superadmin"||m(h).user.profile.role=="technical-operation")?(c(),y(I,{key:1,class:z(`${g.value=="warranty"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[2]||(o[2]=j=>i("warranty"))},{default:a(()=>[p("Warranty")]),_:1},8,["class"])):A("",!0),S.value&&(m(h).user.profile.role=="facility"||m(h).user.profile.role=="admin"||m(h).user.profile.role=="superadmin"||m(h).user.profile.role=="technical-operation")?(c(),y(I,{key:2,class:z(`${g.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[3]||(o[3]=j=>i("facility"))},{default:a(()=>[p("Facility Team")]),_:1},8,["class"])):A("",!0)]),_:1}),g.value=="details"?(c(),y(N,{key:0},{default:a(()=>[t(m(De),{as:"v-form","validation-schema":m(q)},{default:a(({meta:j})=>[t(ke,{class:"my-3 ml-3 text-uppercase text-h6"},{default:a(()=>[p(V(u.headertitle),1)]),_:1}),t(W,null,{default:a(()=>[S.value?(c(),y(b,{key:0},{default:a(()=>{var v,C;return[s("div",Qe,[s("div",et," SN: ISR-2"+V(pe(e.value.id)),1),s("div",tt," REPORTED BY: "+V((v=e.value.profile)==null?void 0:v.display_name),1)]),s("div",at," STATUS: "+V((C=e.value.status)==null?void 0:C.title),1)]}),_:1})):A("",!0),t(b,null,{default:a(()=>[s("div",lt,[t(m(G),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":o[5]||(o[5]=v=>e.value.urgency=v)},{default:a(({field:v,errors:C})=>[t(Q,H({items:k.value,modelValue:e.value.urgency,"onUpdate:modelValue":o[4]||(o[4]=E=>e.value.urgency=E),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},v,{"error-messages":C}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",st,[t(ne,{modelValue:e.value.asset_code,"onUpdate:modelValue":o[6]||(o[6]=v=>e.value.asset_code=v),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"])]),s("div",ot,[t(m(G),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":o[8]||(o[8]=v=>e.value.title=v)},{default:a(({field:v,errors:C})=>[t(ne,H({modelValue:e.value.title,"onUpdate:modelValue":o[7]||(o[7]=E=>e.value.title=E),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},v,{"error-messages":C}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",it,[t(b,null,{default:a(()=>[s("div",dt,[t(b,null,{default:a(()=>[s("div",ut,[t(m(G),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":o[10]||(o[10]=v=>e.value.company_id=v)},{default:a(({field:v,errors:C})=>[t(Q,H({items:oe.value,modelValue:e.value.company_id,"onUpdate:modelValue":o[9]||(o[9]=E=>e.value.company_id=E),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},v,{"error-messages":C}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",nt,[t(m(G),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":o[12]||(o[12]=v=>e.value.location_id=v)},{default:a(({field:v,errors:C})=>[t(Q,H({items:ie.value,modelValue:e.value.location_id,"onUpdate:modelValue":o[11]||(o[11]=E=>e.value.location_id=E),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},v,{"error-messages":C}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",ct,[t(ce,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":o[13]||(o[13]=v=>e.value.description=v)},null,8,["modelValue"])])]),_:1})])]),_:1}),t(ee,{class:"my-3"}),t(b,null,{default:a(()=>{var v;return[s("div",rt,[!M.value&&((v=e.value)==null?void 0:v.status_id)!=8&&(!S.value||S.value&&(u.objectdata.profile_id==B.value||l.value=="asset-supervisor"))?(c(),y(I,{key:0,size:"small",color:"primary",onClick:x,disabled:!j.valid,loading:d.value},{default:a(()=>[p("Submit")]),_:2},1032,["disabled","loading"])):A("",!0)]),s("div",vt," DATE CREATED: "+V(e.value.created_at?m(U)(e.value.created_at):""),1),s("div",mt," DATE CLOSED: "+V(r.date_closed?m(U)(e.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):A("",!0),g.value=="warranty"?(c(),R("div",pt,[t(N,null,{default:a(()=>[t(W,null,{default:a(()=>[_t]),_:1})]),_:1}),((de=(P=e.value.asset)==null?void 0:P.pivot_warranties)==null?void 0:de.length)>0?(c(),y(b,{key:0},{default:a(()=>[s("div",ft,[(c(!0),R(X,null,Z(e.value.asset.pivot_warranties,j=>(c(),y(N,{class:"my-3 px-5",key:j.id},{default:a(()=>[t(W,null,{default:a(()=>[t(b,null,{default:a(()=>[t(w,{cols:"4"},{default:a(()=>[p("Vendor")]),_:1}),t(w,{cols:"8"},{default:a(()=>[p(V(j.vendor.title),1)]),_:2},1024),t(w,{cols:"4"},{default:a(()=>[p("Warranty Start Date")]),_:1}),t(w,{cols:"8"},{default:a(()=>[p(V(m(U)(j.warranty_start_date)),1)]),_:2},1024),t(w,{cols:"4"},{default:a(()=>[p("Warranty End Date")]),_:1}),t(w,{cols:"8"},{default:a(()=>[p(V(m(U)(j.warranty_end_date)),1)]),_:2},1024),t(w,{cols:"4"},{default:a(()=>[p("AMC Start Date")]),_:1}),t(w,{cols:"8"},{default:a(()=>[p(V(m(U)(j.amc_start_date)),1)]),_:2},1024),t(w,{cols:"4"},{default:a(()=>[p("AMC End Date")]),_:1}),t(w,{cols:"8"},{default:a(()=>[p(V(m(U)(j.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(c(),y(N,{key:1,class:"mt-2"},{default:a(()=>[t(W,null,{default:a(()=>[yt]),_:1})]),_:1}))])):S.value&&g.value=="attachment"?(c(),y(qe,{key:2,"incident-id":m(f).params.id,attachment:e.value.attachment,onSave:n,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(l.value=="superadmin"||l.value=="admin"||l.value=="technical-operation"||l.value=="facility")&&S.value&&g.value=="facility"?(c(),y(Je,{key:3,objectdata:e.value,onSaved:n},null,8,["objectdata"])):A("",!0)]}),_:1})]),_:1}),t(Ce,{options:$.value},null,8,["options"])]),_:1}))}},xt=Ie(ht,[["__scopeId","data-v-2cf2be2d"]]);export{xt as D};
