import{r as s,i as ot,u as nt,N as it,O as dt,o as ut,j as V,k as r,C as ct,D as h,b as f,l as o,e as l,A as rt,V as pt,y as vt,x as mt,E,P as y,H as ft,m as S,c as M,d as ht,t as d,Q as yt,K as g,J,R as gt,S as _t,I as w,F as xt,T as Vt,U as Ct}from"./app-727d01fd.js";import{_ as bt}from"./AppPageHeader-26f6934a.js";import{d as kt,e as St}from"./encrypt-1ff76fea.js";import{_ as wt}from"./AppSnackBar-213ad8ac.js";import{u as zt}from"./formatDate-e2fbee14.js";const It={class:"v-col-12"},Dt=l("div",{class:"mr-auto"},"Asset Incidents",-1),Rt={class:"v-col-12 v-col-md"},Ut={class:"v-col-12 v-col-md"},$t={class:"v-col-12 v-col-md"},Lt={class:"v-col-12 v-col-md"},Nt={class:"v-col-12 v-col-md"},Bt=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Tt=l("th",{class:"text-left text-capitalize"},"Urgency",-1),At=l("th",{class:"text-left text-capitalize"},"Type",-1),Pt=l("br",null,null,-1),Ft=l("small",null,"(DD/MM/YY)",-1),Ot=l("th",{class:"text-right text-capitalize"},null,-1),Kt={class:"d-flex align-center justify-end"},qt={__name:"List",setup(jt){const H=s({status:!1,type:"primary",text:null}),u=ot(),z=nt(),C=it(),c=s({loading:!1,data:[]}),b=s(0),Y=s(0),m=s(""),q=s([10,20,50,100]),k=s(10),i=s({}),Q=()=>{v()},_=()=>{n.value==1?v():n.value=1},I=()=>{localStorage.setItem("incident-search",St(m.value)),v()},G=()=>{m.value="",localStorage.setItem("incident-search",""),v()},n=s(C.params&&C.params.page?C.params.page:1),x=s([]),D=s(""),R=s(0),p=t=>{c.value.loading=!0,x.value[0]=t,R.value%2?x.value[1]="DESC":x.value[1]="ASC",R.value++,D.value=JSON.stringify(x.value),v()},U=s([]),W=async()=>{await h(u.token).get("/api/fetch/companies").then(t=>{U.value=t.data}).catch(t=>{})},$=s([]),X=async()=>{await h(u.token).get("/api/fetch/locations/non-paginated/data").then(t=>{$.value=t.data}).catch(t=>{})},L=s([]),Z=async()=>{await h(u.token).get("/api/fetch-global/incident-types/active").then(t=>{L.value=t.data}).catch(t=>{})},N=s([]),tt=async()=>{await h(u.token).get("/api/fetch-global/incident-status/active").then(t=>{N.value=t.data}).catch(t=>{})},et=t=>t==1?"Normal":t==2?"Medium":"High",v=async()=>{console.log("objFIlter",i.value),c.value.loading=!0,await h(u.token).get("/api/fetch/incidents-by/users?userid="+u.user.profile.id+"&role="+u.user.profile.role+"&page="+n.value+"&show="+k.value+"&search="+m.value+"&sort="+D.value+"&filter="+JSON.stringify(i.value)).then(t=>{b.value=t.data.last_page?t.data.last_page:t.data.length,n.value=t.data.current_page?t.data.current_page:n.value,Y.value=t.data.total?t.data.total:t.data.length,c.value.data=t.data.data?t.data.data:t.data,c.value.loading=!1}).catch(t=>{c.value.loading=!1,console.log(t)})};dt(n,(t,a)=>{n.value&&t!=a&&(z.push({name:"PaginatedIncidents",params:{page:n.value}}).catch(e=>{}),v(n.value))});const at=t=>{z.push({name:"EditIncident",params:{id:t},query:{type:"details"}}).catch(a=>{console.log(a)})},lt=t=>{console.log("delete",t)},st=(t,a=5)=>{let e="0000"+t;return e.substring(e.length-a)};return ut(()=>{let t=localStorage.getItem("incident-search");t&&(m.value=kt(t)),v().then(()=>{W(),X(),Z().then(()=>{tt()})})}),(t,a)=>(f(),V(ct,null,{default:r(()=>[o(bt,{title:"Incident list page"}),o(E,{class:"mb-3"},{default:r(()=>[l("div",It,[o(rt,{loading:c.value.loading},{default:r(()=>[o(pt,{class:"d-flex align-center mb-3 pa-3"},{default:r(()=>[Dt,o(vt,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":I,onKeydown:mt(I,["enter"]),"onClick:clear":a[1]||(a[1]=e=>G("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(E,{class:"px-3"},{default:r(()=>[l("div",Rt,[o(y,{items:U.value,modelValue:i.value.company_id,"onUpdate:modelValue":[a[2]||(a[2]=e=>i.value.company_id=e),_],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",Ut,[o(y,{items:$.value,modelValue:i.value.location_id,"onUpdate:modelValue":[a[3]||(a[3]=e=>i.value.location_id=e),_],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",$t,[o(y,{items:L.value,modelValue:i.value.type_id,"onUpdate:modelValue":[a[4]||(a[4]=e=>i.value.type_id=e),_],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Type"},null,8,["items","modelValue"])]),l("div",Lt,[o(y,{items:N.value,modelValue:i.value.status_id,"onUpdate:modelValue":[a[5]||(a[5]=e=>i.value.status_id=e),_],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])]),l("div",Nt,[o(y,{items:q.value,modelValue:k.value,"onUpdate:modelValue":[a[6]||(a[6]=e=>k.value=e),Q],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),o(ft,null,{default:r(()=>[l("thead",null,[l("tr",null,[Bt,Tt,At,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[7]||(a[7]=e=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[8]||(a[8]=e=>p("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[9]||(a[9]=e=>p("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[10]||(a[10]=e=>p("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[11]||(a[11]=e=>p("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[12]||(a[12]=e=>p("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[13]||(a[13]=e=>p("created_at"))},[S(" D.Created"),Pt,Ft]),Ot])]),l("tbody",null,[(f(!0),M(xt,null,ht(c.value.data,e=>{var B,T,A,P,F,O,K;return f(),M("tr",{key:e.id},[l("td",null,"ISR-2"+d(st(e.id)),1),l("td",null,d(et(e.urgency)),1),l("td",null,d((B=e.type)==null?void 0:B.title),1),l("td",null,d((T=e.company)==null?void 0:T.title),1),l("td",null,d((A=e.location)==null?void 0:A.title),1),l("td",null,d(e.asset?e.asset.asset_name:e.title),1),l("td",null,d((P=e.asset)==null?void 0:P.asset_code),1),l("td",null,d((F=e.profile)==null?void 0:F.display_name),1),l("td",null,[o(yt,{class:"text-uppercase",size:"small",color:`${((O=e.status)==null?void 0:O.title.toLowerCase())=="completed"?"success":"error"}`},{default:r(()=>{var j;return[S(d((j=e.status)==null?void 0:j.title),1)]}),_:2},1032,["color"])]),l("td",null,d(g(zt)(e.created_at)),1),l("td",null,[l("div",Kt,[o(J,{size:"small",onClick:()=>at(e.id),icon:g(gt),class:"mx-1"},null,8,["onClick","icon"]),g(u).user.role=="superadmin"||(K=g(u).capabilities)!=null&&K.includes("delete")?(f(),V(J,{key:0,size:"small",onClick:()=>lt(e.id),icon:g(_t),class:"mx-1"},null,8,["onClick","icon"])):w("",!0)])])])}),128))])]),_:1}),c.value.data.length==0?(f(),V(Vt,{key:0,class:"pa-3 text-center w-100"},{default:r(()=>[S("No records found")]),_:1})):w("",!0)]),_:1},8,["loading"]),b.value>1?(f(),V(Ct,{key:0,modelValue:n.value,"onUpdate:modelValue":a[14]||(a[14]=e=>n.value=e),class:"my-4",length:b.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:c.value.loading},null,8,["modelValue","length","disabled"])):w("",!0)])]),_:1}),o(wt,{options:H.value},null,8,["options"])]),_:1}))}};export{qt as default};
