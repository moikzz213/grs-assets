import{r as i,b as g,j as C,k as s,l as a,z as _,a3 as L,A as I,q as N,P as J,$ as M,W as G,m as b,a0 as H,T as Q,i as X,o as Y,K as z,C as Z,f as u,D as V,w as D,v as F,a4 as R,I as B,J as P,c as T,d as ee,F as ae}from"./app-ea1b8183.js";import{_ as le}from"./ApppageHeader-f82612ab.js";import{_ as te,a as se,b as ie}from"./ChangePassword-a8c1a315.js";import{_ as oe}from"./AppSnackBar-edae6743.js";import"./vee-validate.esm-8e79790c.js";const ue={__name:"Capability",props:["item"],emits:["saved"],setup(E,{emit:x}){const m=E,d=i(!1),o=i(m.item.capabilities),h=i(m.item.capabilities),k=i(["add","edit","delete"]),n=async()=>{d.value=!1,x("saved",{id:m.item.id,capabilities:o.value})},y=()=>{d.value=!1,o.value=h.value};return(r,c)=>(g(),C(H,{width:"500",persistent:"",modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=f=>d.value=f)},{activator:s(({props:f})=>[a(_,L(f,{text:"Capability",size:"small",color:"primary"}),null,16)]),default:s(({isActive:f})=>[a(I,{title:"Capabilities"},{default:s(()=>[a(N,null,{default:s(()=>[a(J,{variant:"outlined",density:"compact","hide-details":"",multiple:"","item-title":"name","item-value":"name",label:"- Select -",modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=p=>o.value=p),items:k.value},null,8,["modelValue","items"])]),_:1}),a(M,null,{default:s(()=>[a(G),a(_,{size:"small",text:"cancel",onClick:y}),a(_,{size:"small",color:"secondary",onClick:n},{default:s(()=>[b("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ce={class:"v-col-12"},de={class:"d-flex flex-wrap"},ne={class:"v-col-12 v-col-md-5"},re={class:"v-col-12"},pe={class:"v-col-12 v-col-md-4"},ve={class:"v-col-12 v-col-md-12 d-flex"},me={class:"v-col-12 v-col-md-12 py-0 d-flex"},fe={class:"my-auto"},ge={key:0,class:"v-col-12 v-col-md-3"},_e=u("div",{class:"v-col-12 v-col-md-12"},[b(" Capabilities "),u("br"),u("small",{class:"text-error"},"Warning: it will override the capabilities of all page."),u("br"),u("small",{class:"text-error"},"Select only here if all pages have same capabilities")],-1),be={class:"v-col-12 v-col-md-12 my-auto"},ke={__name:"EditUser",setup(E){const x=Q(),m=X(),d=i(!0),o=i({loading:!1,data:{}}),h=async()=>{d.value=!0,await z(m.token).get("/api/admin/user/single/"+x.params.id).then(e=>{o.value.data=e.data,d.value=!1}).catch(e=>{o.value.loading=!1,d.value=!1})},k=e=>{h().then(()=>{U.value={status:!0,type:"success",text:e}})};Y(()=>{h().then(()=>{f()})});const n=i("profile"),y=async e=>{n.value=e},r=i([]),c=i(!1),f=()=>{z(m.token).get("/api/fetch/pages-slug").then(e=>{var t;r.value=e.data,((t=o.value.data)==null?void 0:t.access.length)>0&&o.value.data.access.map((l,w)=>{r.value.map(($,he)=>{l.slug==$.slug&&($.isSelected=l.slug,$.capabilities=l.capabilities?JSON.parse(l.capabilities):[],v.value.push(l.slug),p.value=!0)})})}).catch(e=>{})},p=i(!1),K=()=>{r.value.map((e,t)=>(e.capabilities||(e.capabilities=[]),c.value?(e.isSelected=e.slug,v.value.push(e.slug),p.value=!0):(e.isSelected="",v.value=[],p.value=!1),e))},A=i(!1),v=i([]),O=e=>{e.isSelected?(v.value.splice(v.value.findIndex(l=>l===e.isSelected),1),e.isSelected="",e.capabilities=""):(!e.isSelected||e.isSelected==null||e.isSelected=="")&&(v.value.push(e.slug),e.isSelected=e.slug),p.value=!0,r.value.filter((l,w)=>!l.isSelected).length>0?c.value=!1:c.value=!0},S=i([]),W=i(["add","edit","delete"]),U=i({status:!0,type:"info",text:null}),j=e=>{r.value.map((t,l)=>{t.id==e.id&&(t.capabilities=e.capabilities)})},q=()=>{A.value=!0,S.value.length>0&&r.value.map((l,w)=>{l.isSelected?l.capabilities=S.value:l.capabilities=[]});let e=r.value.filter(l=>l.isSelected),t={profileID:x.params.id,data:e};z(m.token).post("/api/store-page/settings-capabilities/profile",t).then(l=>{v.value=[],S.value=[],U.value={status:!0,type:"success",text:l.data.message},A.value=!1,h().then(()=>{f()})})};return(e,t)=>(g(),C(Z,null,{default:s(()=>[a(le,{title:"Edit User"}),a(V,{class:"mb-3",disabled:d.value},{default:s(()=>[u("div",ce,[u("div",de,[a(_,{color:`${n.value=="profile"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[0]||(t[0]=()=>y("profile"))},{default:s(()=>[b("profile")]),_:1},8,["color","loading"]),a(_,{color:`${n.value=="account"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[1]||(t[1]=()=>y("account"))},{default:s(()=>[b("Account")]),_:1},8,["color","loading"]),a(_,{color:`${n.value=="change_password"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[2]||(t[2]=()=>y("change_password"))},{default:s(()=>[b("Change Password")]),_:1},8,["color","loading"])])]),u("div",ne,[a(V,null,{default:s(()=>[u("div",re,[D(a(te,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,n.value=="account"]]),D(a(se,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,n.value=="profile"]]),D(a(ie,{"user-id":1},null,512),[[F,n.value=="change_password"]])])]),_:1})]),u("div",pe,[a(I,null,{default:s(()=>[a(N,null,{default:s(()=>[a(V,null,{default:s(()=>[u("div",ve,[a(R,{modelValue:c.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>c.value=l),K],"hide-details":"",variant:"outlined",density:"compact",label:" Access / View Pages"},null,8,["modelValue"]),p.value?(g(),C(_,{key:0,class:"ml-5",size:"small",loading:A.value,color:"secondary",onClick:q},{default:s(()=>[b("Save")]),_:1},8,["loading"])):B("",!0)])]),_:1}),a(P,{class:"mb-3"}),(g(!0),T(ae,null,ee(r.value,(l,w)=>(g(),C(V,{key:l.id},{default:s(()=>[u("div",me,[a(R,{"model-value":v.value.includes(l.slug),"hide-details":"",variant:"outlined","onUpdate:modelValue":$=>O(l,w),label:l.title,density:"compact"},null,8,["model-value","onUpdate:modelValue","label"]),u("div",fe,[l.isSelected?(g(),C(ue,{key:0,item:l,onSaved:j},null,8,["item"])):B("",!0)])]),a(P)]),_:2},1024))),128))]),_:1})]),_:1})]),p.value?(g(),T("div",ge,[a(I,null,{default:s(()=>[a(N,null,{default:s(()=>[a(V,null,{default:s(()=>[_e,a(P),u("div",be,[a(J,{variant:"outlined",density:"compact","hide-details":"",multiple:"",label:"- Select -",modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l),items:W.value},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})])):B("",!0)]),_:1},8,["disabled"]),a(oe,{options:U.value},null,8,["options"])]),_:1}))}};export{ke as default};
