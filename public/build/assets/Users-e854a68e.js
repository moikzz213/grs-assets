import{d as o,e as re,u as ce,I as ve,J as pe,K as me,f as y,w as n,v as fe,x as $,o as p,g as l,A as I,q as K,z as O,L as G,a0 as z,l as X,k as M,b as t,B as ye,E as m,m as F,h as S,C as V,c as Z,y as ge,t as r,M as he,D as ee,N as _e,O as Ve,F as xe,P as Ce,Q as ke,V as we,i as be,ao as Se,H as Ue,$ as Ne,U as De,s as ze}from"./app-96caf3da.js";import{_ as Pe}from"./AppPageHeader-dbda4c03.js";import{d as Re,e as Ae}from"./encrypt-8a4c4811.js";import{_ as Be}from"./AppSnackBar-bd4002fc.js";const Ee=t("div",{class:"mt-2 mr-2"},"Show",-1),Te={class:"v-col-12"},$e={class:"text-right text-capitalize"},Ie={class:"d-flex align-center justify-end"},Ke={class:"text-error"},Oe={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12 v-col-md-6 text-caption"},Fe={class:"v-col-12 v-col-md-6 text-caption py-1"},je={class:"v-col-12 v-col-md-6 text-caption my-auto py-1"},Le={class:"v-col-12 v-col-md-6 text-caption py-1"},Je={class:"v-col-12 text-caption py-1"},Ge={__name:"Users",setup(Qe){const P=o({status:!1,type:"primary",text:null}),u=re(),j=ce(),R=ve(),c=o({loading:!1,data:[]}),A=o(0),ae=o(0),g=o(""),le=o([10,20,50,100]),B=o(10),te=o([{title:"Administrator",value:"admin"},{title:"Asset Supervisor-Project",value:"asset-supervisor"},{title:"Commercial Manager-Project",value:"commercial-manager"},{title:"Facility Team",value:"facility"},{title:"Normal",value:"normal"},{title:"Technical Operation",value:"technical-operation"}]),se=()=>{f()},L=()=>{localStorage.setItem("user-search",Ae(g.value)),f()},oe=()=>{g.value="",localStorage.setItem("user-search",""),f()},v=o(R.params&&R.params.page?R.params.page:1),U=o([]),J=o(""),Q=o(0),x=a=>{c.value.loading=!0,U.value[0]=a,Q.value%2?U.value[1]="DESC":U.value[1]="ASC",Q.value++,J.value=JSON.stringify(U.value),f()},f=async()=>{c.value.loading=!0,await $(u.token).get("/api/user/all?page="+v.value+"&show="+B.value+"&search="+g.value+"&sort="+J.value).then(a=>{A.value=a.data.last_page?a.data.last_page:a.data.length,v.value=a.data.current_page?a.data.current_page:v.value,ae.value=a.data.total?a.data.total:a.data.length,c.value.data=a.data.data?a.data.data:a.data,c.value.loading=!1}).catch(a=>{c.value.loading=!1,console.log(a)})};pe(v,(a,e)=>{v.value&&a!=e&&(j.push({name:"PaginatedUsers",params:{page:v.value}}).catch(s=>{}),f(v.value))});const ne=a=>{j.push({name:"EditUser",params:{id:a}}).catch(e=>{console.log(e)})},ie=a=>{console.log("delete",a)},C=o(!1),ue=()=>{C.value=!0},N=o(!1),W=o(!1),h=o(""),_=o(""),k=o(""),D=o(""),d=o({}),q=()=>{d.value={},N.value=!1,h.value&&(D.value="",$(u.token).get("/api/admin/add-new/profile-by/ecode/"+h.value).then(a=>{if(a.data.id){D.value="Profile already registered.";return}ze.post("/api/fetch-user/other-application",{ecode:h.value,key:"SFFjUDI2S1p0bUpWcit2Y21wNlJhQ1p5WndyQUR2Mnpoc0hERmt0RVBUMD0",user:"TW9pa3p6q"}).then(e=>{var s;W.value=!1,_.value=e.data,(s=e.data)!=null&&s.id?(k.value=e.data.role,N.value=!0,d.value=e.data):D.value="Profile not found. Contact IT department."})}))},de=async()=>{P.value={status:!0,type:"info",text:"Please wait..."};let a=d.value.profile.fullname.split(" "),e={display_name:d.value.profile.fullname,email:d.value.email,first_name:a[0],last_name:a.slice(-1)[0],role:k.value,company_id:d.value.profile.company_id,ecode:d.value.profile.ecode,username:d.value.profile.ecode,designation:d.value.profile.position,profile_id:u.user.profile.id};await $(u.token).post("/api/account/create-new/profile",e).then(s=>{C.value=!1,P.value={status:!0,type:"success",text:s.data.message},E(),f()}).catch(s=>{})},E=()=>{C.value=!1,k.value="",N.value=!1,_.value={},h.value="",d.value={}};return me(()=>{let a=localStorage.getItem("user-search");a&&(g.value=Re(a)),f()}),(a,e)=>(p(),y(fe,null,{default:n(()=>[l(Pe,{title:"Users List"}),l(O,{class:"mb-3"},{default:n(()=>[l(I,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:n(()=>[l(K,{class:"px-5"},{default:n(()=>[l(O,null,{default:n(()=>[l(I,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:n(()=>[Ee,l(G,{items:le.value,modelValue:B.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>B.value=s),se],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),l(z),l(I,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:n(()=>[l(X,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),variant:"outlined",density:"compact",clearable:"",label:"Search",type:"text","hide-details":"","onClick:appendOuter":L,onKeydown:M(L,["enter"]),"onClick:clear":e[2]||(e[2]=s=>oe("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]),_:1}),t("div",Te,[l(K,{loading:c.value.loading},{default:n(()=>[l(ye,null,{default:n(()=>{var s;return[t("thead",null,[t("tr",null,[t("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[3]||(e[3]=i=>x("role"))}," Role "),t("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[4]||(e[4]=i=>x("display_name"))}," Name "),t("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[5]||(e[5]=i=>x("username"))}," Username "),t("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[6]||(e[6]=i=>x("email"))}," Email "),t("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[7]||(e[7]=i=>x("status"))}," Status "),t("th",$e,[m(u).user.role=="superadmin"||(s=m(u).capabilities)!=null&&s.includes("add")?(p(),y(F,{key:0,size:"small",color:"primary",onClick:ue},{default:n(()=>[S("Add New")]),_:1})):V("",!0)])])]),t("tbody",null,[(p(!0),Z(xe,null,ge(c.value.data,i=>{var w,b;return p(),Z("tr",{key:i.id},[t("td",null,r(i.role),1),t("td",null,r(i.display_name),1),t("td",null,r(i.username),1),t("td",null,r(i.email),1),t("td",null,[l(he,{class:"text-uppercase",size:"small",color:`${i.status=="active"?"success":"error"}`},{default:n(()=>[S(r(i.status),1)]),_:2},1032,["color"])]),t("td",null,[t("div",Ie,[m(u).user.role=="superadmin"||(w=m(u).capabilities)!=null&&w.includes("edit")?(p(),y(ee,{key:0,size:"small",onClick:()=>ne(i.id),icon:m(_e),class:"mx-1"},null,8,["onClick","icon"])):V("",!0),m(u).user.role=="superadmin"||(b=m(u).capabilities)!=null&&b.includes("delete")?(p(),y(ee,{key:1,size:"small",onClick:()=>ie(i.id),icon:m(Ve),class:"mx-1"},null,8,["onClick","icon"])):V("",!0)])])])}),128))])]}),_:1}),c.value.data.length==0?(p(),y(Ce,{key:0,class:"pa-3 text-center w-100"},{default:n(()=>[S("No records found")]),_:1})):V("",!0)]),_:1},8,["loading"]),A.value>1?(p(),y(ke,{key:0,modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=s=>v.value=s),class:"my-4",length:A.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:c.value.loading},null,8,["modelValue","length","disabled"])):V("",!0)])]),_:1}),l(De,{width:"600",persistent:"",modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=s=>C.value=s),onKeydown:M(E,["esc"])},{default:n(()=>[l(K,{class:"pt-3"},{default:n(()=>[l(we,{class:"text-h6 d-flex"},{default:n(()=>[S("New User "),l(z),t("small",Ke,r(D.value),1),l(z)]),_:1}),l(be,null,{default:n(()=>[l(O,null,{default:n(()=>{var s,i,w,b,H,Y;return[t("div",Oe,[l(X,{loading:W.value,density:"compact",variant:"outlined",autofocus:"",label:"Search Employee ID","append-inner-icon":m(Se),"hide-details":"",modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=T=>h.value=T),onKeydown:M(q,["enter"]),"onClick:appendInner":q},null,8,["loading","append-inner-icon","modelValue","onKeydown"])]),t("div",Me,[l(G,{density:"compact",variant:"outlined",label:"Role",items:te.value,"hide-details":"",modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=T=>k.value=T)},null,8,["items","modelValue"])]),t("div",Fe," Name: "+r((i=(s=_.value)==null?void 0:s.profile)==null?void 0:i.fullname),1),t("div",je," Status: "+r(_.value.status),1),t("div",Le," Email:"+r((w=_.value)==null?void 0:w.email),1),t("div",Je," Company: "+r((Y=(H=(b=_.value)==null?void 0:b.profile)==null?void 0:H.company)==null?void 0:Y.title),1)]}),_:1})]),_:1}),l(Ue,{class:"mt-2"}),l(Ne,null,{default:n(()=>[l(z),l(F,{size:"small",text:"cancel",onClick:E}),N.value?(p(),y(F,{key:0,size:"small",color:"secondary",onClick:de},{default:n(()=>[S("Confirm")]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"]),l(Be,{options:P.value},null,8,["options"])]),_:1}))}};export{Ge as default};
