import{a as P,r as u,u as G,I as K,K as H,o as k,c as T,w as s,d as t,v as M,b as l,j as m,as as I,e as y,k as Y,E as h,V as J,t as Q,f as W,s as f,i as $,a0 as X,ab as Z,H as ee,p as te,q as ae,L as q,au as se,O as le,F as oe,y as ie,m as de,n as w,z as re,A as ne}from"./app-b5cd2610.js";import{_ as ue}from"./ApppageHeader-53e7b4d9.js";import{_ as ce}from"./AppSnackBar-1772c9b3.js";import{c as pe,a as ve,F as me,b as fe}from"./index.esm-39ab57bb.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const c=b=>(re("data-v-ef9fa2c7"),b=b(),ne(),b),ge={class:"mb-3"},ye={class:"v-col-12 d-flex my-auto"},he={class:"v-col-12 px-6 pt-0 my-auto"},be={class:"v-col-12 px-6 pt-3"},Ve=c(()=>l("div",{class:"v-col-1 font-weight-bold"},null,-1)),Se=c(()=>l("div",{class:"v-col-3 font-weight-bold"}," TYPES ",-1)),xe=c(()=>l("div",{class:"v-col-5 font-weight-bold"}," SIGNATORIES ",-1)),Ce=c(()=>l("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),ke=c(()=>l("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Requestor ",-1)),we=c(()=>l("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Auto ",-1)),Ae={class:"v-col-12 v-col-md-1"},Te={class:"v-col-12 v-col-md-3"},De={class:"v-col-12 v-col-md-6 d-flex my-auto"},Fe={class:"v-col-12 v-col-md-2 d-flex my-auto"},Re=c(()=>l("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),je=c(()=>l("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Receiver ",-1)),Ie=c(()=>l("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Requestor ",-1)),$e={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(b,{emit:qe}){const _=b,p=P(),g=u([]),V=u({}),n=u({title:_.objectdata.title}),U=u([{id:"approve",value:"Approval"},{id:"releasing",value:"Asset Releasing"},{id:"reviewer",value:"Reviewer"},{id:"transport",value:"Transport Arrangement"},{id:"verify",value:"Verify"}]),D=u([]),F=G(),v=K(),S=u(v.params.type);let N=pe({Title:ve().required()});const A=o=>{S.value=o,F.push({path:"/approval-setup/"+o})},x=u(0),z=()=>{let o={id:v.params.id,sort:x.value,profile_id:p.user.profile.id,class:"new"};w(p.token).post("/api/approval-setups/store-signatory/update-data",o).then(e=>{g.value.push({id:e.data.id,sort:x.value,types:null,signatories:[]}),x.value+=1,V.value={status:!0,type:"success",text:"New Signatory has been added"}}).catch(e=>{n.value.loading=!1})},E=async()=>{await w(p.token).get("/api/user/fetch/signatories").then(o=>{D.value=o.data}).catch(o=>{n.value.loading=!1,console.log(o)})},C=u(!1),O=u(!!v.params.id),B=(o,e)=>{let i={id:v.params.id,profile_id:p.user.profile.id,stageID:o,class:"deleted"};g.value.splice(e,1),w(p.token).post("/api/approval-setups/store-signatory/update-data",i).then(a=>{V.value={status:!0,type:"success",text:"Signatory has been deleted."}}).catch(a=>{n.value.loading=!1})},R=o=>{C.value=!0,V.value={status:!0,type:"info",text:"Please wait..."};let e="transfer";S.value=="request-asset"&&(e="request");let i=null;v.params.id&&(i=v.params.id);let a={id:i,type:e,signatories:o,profile_id:p.user.profile.id,class:"update"},d="/api/approval-setups/store-signatory/update-data";o=="title"&&(d="/api/approval-setups/store-update/data",a={id:i,type:e,title:n.value.title,signatories:g.value,profile_id:p.user.profile.id}),w(p.token).post(d,a).then(r=>{V.value={status:!0,type:"success",text:"Data has been saved."},C.value=!1,g.value.sort((j,L)=>j.sort-L.sort),v.params.id||setTimeout(()=>{F.push({name:"EditApproval",params:{id:r.data.id}}).catch(j=>{})},800)}).catch(r=>{n.value.loading=!1})};return H(()=>{if(E(),v.params.id&&_.objectdata.stages.length>0){let o=_.objectdata.stages[_.objectdata.stages.length-1].sort;_.objectdata.stages.map((e,i)=>{let a=[];e.signatures.map(d=>{d.profile_id!=0&&a.push(d.profile_id)}),g.value.push({id:e.id,sort:e.sort,types:e.types,signatories:a})}),x.value=o+1}}),(o,e)=>(k(),T(de,null,{default:s(()=>[t(ue,{title:"Global Approval Setup"}),t(f,{class:"mb-3"},{default:s(()=>[t(M,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[l("div",ge,[t(m,{class:I(`${S.value=="request-asset"?"tab-active":""}  v-col-12 v-col-md-3 mx-2`),onClick:e[0]||(e[0]=i=>A("request-asset"))},{default:s(()=>[y("Request Asset Approvals")]),_:1},8,["class"]),t(m,{class:I(`${S.value=="transfer-asset"?"tab-active":""}   v-col-12 v-col-md-3 mx-2`),onClick:e[1]||(e[1]=i=>A("transfer-asset"))},{default:s(()=>[y("Transfer Asset Approvals")]),_:1},8,["class"]),t(m,{class:"v-col-12 v-col-md-3 mx-2",color:"primary",onClick:e[2]||(e[2]=i=>A("change-approval"))},{default:s(()=>[y("Change / Assign Approvals")]),_:1})]),t(Y,null,{default:s(()=>[t(h(me),{as:"v-form","validation-schema":h(N)},{default:s(({meta:i})=>[t(J,{class:"my-3 ml-3 text-uppercase"},{default:s(()=>[y(Q(_.headertitle),1)]),_:1}),t(W,null,{default:s(()=>[t(f,null,{default:s(()=>[l("div",ye,[t(h(fe),{name:"Title",modelValue:n.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.title=a)},{default:s(({field:a,errors:d})=>[t($,X({modelValue:n.value.title,"onUpdate:modelValue":e[3]||(e[3]=r=>n.value.title=r)},a,{"error-messages":d,label:"Title here*",variant:"outlined","hide-details":"auto",density:"compact",class:"v-col-10 pt-0"}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"]),t(m,{size:"small",class:"mt-1",color:"primary",disabled:!i.valid,loading:C.value,onClick:e[5]||(e[5]=a=>R("title"))},{default:s(()=>[y("Save")]),_:2},1032,["disabled","loading"])])]),_:2},1024),O.value?(k(),T(f,{key:0},{default:s(()=>[l("div",he,[t(m,{onClick:z,color:"primary",size:"x-small",icon:h(Z)},null,8,["icon"]),y(" Add Signatories ")]),l("div",be,[t(f,null,{default:s(()=>[Ve,Se,xe]),_:1}),t(ee),t(f,{class:"mt-0"},{default:s(()=>[Ce,ke,we]),_:1}),(k(!0),te(oe,null,ae(g.value,(a,d)=>(k(),T(f,{class:"mt-0",key:d},{default:s(()=>[l("div",Ae,[t($,{modelValue:a.sort,"onUpdate:modelValue":r=>a.sort=r,label:"Sort*",variant:"outlined","hide-details":"auto",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Te,[t(q,{label:"Select Type",modelValue:a.types,"onUpdate:modelValue":r=>a.types=r,"hide-details":"auto",variant:"outlined","item-value":"id","item-title":"value",density:"compact",items:U.value},null,8,["modelValue","onUpdate:modelValue","items"])]),l("div",De,[t(q,{label:"Select Signatory",modelValue:a.signatories,"onUpdate:modelValue":r=>a.signatories=r,"hide-details":"auto",variant:"outlined",density:"compact",multiple:"","item-value":"id","item-title":"display_name",items:D.value},null,8,["modelValue","onUpdate:modelValue","items"])]),l("div",Fe,[t(m,{disabled:!a.types||a.signatories.length==0,size:"x-small",onClick:()=>R(a),icon:h(se),loading:C.value,color:"success",class:"mx-1 ml-3 my-auto",title:"Save Signatory"},null,8,["disabled","onClick","icon","loading"]),t(m,{size:"x-small",onClick:()=>B(a.id,d),icon:h(le),color:"error",class:"mx-1 ml-3 my-auto",title:"Delete Signatory"},null,8,["onClick","icon"])])]),_:2},1024))),128)),t(f,{class:"mt-0"},{default:s(()=>[Re,je,Ie]),_:1})])]),_:1})):ie("",!0)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})]),_:1})]),_:1}),t(ce,{options:V.value},null,8,["options"])]),_:1}))}},Be=_e($e,[["__scopeId","data-v-ef9fa2c7"]]);export{Be as D};
