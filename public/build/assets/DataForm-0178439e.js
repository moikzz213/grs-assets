import{a as je,r as p,I as Re,u as De,K as Ne,T as ie,J as ne,o as i,c as h,w as d,d as l,v as Le,k as E,V as Ie,b as t,t as n,p as g,y,ag as re,E as _,H as Q,f as Y,s as f,j as x,e as C,L as j,i as A,q as I,F as R,X as Fe,W as Be,P as Pe,_ as ue,D as $,O as ze,aE as ce,aF as pe,aG as ve,aH as _e,aI as Me,m as Qe,n as q}from"./app-89df49be.js";import{_ as Ye}from"./ApppageHeader-6d023923.js";import{_ as $e}from"./Studio-a08a97dc.js";import{_ as Ge}from"./AppSnackBar-591fdd93.js";import{u as me}from"./formatDate-b9aad8c5.js";import{r as fe}from"./generateRandomString-02c0ba3b.js";const Ke={key:0,class:"text-error text-h6"},He={key:1,class:"v-col-12 v-col-md-8"},Je={key:0,class:"no-print"},We={class:"v-col-12 v-col-md-6"},Xe={class:"v-col-12 v-col-md-6"},Ze={class:"v-col-12 v-col-md-6"},et={class:"v-col-12 v-col-md-6"},tt={class:"v-col-12"},at={class:"wd-100"},st={class:"wd-60 text-caption"},lt={class:"wd-40"},ot={class:"wd-60"},dt={class:"wd-40"},it={class:"wd-100"},nt={class:"v-col-12"},rt=t("div",{class:"wd-30"},"ITEM DESCRIPTION",-1),ut=t("div",{class:"wd-15"},"ASSET CODE",-1),ct=t("div",{class:"wd-5"},"QTY",-1),pt=t("div",{class:"wd-10"},"UOM",-1),vt=t("div",{class:"wd-10"},"WEIGHT",-1),_t=t("div",{class:"wd-10"},"VALUE",-1),mt=t("div",{class:"wd-15"},"REASON FOR REQUEST",-1),ft={class:"wd-30"},ht={class:"wd-15"},yt={class:"wd-5"},gt={class:"wd-10"},Vt={class:"wd-10"},wt={class:"wd-10"},bt={class:"wd-15"},kt={class:"v-col-12 v-col-md-1 px-1 no-print"},Tt={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},xt={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},At={class:"v-col-12 pt-0 pb-0"},St={class:"v-col-12 v-col-md-3"},Ut={class:"v-col-12 v-col-md-2"},Ct={class:"v-col-12 v-col-md-1"},qt={class:"v-col-12 v-col-md-1"},Ot={class:"v-col-12 v-col-md-1"},Et={class:"v-col-12 v-col-md-1"},jt={class:"v-col-12 v-col-md-2 d-flex"},Rt={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},Dt=t("div",null,"APPROVAL SETUP",-1),Nt={key:0,class:"no-print"},Lt=t("div",{class:"wd-20"},"Requestor",-1),It={class:"wd-50"},Ft=t("div",{class:"wd-10"},"Status",-1),Bt=t("div",{class:"wd-20"},"Date Approved",-1),Pt={class:"wd-20"},zt={class:"wd-50"},Mt={class:"wd-10"},Qt={class:"wd-20"},Yt=t("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),$t={class:"v-col-12 v-col-md-6"},Gt=t("div",{class:"v-col-12 v-col-md-1"},"Status",-1),Kt=t("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),Ht={class:"v-col-12 v-col-md-2"},Jt={class:"v-col-12 v-col-md-7 d-flex"},Wt={class:"my-auto"},Xt={key:0,class:"v-col-12 no-print"},Zt={class:"v-col-12 text-error"},ea=t("div",{class:"v-col-12 no-print v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),ia={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(he,{emit:ye}){const b=he,m=je(),G=p("Note: Administrator needs to setup signatories first."),F=p(!1),k=Re(),ge=De(),r=p({}),T=p(!1),V=p([{qty:1,attachment:{}}]),Ve=p(new Date),B=a=>{if(a=="approve")return"Approved By";if(a=="reviewer")return"Reviewed By";if(a=="receiver")return"Received By";if(a=="transport")return"Trasport Arranged By";if(a=="releasing")return"Released By";if(a=="verify")return"Verified By"},we=p(window.location.origin),be=(a,s)=>{V.value[a].attachment=s[0]},P=p(!1),K=p(1),ke=a=>{K.value=a,P.value=!0},Te=a=>{V.value[a].attachment=""},H=p(""),J=p([]),xe=async()=>{let a="request";b.headertitle=="Transfer Assets"&&(a="transfer"),await q(m.token).get("/api/fetch/approval-setups/non-paginated/data/"+a).then(s=>{var e,o;J.value=s.data,H.value=(o=(e=s.data.filter(v=>v.id==u.value.request_type_id))==null?void 0:e[0])==null?void 0:o.title}).catch(s=>{})},D=p({}),W=p([]),Ae=async()=>{await q(m.token).get("/api/fetch/companies").then(a=>{W.value=a.data}).catch(a=>{})},X=p(""),Z=p(""),z=p([]),Se=async()=>{await q(m.token).get("/api/fetch/locations/non-paginated/data").then(a=>{var s,e,o,v;z.value=a.data,X.value=(e=(s=a.data.filter(w=>w.id==u.value.transferred_from))==null?void 0:s[0])==null?void 0:e.title,Z.value=(v=(o=a.data.filter(w=>w.id==u.value.transferred_to))==null?void 0:o[0])==null?void 0:v.title}).catch(a=>{})},Ue=()=>{V.value.push({qty:1,attachment:{}}),O()},Ce=(a,s)=>{V.value.splice(s,1),O()},qe=()=>{D.value={status:!0,type:"info",text:"Please wait..."};let a=V.value.map((e,o)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),s={data:r.value,assets:a,approval:S.value,profile_id:m.user.profile.id,role:m.user.profile.role,type:"transfer"};q(m.token).post("/api/request-asset/store-update/data",s).then(e=>{let o="",v="";e.data.message?(o=e.data.message,v="success"):e.data.error&&(o=e.data.error,v="error"),D.value={status:!0,type:v,text:o},k.params.id||setTimeout(()=>{ge.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(w=>{})},800)}).catch(e=>{console.log(e)})},S=p([]),N=p(!0),ee=async()=>{await q(m.token).get("/api/fetch/request-asset/approval-setup-fetch/"+r.value.request_type_id).then(a=>{var s,e;S.value=(s=a.data)==null?void 0:s.stages,k.params.id&&S.value.length>0&&S.value.map((o,v)=>(o.profile_id=U.value[v].profile_id,o.status=U.value[v].status,o.date_approved=U.value[v].date_approved,o.reason_rejected=U.value[v].reason_rejected,o)),((e=a.data)==null?void 0:e.stages.length)>0?N.value=!0:N.value=!1}).catch(a=>{})},O=()=>{let a=!1;F.value=!1,r.value.company_id&&r.value.request_type_id&&r.value.subject&&r.value.transferred_from&&r.value.transferred_to&&(a=!0);let s=!0;V.value.map(o=>{o.item_description&&o.reason_for_request||(s=!1)});let e=!0;S.value.map(o=>{o.profile_id||(e=!1)}),e&&s&&a&&(F.value=!0)},te=a=>{let s={status:a,profile_id:m.user.profile.id,ID:u.value.id};q(m.token).post("/api/request-asset/change-request/data",s).then(e=>{D.value={status:!0,type:"success",text:e.data.message},u.value.status=a,ye("saved",e.data.message)}).catch(e=>{})},ae=(a,s=6)=>{let e="00000"+a;return e.substring(e.length-s)},U=p([]),u=p({}),L=p({});Ne(()=>{var a,s;if(xe().then(()=>{Ae().then(()=>{Se()})}),k.params.id){T.value=!0;let e=b.objectdata;u.value=e,r.value.company_id=e.company_id,r.value.request_type_id=e.request_type_id,r.value.subject=e.subject,r.value.transferred_from=e.transferred_from,r.value.transferred_to=e.transferred_to,r.value.id=e.id,r.value.requestor_id=e.profile_id,U.value=e.request_approvals,V.value=e.items,L.value=(s=(a=e.request_approvals)==null?void 0:a.filter(o=>o.status=="awaiting-approval"))==null?void 0:s[0],ee()}else r.value.company_id=m.user.profile.company_id});const Oe=p("https://assets.grandiose.ae"),Ee=ie(()=>{var c,se,le,oe,de;let a=null,s=Oe.value+"/pv/employee-signatory",e=fe(50),o=fe(50),v=95,w=99;return((se=(c=m.user)==null?void 0:c.profile)==null?void 0:se.id)==((le=L.value)==null?void 0:le.profile_id)&&(v=(oe=L.value)==null?void 0:oe.profile_id,w=(de=L.value)==null?void 0:de.orders),u.value&&(a=s+"/transfer/approvals?o="+w+"&key="+e+"&pid="+v+"&pv="+o+"&id="+u.value.id),a}),M=ie(()=>m.user.role=="receiving-releasing"||m.user.role=="facility");return ne(r.value,async(a,s)=>{O()}),ne(V.value,async(a,s)=>{O()}),(a,s)=>(i(),h(Qe,null,{default:d(()=>[l(Ye,{title:b.headertitle,class:"no-print"},null,8,["title"]),l(f,{class:"mb-3"},{default:d(()=>[l(Le,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:d(()=>[l(E,null,{default:d(()=>[l(Ie,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:d(()=>[t("div",null,n(b.headertitle),1),N.value?y("",!0):(i(),g("div",Ke,n(G.value),1)),T.value?(i(),g("div",{key:1,class:re(u.value.status=="cancelled"?"text-error":u.value.status=="complete"?"text-success":"")}," STATUS ("+n(u.value.status)+") ",3)):y("",!0),t("div",null,"DATE: "+n(_(me)(Ve.value)),1)]),_:1}),l(Q),l(Y,null,{default:d(()=>[l(f,{class:"no-print"},{default:d(()=>[T.value?(i(),g("div",{key:0,class:re(`${u.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+n(ae(u.value.id)),3)):y("",!0),M.value?y("",!0):(i(),g("div",He,[T.value&&(u.value.status=="pending"||u.value.status=="cancelled")?(i(),g("div",Je,[u.value.status=="pending"?(i(),h(x,{key:0,onClick:s[0]||(s[0]=e=>te("cancelled")),size:"small",color:"warning"},{default:d(()=>[C("Cancel request")]),_:1})):y("",!0),u.value.status=="cancelled"?(i(),h(x,{key:1,onClick:s[1]||(s[1]=e=>te("pending")),size:"small",color:"info"},{default:d(()=>[C("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)])),t("div",We,[l(j,{items:J.value,modelValue:r.value.request_type_id,"onUpdate:modelValue":[s[2]||(s[2]=e=>r.value.request_type_id=e),ee],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:T.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),t("div",Xe,[l(j,{items:W.value,modelValue:r.value.company_id,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),t("div",Ze,[l(j,{items:z.value,modelValue:r.value.transferred_from,"onUpdate:modelValue":s[4]||(s[4]=e=>r.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),t("div",et,[l(j,{items:z.value,modelValue:r.value.transferred_to,"onUpdate:modelValue":s[5]||(s[5]=e=>r.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),t("div",tt,[l(A,{modelValue:r.value.subject,"onUpdate:modelValue":s[6]||(s[6]=e=>r.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1}),l(f,{class:"for-print-flex mx-2 mb-1"},{default:d(()=>{var e,o;return[t("div",at,"REQUEST NO: SN-3"+n(ae(u.value.id)),1),t("div",st,"TYPE OF REQUEST: "+n(H.value),1),t("div",lt,"COMPANY: "+n((o=(e=u.value)==null?void 0:e.company)==null?void 0:o.title),1),t("div",ot,"LOCATION FROM: "+n(X.value),1),t("div",dt,"LOCATION TO: "+n(Z.value),1),t("div",it,"SUBJECT: "+n(u.value.subject),1)]}),_:1})]),_:1})]),_:1}),l(E,{class:"my-2"},{default:d(()=>[l(Y,null,{default:d(()=>[M.value?y("",!0):(i(),h(f,{key:0},{default:d(()=>{var e;return[t("div",nt,[!_(k).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||_(m).user.profile.role=="superadmin"||_(m).user.profile.role=="administrator"?(i(),h(x,{key:0,size:"small",color:"primary",class:"no-print",onClick:Ue},{default:d(()=>[C("Add")]),_:1})):y("",!0)])]}),_:1})),l(f,{class:"for-print-flex mx-2 header mb-1"},{default:d(()=>[rt,ut,ct,pt,vt,_t,mt]),_:1}),(i(!0),g(R,null,I(V.value,(e,o)=>(i(),h(f,{key:o,class:"for-print-flex mx-2 row-bordered"},{default:d(()=>[t("div",ft,n(e.item_description),1),t("div",ht,n(e.asset_code),1),t("div",yt,n(e.qty),1),t("div",gt,n(e.uom),1),t("div",Vt,n(e.weight),1),t("div",wt,n(e.item_value),1),t("div",bt,n(e.reason_for_request),1)]),_:2},1024))),128)),(i(!0),g(R,null,I(V.value,(e,o)=>(i(),h(f,{key:o,class:"no-print"},{default:d(()=>{var v,w;return[t("div",kt,[(v=e.attachment)!=null&&v.id?(i(),h(f,{key:0,class:"px-1"},{default:d(()=>[t("div",Tt,[l(A,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":c=>e.attachment.id=c},null,8,["modelValue","onUpdate:modelValue"]),l(x,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:a.mdiClose,size:"16px",color:"error",onClick:()=>Te(o,e.attachment.id)},null,8,["icon","onClick"]),l(E,{onClick:()=>ke(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),l(Fe,{modelValue:P.value,"onUpdate:modelValue":s[7]||(s[7]=c=>P.value=c),width:"95%","max-width":"900"},{default:d(()=>[l(E,{class:"bg-black"},{default:d(()=>[t("div",xt,[l(Be,{src:we.value+"/file/"+K.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(i(),h(f,{key:1,class:"mt-0"},{default:d(()=>[t("div",At,[l(Pe,{color:"grey-lighten-4",class:"text-center"},{default:d(()=>[l($e,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:c=>be(o,c)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),t("div",St,[l(ue,{modelValue:e.item_description,"onUpdate:modelValue":c=>e.item_description=c,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*",rows:"2",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ut,[l(A,{modelValue:e.asset_code,"onUpdate:modelValue":c=>e.asset_code=c,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ct,[l(A,{type:"number",modelValue:e.qty,"onUpdate:modelValue":c=>e.qty=c,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",qt,[l(A,{modelValue:e.uom,"onUpdate:modelValue":c=>e.uom=c,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"UOM"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ot,[l(A,{type:"number",modelValue:e.weight,"onUpdate:modelValue":c=>e.weight=c,variant:"outlined",density:"compact",class:"no-print","hide-details":"",label:"WGT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Et,[l(A,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":c=>e.item_value=c,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",jt,[l(ue,{modelValue:e.reason_for_request,"onUpdate:modelValue":c=>e.reason_for_request=c,variant:"outlined",density:"compact","hide-details":"",rows:"2",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!T.value||T.value&&_(m).user.profile.id==b.objectdata.profile_id&&((w=b.objectdata)==null?void 0:w.status)=="pending"?(i(),h($,{key:0,size:"small",onClick:()=>Ce(e.id,o),icon:_(ze),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(E,{class:"my-2 page-break"},{default:d(()=>[l(Y,null,{default:d(()=>[l(f,null,{default:d(()=>[t("div",Rt,[Dt,_(k).params.id?(i(),g("div",Nt,[l(x,{color:"info",size:"small",target:"_blank",href:Ee.value},{default:d(()=>[C("View Approval Page")]),_:1},8,["href"])])):y("",!0)]),l(Q)]),_:1}),l(f,{class:"for-print-flex mx-2 mt-5 mb-1"},{default:d(()=>{var e,o;return[Lt,t("div",It,n((o=(e=u.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),Ft,Bt]}),_:1}),(i(!0),g(R,null,I(U.value,e=>(i(),h(f,{class:"for-print-flex mx-2 mb-2 mt-0",key:e.id},{default:d(()=>{var o;return[t("div",Pt,n(B(e.approval_type)),1),t("div",zt,n((o=e==null?void 0:e.profile)==null?void 0:o.display_name),1),t("div",Mt,[e.status?(i(),h($,{key:0,class:"mx-2 my-0",icon:e.status=="awaiting-approval"?_(ce):e.status=="pending"?_(pe):e.status=="reject"?_(ve):_(_e),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0)]),t("div",Qt,n(e.date_approved),1)]}),_:2},1024))),128)),l(f,{class:"no-print"},{default:d(()=>{var e,o;return[Yt,t("div",$t,n((o=(e=u.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),Gt,Kt]}),_:1}),N.value?(i(),g(R,{key:0},[(i(!0),g(R,null,I(S.value,(e,o)=>(i(),h(f,{key:e.id,class:"no-print"},{default:d(()=>[t("div",Ht,n(e.types?B(e.types):B(e.approval_type)),1),t("div",Jt,[l(j,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[v=>e.profile_id=v,O],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),l(x,{variant:"text",size:"x-small",class:"no-print"},{default:d(()=>[e.status?(i(),h($,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?_(ce):e.status=="pending"?_(pe):e.status=="reject"?_(ve):_(_e),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),l(Me,{activator:"parent",location:"top","max-width":"400"},{default:d(()=>[C(n(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),t("div",Wt,n(e.date_approved?_(me)(e.date_approved):""),1)]),_:2},1024))),128)),l(f,{class:"no-print"},{default:d(()=>{var e;return[l(Q),M.value?y("",!0):(i(),g("div",Xt,[(!_(k).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||_(m).user.profile.role=="asset-supervisor"||_(m).user.profile.role=="superadmin"||_(m).user.profile.role=="administrator")&&u.value.status!="complete"?(i(),h(x,{key:0,size:"small",disabled:!F.value,onClick:qe,color:"primary"},{default:d(()=>[C(n(_(k).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)]))]}),_:1})],64)):(i(),h(f,{key:1},{default:d(()=>[t("div",Zt,n(G.value),1)]),_:1})),l(f,null,{default:d(()=>[ea]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Ge,{options:D.value},null,8,["options"])]),_:1}))}};export{ia as _};
