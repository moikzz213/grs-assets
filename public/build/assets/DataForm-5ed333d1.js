import{e as he,d as v,I as ye,u as ge,K as Ve,J as W,o as r,f as _,w as s,g as a,A as be,q as E,V as ke,b as o,t as y,c as w,C as g,as as X,E as m,H as P,i as $,z as f,m as q,h as O,L as D,l as A,y as Z,U as Ae,W as Ce,X as we,T as xe,P as Ue,D as ee,O as qe,F as M,aC as Se,aD as Te,aE as je,aF as Ee,aG as Oe,v as De,x as S}from"./app-0d23d45f.js";import{_ as Re}from"./ApppageHeader-18a51581.js";import{_ as Le}from"./Studio-a21aebc6.js";import{_ as Ne}from"./AppSnackBar-f80050c1.js";import{u as te}from"./formatDate-b9aad8c5.js";const ze={key:0,class:"text-error text-h6"},Fe={class:"v-col-8 text-right"},Ie={key:0},Be={class:"v-col-12 v-col-md-6"},Pe={class:"v-col-12 v-col-md-6"},$e={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12 v-col-md-6"},Ge={class:"v-col-12"},Ye={class:"v-col-12"},He={class:"v-col-12 v-col-md-1 px-1"},Ke={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},Qe={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Je={class:"v-col-12 pt-0 pb-0"},We={class:"v-col-12 v-col-md-3"},Xe={class:"v-col-12 v-col-md-2"},Ze={class:"v-col-12 v-col-md-1"},et={class:"v-col-12 v-col-md-1"},tt={class:"v-col-12 v-col-md-1"},at={class:"v-col-12 v-col-md-3 d-flex"},lt=o("div",{class:"v-col-12 font-weight-bold text-uppercase"}," APPROVAL SETUP ",-1),st=o("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),ot={class:"v-col-12 v-col-md-6"},dt=o("div",{class:"v-col-12 v-col-md-1"},"Status",-1),it=o("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),ut={class:"v-col-12 v-col-md-2"},nt={class:"v-col-12 v-col-md-7 d-flex"},rt={class:"my-auto"},ct={class:"v-col-12"},vt={class:"v-col-12 text-error"},pt=o("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),gt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(ae,{emit:le}){const b=ae,p=he(),G=v("Note: Administrator needs to setup signatories first."),z=v(!1),x=ye(),se=ge(),d=v({}),C=v(!1),V=v([{qty:1,attachment:{}}]),oe=v(new Date),Y=t=>{if(t=="approve")return"Approval By";if(t=="reviewer")return"Review By";if(t=="receiver")return"Receiver";if(t=="transport")return"Trasportation Arrangement";if(t=="releasing")return"Asset Releasing";if(t=="verify")return"Verify By"},de=v(window.location.origin),ie=(t,l)=>{V.value[t].attachment=l[0]},F=v(!1),I=v(1),ue=t=>{I.value=t,F.value=!0},ne=t=>{V.value[t].attachment=""},H=v([]),re=async()=>{let t="request";b.headertitle=="Transfer Assets"&&(t="transfer"),await S(p.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(l=>{H.value=l.data}).catch(l=>{})},R=v({}),K=v([]),ce=async()=>{await S(p.token).get("/api/fetch/companies").then(t=>{K.value=t.data}).catch(t=>{})},B=v([]),ve=async()=>{await S(p.token).get("/api/fetch/locations/non-paginated/data").then(t=>{B.value=t.data}).catch(t=>{})},pe=()=>{V.value.push({qty:1,attachment:{}}),T()},me=(t,l)=>{V.value.splice(l,1),T()},_e=()=>{R.value={status:!0,type:"info",text:"Please wait..."};let t=V.value.map((e,n)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:d.value,assets:t,approval:k.value,profile_id:p.user.profile.id,role:p.user.profile.role,type:"transfer"};S(p.token).post("/api/request-asset/store-update/data",l).then(e=>{let n="",h="";e.data.message?(n=e.data.message,h="success"):e.data.error&&(n=e.data.error,h="error"),R.value={status:!0,type:h,text:n},x.params.id||setTimeout(()=>{se.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(U=>{})},800)}).catch(e=>{console.log(e)})},k=v([]),L=v(!0),Q=async()=>{await S(p.token).get("/api/fetch/request-asset/approval-setup-fetch/"+d.value.request_type_id).then(t=>{var l,e,n,h,U,u;k.value=(l=t.data)==null?void 0:l.stages,x.params.id&&k.value.length>0&&(k.value.map((j,N)=>(j.profile_id=i.value[N].profile_id,j.status=i.value[N].status,j.date_approved=i.value[N].date_approved,j.reason_rejected=i.value[N].reason_rejected,j)),k.value.length>1&&(k.value[i.value.length-1]={id:i.value[i.value.length-1].id,profile_id:i.value[i.value.length-1].profile_id,status:i.value[i.value.length-1].status,date_approved:i.value[i.value.length-1].date_approved,status:i.value[i.value.length-1].status,reason_rejected:"",types:i.value[i.value.length-1].approval_type,sort:i.value[i.value.length-1].orders,request_asset_id:i.value[i.value.length-1].request_asset_id,signatures:[{id:(e=c.value.profile)==null?void 0:e.id,display_name:(n=c.value.profile)==null?void 0:n.display_name,first_name:(h=c.value.profile)==null?void 0:h.first_name,last_name:(U=c.value.profile)==null?void 0:U.last_name}]})),((u=t.data)==null?void 0:u.stages.length)>0?L.value=!0:L.value=!1}).catch(t=>{})},T=()=>{let t=!1;z.value=!1,d.value.company_id&&d.value.request_type_id&&d.value.subject&&d.value.transferred_from&&d.value.transferred_to&&(t=!0);let l=!0;V.value.map(n=>{n.item_description||(l=!1)});let e=!0;k.value.map(n=>{n.profile_id||(e=!1)}),e&&l&&t&&(z.value=!0)},J=t=>{let l={status:t,profile_id:p.user.profile.id,ID:c.value.id};S(p.token).post("/api/request-asset/change-request/data",l).then(e=>{R.value={status:!0,type:"success",text:e.data.message},le("saved",e.data.message)}).catch(e=>{})},fe=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},i=v([]),c=v({});return Ve(()=>{if(re().then(()=>{ce().then(()=>{ve()})}),x.params.id){C.value=!0;let t=b.objectdata;c.value=t,d.value.company_id=t.company_id,d.value.request_type_id=t.request_type_id,d.value.subject=t.subject,d.value.transferred_from=t.transferred_from,d.value.transferred_to=t.transferred_to,d.value.id=t.id,d.value.requestor_id=t.profile_id,i.value=t.request_approvals,V.value=t.items,Q()}else d.value.company_id=p.user.profile.company_id}),W(d.value,async(t,l)=>{T()}),W(V.value,async(t,l)=>{T()}),(t,l)=>(r(),_(De,null,{default:s(()=>[a(Re,{title:b.headertitle},null,8,["title"]),a(f,{class:"mb-3"},{default:s(()=>[a(be,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[a(E,null,{default:s(()=>[a(ke,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:s(()=>[o("div",null,y(b.headertitle),1),L.value?g("",!0):(r(),w("div",ze,y(G.value),1)),C.value?(r(),w("div",{key:1,class:X(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+y(c.value.status)+") ",3)):g("",!0),o("div",null,"DATE: "+y(m(te)(oe.value)),1)]),_:1}),a(P),a($,null,{default:s(()=>[a(f,null,{default:s(()=>[C.value?(r(),w("div",{key:0,class:X(`${c.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+y(fe(c.value.id)),3)):g("",!0),o("div",Fe,[C.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(r(),w("div",Ie,[c.value.status=="pending"?(r(),_(q,{key:0,onClick:l[0]||(l[0]=e=>J("cancelled")),size:"small",color:"warning"},{default:s(()=>[O("Cancel request")]),_:1})):g("",!0),c.value.status=="cancelled"?(r(),_(q,{key:1,onClick:l[1]||(l[1]=e=>J("pending")),size:"small",color:"info"},{default:s(()=>[O("Change status to Pending")]),_:1})):g("",!0)])):g("",!0)]),o("div",Be,[a(D,{items:H.value,modelValue:d.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>d.value.request_type_id=e),Q],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:C.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),o("div",Pe,[a(D,{items:K.value,modelValue:d.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),o("div",$e,[a(D,{items:B.value,modelValue:d.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),o("div",Me,[a(D,{items:B.value,modelValue:d.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),o("div",Ge,[a(A,{modelValue:d.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>d.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(E,{class:"my-2"},{default:s(()=>[a($,null,{default:s(()=>[a(f,null,{default:s(()=>{var e;return[o("div",Ye,[!m(x).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||m(p).user.profile.role=="superadmin"||m(p).user.profile.role=="administrator"?(r(),_(q,{key:0,size:"small",color:"primary",onClick:pe},{default:s(()=>[O("Add")]),_:1})):g("",!0)])]}),_:1}),(r(!0),w(M,null,Z(V.value,(e,n)=>(r(),_(f,{key:n},{default:s(()=>{var h,U;return[o("div",He,[(h=e.attachment)!=null&&h.id?(r(),_(f,{key:0,class:"px-1"},{default:s(()=>[o("div",Ke,[a(A,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":u=>e.attachment.id=u},null,8,["modelValue","onUpdate:modelValue"]),a(q,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:t.mdiClose,size:"16px",color:"error",onClick:()=>ne(n,e.attachment.id)},null,8,["icon","onClick"]),a(E,{onClick:()=>ue(n),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(Ae,{modelValue:F.value,"onUpdate:modelValue":l[8]||(l[8]=u=>F.value=u),width:"95%","max-width":"900"},{default:s(()=>[a(E,{class:"bg-black"},{default:s(()=>[a(Ce,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:I.value,"onUpdate:modelValue":l[7]||(l[7]=u=>I.value=u)},{default:s(()=>[a(we,{"reverse-transition":"fade",transition:"fade"},{default:s(()=>[o("div",Qe,[a(xe,{src:de.value+"/file/"+e.attachment.path},null,8,["src"])])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)):(r(),_(f,{key:1,class:"mt-0"},{default:s(()=>[o("div",Je,[a(Ue,{color:"grey-lighten-4",class:"text-center"},{default:s(()=>[a(Le,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:u=>ie(n,u)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),o("div",We,[a(A,{modelValue:e.item_description,"onUpdate:modelValue":u=>e.item_description=u,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Xe,[a(A,{modelValue:e.asset_code,"onUpdate:modelValue":u=>e.asset_code=u,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ze,[a(A,{type:"number",modelValue:e.qty,"onUpdate:modelValue":u=>e.qty=u,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",et,[a(A,{type:"number",modelValue:e.weight,"onUpdate:modelValue":u=>e.weight=u,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",tt,[a(A,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":u=>e.item_value=u,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",at,[a(A,{modelValue:e.reason_for_request,"onUpdate:modelValue":u=>e.reason_for_request=u,variant:"outlined",density:"compact","hide-details":"",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!C.value||C.value&&m(p).user.profile.id==b.objectdata.profile_id&&((U=b.objectdata)==null?void 0:U.status)=="pending"?(r(),_(ee,{key:0,size:"small",onClick:()=>me(e.id,n),icon:m(qe),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):g("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(E,{class:"my-2"},{default:s(()=>[a($,null,{default:s(()=>[a(f,null,{default:s(()=>[lt,a(P)]),_:1}),a(f,null,{default:s(()=>{var e,n;return[st,o("div",ot,y((n=(e=c.value)==null?void 0:e.profile)==null?void 0:n.display_name),1),dt,it]}),_:1}),L.value?(r(),w(M,{key:0},[(r(!0),w(M,null,Z(k.value,(e,n)=>(r(),_(f,{key:e.id},{default:s(()=>[o("div",ut,y(e.types?Y(e.types):Y(e.approval_type)),1),o("div",nt,[a(D,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[h=>e.profile_id=h,T],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(q,{variant:"text",size:"x-small"},{default:s(()=>[e.status?(r(),_(ee,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?m(Se):e.status=="pending"?m(Te):e.status=="reject"?m(je):m(Ee),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):g("",!0),a(Oe,{activator:"parent",location:"top","max-width":"400"},{default:s(()=>[O(y(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),o("div",rt,y(e.date_approved?m(te)(e.date_approved):""),1)]),_:2},1024))),128)),a(f,null,{default:s(()=>{var e;return[a(P),o("div",ct,[(!m(x).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||m(p).user.profile.role=="asset-supervisor"||m(p).user.profile.role=="superadmin"||m(p).user.profile.role=="administrator")&&c.value.status!="complete"?(r(),_(q,{key:0,size:"small",disabled:!z.value,onClick:_e,color:"primary"},{default:s(()=>[O(y(m(x).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):g("",!0)])]}),_:1})],64)):(r(),_(f,{key:1},{default:s(()=>[o("div",vt,y(G.value),1)]),_:1})),a(f,null,{default:s(()=>[pt]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Ne,{options:R.value},null,8,["options"])]),_:1}))}};export{gt as _};
