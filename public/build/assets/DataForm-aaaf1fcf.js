import{a as Se,r as c,I as Ee,u as Ue,K as Ce,T as ae,J as se,o as i,c as h,w as d,d as s,v as qe,k as O,V as Oe,b as a,t as n,p as g,y,ag as le,E as p,H as M,f as Q,s as f,j as A,e as U,L as R,i as w,q as L,F as j,X as Re,W as je,P as De,D as Y,O as Ne,aE as oe,aF as de,aG as ie,aH as ne,aI as Le,m as Ie,n as C}from"./app-f387ecc1.js";import{_ as Fe}from"./ApppageHeader-72bbaec7.js";import{_ as Be}from"./Studio-5fffe9b6.js";import{_ as Pe}from"./AppSnackBar-17f5c8e8.js";import{u as re}from"./formatDate-b9aad8c5.js";import{r as ue}from"./generateRandomString-02c0ba3b.js";const ze={key:0,class:"text-error text-h6"},Me={key:1,class:"v-col-8 text-right"},Qe={key:0,class:"no-print"},Ye={key:2,class:"v-col-8 text-right"},$e={class:"v-col-12 v-col-md-6"},Ge={class:"v-col-12 v-col-md-6"},He={class:"v-col-12 v-col-md-6"},Ke={class:"v-col-12 v-col-md-6"},Je={class:"v-col-12"},We={class:"wd-100"},Xe={class:"wd-60 text-caption"},Ze={class:"wd-40"},et={class:"wd-60"},tt={class:"wd-40"},at={class:"wd-100"},st={class:"v-col-12"},lt=a("div",{class:"wd-30"},"ITEM DESCRIPTION",-1),ot=a("div",{class:"wd-15"},"ASSET CODE",-1),dt=a("div",{class:"wd-10"},"QTY",-1),it=a("div",{class:"wd-10"},"WEIGHT",-1),nt=a("div",{class:"wd-10"},"VALUE",-1),rt=a("div",{class:"wd-20"},"REASON FOR REQUEST",-1),ut={class:"wd-30"},ct={class:"wd-15"},pt={class:"wd-10"},vt={class:"wd-10"},_t={class:"wd-10"},mt={class:"wd-20"},ft={class:"v-col-12 v-col-md-1 px-1 no-print"},ht={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},yt={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},gt={class:"v-col-12 pt-0 pb-0"},Vt={class:"v-col-12 v-col-md-3"},bt={class:"v-col-12 v-col-md-2"},wt={class:"v-col-12 v-col-md-1"},kt={class:"v-col-12 v-col-md-1"},Tt={class:"v-col-12 v-col-md-1"},xt={class:"v-col-12 v-col-md-3 d-flex"},At={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},St=a("div",null,"APPROVAL SETUP",-1),Et={key:0,class:"no-print"},Ut=a("div",{class:"wd-20"},"Requestor",-1),Ct={class:"wd-50"},qt=a("div",{class:"wd-10"},"Status",-1),Ot=a("div",{class:"wd-20"},"Date Approved",-1),Rt={class:"wd-20"},jt={class:"wd-50"},Dt={class:"wd-10"},Nt={class:"wd-20"},Lt=a("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),It={class:"v-col-12 v-col-md-6"},Ft=a("div",{class:"v-col-12 v-col-md-1"},"Status",-1),Bt=a("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),Pt={class:"v-col-12 v-col-md-2"},zt={class:"v-col-12 v-col-md-7 d-flex"},Mt={class:"my-auto"},Qt={key:0,class:"v-col-12 no-print"},Yt={class:"v-col-12 text-error"},$t=a("div",{class:"v-col-12 no-print v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),Zt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(ce,{emit:pe}){const b=ce,v=Se(),$=c("Note: Administrator needs to setup signatories first."),I=c(!1),k=Ee(),ve=Ue(),r=c({}),T=c(!1),V=c([{qty:1,attachment:{}}]),_e=c(new Date),F=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},me=c(window.location.origin),fe=(t,l)=>{V.value[t].attachment=l[0]},B=c(!1),G=c(1),he=t=>{G.value=t,B.value=!0},ye=t=>{V.value[t].attachment=""},H=c(""),K=c([]),ge=async()=>{let t="request";b.headertitle=="Transfer Assets"&&(t="transfer"),await C(v.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(l=>{var e,o;K.value=l.data,H.value=(o=(e=l.data.filter(_=>_.id==u.value.request_type_id))==null?void 0:e[0])==null?void 0:o.title}).catch(l=>{})},D=c({}),J=c([]),Ve=async()=>{await C(v.token).get("/api/fetch/companies").then(t=>{J.value=t.data}).catch(t=>{})},W=c(""),X=c(""),P=c([]),be=async()=>{await C(v.token).get("/api/fetch/locations/non-paginated/data").then(t=>{var l,e,o,_;P.value=t.data,W.value=(e=(l=t.data.filter(x=>x.id==u.value.transferred_from))==null?void 0:l[0])==null?void 0:e.title,X.value=(_=(o=t.data.filter(x=>x.id==u.value.transferred_to))==null?void 0:o[0])==null?void 0:_.title}).catch(t=>{})},we=()=>{V.value.push({qty:1,attachment:{}}),q()},ke=(t,l)=>{V.value.splice(l,1),q()},Te=()=>{D.value={status:!0,type:"info",text:"Please wait..."};let t=V.value.map((e,o)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:r.value,assets:t,approval:S.value,profile_id:v.user.profile.id,role:v.user.profile.role,type:"transfer"};C(v.token).post("/api/request-asset/store-update/data",l).then(e=>{let o="",_="";e.data.message?(o=e.data.message,_="success"):e.data.error&&(o=e.data.error,_="error"),D.value={status:!0,type:_,text:o},k.params.id||setTimeout(()=>{ve.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(x=>{})},800)}).catch(e=>{console.log(e)})},S=c([]),N=c(!0),Z=async()=>{await C(v.token).get("/api/fetch/request-asset/approval-setup-fetch/"+r.value.request_type_id).then(t=>{var l,e;S.value=(l=t.data)==null?void 0:l.stages,k.params.id&&S.value.length>0&&S.value.map((o,_)=>(o.profile_id=E.value[_].profile_id,o.status=E.value[_].status,o.date_approved=E.value[_].date_approved,o.reason_rejected=E.value[_].reason_rejected,o)),((e=t.data)==null?void 0:e.stages.length)>0?N.value=!0:N.value=!1}).catch(t=>{})},q=()=>{let t=!1;I.value=!1,r.value.company_id&&r.value.request_type_id&&r.value.subject&&r.value.transferred_from&&r.value.transferred_to&&(t=!0);let l=!0;V.value.map(o=>{o.item_description&&o.reason_for_request||(l=!1)});let e=!0;S.value.map(o=>{o.profile_id||(e=!1)}),e&&l&&t&&(I.value=!0)},ee=t=>{let l={status:t,profile_id:v.user.profile.id,ID:u.value.id};C(v.token).post("/api/request-asset/change-request/data",l).then(e=>{D.value={status:!0,type:"success",text:e.data.message},u.value.status=t,pe("saved",e.data.message)}).catch(e=>{})},te=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},E=c([]),u=c({});Ce(()=>{if(ge().then(()=>{Ve().then(()=>{be()})}),k.params.id){T.value=!0;let t=b.objectdata;u.value=t,r.value.company_id=t.company_id,r.value.request_type_id=t.request_type_id,r.value.subject=t.subject,r.value.transferred_from=t.transferred_from,r.value.transferred_to=t.transferred_to,r.value.id=t.id,r.value.requestor_id=t.profile_id,E.value=t.request_approvals,V.value=t.items,Z()}else r.value.company_id=v.user.profile.company_id});const xe=c("https://assets.grandiose.ae/"),Ae=ae(()=>{let t=null,l=xe.value+"pv/employee-signatory",e=ue(50),o=ue(50);return u.value&&(t=l+"/transfer/approvals?o=99&key="+e+"&pid=95&pv="+o+"&id="+u.value.id),t}),z=ae(()=>v.user.role=="receiving-releasing"||v.user.role=="facility");return se(r.value,async(t,l)=>{q()}),se(V.value,async(t,l)=>{q()}),(t,l)=>(i(),h(Ie,null,{default:d(()=>[s(Fe,{title:b.headertitle,class:"no-print"},null,8,["title"]),s(f,{class:"mb-3"},{default:d(()=>[s(qe,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:d(()=>[s(O,null,{default:d(()=>[s(Oe,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:d(()=>[a("div",null,n(b.headertitle),1),N.value?y("",!0):(i(),g("div",ze,n($.value),1)),T.value?(i(),g("div",{key:1,class:le(u.value.status=="cancelled"?"text-error":u.value.status=="complete"?"text-success":"")}," STATUS ("+n(u.value.status)+") ",3)):y("",!0),a("div",null,"DATE: "+n(p(re)(_e.value)),1)]),_:1}),s(M),s(Q,null,{default:d(()=>[s(f,{class:"no-print"},{default:d(()=>[T.value?(i(),g("div",{key:0,class:le(`${u.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+n(te(u.value.id)),3)):y("",!0),z.value?y("",!0):(i(),g("div",Me,[T.value&&(u.value.status=="pending"||u.value.status=="cancelled")?(i(),g("div",Qe,[u.value.status=="pending"?(i(),h(A,{key:0,onClick:l[0]||(l[0]=e=>ee("cancelled")),size:"small",color:"warning"},{default:d(()=>[U("Cancel request")]),_:1})):y("",!0),u.value.status=="cancelled"?(i(),h(A,{key:1,onClick:l[1]||(l[1]=e=>ee("pending")),size:"small",color:"info"},{default:d(()=>[U("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)])),u.value.status=="complete"?(i(),g("div",Ye)):y("",!0),a("div",$e,[s(R,{items:K.value,modelValue:r.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>r.value.request_type_id=e),Z],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:T.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),a("div",Ge,[s(R,{items:J.value,modelValue:r.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>r.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),a("div",He,[s(R,{items:P.value,modelValue:r.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>r.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),a("div",Ke,[s(R,{items:P.value,modelValue:r.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>r.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),a("div",Je,[s(w,{modelValue:r.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>r.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1}),s(f,{class:"for-print-flex mx-2 mb-1"},{default:d(()=>{var e,o;return[a("div",We,"REQUEST NO: SN-3"+n(te(u.value.id)),1),a("div",Xe,"TYPE OF REQUEST: "+n(H.value),1),a("div",Ze,"COMPANY: "+n((o=(e=u.value)==null?void 0:e.company)==null?void 0:o.title),1),a("div",et,"LOCATION FROM: "+n(W.value),1),a("div",tt,"LOCATION TO: "+n(X.value),1),a("div",at,"SUBJECT: "+n(u.value.subject),1)]}),_:1})]),_:1})]),_:1}),s(O,{class:"my-2"},{default:d(()=>[s(Q,null,{default:d(()=>[z.value?y("",!0):(i(),h(f,{key:0},{default:d(()=>{var e;return[a("div",st,[!p(k).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="administrator"?(i(),h(A,{key:0,size:"small",color:"primary",class:"no-print",onClick:we},{default:d(()=>[U("Add")]),_:1})):y("",!0)])]}),_:1})),s(f,{class:"for-print-flex mx-2 header mb-1"},{default:d(()=>[lt,ot,dt,it,nt,rt]),_:1}),(i(!0),g(j,null,L(V.value,(e,o)=>(i(),h(f,{key:o,class:"for-print-flex mx-2 row-bordered"},{default:d(()=>[a("div",ut,n(e.item_description),1),a("div",ct,n(e.asset_code),1),a("div",pt,n(e.qty),1),a("div",vt,n(e.weight),1),a("div",_t,n(e.item_value),1),a("div",mt,n(e.reason_for_request),1)]),_:2},1024))),128)),(i(!0),g(j,null,L(V.value,(e,o)=>(i(),h(f,{key:o,class:"no-print"},{default:d(()=>{var _,x;return[a("div",ft,[(_=e.attachment)!=null&&_.id?(i(),h(f,{key:0,class:"px-1"},{default:d(()=>[a("div",ht,[s(w,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":m=>e.attachment.id=m},null,8,["modelValue","onUpdate:modelValue"]),s(A,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:t.mdiClose,size:"16px",color:"error",onClick:()=>ye(o,e.attachment.id)},null,8,["icon","onClick"]),s(O,{onClick:()=>he(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),s(Re,{modelValue:B.value,"onUpdate:modelValue":l[7]||(l[7]=m=>B.value=m),width:"95%","max-width":"900"},{default:d(()=>[s(O,{class:"bg-black"},{default:d(()=>[a("div",yt,[s(je,{src:me.value+"/file/"+G.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(i(),h(f,{key:1,class:"mt-0"},{default:d(()=>[a("div",gt,[s(De,{color:"grey-lighten-4",class:"text-center"},{default:d(()=>[s(Be,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:m=>fe(o,m)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),a("div",Vt,[s(w,{modelValue:e.item_description,"onUpdate:modelValue":m=>e.item_description=m,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",bt,[s(w,{modelValue:e.asset_code,"onUpdate:modelValue":m=>e.asset_code=m,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",wt,[s(w,{type:"number",modelValue:e.qty,"onUpdate:modelValue":m=>e.qty=m,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",kt,[s(w,{type:"number",modelValue:e.weight,"onUpdate:modelValue":m=>e.weight=m,variant:"outlined",density:"compact",class:"no-print","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Tt,[s(w,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":m=>e.item_value=m,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",xt,[s(w,{modelValue:e.reason_for_request,"onUpdate:modelValue":m=>e.reason_for_request=m,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"REASON FOR REQUEST*"},null,8,["modelValue","onUpdate:modelValue"]),!T.value||T.value&&p(v).user.profile.id==b.objectdata.profile_id&&((x=b.objectdata)==null?void 0:x.status)=="pending"?(i(),h(Y,{key:0,size:"small",onClick:()=>ke(e.id,o),icon:p(Ne),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),s(O,{class:"my-2 page-break"},{default:d(()=>[s(Q,null,{default:d(()=>[s(f,null,{default:d(()=>[a("div",At,[St,p(k).params.id?(i(),g("div",Et,[s(A,{color:"info",size:"small",target:"_blank",href:Ae.value},{default:d(()=>[U("View Approval Page")]),_:1},8,["href"])])):y("",!0)]),s(M)]),_:1}),s(f,{class:"for-print-flex mx-2 mt-5 mb-1"},{default:d(()=>{var e,o;return[Ut,a("div",Ct,n((o=(e=u.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),qt,Ot]}),_:1}),(i(!0),g(j,null,L(E.value,e=>(i(),h(f,{class:"for-print-flex mx-2 mb-2 mt-0",key:e.id},{default:d(()=>{var o;return[a("div",Rt,n(F(e.approval_type)),1),a("div",jt,n((o=e==null?void 0:e.profile)==null?void 0:o.display_name),1),a("div",Dt,[e.status?(i(),h(Y,{key:0,class:"mx-2 my-0",icon:e.status=="awaiting-approval"?p(oe):e.status=="pending"?p(de):e.status=="reject"?p(ie):p(ne),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0)]),a("div",Nt,n(e.date_approved),1)]}),_:2},1024))),128)),s(f,{class:"no-print"},{default:d(()=>{var e,o;return[Lt,a("div",It,n((o=(e=u.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),Ft,Bt]}),_:1}),N.value?(i(),g(j,{key:0},[(i(!0),g(j,null,L(S.value,(e,o)=>(i(),h(f,{key:e.id,class:"no-print"},{default:d(()=>[a("div",Pt,n(e.types?F(e.types):F(e.approval_type)),1),a("div",zt,[s(R,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[_=>e.profile_id=_,q],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),s(A,{variant:"text",size:"x-small",class:"no-print"},{default:d(()=>[e.status?(i(),h(Y,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?p(oe):e.status=="pending"?p(de):e.status=="reject"?p(ie):p(ne),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),s(Le,{activator:"parent",location:"top","max-width":"400"},{default:d(()=>[U(n(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),a("div",Mt,n(e.date_approved?p(re)(e.date_approved):""),1)]),_:2},1024))),128)),s(f,{class:"no-print"},{default:d(()=>{var e;return[s(M),z.value?y("",!0):(i(),g("div",Qt,[(!p(k).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||p(v).user.profile.role=="asset-supervisor"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="administrator")&&u.value.status!="complete"?(i(),h(A,{key:0,size:"small",disabled:!I.value,onClick:Te,color:"primary"},{default:d(()=>[U(n(p(k).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)]))]}),_:1})],64)):(i(),h(f,{key:1},{default:d(()=>[a("div",Yt,n($.value),1)]),_:1})),s(f,null,{default:d(()=>[$t]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(Pe,{options:D.value},null,8,["options"])]),_:1}))}};export{Zt as _};
