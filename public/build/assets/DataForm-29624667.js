import{i as le,r as f,W as we,o as se,O as Z,b as _,c as L,e as s,l as e,k as a,E as V,j as b,F as Q,d as ee,z as I,K as r,X as Se,A as N,Y as ce,Z as pe,_ as je,$ as Ce,T as De,m as p,D as x,q as E,t as h,P as ae,a0 as _e,M as re,N as $e,u as Ie,I as U,V as xe,a1 as X,a2 as z,y as ve,J as Ae,L as Re,G as j,a3 as Te,a4 as Ue,C as Ne,p as Le,g as Ee}from"./app-3b05f16d.js";import{_ as Fe}from"./ApppageHeader-71c92b8f.js";import{_ as Oe}from"./AppSnackBar-78f94270.js";import{c as Ye,a as H,F as Be,b as G}from"./index.esm-ee7a9c92.js";import{S as Me}from"./StreamBarcodeReader-97c0c597.js";import{_ as Pe}from"./_plugin-vue_export-helper-c27b6911.js";import{u as K,a as We}from"./formatDate-b9aad8c5.js";import{u as qe}from"./status-cc9c9848.js";import{_ as ze}from"./Studio-a6f8966c.js";import{d as me}from"./dayjs.min-24e9f7f5.js";const He={class:"v-col-12 pt-5"},Ge={class:"v-col-12 pb-2"},Ke={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Je={class:"v-col-12 pt-0 pb-2"},Xe={class:"v-col-12"},Ze={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(C,{emit:B}){const d=C,m=le(),t=f(window.location.origin),u=i=>{let c=null;i.map(o=>{c=y.value.find(k=>k.id==o.id),c||y.value.push(o)})},A=f(!1),R=f(1),O=i=>{R.value=i,A.value=!0},M=i=>{y.value=y.value.filter(c=>c.id!==i)},y=f([]),Y=we(()=>y.value.map(i=>i.id)),g=()=>{let i={id:parseInt(d.incidentId),file_ids:Y.value,profile_id:d.objectdata.profile_id};x(m.token).post("/api/incident/sync-images/store-update",i).then(c=>{let o="Attachment has been updated";Y.value.length==0&&(o="Attachment has been deleted"),B("save",o)}).catch(c=>{})};return se(()=>{y.value=d.attachment}),Z(()=>d.objectdata.attachment,(i,c)=>{y.value=i},{deep:!0}),(i,c)=>(_(),L("div",null,[s("div",He,[e(V,null,{default:a(()=>[s("div",Ge,[e(ze,{options:{multiSelect:!0,type:"incident"},onSelect:u})])]),_:1}),y.value.length>0?(_(),b(V,{key:0,class:"px-1"},{default:a(()=>[(_(!0),L(Q,null,ee(y.value,(o,k)=>(_(),L("div",{key:o.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[e(I,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:r(Se),size:"26px",color:"error",onClick:()=>M(o.id)},null,8,["icon","onClick"]),e(N,{onClick:()=>O(k)},{default:a(()=>[e(ce,{src:t.value+"/file/"+o.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),e(pe,{modelValue:A.value,"onUpdate:modelValue":c[1]||(c[1]=o=>A.value=o),width:"95%","max-width":"900"},{default:a(()=>[e(N,{class:"bg-black"},{default:a(()=>[e(je,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:R.value,"onUpdate:modelValue":c[0]||(c[0]=o=>R.value=o)},{default:a(()=>[(_(!0),L(Q,null,ee(y.value,(o,k)=>(_(),b(Ce,{key:k,"reverse-transition":"fade",transition:"fade"},{default:a(()=>[s("div",Ke,[e(ce,{src:t.value+"/file/"+o.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(_(),b(V,{key:1},{default:a(()=>[s("div",Je,[e(De,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:a(()=>[p(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),e(V,null,{default:a(()=>[s("div",Xe,[e(I,{color:"primary",onClick:g},{default:a(()=>[p("Save")]),_:1})])]),_:1})])]))}},Qe={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},et={class:"font-weight-bold"},tt={class:"reported-by"},at={class:"reported-by"},lt={class:"v-col-12"},st={class:"v-col-12 v-col-md-4 pb-0"},ot={class:"v-col-12 v-col-md-8"},it={class:"v-col-12"},dt={class:"v-col-12"},nt={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},ut={class:"v-col-3"},ct=s("br",null,null,-1),rt={class:"v-col-9"},vt={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(C,{emit:B}){const d=C,m=le(),t=f(m.user.profile.role),u=f({}),A=f([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),R=f([]),O=async()=>{await x(m.token).get("/api/fetch/profile-facility/team").then(i=>{R.value=i.data}).catch(i=>{})},M=()=>{u.value.profile_id=m.user.profile.id,x(m.token).post("/api/incident/update-facility-team",u.value).then(i=>{u.value.remarks_data="",B("saved",i.data.message)}).catch(i=>{})},y=f([]),Y=async()=>{await x(m.token).get("/api/fetch-global/incident-status/active").then(i=>{y.value=i.data}).catch(i=>{})},g=(i,c=6)=>{let o="00000"+i;return o.substring(o.length-c)};return se(()=>{O(),Y(),u.value=d.objectdata,u.value.priority=d.objectdata.priority?parseInt(d.objectdata.priority):null}),Z(()=>d.objectdata.remarks,(i,c)=>{u.value.remarks=i},{deep:!0}),(i,c)=>(_(),L("div",null,[e(N,null,{default:a(()=>[e(E,null,{default:a(()=>[e(V,null,{default:a(()=>{var o;return[s("div",Qe,[s("div",et," SN: ISR-"+h(g(u.value.id)),1),s("div",tt," REPORTED BY: "+h((o=u.value.profile)==null?void 0:o.display_name),1),s("div",at," DATE REPORTED: "+h(r(K)(u.value.created_at)),1)])]}),_:1}),e(V,null,{default:a(()=>[s("div",lt,[e(V,null,{default:a(()=>[s("div",st,[e(ae,{items:A.value,modelValue:u.value.priority,"onUpdate:modelValue":c[0]||(c[0]=o=>u.value.priority=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:t.value=="facility"},null,8,["items","modelValue","disabled"]),e(ae,{items:R.value,modelValue:u.value.handled_by,"onUpdate:modelValue":c[1]||(c[1]=o=>u.value.handled_by=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue"]),e(ae,{items:y.value,modelValue:u.value.status_id,"onUpdate:modelValue":c[2]||(c[2]=o=>u.value.status_id=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",ot,[e(_e,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:u.value.remarks_data,"onUpdate:modelValue":c[3]||(c[3]=o=>u.value.remarks_data=o)},null,8,["modelValue"])])]),_:1})]),e(re,{class:"mt-3"}),s("div",it,[e(I,{class:"",size:"small",disabled:!u.value.priority||!u.value.handled_by||!u.value.status_id,onClick:M,color:"primary"},{default:a(()=>[p("Submit")]),_:1},8,["disabled"])])]),_:1}),e(V,null,{default:a(()=>[s("div",dt,[p(" Remarks "),e(re)]),s("div",nt,[(_(!0),L(Q,null,ee(u.value.remarks,o=>(_(),b(V,{key:i.id},{default:a(()=>{var k;return[s("div",ut,[p(h((k=o.profile)==null?void 0:k.display_name)+" ",1),ct,p(),s("small",null,h(r(We)(o.created_at)),1)]),s("div",rt,h(o.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const F=C=>(Le("data-v-245b838e"),C=C(),Ee(),C),mt={class:"v-col py-0"},pt={class:"v-col py-0"},_t={class:"v-col-12 v-col-md-4"},ft=F(()=>s("div",{class:"font-weight-bold"},"SN:",-1)),yt={class:"v-col-12 v-col-md-4"},ht=F(()=>s("div",{class:"font-weight-bold"},"Reported by:",-1)),bt={class:"v-col-12 v-col-md-4"},gt=F(()=>s("div",{class:"font-weight-bold"},"Status",-1)),Vt={class:"v-col-12 v-col-md-4"},kt=F(()=>s("div",{class:"font-weight-bold"},"Date Reported",-1)),wt={class:"v-col-12 v-col-md-4"},St=F(()=>s("div",{class:"font-weight-bold"},"Date Closed",-1)),jt={class:"v-col-12 v-col-md-4"},Ct={class:"v-col-12 v-col-md-4"},Dt={class:"v-col-12 v-col-md-4 d-flex"},$t={class:"v-col-12"},It={class:"v-col-12 v-col-md-6"},xt={class:"v-col-12 v-col-md-6"},At={class:"v-col-12"},Rt={class:"v-col-12"},Tt={key:1},Ut=F(()=>s("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),Nt={class:"v-col-12 v-col-md-12"},Lt=F(()=>s("h5",{class:"headline mb-0 text-center"},[p(" NO WARRANTY FOUND. "),s("br"),p("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),Et={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(C,{emit:B}){const d=C,m=le(),t=f({}),u=f({}),A=n=>{u.value={status:!0,type:"success",text:n},B("saved")},R=f(m.user.profile.id),O=f([]),M=async()=>{await x(m.token).get("/api/fetch-global/incident-types/active").then(n=>{O.value=n.data}).catch(n=>{})},y=$e(),Y=Ie(),g=f(y.query.type),i=qe(),c=f([]);c.value=Object.assign([],i.urgencies_active_list),i.list.length==0&&i.getStatuses(m.token).then(()=>{c.value=Object.assign([],i.urgencies_active_list)});let o=Ye({Type:H().required(),Urgency:H().required(),Title:H().required(),Company:H().required(),Location:H().required()});const k=f(!1),fe=()=>{te.value=!1,k.value=!0},ye=async n=>{t.value.asset_code=n,await x(m.token).get("/api/fetch/asset-info/by/asset-code/"+n).then(l=>{t.value.title=l.data.asset_name,t.value.company_id=l.data.company_id,t.value.location_id=l.data.location_id,t.value.asset_id=l.data.id,k.value=!1}).catch(l=>{})},te=f(!1),he=()=>{te.value=!0},oe=new URL(window.location),J=n=>{g.value=n,ie("type",n)},P=f(!1),W=f(m.user.profile.role),be=async()=>{P.value=!0,u.value={status:!0,type:"info",text:"Please wait..."},t.value.profile_id=m.user.profile.id,await x(m.token).post("/api/store-update/incident",t.value).then(n=>{u.value={status:!0,type:"success",text:n.data.message},y.params.id?P.value=!1:setTimeout(()=>{Y.push({name:"EditIncident",params:{id:n.data.id},query:{type:"details"}}).catch(l=>{}),P.value=!1},800)}).catch(n=>{console.log("save incident error: ",n),P.value=!1})},S=f(!1),ie=(n,l)=>{oe.searchParams.set(n,l),window.history.pushState({},"",oe)},de=f([]),ge=async()=>{await x(m.token).get("/api/fetch/companies").then(n=>{de.value=n.data}).catch(n=>{})},ne=f([]),Ve=async()=>{await x(m.token).get("/api/fetch/locations/non-paginated/data").then(n=>{ne.value=n.data}).catch(n=>{})},ke=(n,l=5)=>{let w="0000"+n;return w.substring(w.length-l)};return se(()=>{y.params.id&&(S.value=!0),g.value||(g.value="details",ie("type","details")),M().then(()=>{ge().then(()=>{Ve()})}),S.value&&(t.value=d.objectdata,t.value.asset_code=d.objectdata.asset?d.objectdata.asset.asset_code:d.objectdata.asset_code,t.value.title=d.objectdata.asset?d.objectdata.asset.asset_name:d.objectdata.title,t.value.company_id=d.objectdata.company_id,t.value.location_id=d.objectdata.location_id,t.value.asset_id=d.objectdata.asset_id,t.value.profile_id=d.objectdata.profile_id,t.value.type_id=parseInt(d.objectdata.type_id),t.value.urgency=parseInt(d.objectdata.urgency),t.value.description=d.objectdata.description)}),Z(()=>d.objectdata.remarks,(n,l)=>{t.value=d.objectdata},{deep:!0}),Z(()=>d.objectdata.attachment,(n,l)=>{t.value=d.objectdata,t.value.attachment=n},{deep:!0}),(n,l)=>(_(),b(Ne,null,{default:a(()=>[e(Fe,{title:"Incident detail page"}),e(V,{class:"mt-5"},{default:a(()=>[s("div",mt,[e(I,{onClick:l[0]||(l[0]=w=>J("details")),class:"mr-3 mb-3",color:`${g.value=="details"?"primary":"white"}`},{default:a(()=>[p("Details")]),_:1},8,["color"]),S.value?(_(),b(I,{key:0,class:"mr-3 mb-3",color:`${g.value=="attachment"?"primary":"white"}`,onClick:l[1]||(l[1]=w=>J("attachment"))},{default:a(()=>[p("Attachments")]),_:1},8,["color"])):U("",!0),S.value&&(r(m).user.profile.role=="facility"||r(m).user.profile.role=="admin"||r(m).user.profile.role=="superadmin"||r(m).user.profile.role=="technical-operation")?(_(),b(I,{key:1,class:"mr-3 mb-3",color:`${g.value=="warranty"?"primary":"white"}`,onClick:l[2]||(l[2]=w=>J("warranty"))},{default:a(()=>[p("Warranty")]),_:1},8,["color"])):U("",!0),S.value&&(r(m).user.profile.role=="facility"||r(m).user.profile.role=="admin"||r(m).user.profile.role=="superadmin"||r(m).user.profile.role=="technical-operation")?(_(),b(I,{key:2,class:"mr-3 mb-3",color:`${g.value=="facility"?"primary":"white"}`,onClick:l[3]||(l[3]=w=>J("facility"))},{default:a(()=>[p("Facility Team")]),_:1},8,["color"])):U("",!0)])]),_:1}),e(V,{class:"mb-10"},{default:a(()=>{var w,ue;return[s("div",pt,[g.value=="details"?(_(),b(N,{key:0},{default:a(()=>[e(r(Be),{as:"v-form","validation-schema":r(o)},{default:a(({meta:T})=>[e(xe,{class:"text-capitalize my-1"},{default:a(()=>[p(h(d.headertitle),1)]),_:1}),e(E,null,{default:a(()=>[S.value?(_(),b(V,{key:0,class:"bg-background-darken-1 ma-0 rounded"},{default:a(()=>{var q,v;return[s("div",_t,[ft,s("div",null,"ISR-2"+h(ke(t.value.id)),1)]),s("div",yt,[ht,s("div",null,h((q=t.value.profile)==null?void 0:q.display_name),1)]),s("div",bt,[gt,s("div",null,h((v=t.value.status)==null?void 0:v.title),1)]),s("div",Vt,[kt,s("div",null,h(t.value.created_at?r(me)(t.value.created_at).format("MMM. DD, YYYY"):"-"),1)]),s("div",wt,[St,s("div",null,h(t.value.date_closed?r(me)(t.value.date_closed).format("MMM. DD, YYYY"):"-"),1)])]}),_:1})):U("",!0),e(V,null,{default:a(()=>{var q;return[s("div",jt,[e(r(G),{name:"Type",modelValue:t.value.type_id,"onUpdate:modelValue":l[5]||(l[5]=v=>t.value.type_id=v)},{default:a(({field:v,errors:D})=>[e(X,z({items:O.value,modelValue:t.value.type_id,"onUpdate:modelValue":l[4]||(l[4]=$=>t.value.type_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},v,{"error-messages":D}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Ct,[e(r(G),{name:"Urgency",modelValue:t.value.urgency_id,"onUpdate:modelValue":l[7]||(l[7]=v=>t.value.urgency_id=v)},{default:a(({field:v,errors:D})=>[e(X,z({items:c.value,modelValue:t.value.urgency_id,"onUpdate:modelValue":l[6]||(l[6]=$=>t.value.urgency_id=$),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},v,{"error-messages":D}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Dt,[e(ve,{modelValue:t.value.asset_code,"onUpdate:modelValue":l[8]||(l[8]=v=>t.value.asset_code=v),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),e(Ae,{onClick:fe,class:"ml-2 my-auto",size:"large",icon:r(Re)},null,8,["icon"])]),s("div",$t,[e(r(G),{name:"Title",modelValue:t.value.title,"onUpdate:modelValue":l[10]||(l[10]=v=>t.value.title=v)},{default:a(({field:v,errors:D})=>[e(ve,z({modelValue:t.value.title,"onUpdate:modelValue":l[9]||(l[9]=$=>t.value.title=$),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},v,{"error-messages":D}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",It,[e(r(G),{name:"Company",modelValue:t.value.company_id,"onUpdate:modelValue":l[12]||(l[12]=v=>t.value.company_id=v)},{default:a(({field:v,errors:D})=>[e(X,z({items:de.value,modelValue:t.value.company_id,"onUpdate:modelValue":l[11]||(l[11]=$=>t.value.company_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},v,{"error-messages":D}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",xt,[e(r(G),{name:"Location",modelValue:t.value.location_id,"onUpdate:modelValue":l[14]||(l[14]=v=>t.value.location_id=v)},{default:a(({field:v,errors:D})=>[e(X,z({items:ne.value,modelValue:t.value.location_id,"onUpdate:modelValue":l[13]||(l[13]=$=>t.value.location_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},v,{"error-messages":D}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",At,[e(_e,{rows:"3",variant:"outlined",density:"compact",label:"Incident Description","hide-details":"auto",modelValue:t.value.description,"onUpdate:modelValue":l[15]||(l[15]=v=>t.value.description=v)},null,8,["modelValue"])]),s("div",Rt,[((q=t.value)==null?void 0:q.status_id)!=8&&(!S.value||S.value&&(d.objectdata.profile_id==R.value||W.value=="asset-supervisor"))?(_(),b(I,{key:0,color:"primary",onClick:be,disabled:!T.valid,loading:P.value},{default:a(()=>[p(h(S.value?"update":"submit"),1)]),_:2},1032,["disabled","loading"])):U("",!0)])]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):U("",!0),g.value=="warranty"?(_(),L("div",Tt,[e(N,null,{default:a(()=>[e(E,null,{default:a(()=>[Ut]),_:1})]),_:1}),((ue=(w=t.value.asset)==null?void 0:w.pivot_warranties)==null?void 0:ue.length)>0?(_(),b(V,{key:0},{default:a(()=>[s("div",Nt,[(_(!0),L(Q,null,ee(t.value.asset.pivot_warranties,T=>(_(),b(N,{class:"my-3 px-5",key:T.id},{default:a(()=>[e(E,null,{default:a(()=>[e(V,null,{default:a(()=>[e(j,{cols:"4"},{default:a(()=>[p("Vendor")]),_:1}),e(j,{cols:"8"},{default:a(()=>[p(h(T.vendor.title),1)]),_:2},1024),e(j,{cols:"4"},{default:a(()=>[p("Warranty Start Date")]),_:1}),e(j,{cols:"8"},{default:a(()=>[p(h(r(K)(T.warranty_start_date)),1)]),_:2},1024),e(j,{cols:"4"},{default:a(()=>[p("Warranty End Date")]),_:1}),e(j,{cols:"8"},{default:a(()=>[p(h(r(K)(T.warranty_end_date)),1)]),_:2},1024),e(j,{cols:"4"},{default:a(()=>[p("AMC Start Date")]),_:1}),e(j,{cols:"8"},{default:a(()=>[p(h(r(K)(T.amc_start_date)),1)]),_:2},1024),e(j,{cols:"4"},{default:a(()=>[p("AMC End Date")]),_:1}),e(j,{cols:"8"},{default:a(()=>[p(h(r(K)(T.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(_(),b(N,{key:1,class:"mt-2"},{default:a(()=>[e(E,null,{default:a(()=>[Lt]),_:1})]),_:1}))])):S.value&&g.value=="attachment"?(_(),b(Ze,{key:2,"incident-id":parseInt(r(y).params.id),attachment:t.value.attachment,onSave:A,objectdata:t.value},null,8,["incident-id","attachment","objectdata"])):(W.value=="superadmin"||W.value=="admin"||W.value=="technical-operation"||W.value=="facility")&&S.value&&g.value=="facility"?(_(),b(vt,{key:3,objectdata:t.value,onSaved:A},null,8,["objectdata"])):U("",!0)])]}),_:1}),e(Oe,{options:u.value},null,8,["options"]),e(pe,{width:"500",modelValue:k.value,"onUpdate:modelValue":l[17]||(l[17]=w=>k.value=w)},{default:a(()=>[e(N,null,{default:a(()=>[e(E,null,{default:a(()=>[e(r(Me),{onDecode:ye,onLoaded:he})]),_:1}),te.value?U("",!0):(_(),b(E,{key:0},{default:a(()=>[p("Please wait...")]),_:1})),e(Te,null,{default:a(()=>[e(Ue),e(I,{text:"Close",onClick:l[16]||(l[16]=w=>k.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Gt=Pe(Et,[["__scopeId","data-v-245b838e"]]);export{Gt as D};
