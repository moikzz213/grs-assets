import{r as n,a as re,u as ce,G as pe,H as ve,I as me,c as h,w as i,m as fe,n as K,o as v,d as t,v as O,k as M,s as j,J as Y,_ as R,i as Z,h as F,b as l,x as ye,C as m,j as L,e as N,y as C,p as X,q as ge,t as u,K as he,B as ee,L as xe,M as Ve,F as _e,N as Ce,O as ke,V as we,f as Se,ap as be,E as Ue,Z as Ne,S as ze,l as De}from"./app-23261638.js";import{_ as Pe}from"./ApppageHeader-fbb2d5b6.js";import{d as Re,e as Be}from"./encrypt-c741ace1.js";import{_ as $e}from"./AppSnackBar-c99d8c1d.js";const Ae=l("div",{class:"mt-2 mr-2"},"Show",-1),Ee={class:"v-col-12"},Te={class:"text-right text-capitalize"},Ie={class:"d-flex align-center justify-end"},Ke={class:"text-error"},Oe={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12 v-col-md-6 text-caption"},je={class:"v-col-12 v-col-md-6 text-caption py-1"},Fe={class:"v-col-12 v-col-md-6 text-caption my-auto py-1"},Le={class:"v-col-12 v-col-md-6 text-caption py-1"},Je={class:"v-col-12 text-caption py-1"},Ye={__name:"Users",setup(We){const B=n({status:!1,type:"primary",text:null}),r=re(),J=ce(),$=pe(),c=n({loading:!1,data:[]}),A=n(0),ae=n(0),x=n(""),le=n([10,20,50,100]),E=n(10),te=n([{title:"Administrator",value:"admin"},{title:"Asset Supervisor-Project",value:"asset-supervisor"},{title:"Commercial Manager-Project",value:"commercial-manager"},{title:"Facility Team",value:"facility"},{title:"Normal",value:"normal"},{title:"Technical Operation",value:"technical-operation"}]),oe=()=>{g()},W=()=>{localStorage.setItem("user-search",Be(x.value)),g()},se=()=>{x.value="",localStorage.setItem("user-search",""),g()},p=n($.params&&$.params.page?$.params.page:1),z=n([]),q=n(""),Q=n(0),y=a=>{c.value.loading=!0,z.value[0]=a,Q.value%2?z.value[1]="DESC":z.value[1]="ASC",Q.value++,q.value=JSON.stringify(z.value),g()},g=async()=>{c.value.loading=!0,await K(r.token).get("/api/user/all?page="+p.value+"&show="+E.value+"&search="+x.value+"&sort="+q.value).then(a=>{A.value=a.data.last_page?a.data.last_page:a.data.length,p.value=a.data.current_page?a.data.current_page:p.value,ae.value=a.data.total?a.data.total:a.data.length,c.value.data=a.data.data?a.data.data:a.data,c.value.loading=!1}).catch(a=>{c.value.loading=!1,console.log(a)})};ve(p,(a,e)=>{p.value&&a!=e&&(J.push({name:"PaginatedUsers",params:{page:p.value}}).catch(s=>{}),g(p.value))});const ne=a=>{J.push({name:"EditUser",params:{id:a}}).catch(e=>{console.log(e)})},ie=a=>{console.log("delete",a)},k=n(!1),ue=()=>{k.value=!0},D=n(!1),G=n(!1),V=n(""),_=n(""),w=n(""),P=n(""),d=n({}),H=()=>{d.value={},D.value=!1,V.value&&(P.value="",K(r.token).get("/api/admin/add-new/profile-by/ecode/"+V.value).then(a=>{if(a.data.id){P.value="Profile already registered.";return}De.post("/api/fetch-user/other-application",{ecode:V.value,key:"SFFjUDI2S1p0bUpWcit2Y21wNlJhQ1p5WndyQUR2Mnpoc0hERmt0RVBUMD0",user:"TW9pa3p6q"}).then(e=>{var s;G.value=!1,_.value=e.data,(s=e.data)!=null&&s.id?(w.value=e.data.role,D.value=!0,d.value=e.data):P.value="Profile not found. Contact IT department."})}))},de=async()=>{var s,o;B.value={status:!0,type:"info",text:"Please wait..."};let a=d.value.profile.fullname.split(" "),e={display_name:d.value.profile.fullname,email:d.value.email,first_name:a[0],last_name:a.slice(-1)[0],role:w.value,company_id:d.value.profile.company_id,ecode:d.value.profile.ecode,username:d.value.profile.ecode,designation:d.value.profile.position,profile_id:r.user.profile.id,company:(o=(s=d.value.profile)==null?void 0:s.company)==null?void 0:o.title};await K(r.token).post("/api/account/create-new/profile",e).then(f=>{k.value=!1,B.value={status:!0,type:"success",text:f.data.message},T(),g()}).catch(f=>{})},T=()=>{k.value=!1,w.value="",D.value=!1,_.value={},V.value="",d.value={}};return me(()=>{let a=localStorage.getItem("user-search");a&&(x.value=Re(a)),g()}),(a,e)=>(v(),h(fe,null,{default:i(()=>[t(Pe,{title:"Users List"}),t(j,{class:"mb-3"},{default:i(()=>[t(O,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:i(()=>[t(M,{class:"px-5"},{default:i(()=>[t(j,null,{default:i(()=>[t(O,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:i(()=>[Ae,t(Y,{items:le.value,modelValue:E.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>E.value=s),oe],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),t(R),t(O,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:i(()=>[t(Z,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),variant:"outlined",density:"compact",clearable:"",label:"Search",type:"text","hide-details":"","onClick:appendOuter":W,onKeydown:F(W,["enter"]),"onClick:clear":e[2]||(e[2]=s=>se("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]),_:1}),l("div",Ee,[t(M,{loading:c.value.loading},{default:i(()=>[t(ye,null,{default:i(()=>{var s;return[l("thead",null,[l("tr",null,[l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[3]||(e[3]=o=>y("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[4]||(e[4]=o=>y("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[5]||(e[5]=o=>y("display_name"))}," Name "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[6]||(e[6]=o=>y("username"))}," Username "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[7]||(e[7]=o=>y("email"))}," Email "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[8]||(e[8]=o=>y("role"))}," Role "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[9]||(e[9]=o=>y("status"))}," Status "),l("th",Te,[m(r).user.role=="superadmin"||(s=m(r).capabilities)!=null&&s.includes("add")?(v(),h(L,{key:0,size:"small",color:"primary",onClick:ue},{default:i(()=>[N("Add New")]),_:1})):C("",!0)])])]),l("tbody",null,[(v(!0),X(_e,null,ge(c.value.data,o=>{var f,S,b,U;return v(),X("tr",{key:o.id},[l("td",null,u((f=o.company)==null?void 0:f.title),1),l("td",null,u((S=o.location)==null?void 0:S.title),1),l("td",null,u(o.display_name),1),l("td",null,u(o.username),1),l("td",null,u(o.email),1),l("td",null,u(o.role),1),l("td",null,[t(he,{class:"text-uppercase",size:"small",color:`${o.status=="active"?"success":"error"}`},{default:i(()=>[N(u(o.status),1)]),_:2},1032,["color"])]),l("td",null,[l("div",Ie,[m(r).user.role=="superadmin"||(b=m(r).capabilities)!=null&&b.includes("edit")?(v(),h(ee,{key:0,size:"small",onClick:()=>ne(o.id),icon:m(xe),class:"mx-1"},null,8,["onClick","icon"])):C("",!0),m(r).user.role=="superadmin"||(U=m(r).capabilities)!=null&&U.includes("delete")?(v(),h(ee,{key:1,size:"small",onClick:()=>ie(o.id),icon:m(Ve),class:"mx-1"},null,8,["onClick","icon"])):C("",!0)])])])}),128))])]}),_:1}),c.value.data.length==0?(v(),h(Ce,{key:0,class:"pa-3 text-center w-100"},{default:i(()=>[N("No records found")]),_:1})):C("",!0)]),_:1},8,["loading"]),A.value>1?(v(),h(ke,{key:0,modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=s=>p.value=s),class:"my-4",length:A.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:c.value.loading},null,8,["modelValue","length","disabled"])):C("",!0)])]),_:1}),t(ze,{width:"600",persistent:"",modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=s=>k.value=s),onKeydown:F(T,["esc"])},{default:i(()=>[t(M,{class:"pt-3"},{default:i(()=>[t(we,{class:"text-h6 d-flex"},{default:i(()=>[N("New User "),t(R),l("small",Ke,u(P.value),1),t(R)]),_:1}),t(Se,null,{default:i(()=>[t(j,null,{default:i(()=>{var s,o,f,S,b,U;return[l("div",Oe,[t(Z,{loading:G.value,density:"compact",variant:"outlined",autofocus:"",label:"Search Employee ID","append-inner-icon":m(be),"hide-details":"",modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=I=>V.value=I),onKeydown:F(H,["enter"]),"onClick:appendInner":H},null,8,["loading","append-inner-icon","modelValue","onKeydown"])]),l("div",Me,[t(Y,{density:"compact",variant:"outlined",label:"Role",items:te.value,"hide-details":"",modelValue:w.value,"onUpdate:modelValue":e[12]||(e[12]=I=>w.value=I)},null,8,["items","modelValue"])]),l("div",je," Name: "+u((o=(s=_.value)==null?void 0:s.profile)==null?void 0:o.fullname),1),l("div",Fe," Status: "+u(_.value.status),1),l("div",Le," Email:"+u((f=_.value)==null?void 0:f.email),1),l("div",Je," Company: "+u((U=(b=(S=_.value)==null?void 0:S.profile)==null?void 0:b.company)==null?void 0:U.title),1)]}),_:1})]),_:1}),t(Ue,{class:"mt-2"}),t(Ne,null,{default:i(()=>[t(R),t(L,{size:"small",text:"cancel",onClick:T}),D.value?(v(),h(L,{key:0,size:"small",color:"secondary",onClick:de},{default:i(()=>[N("Confirm")]),_:1})):C("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"]),t($e,{options:B.value},null,8,["options"])]),_:1}))}};export{Ye as default};
