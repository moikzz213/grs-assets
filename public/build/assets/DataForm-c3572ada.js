import{N as Q,r as v,i as W,X as re,o as ee,O as z,b as p,c as R,e as s,l as t,k as a,j as h,I as S,E as y,F as G,d as X,z as A,K as _,Y as ve,A as M,Z as se,_ as me,$ as pe,a0 as _e,U as ye,m as k,D as T,q as ie,t as g,P as H,a1 as de,M as Z,u as fe,G as he,a2 as Y,V as be,a3 as K,a4 as N,y as oe,C as Ve}from"./app-2bfa4af2.js";import{_ as ge}from"./AppPageHeader-ec450be5.js";import{_ as ke}from"./AppSnackBar-faf10b8c.js";import{c as je,a as B,F as xe,b as P}from"./index.esm-c82afba1.js";import{u as J,a as $e}from"./formatDate-e2fbee14.js";import{_ as we}from"./Studio-323f2d90.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";const Se={class:"v-col-12 pt-5"},De={class:"v-col-12 pb-2"},Ue={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ae={class:"v-col-12 pt-0 pb-2"},Te={class:"v-col-12"},qe={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(I,{emit:F}){const u=I,b=Q(),e=v(b.query.v),w=W(),n=v(window.location.origin),L=i=>{let d=null;i.map(l=>{d=f.value.find(j=>j.id==l.id),d||f.value.push(l)})},m=v(!1),C=v(1),V=i=>{C.value=i,m.value=!0},O=i=>{f.value=f.value.filter(d=>d.id!==i)},f=v([]),q=re(()=>f.value.map(i=>i.id)),E=()=>{let i={id:parseInt(u.incidentId),file_ids:q.value,profile_id:u.objectdata.profile_id};T(w.token).post("/api/incident/sync-images/store-update",i).then(d=>{let l="Attachment has been updated";q.value.length==0&&(l="Attachment has been deleted"),F("save",l)}).catch(d=>{})};return ee(()=>{f.value=u.attachment}),z(()=>u.objectdata.attachment,(i,d)=>{f.value=i},{deep:!0}),(i,d)=>(p(),R("div",null,[s("div",Se,[t(y,null,{default:a(()=>[s("div",De,[e.value?S("",!0):(p(),h(we,{key:0,options:{multiSelect:!0,type:"maintenance"},onSelect:L}))])]),_:1}),f.value.length>0?(p(),h(y,{key:0,class:"px-1"},{default:a(()=>[(p(!0),R(G,null,X(f.value,(l,j)=>(p(),R("div",{key:l.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[t(A,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:_(ve),size:"26px",color:"error",onClick:()=>O(l.id)},null,8,["icon","onClick"]),t(M,{onClick:()=>V(j)},{default:a(()=>[t(se,{src:n.value+"/file/"+l.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(me,{modelValue:m.value,"onUpdate:modelValue":d[1]||(d[1]=l=>m.value=l),width:"95%","max-width":"900"},{default:a(()=>[t(M,{class:"bg-black"},{default:a(()=>[t(pe,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:C.value,"onUpdate:modelValue":d[0]||(d[0]=l=>C.value=l)},{default:a(()=>[(p(!0),R(G,null,X(f.value,(l,j)=>(p(),h(_e,{key:j,"reverse-transition":"fade",transition:"fade"},{default:a(()=>[s("div",Ue,[t(se,{src:n.value+"/file/"+l.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(p(),h(y,{key:1},{default:a(()=>[s("div",Ae,[t(ye,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:a(()=>[k(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),e.value?S("",!0):(p(),h(y,{key:2},{default:a(()=>[s("div",Te,[t(A,{color:"primary",onClick:E},{default:a(()=>[k("Save")]),_:1})])]),_:1}))])]))}},Ee={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Re={class:"font-weight-bold"},Ie={class:"reported-by"},Fe={class:"reported-by"},Le={class:"v-col-12"},Oe={class:"v-col-12 v-col-md-4 pb-0"},Ne={class:"v-col-12 v-col-md-8"},Be={class:"v-col-12"},Pe={class:"v-col-12"},ze={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Me={class:"v-col-3"},He=s("br",null,null,-1),Ye={class:"v-col-9"},Ke={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(I,{emit:F}){const u=I,b=Q(),e=W(),w=v(e.user.profile.role),n=v({}),L=v([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),m=v(b.query.v),C=v([]),V=async()=>{await T(e.token).get("/api/fetch/profile-facility/team").then(i=>{C.value=i.data}).catch(i=>{})},O=()=>{n.value.profile_id=e.user.profile.id,T(e.token).post("/api/incident/update-facility-team",n.value).then(i=>{n.value.remarks_data="",F("saved",i.data.message)}).catch(i=>{})},f=v([]),q=async()=>{await T(e.token).get("/api/fetch-global/incident-status/active").then(i=>{f.value=i.data}).catch(i=>{})},E=(i,d=6)=>{let l="00000"+i;return l.substring(l.length-d)};return ee(()=>{V(),q(),n.value=u.objectdata,n.value.priority=u.objectdata.priority?parseInt(u.objectdata.priority):null}),z(()=>u.objectdata.remarks,(i,d)=>{n.value.remarks=i},{deep:!0}),(i,d)=>(p(),R("div",null,[t(M,null,{default:a(()=>[t(ie,null,{default:a(()=>[t(y,null,{default:a(()=>{var l;return[s("div",Ee,[s("div",Re," SN: ISR-"+g(E(n.value.id)),1),s("div",Ie," REPORTED BY: "+g((l=n.value.profile)==null?void 0:l.display_name),1),s("div",Fe," DATE REPORTED: "+g(_(J)(n.value.created_at)),1)])]}),_:1}),t(y,null,{default:a(()=>[s("div",Le,[t(y,null,{default:a(()=>[s("div",Oe,[t(H,{items:L.value,modelValue:n.value.priority,"onUpdate:modelValue":d[0]||(d[0]=l=>n.value.priority=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:w.value=="facility"},null,8,["items","modelValue","disabled"]),t(H,{items:C.value,modelValue:n.value.handled_by,"onUpdate:modelValue":d[1]||(d[1]=l=>n.value.handled_by=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:w.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),t(H,{items:f.value,modelValue:n.value.status_id,"onUpdate:modelValue":d[2]||(d[2]=l=>n.value.status_id=l),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",Ne,[t(de,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:n.value.remarks_data,"onUpdate:modelValue":d[3]||(d[3]=l=>n.value.remarks_data=l)},null,8,["modelValue"])])]),_:1})]),t(Z,{class:"mt-3"}),s("div",Be,[m.value?S("",!0):(p(),h(A,{key:0,class:"",size:"small",disabled:!n.value.priority||!n.value.handled_by||!n.value.status_id,onClick:O,color:"primary"},{default:a(()=>[k("Submit")]),_:1},8,["disabled"]))])]),_:1}),t(y,null,{default:a(()=>[s("div",Pe,[k(" Remarks "),t(Z)]),s("div",ze,[(p(!0),R(G,null,X(n.value.remarks,l=>(p(),h(y,{key:i.id},{default:a(()=>{var j;return[s("div",Me,[k(g((j=l.profile)==null?void 0:j.display_name)+" ",1),He,k(),s("small",null,g(_($e)(l.created_at)),1)]),s("div",Ye,g(l.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const Ge={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},Xe={class:"font-weight-bold"},Ze={class:"reported-by"},Je={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},Qe={class:"v-col-12 v-col-md-3"},We={class:"v-col-12 v-col-md-6 d-flex"},et={class:"v-col-12"},tt={class:"v-col-12 v-col-md-12"},at={class:"v-col-12 v-col-md-3"},lt={class:"v-col-12"},st={class:"v-col-12"},ot={class:"v-col-12 v-col-md-9"},it={class:"v-col-12 v-col-md-6"},dt={class:"v-col-12 v-col-md-3"},ut={class:"v-col-12 v-col-md-3"},nt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(I,{emit:F}){const u=I,b=W(),e=v({}),w=v({}),n=c=>{w.value={status:!0,type:"success",text:c},F("saved")},L=v(b.user.profile.id),m=Q(),C=fe(),V=v(m.query.type),O=v(m.query.v),f=v([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let q=je({Urgency:B().required(),Title:B().required(),Company:B().required(),Location:B().required()});const E=new URL(window.location),i=c=>{V.value=c,te("type",c)},d=v(!1),l=v(b.user.profile.role),j=async()=>{d.value=!0,w.value={status:!0,type:"info",text:"Please wait..."},e.value.type_id=2,e.value.profile_id=b.user.profile.id,await T(b.token).post("/api/store-update/incident",e.value).then(c=>{w.value={status:!0,type:"success",text:c.data.message},m.params.id?d.value=!1:setTimeout(()=>{C.push({name:"EditMaintenance",params:{id:c.data.id},query:{type:"details"}}).catch(o=>{}),d.value=!1},800)}).catch(c=>{})},x=v(!1),te=(c,o)=>{E.searchParams.set(c,o),window.history.pushState({},"",E)},ae=v([]),ue=async()=>{await T(b.token).get("/api/fetch/companies").then(c=>{ae.value=c.data}).catch(c=>{})},le=v([]),ne=async()=>{await T(b.token).get("/api/fetch/locations/non-paginated/data").then(c=>{le.value=c.data}).catch(c=>{})},ce=(c,o=5)=>{let D="0000"+c;return D.substring(D.length-o)};return ee(()=>{var c;m.query.asset_code&&(e.value.asset_code=m.query.asset_code),m.query.title&&(e.value.title=m.query.title),m.query.asset_id&&(e.value.asset_id=parseInt(m.query.asset_id)),m.query.comp&&(e.value.company_id=parseInt(m.query.comp)),m.query.loc&&(e.value.location_id=parseInt(m.query.loc)),m.params.id&&(x.value=!0),V.value||(V.value="details",te("type","details")),ue().then(()=>{ne()}),console.log("isEdit.value",x.value),x.value&&(e.value=u.objectdata,e.value.asset_code=(c=u.objectdata.asset)==null?void 0:c.asset_code,e.value.title=u.objectdata.asset?u.objectdata.asset.asset_name:u.objectdata.title,e.value.company_id=u.objectdata.company_id,e.value.location_id=u.objectdata.location_id,e.value.asset_id=u.objectdata.asset_id,e.value.profile_id=u.objectdata.profile_id,e.value.type_id=parseInt(u.objectdata.type_id),e.value.urgency=parseInt(u.objectdata.urgency),e.value.description=u.objectdata.description),console.log("objData.value",e.value)}),z(()=>u.objectdata.remarks,(c,o)=>{e.value=u.objectdata},{deep:!0}),z(()=>u.objectdata.attachment,(c,o)=>{e.value=u.objectdata,e.value.attachment=c},{deep:!0}),(c,o)=>(p(),h(Ve,null,{default:a(()=>[t(ge,{title:"Maintenance detail page"}),t(y,{class:"mb-3"},{default:a(()=>[t(he,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:a(()=>[t(y,{class:"mb-3"},{default:a(()=>[t(A,{class:Y(`${V.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:o[0]||(o[0]=D=>i("details"))},{default:a(()=>[k("Details")]),_:1},8,["class"]),x.value?(p(),h(A,{key:0,class:Y(`${V.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[1]||(o[1]=D=>i("attachment"))},{default:a(()=>[k("Attachments")]),_:1},8,["class"])):S("",!0),x.value&&(_(b).user.profile.role=="facility"||_(b).user.profile.role=="admin"||_(b).user.profile.role=="superadmin"||_(b).user.profile.role=="technical-operation")?(p(),h(A,{key:1,class:Y(`${V.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:o[2]||(o[2]=D=>i("facility"))},{default:a(()=>[k("Facility Team")]),_:1},8,["class"])):S("",!0)]),_:1}),V.value=="details"?(p(),h(M,{key:0},{default:a(()=>[t(_(xe),{as:"v-form","validation-schema":_(q)},{default:a(({meta:D})=>[t(be,{class:"my-3 ml-3 text-uppercase text-h6"},{default:a(()=>[k(g(u.headertitle),1)]),_:1}),t(ie,null,{default:a(()=>[x.value?(p(),h(y,{key:0},{default:a(()=>{var r,$;return[s("div",Ge,[s("div",Xe," SN: ISR-2"+g(ce(e.value.id)),1),s("div",Ze," REPORTED BY: "+g((r=e.value.profile)==null?void 0:r.display_name),1)]),s("div",Je," STATUS: "+g(($=e.value.status)==null?void 0:$.title),1)]}),_:1})):S("",!0),t(y,null,{default:a(()=>[s("div",Qe,[t(_(P),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":o[4]||(o[4]=r=>e.value.urgency=r)},{default:a(({field:r,errors:$})=>[t(K,N({items:f.value,modelValue:e.value.urgency,"onUpdate:modelValue":o[3]||(o[3]=U=>e.value.urgency=U),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},r,{"error-messages":$}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",We,[t(oe,{modelValue:e.value.asset_code,"onUpdate:modelValue":o[5]||(o[5]=r=>e.value.asset_code=r),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"])]),s("div",et,[t(_(P),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":o[7]||(o[7]=r=>e.value.title=r)},{default:a(({field:r,errors:$})=>[t(oe,N({modelValue:e.value.title,"onUpdate:modelValue":o[6]||(o[6]=U=>e.value.title=U),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},r,{"error-messages":$}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",tt,[t(y,null,{default:a(()=>[s("div",at,[t(y,null,{default:a(()=>[s("div",lt,[t(_(P),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":o[9]||(o[9]=r=>e.value.company_id=r)},{default:a(({field:r,errors:$})=>[t(K,N({items:ae.value,modelValue:e.value.company_id,"onUpdate:modelValue":o[8]||(o[8]=U=>e.value.company_id=U),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},r,{"error-messages":$}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",st,[t(_(P),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":o[11]||(o[11]=r=>e.value.location_id=r)},{default:a(({field:r,errors:$})=>[t(K,N({items:le.value,modelValue:e.value.location_id,"onUpdate:modelValue":o[10]||(o[10]=U=>e.value.location_id=U),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},r,{"error-messages":$}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",ot,[t(de,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":o[12]||(o[12]=r=>e.value.description=r)},null,8,["modelValue"])])]),_:1})])]),_:1}),t(Z,{class:"my-3"}),t(y,null,{default:a(()=>{var r;return[s("div",it,[!O.value&&((r=e.value)==null?void 0:r.status_id)!=8&&(!x.value||x.value&&(u.objectdata.profile_id==L.value||l.value=="asset-supervisor"))?(p(),h(A,{key:0,size:"small",color:"primary",onClick:j,disabled:!D.valid,loading:d.value},{default:a(()=>[k("Submit")]),_:2},1032,["disabled","loading"])):S("",!0)]),s("div",dt," DATE CREATED: "+g(e.value.created_at?_(J)(e.value.created_at):""),1),s("div",ut," DATE CLOSED: "+g(c.date_closed?_(J)(e.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):x.value&&V.value=="attachment"?(p(),h(qe,{key:1,"incident-id":_(m).params.id,attachment:e.value.attachment,onSave:n,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(l.value=="superadmin"||l.value=="admin"||l.value=="technical-operation"||l.value=="facility")&&x.value&&V.value=="facility"?(p(),h(Ke,{key:2,objectdata:e.value,onSaved:n},null,8,["objectdata"])):S("",!0)]),_:1})]),_:1}),t(ke,{options:w.value},null,8,["options"])]),_:1}))}},ft=Ce(nt,[["__scopeId","data-v-06d722aa"]]);export{ft as D};
