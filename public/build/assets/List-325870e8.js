import{r as o,i as de,u as ue,L as ce,M as re,o as pe,j as g,k as i,C as me,K as _,b as v,l as s,N as I,G as m,z as ve,m as N,I as x,A as R,q as ye,D as L,f as a,O as V,P as fe,y as he,x as ge,Q as _e,c as G,d as xe,F as Ve,R as Ce,S as be,t as r,T as ke,E as Q,U as Se,W as we}from"./app-273ebe1e.js";import{_ as ze}from"./ApppageHeader-6f30069f.js";import{d as Ie,e as Ne}from"./encrypt-0d6536d5.js";import{_ as Re}from"./AppSnackBar-adb7e97a.js";import{u as Le}from"./formatDate-24b70229.js";const Ue=a("div",{class:"my-auto"},"Filter",-1),$e={class:"v-col-md-2 py-1"},Be={class:"v-col-md-2 py-1"},De={class:"v-col-md-2 py-1"},Te={class:"v-col-md-2 py-1"},Fe=a("div",{class:"mt-2 mr-2"},"Show",-1),Pe={class:"v-col-12"},Ae=a("th",{class:"text-left text-capitalize"},"ISR No.",-1),Oe=a("th",{class:"text-left text-capitalize"}," Urgency ",-1),Ee=a("th",{class:"text-left text-capitalize"}," Type ",-1),Ke=a("th",{class:"text-right text-capitalize"},null,-1),je={class:"d-flex align-center justify-end"},He={__name:"List",setup(qe){const W=o({status:!1,type:"primary",text:null}),d=de(),k=ue(),S=ce(),p=o({loading:!1,data:[]}),w=o(0),H=o(0),h=o(""),X=o([10,20,50,100]),z=o(10),c=o({}),Y=()=>{f()},C=()=>{u.value==1?f():u.value=1},U=()=>{localStorage.setItem("incident-search",Ne(h.value)),f()},Z=()=>{h.value="",localStorage.setItem("incident-search",""),f()},u=o(S.params&&S.params.page?S.params.page:1),b=o([]),$=o(""),B=o(0),y=e=>{p.value.loading=!0,b.value[0]=e,B.value%2?b.value[1]="DESC":b.value[1]="ASC",B.value++,$.value=JSON.stringify(b.value),f()},D=o([]),ee=async()=>{await _(d.token).get("/api/fetch/companies").then(e=>{D.value=e.data}).catch(e=>{})},T=o([]),te=async()=>{await _(d.token).get("/api/fetch/locations/non-paginated/data").then(e=>{T.value=e.data}).catch(e=>{})},F=o([]),ae=async()=>{await _(d.token).get("/api/fetch-global/incident-types/active").then(e=>{F.value=e.data}).catch(e=>{})},P=o([]),le=async()=>{await _(d.token).get("/api/fetch-global/incident-status/active").then(e=>{P.value=e.data}).catch(e=>{})},f=async()=>{console.log("objFIlter",c.value),p.value.loading=!0,await _(d.token).get("/api/fetch/incidents-by/users?userid="+d.user.profile.id+"&role="+d.user.profile.role+"&page="+u.value+"&show="+z.value+"&search="+h.value+"&sort="+$.value+"&filter="+JSON.stringify(c.value)).then(e=>{w.value=e.data.last_page?e.data.last_page:e.data.length,u.value=e.data.current_page?e.data.current_page:u.value,H.value=e.data.total?e.data.total:e.data.length,p.value.data=e.data.data?e.data.data:e.data,p.value.loading=!1}).catch(e=>{p.value.loading=!1,console.log(e)})};re(u,(e,t)=>{u.value&&e!=t&&(k.push({name:"PaginatedIncidents",params:{page:u.value}}).catch(l=>{}),f(u.value))});const se=e=>{k.push({name:"EditIncident",params:{id:e},query:{type:"details"}}).catch(t=>{console.log(t)})},oe=e=>{console.log("delete",e)},ne=()=>{k.push({name:"NewIncident",query:{type:"details"}}).catch(e=>{console.log(e)})},ie=(e,t=6)=>{let l="00000"+e;return l.substr(l.length-t)};return pe(()=>{let e=localStorage.getItem("incident-search");e&&(h.value=Ie(e)),f().then(()=>{ee(),te(),ae().then(()=>{le()})})}),(e,t)=>(v(),g(me,null,{default:i(()=>[s(ze,{title:"Incident list page"}),s(L,{class:"mb-3"},{default:i(()=>[s(I,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:i(()=>{var l;return[m(d).user.role=="superadmin"||(l=m(d).capabilities)!=null&&l.includes("add")?(v(),g(ve,{key:0,size:"small",color:"primary",onClick:ne},{default:i(()=>[N("Report New Incident")]),_:1})):x("",!0),s(R,{class:"px-5 mb-1"},{default:i(()=>[s(ye,null,{default:i(()=>[s(L,null,{default:i(()=>[Ue,a("div",$e,[s(V,{items:D.value,modelValue:c.value.company_id,"onUpdate:modelValue":[t[0]||(t[0]=n=>c.value.company_id=n),C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),a("div",Be,[s(V,{items:T.value,modelValue:c.value.location_id,"onUpdate:modelValue":[t[1]||(t[1]=n=>c.value.location_id=n),C],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),a("div",De,[s(V,{items:F.value,modelValue:c.value.type_id,"onUpdate:modelValue":[t[2]||(t[2]=n=>c.value.type_id=n),C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Type"},null,8,["items","modelValue"])]),a("div",Te,[s(V,{items:P.value,modelValue:c.value.status_id,"onUpdate:modelValue":[t[3]||(t[3]=n=>c.value.status_id=n),C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])])]),_:1})]),_:1})]),_:1}),s(R,{class:"px-5"},{default:i(()=>[s(L,null,{default:i(()=>[s(I,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:i(()=>[Fe,s(V,{items:X.value,modelValue:z.value,"onUpdate:modelValue":[t[4]||(t[4]=n=>z.value=n),Y],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),s(fe),s(I,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:i(()=>[s(he,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=n=>h.value=n),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"","onClick:appendOuter":U,onKeydown:ge(U,["enter"]),"onClick:clear":t[6]||(t[6]=n=>Z("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]}),_:1}),a("div",Pe,[s(R,{loading:p.value.loading},{default:i(()=>[s(_e,null,{default:i(()=>[a("thead",null,[a("tr",null,[Ae,Oe,Ee,a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[7]||(t[7]=l=>y("company_id"))}," Company "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[8]||(t[8]=l=>y("location_id"))}," Location "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[9]||(t[9]=l=>y("asset_id"))}," Asset "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[10]||(t[10]=l=>y("asset_id"))}," AssetCode "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[11]||(t[11]=l=>y("profile_id"))}," ReportedBy "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[12]||(t[12]=l=>y("status_id"))}," Status "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[13]||(t[13]=l=>y("created_at"))}," Date "),Ke])]),a("tbody",null,[(v(!0),G(Ve,null,xe(p.value.data,l=>{var n,A,O,E,K,j,q,J;return v(),G("tr",{key:l.id},[a("td",null,"ISR-"+r(ie(l.id)),1),a("td",null,r(l.urgency),1),a("td",null,r((n=l.type)==null?void 0:n.title),1),a("td",null,r((A=l.company)==null?void 0:A.title),1),a("td",null,r((O=l.location)==null?void 0:O.title),1),a("td",null,r(l.asset?l.asset.asset_name:l.title),1),a("td",null,r((E=l.asset)==null?void 0:E.asset_code),1),a("td",null,r((K=l.profile)==null?void 0:K.display_name),1),a("td",null,[s(ke,{class:"text-uppercase",size:"small",color:`${((j=l.status)==null?void 0:j.title.toLowerCase())=="completed"?"success":"error"}`},{default:i(()=>{var M;return[N(r((M=l.status)==null?void 0:M.title),1)]}),_:2},1032,["color"])]),a("td",null,r(m(Le)(l.created_at)),1),a("td",null,[a("div",je,[m(d).user.role=="superadmin"||(q=m(d).capabilities)!=null&&q.includes("edit")?(v(),g(Q,{key:0,size:"small",onClick:()=>se(l.id),icon:m(Se),class:"mx-1"},null,8,["onClick","icon"])):x("",!0),m(d).user.role=="superadmin"||(J=m(d).capabilities)!=null&&J.includes("delete")?(v(),g(Q,{key:1,size:"small",onClick:()=>oe(l.id),icon:m(we),class:"mx-1"},null,8,["onClick","icon"])):x("",!0)])])])}),128))])]),_:1}),p.value.data.length==0?(v(),g(Ce,{key:0,class:"pa-3 text-center w-100"},{default:i(()=>[N("No records found")]),_:1})):x("",!0)]),_:1},8,["loading"]),w.value>1?(v(),g(be,{key:0,modelValue:u.value,"onUpdate:modelValue":t[14]||(t[14]=l=>u.value=l),class:"my-4",length:w.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:p.value.loading},null,8,["modelValue","length","disabled"])):x("",!0)])]),_:1}),s(Re,{options:W.value},null,8,["options"])]),_:1}))}};export{He as default};
