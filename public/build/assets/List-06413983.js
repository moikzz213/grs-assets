import{r as o,i as nt,u as it,N as dt,O as ut,o as ct,j as g,k as n,C as rt,D as x,b as m,l as s,G as w,A as z,q as pt,E as B,e as l,P as V,Q as mt,y as vt,x as ft,H as yt,m as N,c as W,d as gt,t as d,R as ht,K as v,J as R,S as _t,aY as xt,T as Vt,I as D,F as Ct,U as kt,W as bt}from"./app-27cfa12c.js";import{_ as St}from"./ApppageHeader-7459ffea.js";import{d as wt,e as zt}from"./encrypt-6c029731.js";import{_ as Bt}from"./AppSnackBar-a603d8bf.js";import{u as Nt}from"./formatDate-e2fbee14.js";const Rt=l("div",{class:"my-auto"},"Filter",-1),Dt={class:"v-col-md-2 py-1"},Pt={class:"v-col-md-2 py-1"},$t={class:"v-col-md-2 py-1"},Ft=l("div",{class:"mt-2 mr-2"},"Show",-1),It={class:"v-col-12"},Lt=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Ut=l("th",{class:"text-left text-capitalize"}," Urgency ",-1),At=l("th",{class:"text-left text-capitalize"}," Priority ",-1),Kt=l("br",null,null,-1),Mt=l("small",null,"(DD/MM/YY)",-1),Ot=l("th",{class:"text-right text-capitalize"},null,-1),jt={class:"d-flex align-center justify-end"},Wt={__name:"List",setup(Et){const G=o({status:!1,type:"primary",text:null}),c=nt(),P=it(),C=dt(),u=o({loading:!1,data:[]}),k=o(0),Q=o(0),y=o(""),X=o([10,20,50,100]),b=o(10),r=o({}),Z=()=>{f()},S=()=>{i.value==1?f():i.value=1},$=()=>{localStorage.setItem("maintenance-search",zt(y.value)),f()},tt=()=>{y.value="",localStorage.setItem("maintenance-search",""),f()},i=o(C.params&&C.params.page?C.params.page:1),F=e=>e?e==1?"Normal":e==2?"Medium":"High":"",h=o([]),I=o(""),L=o(0),p=e=>{u.value.loading=!0,h.value[0]=e,L.value%2?h.value[1]="DESC":h.value[1]="ASC",L.value++,I.value=JSON.stringify(h.value),f()},U=o([]),et=async()=>{await x(c.token).get("/api/fetch/companies").then(e=>{U.value=e.data}).catch(e=>{})},A=o([]),at=async()=>{await x(c.token).get("/api/fetch/locations/non-paginated/data").then(e=>{A.value=e.data}).catch(e=>{})},K=o([]),lt=async()=>{await x(c.token).get("/api/fetch-global/incident-status/active").then(e=>{K.value=e.data}).catch(e=>{})},f=async()=>{console.log("objFIlter",r.value),u.value.loading=!0,await x(c.token).get("/api/fetch/maintenance-assets/data?page="+i.value+"&show="+b.value+"&search="+y.value+"&sort="+I.value+"&filter="+JSON.stringify(r.value)).then(e=>{k.value=e.data.last_page?e.data.last_page:e.data.length,i.value=e.data.current_page?e.data.current_page:i.value,Q.value=e.data.total?e.data.total:e.data.length,u.value.data=e.data.data?e.data.data:e.data,u.value.loading=!1}).catch(e=>{u.value.loading=!1,console.log(e)})};ut(i,(e,a)=>{i.value&&e!=a&&(P.push({name:"PaginatedMaintenance",params:{page:i.value}}).catch(t=>{}),f(i.value))});const M=(e,a)=>{let t={type:"details"};a=="view"&&(t={type:"details",pd:"ox2rKaIYFhBOQW31j6kkiMrJ4KfnYpLmwJhMzBFwPBlVjgGR4g",v:1,vv:"xK2sX1sDL1BBAvmuoPpWoNRgc4wzbdZ9F2OXAKrS3N2g65xNgy"}),P.push({name:"EditMaintenance",params:{id:e},query:t}).catch(_=>{console.log(_)})},st=e=>{console.log("delete",e)},ot=(e,a=5)=>{let t="0000"+e;return t.substring(t.length-a)};return ct(()=>{let e=localStorage.getItem("maintenance-search");e&&(y.value=wt(e)),f().then(()=>{et(),at(),lt()})}),(e,a)=>(m(),g(rt,null,{default:n(()=>[s(St,{title:"Maintenance list page"}),s(B,{class:"mb-3"},{default:n(()=>[s(w,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:n(()=>[s(z,{class:"px-5 mb-1"},{default:n(()=>[s(pt,null,{default:n(()=>[s(B,null,{default:n(()=>[Rt,l("div",Dt,[s(V,{items:U.value,modelValue:r.value.company_id,"onUpdate:modelValue":[a[0]||(a[0]=t=>r.value.company_id=t),S],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",Pt,[s(V,{items:A.value,modelValue:r.value.location_id,"onUpdate:modelValue":[a[1]||(a[1]=t=>r.value.location_id=t),S],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",$t,[s(V,{items:K.value,modelValue:r.value.status_id,"onUpdate:modelValue":[a[2]||(a[2]=t=>r.value.status_id=t),S],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])])]),_:1})]),_:1})]),_:1}),s(z,{class:"px-5"},{default:n(()=>[s(B,null,{default:n(()=>[s(w,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:n(()=>[Ft,s(V,{items:X.value,modelValue:b.value,"onUpdate:modelValue":[a[3]||(a[3]=t=>b.value=t),Z],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),s(mt),s(w,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:n(()=>[s(vt,{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=t=>y.value=t),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"","onClick:appendOuter":$,onKeydown:ft($,["enter"]),"onClick:clear":a[5]||(a[5]=t=>tt("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]),_:1}),l("div",It,[s(z,{loading:u.value.loading},{default:n(()=>[s(yt,null,{default:n(()=>[l("thead",null,[l("tr",null,[Lt,Ut,At,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[6]||(a[6]=t=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[7]||(a[7]=t=>p("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[8]||(a[8]=t=>p("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[9]||(a[9]=t=>p("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[10]||(a[10]=t=>p("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[11]||(a[11]=t=>p("handled_by"))}," HandledBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[12]||(a[12]=t=>p("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[13]||(a[13]=t=>p("created_at"))},[N(" D.Created"),Kt,Mt]),Ot])]),l("tbody",null,[(m(!0),W(Ct,null,gt(u.value.data,t=>{var _,O,j,E,T,J,Y,q;return m(),W("tr",{key:t.id},[l("td",null,"ISR-2"+d(ot(t.id)),1),l("td",null,d(F(t.urgency)),1),l("td",null,d(F(t.priority)),1),l("td",null,d((_=t.company)==null?void 0:_.title),1),l("td",null,d((O=t.location)==null?void 0:O.title),1),l("td",null,d(t.asset?t.asset.asset_name:t.title),1),l("td",null,d((j=t.asset)==null?void 0:j.asset_code),1),l("td",null,d((E=t.profile)==null?void 0:E.display_name),1),l("td",null,d((T=t.handled_by)==null?void 0:T.display_name),1),l("td",null,[s(ht,{class:"text-uppercase",size:"small",color:`${((J=t.status)==null?void 0:J.title.toLowerCase())=="completed"?"success":"error"}`},{default:n(()=>{var H;return[N(d((H=t.status)==null?void 0:H.title),1)]}),_:2},1032,["color"])]),l("td",null,d(v(Nt)(t.created_at)),1),l("td",null,[l("div",jt,[v(c).user.role=="superadmin"||(Y=v(c).capabilities)!=null&&Y.includes("edit")?(m(),g(R,{key:0,size:"small",onClick:()=>M(t.id,"edit"),icon:v(_t),class:"mx-1"},null,8,["onClick","icon"])):(m(),g(R,{key:1,size:"small",onClick:()=>M(t.id,"view"),icon:v(xt),class:"mx-1"},null,8,["onClick","icon"])),v(c).user.role=="superadmin"||(q=v(c).capabilities)!=null&&q.includes("delete")?(m(),g(R,{key:2,size:"small",onClick:()=>st(t.id),icon:v(Vt),class:"mx-1"},null,8,["onClick","icon"])):D("",!0)])])])}),128))])]),_:1}),u.value.data.length==0?(m(),g(kt,{key:0,class:"pa-3 text-center w-100"},{default:n(()=>[N("No records found")]),_:1})):D("",!0)]),_:1},8,["loading"]),k.value>1?(m(),g(bt,{key:0,modelValue:i.value,"onUpdate:modelValue":a[14]||(a[14]=t=>i.value=t),class:"my-4",length:k.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:u.value.loading},null,8,["modelValue","length","disabled"])):D("",!0)])]),_:1}),s(Bt,{options:G.value},null,8,["options"])]),_:1}))}};export{Wt as default};
