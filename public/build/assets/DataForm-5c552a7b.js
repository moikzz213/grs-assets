import{a as G,r as u,u as L,G as M,I as Y,o as C,c as A,w as s,d as t,v as J,b as l,j as g,ar as I,e as V,k as K,C as y,V as H,t as Q,f as W,s as m,i as q,Y as X,a7 as Z,E as ee,p as te,q as ae,J as U,as as se,M as le,F as oe,y as ie,m as de,n as k,z as re,A as ne}from"./app-e155f7da.js";import{_ as ue}from"./AppPageHeader-4df8c0e4.js";import{_ as ce}from"./AppSnackBar-101d9f62.js";import{c as pe,a as ve,F as me,b as fe}from"./index.esm-0d152541.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const c=h=>(re("data-v-3beebdf5"),h=h(),ne(),h),ge={class:"mb-3"},ye={class:"v-col-12 d-flex my-auto"},he={class:"v-col-12 px-6 pt-0 my-auto"},be={class:"v-col-12 px-6 pt-3"},Ve=c(()=>l("div",{class:"v-col-1 font-weight-bold"},null,-1)),Se=c(()=>l("div",{class:"v-col-3 font-weight-bold"}," TYPES ",-1)),xe=c(()=>l("div",{class:"v-col-5 font-weight-bold"}," SIGNATORIES ",-1)),we=c(()=>l("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),Ce=c(()=>l("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Requestor ",-1)),ke=c(()=>l("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Auto ",-1)),Ae={class:"v-col-12 v-col-md-1"},Te={class:"v-col-12 v-col-md-3"},De={class:"v-col-12 v-col-md-6 d-flex my-auto"},Fe={class:"v-col-12 v-col-md-2 d-flex my-auto"},Re=c(()=>l("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),je=c(()=>l("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Receiver ",-1)),Ie=c(()=>l("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Requestor ",-1)),qe={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(h,{emit:Ue}){const f=h,p=G(),_=u([]),b=u({}),n=u({title:f.objectdata.title}),$=u([{id:"approve",value:"Approval"},{id:"releasing",value:"Asset Releasing"},{id:"reviewer",value:"Reviewer"},{id:"transport",value:"Transport Arrangement"},{id:"verify",value:"Verify"}]),T=u([]),D=L(),v=M(),S=u(v.params.type);let N=pe({Title:ve().required()});const F=o=>{S.value=o,D.push({path:"/approval-setup/"+o})},x=u(0),z=()=>{let o={id:v.params.id,sort:x.value,profile_id:p.user.profile.id,class:"new"};k(p.token).post("/api/approval-setups/store-signatory/update-data",o).then(e=>{_.value.push({id:e.data.id,sort:x.value,types:null,signatories:[]}),x.value+=1,b.value={status:!0,type:"success",text:"New Signatory has been added"}}).catch(e=>{n.value.loading=!1})},E=async()=>{await k(p.token).get("/api/user/fetch/signatories").then(o=>{T.value=o.data}).catch(o=>{n.value.loading=!1,console.log(o)})},w=u(!1),B=u(!!v.params.id),O=(o,e)=>{let i={id:v.params.id,profile_id:p.user.profile.id,stageID:o,class:"deleted"};_.value.splice(e,1),k(p.token).post("/api/approval-setups/store-signatory/update-data",i).then(a=>{b.value={status:!0,type:"success",text:"Signatory has been deleted."}}).catch(a=>{n.value.loading=!1})},R=o=>{w.value=!0,b.value={status:!0,type:"info",text:"Please wait..."};let e="transfer";S.value=="request-asset"&&(e="request");let i=null;v.params.id&&(i=v.params.id);let a={id:i,type:e,signatories:o,profile_id:p.user.profile.id,class:"update"},d="/api/approval-setups/store-signatory/update-data";o=="title"&&(d="/api/approval-setups/store-update/data",a={id:i,type:e,title:n.value.title,signatories:_.value,profile_id:p.user.profile.id}),k(p.token).post(d,a).then(r=>{b.value={status:!0,type:"success",text:"Data has been saved."},w.value=!1,_.value.sort((j,P)=>j.sort-P.sort),v.params.id||setTimeout(()=>{D.push({name:"EditApproval",params:{id:r.data.id}}).catch(j=>{})},800)}).catch(r=>{n.value.loading=!1})};return Y(()=>{if(E(),v.params.id&&f.objectdata.stages.length>0){let o=f.objectdata.stages[f.objectdata.stages.length-1].sort;f.objectdata.stages.map((e,i)=>{let a=[];e.signatures.map(d=>{d.profile_id!=0&&a.push(d.profile_id)}),_.value.push({id:e.id,sort:e.sort,types:e.types,signatories:a})}),x.value=o+1}}),(o,e)=>(C(),A(de,null,{default:s(()=>[t(ue,{title:"Global Approval Setup"}),t(m,{class:"mb-3"},{default:s(()=>[t(J,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[l("div",ge,[t(g,{class:I(`${S.value=="request-asset"?"tab-active":""}  v-col-12 v-col-md-3 mx-2`),onClick:e[0]||(e[0]=i=>F("request-asset"))},{default:s(()=>[V("Request Asset Approvals")]),_:1},8,["class"]),t(g,{class:I(`${S.value=="transfer-asset"?"tab-active":""}   v-col-12 v-col-md-3 mx-2`),onClick:e[1]||(e[1]=i=>F("transfer-asset"))},{default:s(()=>[V("Transfer Asset Approvals")]),_:1},8,["class"])]),t(K,null,{default:s(()=>[t(y(me),{as:"v-form","validation-schema":y(N)},{default:s(({meta:i})=>[t(H,{class:"my-3 ml-3 text-uppercase"},{default:s(()=>[V(Q(f.headertitle),1)]),_:1}),t(W,null,{default:s(()=>[t(m,null,{default:s(()=>[l("div",ye,[t(y(fe),{name:"Title",modelValue:n.value.title,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.title=a)},{default:s(({field:a,errors:d})=>[t(q,X({modelValue:n.value.title,"onUpdate:modelValue":e[2]||(e[2]=r=>n.value.title=r)},a,{"error-messages":d,label:"Title here*",variant:"outlined","hide-details":"auto",density:"compact",class:"v-col-10 pt-0"}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"]),t(g,{size:"small",class:"mt-1",color:"primary",disabled:!i.valid,loading:w.value,onClick:e[4]||(e[4]=a=>R("title"))},{default:s(()=>[V("Save")]),_:2},1032,["disabled","loading"])])]),_:2},1024),B.value?(C(),A(m,{key:0},{default:s(()=>[l("div",he,[t(g,{onClick:z,color:"primary",size:"x-small",icon:y(Z)},null,8,["icon"]),V(" Add Signatories ")]),l("div",be,[t(m,null,{default:s(()=>[Ve,Se,xe]),_:1}),t(ee),t(m,{class:"mt-0"},{default:s(()=>[we,Ce,ke]),_:1}),(C(!0),te(oe,null,ae(_.value,(a,d)=>(C(),A(m,{class:"mt-0",key:d},{default:s(()=>[l("div",Ae,[t(q,{modelValue:a.sort,"onUpdate:modelValue":r=>a.sort=r,label:"Sort*",variant:"outlined","hide-details":"auto",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",Te,[t(U,{label:"Select Type",modelValue:a.types,"onUpdate:modelValue":r=>a.types=r,"hide-details":"auto",variant:"outlined","item-value":"id","item-title":"value",density:"compact",items:$.value},null,8,["modelValue","onUpdate:modelValue","items"])]),l("div",De,[t(U,{label:"Select Signatory",modelValue:a.signatories,"onUpdate:modelValue":r=>a.signatories=r,"hide-details":"auto",variant:"outlined",density:"compact",multiple:"","item-value":"id","item-title":"display_name",items:T.value},null,8,["modelValue","onUpdate:modelValue","items"])]),l("div",Fe,[t(g,{disabled:!a.types||a.signatories.length==0,size:"x-small",onClick:()=>R(a),icon:y(se),loading:w.value,color:"success",class:"mx-1 ml-3 my-auto",title:"Save Signatory"},null,8,["disabled","onClick","icon","loading"]),t(g,{size:"x-small",onClick:()=>O(a.id,d),icon:y(le),color:"error",class:"mx-1 ml-3 my-auto",title:"Delete Signatory"},null,8,["onClick","icon"])])]),_:2},1024))),128)),t(m,{class:"mt-0"},{default:s(()=>[Re,je,Ie]),_:1})])]),_:1})):ie("",!0)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})]),_:1})]),_:1}),t(ce,{options:b.value},null,8,["options"])]),_:1}))}},Oe=_e(qe,[["__scopeId","data-v-3beebdf5"]]);export{Oe as D};
