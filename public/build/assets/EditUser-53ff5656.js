import{r as i,b as g,j as C,k as s,l,z as _,a3 as Z,A as P,q as I,P as j,a4 as G,a5 as H,m as b,Z as Q,N as X,i as Y,o as ee,D as z,C as le,e as u,E as V,w as D,v as F,ag as O,I as B,M as N,c as T,d as ae,F as te}from"./app-4d09b9e7.js";import{_ as se}from"./AppPageHeader-8a6b4320.js";import{_ as ie,a as oe,b as ue}from"./ChangePassword-25dedc9e.js";import{_ as de}from"./AppSnackBar-a9c4abb9.js";import"./index.esm-feb86d9b.js";const ce={__name:"Capability",props:["item"],emits:["saved"],setup(E,{emit:x}){const d=E,n=i(!1),o=i(d.item.capabilities),h=i(d.item.capabilities),k=i(["add","edit","delete"]),r=async()=>{n.value=!1,x("saved",{id:d.item.id,capabilities:o.value})},y=()=>{n.value=!1,o.value=h.value};return(p,c)=>(g(),C(Q,{width:"500",persistent:"",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=f=>n.value=f)},{activator:s(({props:f})=>[l(_,Z(f,{text:"Capability",size:"small",color:"primary"}),null,16)]),default:s(({isActive:f})=>[l(P,{title:"Capabilities"},{default:s(()=>[l(I,null,{default:s(()=>[l(j,{variant:"outlined",density:"compact","hide-details":"",multiple:"","item-title":"name","item-value":"name",label:"- Select -",modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=v=>o.value=v),items:k.value},null,8,["modelValue","items"])]),_:1}),l(G,null,{default:s(()=>[l(H),l(_,{size:"small",text:"cancel",onClick:y}),l(_,{size:"small",color:"secondary",onClick:r},{default:s(()=>[b("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ne={class:"v-col-12"},re={class:"d-flex flex-wrap"},pe={class:"v-col-12 v-col-md-5"},ve={class:"v-col-12"},me={class:"v-col-12 v-col-md-4"},fe={class:"v-col-12 v-col-md-12 d-flex"},ge={class:"v-col-12 v-col-md-12 py-0 d-flex"},_e={class:"my-auto"},be={key:0,class:"v-col-12 v-col-md-3"},he=u("div",{class:"v-col-12 v-col-md-12"},[b(" Capabilities "),u("br"),u("small",{class:"text-error"},"Warning: it will override the capabilities of all page."),u("br"),u("small",{class:"text-error"},"Select only here if all pages have same capabilities")],-1),ye={class:"v-col-12 v-col-md-12 my-auto"},Ae={__name:"EditUser",setup(E){var R,M;const x=X(),d=Y(),n=i(!0),o=i({loading:!1,data:{}}),h=async()=>{n.value=!0,await z(d.token).get("/api/admin/user/single/"+x.params.id).then(e=>{o.value.data=e.data,n.value=!1}).catch(e=>{o.value.loading=!1,n.value=!1})},k=e=>{h().then(()=>{U.value={status:!0,type:"success",text:e}})};ee(()=>{h().then(()=>{f()})});const r=i("profile"),y=async e=>{r.value=e},p=i([]),c=i(!1),f=()=>{z(d.token).get("/api/fetch/pages-slug").then(e=>{var t;p.value=e.data,((t=o.value.data)==null?void 0:t.access.length)>0&&o.value.data.access.map((a,w)=>{p.value.map((A,Se)=>{a.slug==A.slug&&(A.isSelected=a.slug,A.capabilities=a.capabilities?JSON.parse(a.capabilities):[],m.value.push(a.slug),v.value=!0)})})}).catch(e=>{})},v=i(!1),q=()=>{p.value.map((e,t)=>(e.capabilities||(e.capabilities=[]),c.value?(e.isSelected=e.slug,m.value.push(e.slug),v.value=!0):(e.isSelected="",m.value=[],v.value=!1),e))},$=i(!1),m=i([]),J=e=>{e.isSelected?(m.value.splice(m.value.findIndex(a=>a===e.isSelected),1),e.isSelected="",e.capabilities=""):(!e.isSelected||e.isSelected==null||e.isSelected=="")&&(m.value.push(e.slug),e.isSelected=e.slug),v.value=!0,p.value.filter((a,w)=>!a.isSelected).length>0?c.value=!1:c.value=!0},S=i([]),K=i(["add","edit","delete"]),U=i({status:!0,type:"info",text:null}),L=e=>{p.value.map((t,a)=>{t.id==e.id&&(t.capabilities=e.capabilities)})};i((M=(R=d==null?void 0:d.user)==null?void 0:R.profile)==null?void 0:M.id);const W=()=>{$.value=!0,S.value.length>0&&p.value.map((a,w)=>{a.isSelected?a.capabilities=S.value:a.capabilities=[]});let e=p.value.filter(a=>a.isSelected),t={profileID:x.params.id,data:e,profile_id:d.user.profile.id};z(d.token).post("/api/store-page/settings-capabilities/profile",t).then(a=>{m.value=[],S.value=[],U.value={status:!0,type:"success",text:a.data.message},$.value=!1,h().then(()=>{f()})})};return(e,t)=>(g(),C(le,null,{default:s(()=>[l(se,{title:"Edit User"}),l(V,{class:"mb-3",disabled:n.value},{default:s(()=>[u("div",ne,[u("div",re,[l(_,{color:`${r.value=="profile"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[0]||(t[0]=()=>y("profile"))},{default:s(()=>[b("profile")]),_:1},8,["color","loading"]),l(_,{color:`${r.value=="account"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[1]||(t[1]=()=>y("account"))},{default:s(()=>[b("Account")]),_:1},8,["color","loading"]),l(_,{color:`${r.value=="change_password"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[2]||(t[2]=()=>y("change_password"))},{default:s(()=>[b("Change Password")]),_:1},8,["color","loading"])])]),u("div",pe,[l(V,null,{default:s(()=>[u("div",ve,[D(l(ie,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,r.value=="account"]]),D(l(oe,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,r.value=="profile"]]),D(l(ue,{user:o.value.data},null,8,["user"]),[[F,r.value=="change_password"]])])]),_:1})]),u("div",me,[l(P,null,{default:s(()=>[l(I,null,{default:s(()=>[l(V,null,{default:s(()=>[u("div",fe,[l(O,{modelValue:c.value,"onUpdate:modelValue":[t[3]||(t[3]=a=>c.value=a),q],"hide-details":"",variant:"outlined",density:"compact",label:" Access / View Pages"},null,8,["modelValue"]),v.value?(g(),C(_,{key:0,class:"ml-5",size:"small",loading:$.value,color:"secondary",onClick:W},{default:s(()=>[b("Save")]),_:1},8,["loading"])):B("",!0)])]),_:1}),l(N,{class:"mb-3"}),(g(!0),T(te,null,ae(p.value,(a,w)=>(g(),C(V,{key:a.id},{default:s(()=>[u("div",ge,[l(O,{"model-value":m.value.includes(a.slug),"hide-details":"",variant:"outlined","onUpdate:modelValue":A=>J(a,w),label:a.title,density:"compact"},null,8,["model-value","onUpdate:modelValue","label"]),u("div",_e,[a.isSelected?(g(),C(ce,{key:0,item:a,onSaved:L},null,8,["item"])):B("",!0)])]),l(N)]),_:2},1024))),128))]),_:1})]),_:1})]),v.value?(g(),T("div",be,[l(P,null,{default:s(()=>[l(I,null,{default:s(()=>[l(V,null,{default:s(()=>[he,l(N),u("div",ye,[l(j,{variant:"outlined",density:"compact","hide-details":"",multiple:"",label:"- Select -",modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=a=>S.value=a),items:K.value},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})])):B("",!0)]),_:1},8,["disabled"]),l(de,{options:U.value},null,8,["options"])]),_:1}))}};export{Ae as default};
