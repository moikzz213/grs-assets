import{a as de,r,T as ie,J as q,a$ as re,o as n,p,d as s,w as o,k as I,s as k,b as m,ag as ce,E as w,V as ve,e as h,t as x,a3 as K,f as A,F as z,q as B,c as y,i as pe,a0 as me,h as Y,y as _,L as G,_ as fe,H as ye,j as D,v as he,D as _e,O as be,U as ge,W as L,X as Q,ae as Ve,n as R}from"./app-c76d4235.js";import{a as ke,c as we,F as xe,b as Ce}from"./index.esm-11588b80.js";import{_ as je}from"./Studio-7deb884c.js";const Se={class:"text-error"},Fe={class:"d-flex pa-3"},Ae={key:0,class:"v-col-4",style:{"border-left":"1px solid #ccc","border-right":"1px solid #ccc"}},De=m("h5",null,"LINK ASSET",-1),Ue={key:1,class:"v-col-4 text-center",style:{"border-left":"1px solid #ccc","background-color":"#e0e0e0"}},$e={class:"d-flex mb-5 justify-center"},Oe=["data"],Ne=m("div",{class:"mb-5",style:{position:"absolute",bottom:"0"}}," Note: Dont forget to click the save button at the top ",-1),Te=m("br",null,null,-1),qe=m("br",null,null,-1),Be={__name:"DialogForm",props:{dataObject:{type:Object,default:{}},addNewDialog:{type:Boolean,default:!1},title:{type:String,default:""},freeForm:{type:Array,default:[]}},emits:["savedResponse","fileSave","save"],setup(Z,{emit:U}){const f=Z,C=de(),$=r(""),v=r([]),ee=a=>{let t=null;a.map(i=>{t=v.value.find(u=>u.id==i.id),t||v.value.push(i)})},E=r([]),j=r(""),O=r(!1),N=r(1),b=r("image"),ae=a=>{let t=a.path.split(".");b.value=t[t.length-1],N.value=a,O.value=!0},te=a=>{v.value=v.value.filter(t=>t.id!==a)},W=ie(()=>v.value.map(a=>a.id)),le=()=>{let a={id:parseInt(P.value),file_ids:W.value,profile_id:C.user.profile.id};R(C.token).post("/api/warranty/sync-images/store-update",a).then(t=>{let i="Attachment has been updated";W.value.length==0&&(i="Attachment has been deleted"),U("fileSave",i)}).catch(t=>{})},se=a=>{let t=l.value.display_assets,i=l.value.assets;t.splice(a,1),l.value.display_assets=[...t],i.splice(a,1),l.value.assets=[...i]},g=r(!1),l=r({}),T=r(f.freeForm);q(()=>f.freeForm,a=>{T.value=[...a]});const H=()=>{g.value=!1,l.value={},U("cancelled",g.value)},J=()=>{g.value=!1,U("save",l.value),l.value={}},M=r({});T.value.map((a,t)=>{a.required&&(M.value[a.name]=ke().required())});let oe=we(M.value);const V=r(!1),ue=a=>{v.value=[],a&&R(C.token).post("/api/fetch/warranty/by/id/"+a).then(t=>{var i,u,e,d,c;((e=(u=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:u.pivot_assets)==null?void 0:e.length)>0&&t.data.data.pivot_assets.map((F,X)=>{l.value.assets.push(F.id),l.value.display_assets.push(F)}),v.value=(c=(d=t.data)==null?void 0:d.data)==null?void 0:c.attachment}).catch(t=>{})},S=r(window.location.origin),P=r(0);q(()=>f.addNewDialog,a=>{V.value=!1,l.value={},g.value=a,$.value="New "+f.title,f.dataObject.type&&(l.value=f.dataObject,$.value="Edit "+f.title),f.title=="Warranty"&&(l.value.assets=[],l.value.display_assets=[],l.value.pivot_assets=[],ue(l.value.id),P.value=l.value.id,V.value=!0)});const ne=a=>{a.length<4||R(C.token).get("/api/search-assets/warranty/"+a).then(t=>{let i=[];t.data&&t.data.length>0&&t.data.map((u,e)=>{i[e]=u,i[e].new_title=u.asset_name+" ("+u.asset_code+")"}),E.value=i}).catch(t=>{})};return q(()=>j.value,a=>{a&&(l.value.assets.includes(a.id)||(l.value.assets.push(a.id),l.value.display_assets.push(a)),j.value=""),console.log("dataObj.value",a)}),(a,t)=>{const i=re("v-card-action");return n(),p("div",null,[s(Q,{width:V.value?1200:600,persistent:"",modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=u=>g.value=u),onKeydown:Y(H,["esc"]),class:"d-flex",style:{overflow:"auto"}},{default:o(()=>[s(I,{class:"py-3"},{default:o(()=>[s(k,null,{default:o(()=>[m("div",{class:ce(`${V.value?"v-col-4":"v-col-12"}`)},[s(w(xe),{as:"v-form","validation-schema":w(oe)},{default:o(({meta:u})=>[s(ve,{class:"text-h6 d-flex"},{default:o(()=>[h(x($.value),1),s(K),m("small",Se,x(a.errorMessage),1),s(K)]),_:1}),s(A,null,{default:o(()=>[s(k,null,{default:o(()=>[(n(!0),p(z,null,B(T.value,(e,d)=>(n(),p("div",{class:"v-col-12",key:d},[s(w(Ce),{name:e.name,modelValue:l.value[e.name],"onUpdate:modelValue":c=>l.value[e.name]=c},{default:o(({field:c,errors:F})=>[e.type=="text"||e.type=="number"||e.type=="date"||e.type=="email"?(n(),y(pe,me({key:0,type:e.type,autofocus:d===0,modelValue:l.value[e.name],"onUpdate:modelValue":X=>l.value[e.name]=X,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,"hide-details":""},c,{onKeydown:Y(J,["enter"]),"error-messages":F}),null,16,["type","autofocus","modelValue","onUpdate:modelValue","label","onKeydown","error-messages"])):_("",!0)]),_:2},1032,["name","modelValue","onUpdate:modelValue"]),e.type=="select"?(n(),y(G,{key:0,autofocus:d===0,modelValue:l.value[e.name],"onUpdate:modelValue":c=>l.value[e.name]=c,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":""}`,items:e.data,"hide-details":"","item-value":"id","item-title":"title"},null,8,["autofocus","modelValue","onUpdate:modelValue","label","items"])):_("",!0),e.type=="textarea"?(n(),y(fe,{key:1,autofocus:d===0,modelValue:l.value[e.name],"onUpdate:modelValue":c=>l.value[e.name]=c,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,items:e.data,"hide-details":""},null,8,["autofocus","modelValue","onUpdate:modelValue","label","items"])):_("",!0)]))),128))]),_:1})]),_:1}),s(ye,{class:"mt-2"}),m("div",Fe,[s(K),s(D,{size:"small",text:"cancel",onClick:H,class:"mx-1"}),s(D,{size:"small",color:"primary",onClick:J,disabled:!u.valid},{default:o(()=>[h("Save")]),_:2},1032,["disabled"])])]),_:1},8,["validation-schema"])],2),V.value?(n(),p("div",Ae,[s(A,null,{default:o(()=>[De,s(k,{class:"mt-1"},{default:o(()=>[s(he,null,{default:o(()=>[s(G,{density:"compact",label:"Search asset name or code",variant:"outlined",items:E.value,"onUpdate:search":ne,"item-value":"id","item-title":"new_title",modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=u=>j.value=u),"hide-details":"",clearable:"","return-object":""},null,8,["items","modelValue"])]),_:1})]),_:1}),s(k,{style:{"max-height":"460px",overflow:"auto"}},{default:o(()=>[(n(!0),p(z,null,B(l.value.display_assets,(u,e)=>(n(),p("div",{class:"v-col-12 v-col-md-12 text-caption py-1",key:e},[h(" - "+x(u.asset_name)+" ",1),m("b",null,"("+x(u.asset_code)+")",1),s(_e,{onClick:d=>se(e),class:"ml-2 cursor-pointer",color:"error",icon:w(be)},null,8,["onClick","icon"])]))),128))]),_:1})]),_:1}),s(i,{class:"mb-5",style:{position:"absolute",bottom:"0"}},{default:o(()=>[h(" Note: Dont forget to click the save button ")]),_:1})])):_("",!0),V.value?(n(),p("div",Ue,[f.dataObject.type?(n(),y(A,{key:0},{default:o(()=>{var u,e;return[m("div",$e,[s(je,{options:{multiSelect:!0,type:"warranty"},onSelect:ee}),s(D,{color:"primary",onClick:le,disabled:((u=v.value)==null?void 0:u.length)==0},{default:o(()=>[h("Save Files")]),_:1},8,["disabled"])]),((e=v.value)==null?void 0:e.length)>0?(n(),y(k,{key:0,class:"px-1"},{default:o(()=>[(n(!0),p(z,null,B(v.value,(d,c)=>(n(),p("div",{key:d.id,class:"v-col-12 v-col-md-4 pa-2",style:{position:"relative"}},[s(D,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:w(ge),size:"20px",color:"error",onClick:()=>te(d.id)},null,8,["icon","onClick"]),h(" "+x(d.mime)+" ",1),s(I,{onClick:()=>ae(d)},{default:o(()=>[d.mime=="image/jpeg"||d.mime=="image/png"?(n(),y(L,{key:0,src:S.value+"/file/"+d.path,cover:"","aspect-ratio":"1"},null,8,["src"])):(n(),y(L,{key:1,src:S.value+"/assets/images/pdf-image.png",cover:"","aspect-ratio":"1"},null,8,["src"]))]),_:2},1032,["onClick"])]))),128)),s(Q,{modelValue:O.value,"onUpdate:modelValue":t[1]||(t[1]=d=>O.value=d),width:"95%","max-width":"900"},{default:o(()=>[s(I,{class:"bg-black"},{default:o(()=>[m("div",{style:Ve(`${b.value=="pdf"?"height: 980px;":"height: 680px;"} 
                                                        width: 100%;
                                                        `),class:"d-flex align-center justify-center"},[b.value=="jpg"||b.value=="jpeg"||b.value=="png"?(n(),y(L,{key:0,src:S.value+"/file/"+N.value.path},null,8,["src"])):_("",!0),b.value=="pdf"?(n(),p("object",{key:1,data:S.value+"/file/"+N.value.path,type:"application/pdf",width:"100%",height:"800px"},null,8,Oe)):_("",!0)],4)]),_:1})]),_:1},8,["modelValue"])]),_:1})):_("",!0),s(k,null,{default:o(()=>[Ne]),_:1})]}),_:1})):(n(),y(A,{key:1},{default:o(()=>[h(" You can upload files on update only."),Te,qe,h(" kindly create new warranty first then click update/edit. ")]),_:1}))])):_("",!0)]),_:1})]),_:1})]),_:1},8,["width","modelValue","onKeydown"])])}}};export{Be as _};
