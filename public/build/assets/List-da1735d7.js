import{r as o,a as nt,u as dt,G as ct,H as rt,I as ut,c as $,w as u,m as pt,n as C,o as f,d as i,b as l,k as mt,V as vt,i as ft,h as yt,s as Y,J as I,x as gt,e as L,p as G,q as ht,t as d,K as St,C as k,B as H,L as xt,M as Vt,y as R,F as _t,N as Ct,O as It}from"./app-2443e7d1.js";import{_ as kt}from"./ApppageHeader-6db7d1f6.js";import{d as y,e as g}from"./encrypt-6d075844.js";import{_ as bt}from"./AppSnackBar-86534646.js";import{u as wt}from"./formatDate-b9aad8c5.js";const $t={class:"v-col-12"},zt=l("div",{class:"mr-auto"},"Asset Incidents",-1),Bt={class:"v-col-12 v-col-md"},Dt={class:"v-col-12 v-col-md"},Lt={class:"v-col-12 v-col-md"},Rt={class:"v-col-12 v-col-md"},Ut={class:"v-col-12 v-col-md"},Nt=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),At=l("th",{class:"text-left text-capitalize"},"Urgency",-1),Pt=l("th",{class:"text-left text-capitalize"},"Type",-1),Tt=l("br",null,null,-1),Ft=l("small",null,"(DD/MM/YY)",-1),Ot=l("th",{class:"text-right text-capitalize last-child-action"},null,-1),Kt={class:"last-child-action"},Mt={class:"d-flex align-center justify-end"},Ht={__name:"List",setup(Et){const Q=o({status:!1,type:"primary",text:null}),c=nt(),U=dt(),z=ct(),r=o({loading:!1,data:[]}),B=o(0),W=o(0),v=o(""),X=o([10,20,50,100]),h=o(10),s=o({}),Z=()=>{localStorage.setItem("incident-filter-row",g(h.value)),m()},b=a=>{D.value="",n.value==1?(a=="company"?localStorage.setItem("incident-filter-company",g(s.value.company_id)):a=="location"?localStorage.setItem("incident-filter-location",g(s.value.location_id)):a=="type"?localStorage.setItem("incident-filter-type",g(s.value.type_id)):a=="status"&&localStorage.setItem("incident-filter-status",g(s.value.status_id)),m()):n.value=1},N=()=>{localStorage.setItem("incident-search",g(v.value)),m()},S=a=>{a=="search"?(v.value="",localStorage.setItem("incident-search",""),m()):a=="company"?localStorage.setItem("incident-filter-company",""):a=="location"?localStorage.setItem("incident-filter-location",""):a=="type"?localStorage.setItem("incident-filter-type",""):a=="status"&&localStorage.setItem("incident-filter-status","")},n=o(z.params&&z.params.page?z.params.page:1),w=o([]),D=o(""),A=o(0),p=a=>{r.value.loading=!0,w.value[0]=a,A.value%2?w.value[1]="DESC":w.value[1]="ASC",A.value++,D.value=JSON.stringify(w.value),m()},P=o([]),tt=async()=>{await C(c.token).get("/api/fetch/companies").then(a=>{P.value=a.data}).catch(a=>{})},T=o([]),et=async()=>{await C(c.token).get("/api/fetch/locations/non-paginated/data").then(a=>{T.value=a.data}).catch(a=>{})},F=o([]),at=async()=>{await C(c.token).get("/api/fetch-global/incident-types/active").then(a=>{F.value=a.data}).catch(a=>{})},O=o([]),lt=async()=>{await C(c.token).get("/api/fetch-global/incident-status/active").then(a=>{O.value=a.data}).catch(a=>{})},m=async()=>{r.value.loading=!0,await C(c.token).get("/api/fetch/incidents-by/users?userid="+c.user.profile.id+"&role="+c.user.profile.role+"&page="+n.value+"&show="+h.value+"&search="+v.value+"&sort="+D.value+"&filter="+JSON.stringify(s.value)).then(a=>{B.value=a.data.last_page?a.data.last_page:a.data.length,n.value=a.data.current_page?a.data.current_page:n.value,W.value=a.data.total?a.data.total:a.data.length,r.value.data=a.data.data?a.data.data:a.data,r.value.loading=!1}).catch(a=>{r.value.loading=!1,localStorage.setItem("incident-search",null),localStorage.setItem("incident-filter-company",null),localStorage.setItem("incident-filter-location",null),localStorage.setItem("incident-filter-type",null),localStorage.setItem("incident-filter-status",null),localStorage.setItem("incident-filter-row",10)})};rt(n,(a,t)=>{n.value&&a!=t&&(U.push({name:"PaginatedIncidents",params:{page:n.value}}).catch(e=>{}),m(n.value))});const st=a=>{U.push({name:"EditIncident",params:{id:a},query:{type:"details"}}).catch(t=>{})},ot=a=>{console.log("delete",a)},it=(a,t=5)=>{let e="0000"+a;return e.substring(e.length-t)};return ut(()=>{let a=localStorage.getItem("incident-search"),t=localStorage.getItem("incident-filter-company"),e=localStorage.getItem("incident-filter-location"),x=localStorage.getItem("incident-filter-type"),V=localStorage.getItem("incident-filter-status"),_=localStorage.getItem("incident-filter-row");a&&(v.value=y(a)),t&&(s.value.company_id=y(t)),e&&(s.value.location_id=y(e)),x&&(s.value.type_id=y(x)),V&&(s.value.status_id=y(V)),_&&(h.value=y(_)),m().then(()=>{tt(),et(),at().then(()=>{lt()})})}),(a,t)=>(f(),$(pt,null,{default:u(()=>[i(kt,{title:"Asset Incident Page"}),i(Y,{class:"mb-3"},{default:u(()=>[l("div",$t,[i(mt,{loading:r.value.loading},{default:u(()=>[i(vt,{class:"d-flex align-center mb-3 pa-3"},{default:u(()=>[zt,i(ft,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-200035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":N,onKeydown:yt(N,["enter"]),"onClick:clear":t[1]||(t[1]=e=>S("search"))},null,8,["modelValue","onKeydown"])]),_:1}),i(Y,{class:"px-3"},{default:u(()=>[l("div",Bt,[i(I,{items:P.value,modelValue:s.value.company_id,"onUpdate:modelValue":[t[2]||(t[2]=e=>s.value.company_id=e),t[3]||(t[3]=e=>b("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company","onClick:clear":t[4]||(t[4]=e=>S("company"))},null,8,["items","modelValue"])]),l("div",Dt,[i(I,{items:T.value,modelValue:s.value.location_id,"onUpdate:modelValue":[t[5]||(t[5]=e=>s.value.location_id=e),t[6]||(t[6]=e=>b("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title","onClick:clear":t[7]||(t[7]=e=>S("location"))},null,8,["items","modelValue"])]),l("div",Lt,[i(I,{items:F.value,modelValue:s.value.type_id,"onUpdate:modelValue":[t[8]||(t[8]=e=>s.value.type_id=e),t[9]||(t[9]=e=>b("type"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"","onClick:clear":t[10]||(t[10]=e=>S("type")),label:"Type"},null,8,["items","modelValue"])]),l("div",Rt,[i(I,{items:O.value,modelValue:s.value.status_id,"onUpdate:modelValue":[t[11]||(t[11]=e=>s.value.status_id=e),t[12]||(t[12]=e=>b("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"","onClick:clear":t[13]||(t[13]=e=>S("status")),label:"Status"},null,8,["items","modelValue"])]),l("div",Ut,[i(I,{items:X.value,modelValue:h.value,"onUpdate:modelValue":[t[14]||(t[14]=e=>h.value=e),Z],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),i(gt,null,{default:u(()=>[l("thead",null,[l("tr",null,[Nt,At,Pt,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[15]||(t[15]=e=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[16]||(t[16]=e=>p("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[17]||(t[17]=e=>p("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[18]||(t[18]=e=>p("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[19]||(t[19]=e=>p("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[20]||(t[20]=e=>p("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[21]||(t[21]=e=>p("created_at"))},[L(" D.Created"),Tt,Ft]),Ot])]),l("tbody",null,[(f(!0),G(_t,null,ht(r.value.data,e=>{var x,V,_,K,M,E,J,j;return f(),G("tr",{key:e.id},[l("td",null,"ISR-2"+d(it(e.id)),1),l("td",null,d((x=e.urgency)==null?void 0:x.title),1),l("td",null,d((V=e.type)==null?void 0:V.title),1),l("td",null,d((_=e.company)==null?void 0:_.title),1),l("td",null,d((K=e.location)==null?void 0:K.title),1),l("td",null,d(e.asset?e.asset.asset_name:e.title),1),l("td",null,d((M=e.asset)==null?void 0:M.asset_code),1),l("td",null,d((E=e.profile)==null?void 0:E.display_name),1),l("td",null,[i(St,{class:"text-uppercase",size:"small",color:`${(J=e.status)==null?void 0:J.color}`},{default:u(()=>{var q;return[L(d((q=e.status)==null?void 0:q.title),1)]}),_:2},1032,["color"])]),l("td",null,d(k(wt)(e.created_at)),1),l("td",Kt,[l("div",Mt,[i(H,{size:"small",onClick:()=>st(e.id),icon:k(xt),class:"mx-1"},null,8,["onClick","icon"]),k(c).user.role=="superadmin"||(j=k(c).capabilities)!=null&&j.includes("delete")?(f(),$(H,{key:0,size:"small",onClick:()=>ot(e.id),icon:k(Vt),class:"mx-1"},null,8,["onClick","icon"])):R("",!0)])])])}),128))])]),_:1}),r.value.data.length==0?(f(),$(Ct,{key:0,class:"pa-3 text-center w-100"},{default:u(()=>[L("No records found")]),_:1})):R("",!0)]),_:1},8,["loading"]),B.value>1?(f(),$(It,{key:0,modelValue:n.value,"onUpdate:modelValue":t[22]||(t[22]=e=>n.value=e),class:"my-4",length:B.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:r.value.loading},null,8,["modelValue","length","disabled"])):R("",!0)])]),_:1}),i(bt,{options:Q.value},null,8,["options"])]),_:1}))}};export{Ht as default};
