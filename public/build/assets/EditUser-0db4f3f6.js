import{r as i,o as g,c as C,w as s,d as a,j as m,Y as Z,k as P,f as E,J as G,Z as H,_ as Q,e as _,S as X,G as ee,u as ae,a as le,I as se,n as z,m as te,b as o,s as V,$ as B,a0 as D,ae as j,y as I,E as N,p as q,q as ie,F as oe}from"./app-23551d0a.js";import{_ as ue}from"./ApppageHeader-270ca439.js";import{_ as ce,a as de,b as ne}from"./ChangePassword-96bd8941.js";import{_ as re}from"./AppSnackBar-d8e4e03a.js";import"./index.esm-ac89d41e.js";const pe={__name:"Capability",props:["item"],emits:["saved"],setup(R,{emit:k}){const y=R,c=i(!1),n=i(y.item.capabilities),d=i(y.item.capabilities),A=i(["add","edit","delete"]),h=async()=>{c.value=!1,k("saved",{id:y.item.id,capabilities:n.value})},x=()=>{c.value=!1,n.value=d.value};return(r,p)=>(g(),C(X,{width:"500",persistent:"",modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=u=>c.value=u)},{activator:s(({props:u})=>[a(m,Z(u,{text:"Capability",size:"small",color:"primary"}),null,16)]),default:s(({isActive:u})=>[a(P,{title:"Capabilities"},{default:s(()=>[a(E,null,{default:s(()=>[a(G,{variant:"outlined",density:"compact","hide-details":"",multiple:"","item-title":"name","item-value":"name",label:"- Select -",modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=f=>n.value=f),items:A.value},null,8,["modelValue","items"])]),_:1}),a(H,null,{default:s(()=>[a(Q),a(m,{size:"small",text:"cancel",onClick:x}),a(m,{size:"small",color:"secondary",onClick:h},{default:s(()=>[_("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ve={class:"v-col-12"},me={class:"v-col-12"},fe={class:"d-flex flex-wrap"},ge={class:"v-col-12 v-col-md-5"},_e={class:"v-col-12"},be={class:"v-col-12 v-col-md-4"},ye={class:"v-col-12 v-col-md-12 d-flex"},he={class:"v-col-12 v-col-md-12 py-0 d-flex"},Se={class:"my-auto"},Ve={key:0,class:"v-col-12 v-col-md-3"},Ce=o("div",{class:"v-col-12 v-col-md-12"},[_(" Capabilities "),o("br"),o("small",{class:"text-error"},"Warning: it will override the capabilities of all page."),o("br"),o("small",{class:"text-error"},"Select only here if all pages have same capabilities")],-1),ke={class:"v-col-12 v-col-md-12 my-auto"},ze={__name:"EditUser",setup(R){var O,T;const k=ee(),y=ae(),c=le(),n=i(!0),d=i({loading:!1,data:{}}),A=()=>{y.back()},h=async()=>{n.value=!0,await z(c.token).get("/api/admin/user/single/"+k.params.id).then(e=>{d.value.data=e.data,n.value=!1}).catch(e=>{d.value.loading=!1,n.value=!1})},x=e=>{h().then(()=>{F.value={status:!0,type:"success",text:e}})};se(()=>{h().then(()=>{J()})});const r=i("profile"),p=async e=>{r.value=e},u=i([]),f=i(!1),J=()=>{z(c.token).get("/api/fetch/pages-slug").then(e=>{var t;u.value=e.data,((t=d.value.data)==null?void 0:t.access.length)>0&&d.value.data.access.map((l,w)=>{u.value.map(($,xe)=>{l.slug==$.slug&&($.isSelected=l.slug,$.capabilities=l.capabilities?JSON.parse(l.capabilities):[],v.value.push(l.slug),b.value=!0)})})}).catch(e=>{})},b=i(!1),K=()=>{u.value.map((e,t)=>(e.capabilities||(e.capabilities=[]),f.value?(e.isSelected=e.slug,v.value.push(e.slug),b.value=!0):(e.isSelected="",v.value=[],b.value=!1),e))},U=i(!1),v=i([]),L=e=>{e.isSelected?(v.value.splice(v.value.findIndex(l=>l===e.isSelected),1),e.isSelected="",e.capabilities=""):(!e.isSelected||e.isSelected==null||e.isSelected=="")&&(v.value.push(e.slug),e.isSelected=e.slug),b.value=!0,u.value.filter((l,w)=>!l.isSelected).length>0?f.value=!1:f.value=!0},S=i([]),M=i(["add","edit","delete"]),F=i({status:!0,type:"info",text:null}),W=e=>{u.value.map((t,l)=>{t.id==e.id&&(t.capabilities=e.capabilities)})};i((T=(O=c==null?void 0:c.user)==null?void 0:O.profile)==null?void 0:T.id);const Y=()=>{U.value=!0,S.value.length>0&&u.value.map((l,w)=>{l.isSelected?l.capabilities=S.value:l.capabilities=[]});let e=u.value.filter(l=>l.isSelected),t={profileID:k.params.id,data:e,profile_id:c.user.profile.id};z(c.token).post("/api/store-page/settings-capabilities/profile",t).then(l=>{v.value=[],S.value=[],F.value={status:!0,type:"success",text:l.data.message},U.value=!1,h().then(()=>{J()})})};return(e,t)=>(g(),C(te,null,{default:s(()=>[a(ue,{title:"Edit User"}),a(V,{class:"mb-3",disabled:n.value},{default:s(()=>[o("div",ve,[a(m,{color:"primary",class:"mr-4",loading:e.loadingAsset,onClick:A},{default:s(()=>[_("Back")]),_:1},8,["loading"])]),o("div",me,[o("div",fe,[a(m,{color:`${r.value=="profile"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:d.value.loading,onClick:t[0]||(t[0]=()=>p("profile"))},{default:s(()=>[_("profile")]),_:1},8,["color","loading"]),a(m,{color:`${r.value=="account"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:d.value.loading,onClick:t[1]||(t[1]=()=>p("account"))},{default:s(()=>[_("Account")]),_:1},8,["color","loading"]),a(m,{color:`${r.value=="change_password"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:d.value.loading,onClick:t[2]||(t[2]=()=>p("change_password"))},{default:s(()=>[_("Change Password")]),_:1},8,["color","loading"])])]),o("div",ge,[a(V,null,{default:s(()=>[o("div",_e,[B(a(ce,{user:d.value.data,onSaved:x},null,8,["user"]),[[D,r.value=="account"]]),B(a(de,{user:d.value.data,onSaved:x},null,8,["user"]),[[D,r.value=="profile"]]),B(a(ne,{user:d.value.data},null,8,["user"]),[[D,r.value=="change_password"]])])]),_:1})]),o("div",be,[a(P,null,{default:s(()=>[a(E,null,{default:s(()=>[a(V,null,{default:s(()=>[o("div",ye,[a(j,{modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>f.value=l),K],"hide-details":"",variant:"outlined",density:"compact",label:" Access / View Pages"},null,8,["modelValue"]),b.value?(g(),C(m,{key:0,class:"ml-5",size:"small",loading:U.value,color:"secondary",onClick:Y},{default:s(()=>[_("Save")]),_:1},8,["loading"])):I("",!0)])]),_:1}),a(N,{class:"mb-3"}),(g(!0),q(oe,null,ie(u.value,(l,w)=>(g(),C(V,{key:l.id},{default:s(()=>[o("div",he,[a(j,{"model-value":v.value.includes(l.slug),"hide-details":"",variant:"outlined","onUpdate:modelValue":$=>L(l,w),label:l.title,density:"compact"},null,8,["model-value","onUpdate:modelValue","label"]),o("div",Se,[l.isSelected?(g(),C(pe,{key:0,item:l,onSaved:W},null,8,["item"])):I("",!0)])]),a(N)]),_:2},1024))),128))]),_:1})]),_:1})]),b.value?(g(),q("div",Ve,[a(P,null,{default:s(()=>[a(E,null,{default:s(()=>[a(V,null,{default:s(()=>[Ce,a(N),o("div",ke,[a(G,{variant:"outlined",density:"compact","hide-details":"",multiple:"",label:"- Select -",modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l),items:M.value},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})])):I("",!0)]),_:1},8,["disabled"]),a(re,{options:F.value},null,8,["options"])]),_:1}))}};export{ze as default};
