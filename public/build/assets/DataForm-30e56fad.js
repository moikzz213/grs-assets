import{i as te,r as d,o as le,b as f,c as W,j as g,k as l,l as a,q as P,G as m,z as T,m as F,A as q,I,D as h,F as me,d as ve,X as pe,Y as fe,Z as _e,_ as de,f as i,K as R,t as U,O as Q,$ as ne,J as ue,L as ye,u as be,N as ge,a0 as ee,V as he,a1 as Z,a2 as K,y as ie,E as Ve,H as ke,a3 as je,P as xe,C as De}from"./app-273ebe1e.js";import{_ as Ce}from"./ApppageHeader-6f30069f.js";import{_ as we}from"./AppSnackBar-adb7e97a.js";import{c as $e,a as X,F as Se,b as G}from"./index.esm-baee3734.js";import{S as Fe}from"./StreamBarcodeReader-c2d2c329.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{u as ae}from"./formatDate-24b70229.js";import{v as Ue}from"./filepond.min-3c5c6ec6.js";const Te=i("div",{class:"v-col-12 text-uppercase font-weight-bold"}," Uploaded Files ",-1),Re=i("div",{class:"v-col-12"},"No file found.",-1),Le=["src"],Ee={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},files:{type:Array,default:[]}},emits:["deleted"],setup(z,{emit:r}){const u=z;console.log("objectdata",u.objectdata.profile_id);const e=te(),$=d([]),n=d(null),H=Ue(),A={process:(x,p,b,D,N,B,O,oe,C)=>{const E=new FormData;E.append(x,p,p.name),E.append("profile_id",e.user.profile.id),E.append("ID",u.incidentId),E.append("type","incident");const j=new XMLHttpRequest;return j.open("POST","/api/upload-files/docs-images"),j.upload.onprogress=J=>{B(J.lengthComputable,J.loaded,J.total)},j.onload=function(){j.status>=200&&j.status<300?D(j.responseText):N("oh no")},j.send(E),{abort:()=>{j.abort(),O()}}}},M=d(e.user.profile.id),k=d(""),L=d(!1),y=(x,p)=>{L.value=p,k.value=x},Y=()=>{console.log("initialised")},_=()=>{n.value.processFiles().then(x=>{let p={};x.map((b,D)=>{p=JSON.parse(b.serverId)[0][0],c.value.push(p)})})},v=(x,p)=>{let b={data:x,ID:u.incidentId};R(e.token).post("/api/delete/uploaded-file",b).then(D=>{c.value.splice(p,1),r("deleted",D.data.msg)}).catch(D=>{})},c=d([]);return le(()=>{c.value=u.files}),(x,p)=>(f(),W("div",null,[u.objectdata.profile_id==M.value?(f(),g(q,{key:0},{default:l(()=>[a(P,null,{default:l(()=>[a(m(H),{name:"filename",ref_key:"pond",ref:n,credits:"","label-idle":"Select or Drop image (jpeg, jpg, png) here... max 6 files only","allow-multiple":!0,"accepted-file-types":"image/jpeg, image/png",files:$.value,server:A,onInit:Y,"max-files":"6",instantUpload:"false"},null,8,["files"]),a(T,{onClick:_},{default:l(()=>[F("Upload")]),_:1})]),_:1})]),_:1})):I("",!0),a(q,{class:"mt-2"},{default:l(()=>[a(P,null,{default:l(()=>[a(h,null,{default:l(()=>[Te]),_:1}),c.value&&c.value.length>0?(f(),g(h,{key:0},{default:l(()=>[(f(!0),W(me,null,ve(c.value,(b,D)=>(f(),W("div",{class:"v-col-12 v-col-md-3 text-center parent-row-show",key:b.id},[a(pe,{onClick:N=>y(b,!0),class:"mx-3 cursor-pointer",src:`/storage/uploads/${b.path}`,alt:"File",maxHeight:"150",style:{border:"1px solid #e2e2e2"}},null,8,["onClick","src"]),m(e).user.profile.id==b.profile_id?(f(),g(T,{key:0,onClick:N=>v(b,D),class:"show-hover mx-auto mt-2",size:"small",color:"error"},{default:l(()=>[F("Delete Image")]),_:2},1032,["onClick"])):I("",!0)]))),128))]),_:1})):(f(),g(h,{key:1},{default:l(()=>[Re]),_:1}))]),_:1})]),_:1}),a(de,{maxWidth:"900",modelValue:L.value,"onUpdate:modelValue":p[1]||(p[1]=b=>L.value=b)},{default:l(()=>[a(T,{size:"small",onClick:p[0]||(p[0]=()=>y("",!1)),icon:m(fe),style:{position:"absolute",right:"-10px",top:"-10px","z-index":"9999"},color:"error"},null,8,["icon"]),a(q,{class:"text-center"},{default:l(()=>[a(_e,{color:"primary",title:`Filename: ${k.value.original_name}`},null,8,["title"]),a(P,null,{default:l(()=>[k.value?(f(),W("img",{key:0,src:`/storage/uploads/${k.value.path}`,alt:"Image"},null,8,Le)):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Ae={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Ne={class:"font-weight-bold"},Pe={class:"reported-by"},Be={class:"reported-by"},Oe={class:"v-col-12"},qe={class:"v-col-12 v-col-md-4 pb-0"},ze={class:"v-col-12 v-col-md-8"},He={class:"v-col-12"},Me={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["deleted"],setup(z,{emit:r}){const u=z,e=te(),$=d(e.user.profile.role),n=d({}),H=d([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),A=d([]),M=async()=>{await R(e.token).get("/api/fetch/profile-facility/team").then(_=>{A.value=_.data}).catch(_=>{})},k=()=>{n.value.profile_id=e.user.profile.id,R(e.token).post("/api/incident/update-facility-team",n.value).then(_=>{r("saved",_.data.message)}).catch(_=>{})},L=d([]),y=async()=>{await R(e.token).get("/api/fetch-global/incident-status/active").then(_=>{L.value=_.data}).catch(_=>{})},Y=(_,v=6)=>{let c="00000"+_;return c.substring(c.length-v)};return le(()=>{M(),y(),n.value=u.objectdata,n.value.priority=u.objectdata.priority?parseInt(u.objectdata.priority):null}),(_,v)=>(f(),W("div",null,[a(q,null,{default:l(()=>[a(P,null,{default:l(()=>[a(h,null,{default:l(()=>{var c;return[i("div",Ae,[i("div",Ne," SN: ISR-"+U(Y(n.value.id)),1),i("div",Pe," REPORTED BY: "+U((c=n.value.profile)==null?void 0:c.display_name),1),i("div",Be," DATE REPORTED: "+U(m(ae)(n.value.created_at)),1)])]}),_:1}),a(h,null,{default:l(()=>[i("div",Oe,[a(h,null,{default:l(()=>[i("div",qe,[a(Q,{items:H.value,modelValue:n.value.priority,"onUpdate:modelValue":v[0]||(v[0]=c=>n.value.priority=c),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:$.value=="facility"},null,8,["items","modelValue","disabled"]),a(Q,{items:A.value,modelValue:n.value.handled_by,"onUpdate:modelValue":v[1]||(v[1]=c=>n.value.handled_by=c),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:$.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),a(Q,{items:L.value,modelValue:n.value.status_id,"onUpdate:modelValue":v[2]||(v[2]=c=>n.value.status_id=c),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),i("div",ze,[a(ne,{class:"my-2",variant:"outlined",density:"compact",label:"Remarks",modelValue:n.value.remarks,"onUpdate:modelValue":v[3]||(v[3]=c=>n.value.remarks=c)},null,8,["modelValue"])])]),_:1})]),a(ue,{class:"mt-3"}),i("div",He,[a(T,{class:"",size:"small",disabled:!n.value.priority||!n.value.handled_by||!n.value.status_id,onClick:k,color:"primary"},{default:l(()=>[F("Submit")]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]))}};const Ye={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},Je={class:"font-weight-bold"},Ke={class:"reported-by"},Xe={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},Ge={class:"v-col-12 v-col-md-3"},We={class:"v-col-12 v-col-md-3"},Ze={class:"v-col-12 v-col-md-6 d-flex"},Qe={class:"v-col-12"},ea={class:"v-col-12 v-col-md-12"},aa={class:"v-col-12 v-col-md-3"},ta={class:"v-col-12"},la={class:"v-col-12"},oa={class:"v-col-12 v-col-md-9"},sa={class:"v-col-12 v-col-md-6"},ia={class:"v-col-12 v-col-md-3"},da={class:"v-col-12 v-col-md-3"},na={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},setup(z){const r=z,u=te(),e=d({}),$=d({}),n=o=>{$.value={status:!0,type:"success",text:o}},H=d(u.user.profile.id),A=d([]),M=async()=>{await R(u.token).get("/api/fetch-global/incident-types/active").then(o=>{A.value=o.data}).catch(o=>{})},k=ye(),L=be(),y=d(k.query.type),Y=d([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let _=$e({Type:X().required(),Urgency:X().required(),Title:X().required(),Company:X().required(),Location:X().required()});const v=d(!1),c=()=>{p.value=!1,v.value=!0},x=async o=>{await R(u.token).get("/api/fetch/asset-info/by/asset-code/"+o).then(t=>{e.value.asset_code=t.data.asset_code,e.value.title=t.data.asset_name,e.value.company_id=t.data.company_id,e.value.location_id=t.data.location_id,e.value.asset_id=t.data.id,v.value=!1}).catch(t=>{})},p=d(!1),b=()=>{p.value=!0},D=new URL(window.location),N=o=>{y.value=o,E("type",o)},B=d(!1),O=d(u.user.profile.role),oe=async()=>{B.value=!0,$.value={status:!0,type:"info",text:"Please wait..."},e.value.profile_id=u.user.profile.id,await R(u.token).post("/api/store-update/incident",e.value).then(o=>{$.value={status:!0,type:"success",text:o.data.message},k.params.id?B.value=!1:setTimeout(()=>{L.push({name:"EditIncident",params:{id:o.data.id},query:{type:"details"}}).catch(t=>{}),B.value=!1},800)}).catch(o=>{})};d(!1);const C=d(!1),E=(o,t)=>{D.searchParams.set(o,t),window.history.pushState({},"",D)},j=d([]),J=async()=>{await R(u.token).get("/api/fetch/companies").then(o=>{j.value=o.data}).catch(o=>{})},se=d([]),ce=async()=>{await R(u.token).get("/api/fetch/locations/non-paginated/data").then(o=>{se.value=o.data}).catch(o=>{})},re=(o,t=6)=>{let w="00000"+o;return w.substring(w.length-t)};return le(()=>{var o;k.params.id&&(C.value=!0),y.value||(y.value="details",E("type","details")),M().then(()=>{J().then(()=>{ce()})}),C.value&&(e.value=r.objectdata,e.value.asset_code=(o=r.objectdata.asset)==null?void 0:o.asset_code,e.value.title=r.objectdata.asset?r.objectdata.asset.asset_name:r.objectdata.title,e.value.company_id=r.objectdata.company_id,e.value.location_id=r.objectdata.location_id,e.value.asset_id=r.objectdata.id,e.value.profile_id=r.objectdata.profile_id,e.value.type_id=parseInt(r.objectdata.type_id),e.value.urgency=parseInt(r.objectdata.urgency),e.value.description=r.objectdata.description)}),(o,t)=>(f(),g(De,null,{default:l(()=>[a(Ce,{title:"Incident detail page"}),a(h,{class:"mb-3"},{default:l(()=>[a(ge,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[a(h,{class:"mb-3"},{default:l(()=>[a(T,{class:ee(`${y.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:t[0]||(t[0]=w=>N("details"))},{default:l(()=>[F("Details")]),_:1},8,["class"]),C.value?(f(),g(T,{key:0,class:ee(`${y.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[1]||(t[1]=w=>N("attachment"))},{default:l(()=>[F("Attachments")]),_:1},8,["class"])):I("",!0),C.value&&(m(u).user.profile.role=="facility"||m(u).user.profile.role=="admin"||m(u).user.profile.role=="superadmin"||m(u).user.profile.role=="technical-operation")?(f(),g(T,{key:1,class:ee(`${y.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[2]||(t[2]=w=>N("facility"))},{default:l(()=>[F("Facility Team")]),_:1},8,["class"])):I("",!0)]),_:1}),y.value=="details"?(f(),g(q,{key:0},{default:l(()=>[a(m(Se),{as:"v-form","validation-schema":m(_)},{default:l(({meta:w})=>[a(he,{class:"my-3 ml-3 text-uppercase text-h6"},{default:l(()=>[F(U(r.headertitle),1)]),_:1}),a(P,null,{default:l(()=>[C.value?(f(),g(h,{key:0},{default:l(()=>{var s,V;return[i("div",Ye,[i("div",Je," SN: ISR-"+U(re(e.value.id)),1),i("div",Ke," REPORTED BY: "+U((s=e.value.profile)==null?void 0:s.display_name),1)]),i("div",Xe," STATUS: "+U((V=e.value.status)==null?void 0:V.title),1)]}),_:1})):I("",!0),a(h,null,{default:l(()=>[i("div",Ge,[a(m(G),{name:"Type",modelValue:e.value.type_id,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.type_id=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:A.value,modelValue:e.value.type_id,"onUpdate:modelValue":t[3]||(t[3]=S=>e.value.type_id=S),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",We,[a(m(G),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value.urgency=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:Y.value,modelValue:e.value.urgency,"onUpdate:modelValue":t[5]||(t[5]=S=>e.value.urgency=S),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",Ze,[a(ie,{modelValue:e.value.asset_code,"onUpdate:modelValue":t[7]||(t[7]=s=>e.value.asset_code=s),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),a(Ve,{onClick:c,class:"ml-2 my-auto",size:"large",icon:m(ke)},null,8,["icon"])]),i("div",Qe,[a(m(G),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":t[9]||(t[9]=s=>e.value.title=s)},{default:l(({field:s,errors:V})=>[a(ie,K({modelValue:e.value.title,"onUpdate:modelValue":t[8]||(t[8]=S=>e.value.title=S),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},s,{"error-messages":V}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",ea,[a(h,null,{default:l(()=>[i("div",aa,[a(h,null,{default:l(()=>[i("div",ta,[a(m(G),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":t[11]||(t[11]=s=>e.value.company_id=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:j.value,modelValue:e.value.company_id,"onUpdate:modelValue":t[10]||(t[10]=S=>e.value.company_id=S),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",la,[a(m(G),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":t[13]||(t[13]=s=>e.value.location_id=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:se.value,modelValue:e.value.location_id,"onUpdate:modelValue":t[12]||(t[12]=S=>e.value.location_id=S),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),i("div",oa,[a(ne,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":t[14]||(t[14]=s=>e.value.description=s)},null,8,["modelValue"])])]),_:1})])]),_:1}),a(ue,{class:"my-3"}),a(h,null,{default:l(()=>[i("div",sa,[!C.value||C.value&&r.objectdata.profile_id==H.value?(f(),g(T,{key:0,size:"small",color:"primary",onClick:oe,disabled:!w.valid,loading:B.value},{default:l(()=>[F("Submit")]),_:2},1032,["disabled","loading"])):I("",!0)]),i("div",ia," DATE REPORTED: "+U(m(ae)(e.value.created_at)),1),i("div",da," DATE CLOSED: "+U(o.date_closed?m(ae)(e.value.date_closed):""),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):C.value&&y.value=="attachment"?(f(),g(Ee,{key:1,"incident-id":m(k).params.id,files:e.value.files,onDeleted:n,objectdata:r.objectdata},null,8,["incident-id","files","objectdata"])):(O.value=="superadmin"||O.value=="admin"||O.value=="technical-operation"||O.value=="facility")&&C.value&&y.value=="facility"?(f(),g(Me,{key:2,objectdata:r.objectdata,onSaved:n},null,8,["objectdata"])):I("",!0)]),_:1})]),_:1}),a(we,{options:$.value},null,8,["options"]),a(de,{width:"500",modelValue:v.value,"onUpdate:modelValue":t[16]||(t[16]=w=>v.value=w)},{default:l(()=>[a(q,null,{default:l(()=>[a(P,null,{default:l(()=>[a(m(Fe),{onDecode:x,onLoaded:b})]),_:1}),p.value?I("",!0):(f(),g(P,{key:0},{default:l(()=>[F("Please wait...")]),_:1})),a(je,null,{default:l(()=>[a(xe),a(T,{text:"Close",onClick:t[15]||(t[15]=w=>v.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ya=Ie(na,[["__scopeId","data-v-d229f7fb"]]);export{ya as D};
