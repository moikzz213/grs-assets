import{i as te,r as d,o as le,b as f,c as W,j as b,k as l,l as a,q as P,G as m,z as U,m as S,A as q,I as F,D as h,F as me,d as ve,X as pe,Y as fe,Z as _e,_ as de,f as i,K as T,t as I,O as Q,$ as ne,J as ue,L as ye,u as ge,N as be,a0 as ee,V as he,a1 as Z,a2 as K,y as ie,E as Ve,H as ke,a3 as je,P as xe,C as De}from"./app-6b853f5a.js";import{_ as Ce}from"./AppPageHeader-1a766bb1.js";import{_ as we}from"./AppSnackBar-04a5f438.js";import{c as $e,a as X,F as Se,b as G}from"./index.esm-a45c2025.js";import{S as Fe}from"./StreamBarcodeReader-1557b3a8.js";import{_ as Ie}from"./_plugin-vue_export-helper-c27b6911.js";import{u as ae}from"./formatDate-24b70229.js";import{v as Ue}from"./filepond.min-cb09c25f.js";const Te=i("div",{class:"v-col-12 text-uppercase font-weight-bold"}," Uploaded Files ",-1),Re=i("div",{class:"v-col-12"},"No file found.",-1),Le=["src"],Ee={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},files:{type:Array,default:[]}},emits:["deleted"],setup(z,{emit:r}){const u=z;console.log("objectdata",u.objectdata.profile_id);const e=te(),w=d([]),c=d(null),H=Ue(),A={process:(x,p,g,D,N,B,O,oe,L)=>{const E=new FormData;E.append(x,p,p.name),E.append("profile_id",e.user.profile.id),E.append("ID",u.incidentId),E.append("type","incident");const j=new XMLHttpRequest;return j.open("POST","/api/upload-files/docs-images"),j.upload.onprogress=J=>{B(J.lengthComputable,J.loaded,J.total)},j.onload=function(){j.status>=200&&j.status<300?D(j.responseText):N("oh no")},j.send(E),{abort:()=>{j.abort(),O()}}}},M=d(e.user.profile.id),k=d(""),R=d(!1),y=(x,p)=>{R.value=p,k.value=x},Y=()=>{console.log("initialised")},_=()=>{c.value.processFiles().then(x=>{let p={};x.map((g,D)=>{p=JSON.parse(g.serverId)[0][0],n.value.push(p)})})},v=(x,p)=>{let g={data:x,ID:u.incidentId};T(e.token).post("/api/delete/uploaded-file",g).then(D=>{n.value.splice(p,1),r("deleted",D.data.msg)}).catch(D=>{})},n=d([]);return le(()=>{n.value=u.files}),(x,p)=>(f(),W("div",null,[u.objectdata.profile_id==M.value?(f(),b(q,{key:0},{default:l(()=>[a(P,null,{default:l(()=>[a(m(H),{name:"filename",ref_key:"pond",ref:c,credits:"","label-idle":"Select or Drop image (jpeg, jpg, png) here... max 6 files only","allow-multiple":!0,"accepted-file-types":"image/jpeg, image/png",files:w.value,server:A,onInit:Y,"max-files":"6",instantUpload:"false"},null,8,["files"]),a(U,{onClick:_},{default:l(()=>[S("Upload")]),_:1})]),_:1})]),_:1})):F("",!0),a(q,{class:"mt-2"},{default:l(()=>[a(P,null,{default:l(()=>[a(h,null,{default:l(()=>[Te]),_:1}),n.value&&n.value.length>0?(f(),b(h,{key:0},{default:l(()=>[(f(!0),W(me,null,ve(n.value,(g,D)=>(f(),W("div",{class:"v-col-12 v-col-md-3 text-center parent-row-show",key:g.id},[a(pe,{onClick:N=>y(g,!0),class:"mx-3 cursor-pointer",src:`/storage/uploads/${g.path}`,alt:"File",maxHeight:"150",style:{border:"1px solid #e2e2e2"}},null,8,["onClick","src"]),m(e).user.profile.id==g.profile_id?(f(),b(U,{key:0,onClick:N=>v(g,D),class:"show-hover mx-auto mt-2",size:"small",color:"error"},{default:l(()=>[S("Delete Image")]),_:2},1032,["onClick"])):F("",!0)]))),128))]),_:1})):(f(),b(h,{key:1},{default:l(()=>[Re]),_:1}))]),_:1})]),_:1}),a(de,{maxWidth:"900",modelValue:R.value,"onUpdate:modelValue":p[1]||(p[1]=g=>R.value=g)},{default:l(()=>[a(U,{size:"small",onClick:p[0]||(p[0]=()=>y("",!1)),icon:m(fe),style:{position:"absolute",right:"-10px",top:"-10px","z-index":"9999"},color:"error"},null,8,["icon"]),a(q,{class:"text-center"},{default:l(()=>[a(_e,{color:"primary",title:`Filename: ${k.value.original_name}`},null,8,["title"]),a(P,null,{default:l(()=>[k.value?(f(),W("img",{key:0,src:`/storage/uploads/${k.value.path}`,alt:"Image"},null,8,Le)):F("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Ae={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Ne={class:"font-weight-bold"},Pe={class:"reported-by"},Be={class:"reported-by"},Oe={class:"v-col-12"},qe={class:"v-col-12 v-col-md-4 pb-0"},ze={class:"v-col-12 v-col-md-8"},He={class:"v-col-12"},Me={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["deleted"],setup(z,{emit:r}){const u=z,e=te(),w=d(e.user.profile.role),c=d({}),H=d([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),A=d([]),M=async()=>{await T(e.token).get("/api/fetch/profile-facility/team").then(_=>{A.value=_.data}).catch(_=>{})},k=()=>{c.value.profile_id=e.user.profile.id,T(e.token).post("/api/incident/update-facility-team",c.value).then(_=>{r("saved",_.data.message)}).catch(_=>{})},R=d([]),y=async()=>{await T(e.token).get("/api/fetch-global/incident-status/active").then(_=>{R.value=_.data}).catch(_=>{})},Y=(_,v=6)=>{let n="00000"+_;return n.substring(n.length-v)};return le(()=>{M(),y(),c.value=u.objectdata,c.value.priority=parseInt(u.objectdata.priority)}),(_,v)=>(f(),W("div",null,[a(q,null,{default:l(()=>[a(P,null,{default:l(()=>[a(h,null,{default:l(()=>{var n;return[i("div",Ae,[i("div",Ne," SN: ISR-"+I(Y(c.value.id)),1),i("div",Pe," REPORTED BY: "+I((n=c.value.profile)==null?void 0:n.display_name),1),i("div",Be," DATE REPORTED: "+I(m(ae)(c.value.created_at)),1)])]}),_:1}),a(h,null,{default:l(()=>[i("div",Oe,[a(h,null,{default:l(()=>[i("div",qe,[a(Q,{items:H.value,modelValue:c.value.priority,"onUpdate:modelValue":v[0]||(v[0]=n=>c.value.priority=n),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:w.value=="facility"},null,8,["items","modelValue","disabled"]),a(Q,{items:A.value,modelValue:c.value.handled_by,"onUpdate:modelValue":v[1]||(v[1]=n=>c.value.handled_by=n),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:w.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),a(Q,{items:R.value,modelValue:c.value.status_id,"onUpdate:modelValue":v[2]||(v[2]=n=>c.value.status_id=n),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),i("div",ze,[a(ne,{class:"my-2",variant:"outlined",density:"compact",label:"Remarks",modelValue:c.value.remarks,"onUpdate:modelValue":v[3]||(v[3]=n=>c.value.remarks=n)},null,8,["modelValue"])])]),_:1})]),a(ue,{class:"mt-3"}),i("div",He,[a(U,{class:"",size:"small",onClick:k,color:"primary"},{default:l(()=>[S("Submit")]),_:1})])]),_:1})]),_:1})]),_:1})]))}};const Ye={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},Je={class:"font-weight-bold"},Ke={class:"reported-by"},Xe={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},Ge={class:"v-col-12 v-col-md-3"},We={class:"v-col-12 v-col-md-3"},Ze={class:"v-col-12 v-col-md-6 d-flex"},Qe={class:"v-col-12"},ea={class:"v-col-12 v-col-md-12"},aa={class:"v-col-12 v-col-md-3"},ta={class:"v-col-12"},la={class:"v-col-12"},oa={class:"v-col-12 v-col-md-9"},sa={class:"v-col-12 v-col-md-6"},ia={class:"v-col-12 v-col-md-3"},da={class:"v-col-12 v-col-md-3"},na={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},setup(z){const r=z,u=te(),e=d({}),w=d({}),c=o=>{w.value={status:!0,type:"success",text:o}},H=d(u.user.profile.id),A=d([]),M=async()=>{await T(u.token).get("/api/fetch-global/incident-types/active").then(o=>{A.value=o.data}).catch(o=>{})},k=ye(),R=ge(),y=d(k.query.type),Y=d([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let _=$e({Type:X().required(),Urgency:X().required(),Title:X().required(),Company:X().required(),Location:X().required()});const v=d(!1),n=()=>{p.value=!1,v.value=!0},x=async o=>{await T(u.token).get("/api/fetch/asset-info/by/asset-code/"+o).then(t=>{e.value.asset_code=t.data.asset_code,e.value.title=t.data.asset_name,e.value.company_id=t.data.company_id,e.value.location_id=t.data.location_id,e.value.asset_id=t.data.id,v.value=!1}).catch(t=>{})},p=d(!1),g=()=>{p.value=!0},D=new URL(window.location),N=o=>{y.value=o,E("type",o)},B=d(!1),O=d(u.user.profile.role),oe=async()=>{B.value=!0,w.value={status:!0,type:"info",text:"Please wait..."},e.value.profile_id=u.user.profile.id,await T(u.token).post("/api/store-update/incident",e.value).then(o=>{w.value={status:!0,type:"success",text:o.data.message},k.params.id?B.value=!1:setTimeout(()=>{R.push({name:"EditIncident",params:{id:o.data.id},query:{type:"details"}}).catch(t=>{}),B.value=!1},800)}).catch(o=>{})};d(!1);const L=d(!1),E=(o,t)=>{D.searchParams.set(o,t),window.history.pushState({},"",D)},j=d([]),J=async()=>{await T(u.token).get("/api/fetch/companies").then(o=>{j.value=o.data}).catch(o=>{})},se=d([]),ce=async()=>{await T(u.token).get("/api/fetch/locations/non-paginated/data").then(o=>{se.value=o.data}).catch(o=>{})},re=(o,t=6)=>{let C="00000"+o;return C.substring(C.length-t)};return le(()=>{var o;k.params.id&&(L.value=!0),y.value||(y.value="details",E("type","details")),M().then(()=>{J().then(()=>{ce()})}),L.value&&(e.value=r.objectdata,e.value.asset_code=(o=r.objectdata.asset)==null?void 0:o.asset_code,e.value.title=r.objectdata.asset?r.objectdata.asset.asset_name:r.objectdata.title,e.value.company_id=r.objectdata.company_id,e.value.location_id=r.objectdata.location_id,e.value.asset_id=r.objectdata.id,e.value.profile_id=r.objectdata.profile_id,e.value.type_id=parseInt(r.objectdata.type_id),e.value.urgency=parseInt(r.objectdata.urgency),e.value.description=r.objectdata.description)}),(o,t)=>(f(),b(De,null,{default:l(()=>[a(Ce,{title:"Incident detail page"}),a(h,{class:"mb-3"},{default:l(()=>[a(be,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[a(h,{class:"mb-3"},{default:l(()=>[a(U,{class:ee(`${y.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:t[0]||(t[0]=C=>N("details"))},{default:l(()=>[S("Details")]),_:1},8,["class"]),L.value?(f(),b(U,{key:0,class:ee(`${y.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[1]||(t[1]=C=>N("attachment"))},{default:l(()=>[S("Attachments")]),_:1},8,["class"])):F("",!0),L.value&&(m(u).user.profile.role=="facility"||m(u).user.profile.role=="admin"||m(u).user.profile.role=="superadmin"||m(u).user.profile.role=="technical-operation")?(f(),b(U,{key:1,class:ee(`${y.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[2]||(t[2]=C=>N("facility"))},{default:l(()=>[S("Facility Team")]),_:1},8,["class"])):F("",!0)]),_:1}),y.value=="details"?(f(),b(q,{key:0},{default:l(()=>[a(m(Se),{as:"v-form","validation-schema":m(_)},{default:l(({meta:C})=>[a(he,{class:"my-3 ml-3 text-uppercase text-h6"},{default:l(()=>[S(I(r.headertitle),1)]),_:1}),a(P,null,{default:l(()=>[L.value?(f(),b(h,{key:0},{default:l(()=>{var s,V;return[i("div",Ye,[i("div",Je," SN: ISR-"+I(re(e.value.id)),1),i("div",Ke," REPORTED BY: "+I((s=e.value.profile)==null?void 0:s.display_name),1)]),i("div",Xe," STATUS: "+I((V=e.value.status)==null?void 0:V.title),1)]}),_:1})):F("",!0),a(h,null,{default:l(()=>[i("div",Ge,[a(m(G),{name:"Type",modelValue:e.value.type_id,"onUpdate:modelValue":t[4]||(t[4]=s=>e.value.type_id=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:A.value,modelValue:e.value.type_id,"onUpdate:modelValue":t[3]||(t[3]=$=>e.value.type_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",We,[a(m(G),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":t[6]||(t[6]=s=>e.value.urgency=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:Y.value,modelValue:e.value.urgency,"onUpdate:modelValue":t[5]||(t[5]=$=>e.value.urgency=$),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",Ze,[a(ie,{modelValue:e.value.asset_code,"onUpdate:modelValue":t[7]||(t[7]=s=>e.value.asset_code=s),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),a(Ve,{onClick:n,class:"ml-2 my-auto",size:"large",icon:m(ke)},null,8,["icon"])]),i("div",Qe,[a(m(G),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":t[9]||(t[9]=s=>e.value.title=s)},{default:l(({field:s,errors:V})=>[a(ie,K({modelValue:e.value.title,"onUpdate:modelValue":t[8]||(t[8]=$=>e.value.title=$),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},s,{"error-messages":V}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",ea,[a(h,null,{default:l(()=>[i("div",aa,[a(h,null,{default:l(()=>[i("div",ta,[a(m(G),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":t[11]||(t[11]=s=>e.value.company_id=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:j.value,modelValue:e.value.company_id,"onUpdate:modelValue":t[10]||(t[10]=$=>e.value.company_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),i("div",la,[a(m(G),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":t[13]||(t[13]=s=>e.value.location_id=s)},{default:l(({field:s,errors:V})=>[a(Z,K({items:se.value,modelValue:e.value.location_id,"onUpdate:modelValue":t[12]||(t[12]=$=>e.value.location_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},s,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),i("div",oa,[a(ne,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":t[14]||(t[14]=s=>e.value.description=s)},null,8,["modelValue"])])]),_:1})])]),_:1}),a(ue,{class:"my-3"}),a(h,null,{default:l(()=>[i("div",sa,[r.objectdata.profile_id==H.value?(f(),b(U,{key:0,size:"small",color:"primary",onClick:oe,disabled:!C.valid,loading:B.value},{default:l(()=>[S("Submit")]),_:2},1032,["disabled","loading"])):F("",!0)]),i("div",ia," DATE REPORTED: "+I(m(ae)(e.value.created_at)),1),i("div",da," DATE CLOSED: "+I(o.date_closed?m(ae)(e.value.date_closed):""),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):L.value&&y.value=="attachment"?(f(),b(Ee,{key:1,"incident-id":m(k).params.id,files:e.value.files,onDeleted:c,objectdata:r.objectdata},null,8,["incident-id","files","objectdata"])):(O.value=="superadmin"||O.value=="admin"||O.value=="technical-operation"||O.value=="facility")&&L.value&&y.value=="facility"?(f(),b(Me,{key:2,objectdata:r.objectdata,onSaved:c},null,8,["objectdata"])):F("",!0)]),_:1})]),_:1}),a(we,{options:w.value},null,8,["options"]),a(de,{width:"500",modelValue:v.value,"onUpdate:modelValue":t[16]||(t[16]=C=>v.value=C)},{default:l(()=>[a(q,null,{default:l(()=>[a(P,null,{default:l(()=>[a(m(Fe),{onDecode:x,onLoaded:g})]),_:1}),p.value?F("",!0):(f(),b(P,{key:0},{default:l(()=>[S("Please wait...")]),_:1})),a(je,null,{default:l(()=>[a(xe),a(U,{text:"Close",onClick:t[15]||(t[15]=C=>v.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ya=Ie(na,[["__scopeId","data-v-1aaedf36"]]);export{ya as D};
