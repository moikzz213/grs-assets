import{i as le,r as f,W as ge,o as se,O as X,b as p,c as N,e as o,l as e,k as t,E as h,j as b,F as Z,d as Q,z as D,K as r,X as ke,A as E,Y as ce,Z as ve,_ as Se,$ as je,T as we,m,D as $,q as L,t as V,P as te,a0 as me,M as ae,N as Ce,u as xe,G as j,a1 as K,I as U,V as Te,a2 as J,a3 as z,y as re,J as De,L as $e,a4 as Ae,a5 as Re,C as Ie,p as Ue,g as Ee}from"./app-4d09b9e7.js";import{_ as Ne}from"./AppPageHeader-8a6b4320.js";import{_ as Le}from"./AppSnackBar-a9c4abb9.js";import{c as Oe,a as M,F as Fe,b as H}from"./index.esm-feb86d9b.js";import{S as Be}from"./StreamBarcodeReader-30f8a2c4.js";import{_ as Pe}from"./_plugin-vue_export-helper-c27b6911.js";import{u as O,a as We}from"./formatDate-d9866ad4.js";import{_ as qe}from"./Studio-b8bbf1e7.js";const ze={class:"v-col-12 pt-5"},Me={class:"v-col-12 pb-2"},He={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ye={class:"v-col-12 pt-0 pb-2"},Ge={class:"v-col-12"},Ke={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(x,{emit:P}){const d=x,_=le(),a=f(window.location.origin),c=i=>{let v=null;i.map(s=>{v=y.value.find(w=>w.id==s.id),v||y.value.push(s)})},A=f(!1),R=f(1),F=i=>{R.value=i,A.value=!0},W=i=>{y.value=y.value.filter(v=>v.id!==i)},y=f([]),B=ge(()=>y.value.map(i=>i.id)),g=()=>{let i={id:parseInt(d.incidentId),file_ids:B.value,profile_id:d.objectdata.profile_id};$(_.token).post("/api/incident/sync-images/store-update",i).then(v=>{let s="Attachment has been updated";B.value.length==0&&(s="Attachment has been deleted"),P("save",s)}).catch(v=>{})};return se(()=>{y.value=d.attachment}),X(()=>d.objectdata.attachment,(i,v)=>{y.value=i},{deep:!0}),(i,v)=>(p(),N("div",null,[o("div",ze,[e(h,null,{default:t(()=>[o("div",Me,[e(qe,{options:{multiSelect:!0,type:"incident"},onSelect:c})])]),_:1}),y.value.length>0?(p(),b(h,{key:0,class:"px-1"},{default:t(()=>[(p(!0),N(Z,null,Q(y.value,(s,w)=>(p(),N("div",{key:s.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[e(D,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:r(ke),size:"26px",color:"error",onClick:()=>W(s.id)},null,8,["icon","onClick"]),e(E,{onClick:()=>F(w)},{default:t(()=>[e(ce,{src:a.value+"/file/"+s.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),e(ve,{modelValue:A.value,"onUpdate:modelValue":v[1]||(v[1]=s=>A.value=s),width:"95%","max-width":"900"},{default:t(()=>[e(E,{class:"bg-black"},{default:t(()=>[e(Se,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:R.value,"onUpdate:modelValue":v[0]||(v[0]=s=>R.value=s)},{default:t(()=>[(p(!0),N(Z,null,Q(y.value,(s,w)=>(p(),b(je,{key:w,"reverse-transition":"fade",transition:"fade"},{default:t(()=>[o("div",He,[e(ce,{src:a.value+"/file/"+s.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(p(),b(h,{key:1},{default:t(()=>[o("div",Ye,[e(we,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:t(()=>[m(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),e(h,null,{default:t(()=>[o("div",Ge,[e(D,{color:"primary",onClick:g},{default:t(()=>[m("Save")]),_:1})])]),_:1})])]))}},Je={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Xe={class:"font-weight-bold"},Ze={class:"reported-by"},Qe={class:"reported-by"},et={class:"v-col-12"},tt={class:"v-col-12 v-col-md-4 pb-0"},at={class:"v-col-12 v-col-md-8"},lt={class:"v-col-12"},st={class:"v-col-12"},ot={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},dt={class:"v-col-3"},it=o("br",null,null,-1),nt={class:"v-col-9"},ut={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(x,{emit:P}){const d=x,_=le(),a=f(_.user.profile.role),c=f({}),A=f([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),R=f([]),F=async()=>{await $(_.token).get("/api/fetch/profile-facility/team").then(i=>{R.value=i.data}).catch(i=>{})},W=()=>{c.value.profile_id=_.user.profile.id,$(_.token).post("/api/incident/update-facility-team",c.value).then(i=>{c.value.remarks_data="",P("saved",i.data.message)}).catch(i=>{})},y=f([]),B=async()=>{await $(_.token).get("/api/fetch-global/incident-status/active").then(i=>{y.value=i.data}).catch(i=>{})},g=(i,v=6)=>{let s="00000"+i;return s.substring(s.length-v)};return se(()=>{F(),B(),c.value=d.objectdata,c.value.priority=d.objectdata.priority?parseInt(d.objectdata.priority):null}),X(()=>d.objectdata.remarks,(i,v)=>{c.value.remarks=i},{deep:!0}),(i,v)=>(p(),N("div",null,[e(E,null,{default:t(()=>[e(L,null,{default:t(()=>[e(h,null,{default:t(()=>{var s;return[o("div",Je,[o("div",Xe," SN: ISR-"+V(g(c.value.id)),1),o("div",Ze," REPORTED BY: "+V((s=c.value.profile)==null?void 0:s.display_name),1),o("div",Qe," DATE REPORTED: "+V(r(O)(c.value.created_at)),1)])]}),_:1}),e(h,null,{default:t(()=>[o("div",et,[e(h,null,{default:t(()=>[o("div",tt,[e(te,{items:A.value,modelValue:c.value.priority,"onUpdate:modelValue":v[0]||(v[0]=s=>c.value.priority=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:a.value=="facility"},null,8,["items","modelValue","disabled"]),e(te,{items:R.value,modelValue:c.value.handled_by,"onUpdate:modelValue":v[1]||(v[1]=s=>c.value.handled_by=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:a.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),e(te,{items:y.value,modelValue:c.value.status_id,"onUpdate:modelValue":v[2]||(v[2]=s=>c.value.status_id=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),o("div",at,[e(me,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:c.value.remarks_data,"onUpdate:modelValue":v[3]||(v[3]=s=>c.value.remarks_data=s)},null,8,["modelValue"])])]),_:1})]),e(ae,{class:"mt-3"}),o("div",lt,[e(D,{class:"",size:"small",disabled:!c.value.priority||!c.value.handled_by||!c.value.status_id,onClick:W,color:"primary"},{default:t(()=>[m("Submit")]),_:1},8,["disabled"])])]),_:1}),e(h,null,{default:t(()=>[o("div",st,[m(" Remarks "),e(ae)]),o("div",ot,[(p(!0),N(Z,null,Q(c.value.remarks,s=>(p(),b(h,{key:i.id},{default:t(()=>{var w;return[o("div",dt,[m(V((w=s.profile)==null?void 0:w.display_name)+" ",1),it,m(),o("small",null,V(r(We)(s.created_at)),1)]),o("div",nt,V(s.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const pe=x=>(Ue("data-v-15e35005"),x=x(),Ee(),x),ct={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},rt={class:"font-weight-bold"},vt={class:"reported-by"},mt={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},pt={class:"v-col-12 v-col-md-3"},_t={class:"v-col-12 v-col-md-3"},ft={class:"v-col-12 v-col-md-6 d-flex"},yt={class:"v-col-12"},ht={class:"v-col-12 v-col-md-12"},bt={class:"v-col-12 v-col-md-3"},Vt={class:"v-col-12"},gt={class:"v-col-12"},kt={class:"v-col-12 v-col-md-9"},St={class:"v-col-12 v-col-md-6"},jt={class:"v-col-12 v-col-md-3"},wt={class:"v-col-12 v-col-md-3"},Ct={key:1},xt=pe(()=>o("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),Tt={class:"v-col-12 v-col-md-12"},Dt=pe(()=>o("h5",{class:"headline mb-0 text-center"},[m("NO WARRANTY FOUND. "),o("br"),m("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),$t={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(x,{emit:P}){const d=x,_=le(),a=f({}),c=f({}),A=n=>{c.value={status:!0,type:"success",text:n},P("saved")},R=f(_.user.profile.id),F=f([]),W=async()=>{await $(_.token).get("/api/fetch-global/incident-types/active").then(n=>{F.value=n.data}).catch(n=>{})},y=Ce(),B=xe(),g=f(y.query.type),i=f([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let v=Oe({Type:M().required(),Urgency:M().required(),Title:M().required(),Company:M().required(),Location:M().required()});const s=f(!1),w=()=>{ee.value=!1,s.value=!0},_e=async n=>{a.value.asset_code=n,await $(_.token).get("/api/fetch/asset-info/by/asset-code/"+n).then(l=>{a.value.title=l.data.asset_name,a.value.company_id=l.data.company_id,a.value.location_id=l.data.location_id,a.value.asset_id=l.data.id,s.value=!1}).catch(l=>{})},ee=f(!1),fe=()=>{ee.value=!0},oe=new URL(window.location),Y=n=>{g.value=n,de("type",n)},G=f(!1),q=f(_.user.profile.role),ye=async()=>{G.value=!0,c.value={status:!0,type:"info",text:"Please wait..."},a.value.profile_id=_.user.profile.id,await $(_.token).post("/api/store-update/incident",a.value).then(n=>{c.value={status:!0,type:"success",text:n.data.message},y.params.id?G.value=!1:setTimeout(()=>{B.push({name:"EditIncident",params:{id:n.data.id},query:{type:"details"}}).catch(l=>{}),G.value=!1},800)}).catch(n=>{})},C=f(!1),de=(n,l)=>{oe.searchParams.set(n,l),window.history.pushState({},"",oe)},ie=f([]),he=async()=>{await $(_.token).get("/api/fetch/companies").then(n=>{ie.value=n.data}).catch(n=>{})},ne=f([]),be=async()=>{await $(_.token).get("/api/fetch/locations/non-paginated/data").then(n=>{ne.value=n.data}).catch(n=>{})},Ve=(n,l=5)=>{let I="0000"+n;return I.substring(I.length-l)};return se(()=>{y.params.id&&(C.value=!0),g.value||(g.value="details",de("type","details")),W().then(()=>{he().then(()=>{be()})}),C.value&&(a.value=d.objectdata,a.value.asset_code=d.objectdata.asset?d.objectdata.asset.asset_code:d.objectdata.asset_code,a.value.title=d.objectdata.asset?d.objectdata.asset.asset_name:d.objectdata.title,a.value.company_id=d.objectdata.company_id,a.value.location_id=d.objectdata.location_id,a.value.asset_id=d.objectdata.asset_id,a.value.profile_id=d.objectdata.profile_id,a.value.type_id=parseInt(d.objectdata.type_id),a.value.urgency=parseInt(d.objectdata.urgency),a.value.description=d.objectdata.description)}),X(()=>d.objectdata.remarks,(n,l)=>{a.value=d.objectdata},{deep:!0}),X(()=>d.objectdata.attachment,(n,l)=>{a.value=d.objectdata,a.value.attachment=n},{deep:!0}),(n,l)=>(p(),b(Ie,null,{default:t(()=>[e(Ne,{title:"Incident detail page"}),e(h,{class:"mb-3"},{default:t(()=>[e(j,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:t(()=>{var I,ue;return[e(h,{class:"mb-3"},{default:t(()=>[e(D,{class:K(`${g.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:l[0]||(l[0]=k=>Y("details"))},{default:t(()=>[m("Details")]),_:1},8,["class"]),C.value?(p(),b(D,{key:0,class:K(`${g.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:l[1]||(l[1]=k=>Y("attachment"))},{default:t(()=>[m("Attachments")]),_:1},8,["class"])):U("",!0),C.value&&(r(_).user.profile.role=="facility"||r(_).user.profile.role=="admin"||r(_).user.profile.role=="superadmin"||r(_).user.profile.role=="technical-operation")?(p(),b(D,{key:1,class:K(`${g.value=="warranty"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:l[2]||(l[2]=k=>Y("warranty"))},{default:t(()=>[m("Warranty")]),_:1},8,["class"])):U("",!0),C.value&&(r(_).user.profile.role=="facility"||r(_).user.profile.role=="admin"||r(_).user.profile.role=="superadmin"||r(_).user.profile.role=="technical-operation")?(p(),b(D,{key:2,class:K(`${g.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:l[3]||(l[3]=k=>Y("facility"))},{default:t(()=>[m("Facility Team")]),_:1},8,["class"])):U("",!0)]),_:1}),g.value=="details"?(p(),b(E,{key:0},{default:t(()=>[e(r(Fe),{as:"v-form","validation-schema":r(v)},{default:t(({meta:k})=>[e(Te,{class:"my-3 ml-3 text-uppercase text-h6"},{default:t(()=>[m(V(d.headertitle),1)]),_:1}),e(L,null,{default:t(()=>[C.value?(p(),b(h,{key:0},{default:t(()=>{var u,S;return[o("div",ct,[o("div",rt," SN: ISR-2"+V(Ve(a.value.id)),1),o("div",vt," REPORTED BY: "+V((u=a.value.profile)==null?void 0:u.display_name),1)]),o("div",mt," STATUS: "+V((S=a.value.status)==null?void 0:S.title),1)]}),_:1})):U("",!0),e(h,null,{default:t(()=>[o("div",pt,[e(r(H),{name:"Type",modelValue:a.value.type_id,"onUpdate:modelValue":l[5]||(l[5]=u=>a.value.type_id=u)},{default:t(({field:u,errors:S})=>[e(J,z({items:F.value,modelValue:a.value.type_id,"onUpdate:modelValue":l[4]||(l[4]=T=>a.value.type_id=T),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},u,{"error-messages":S}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",_t,[e(r(H),{name:"Urgency",modelValue:a.value.urgency,"onUpdate:modelValue":l[7]||(l[7]=u=>a.value.urgency=u)},{default:t(({field:u,errors:S})=>[e(J,z({items:i.value,modelValue:a.value.urgency,"onUpdate:modelValue":l[6]||(l[6]=T=>a.value.urgency=T),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},u,{"error-messages":S}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",ft,[e(re,{modelValue:a.value.asset_code,"onUpdate:modelValue":l[8]||(l[8]=u=>a.value.asset_code=u),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),e(De,{onClick:w,class:"ml-2 my-auto",size:"large",icon:r($e)},null,8,["icon"])]),o("div",yt,[e(r(H),{name:"Title",modelValue:a.value.title,"onUpdate:modelValue":l[10]||(l[10]=u=>a.value.title=u)},{default:t(({field:u,errors:S})=>[e(re,z({modelValue:a.value.title,"onUpdate:modelValue":l[9]||(l[9]=T=>a.value.title=T),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},u,{"error-messages":S}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",ht,[e(h,null,{default:t(()=>[o("div",bt,[e(h,null,{default:t(()=>[o("div",Vt,[e(r(H),{name:"Company",modelValue:a.value.company_id,"onUpdate:modelValue":l[12]||(l[12]=u=>a.value.company_id=u)},{default:t(({field:u,errors:S})=>[e(J,z({items:ie.value,modelValue:a.value.company_id,"onUpdate:modelValue":l[11]||(l[11]=T=>a.value.company_id=T),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},u,{"error-messages":S}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",gt,[e(r(H),{name:"Location",modelValue:a.value.location_id,"onUpdate:modelValue":l[14]||(l[14]=u=>a.value.location_id=u)},{default:t(({field:u,errors:S})=>[e(J,z({items:ne.value,modelValue:a.value.location_id,"onUpdate:modelValue":l[13]||(l[13]=T=>a.value.location_id=T),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},u,{"error-messages":S}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),o("div",kt,[e(me,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:a.value.description,"onUpdate:modelValue":l[15]||(l[15]=u=>a.value.description=u)},null,8,["modelValue"])])]),_:1})])]),_:1}),e(ae,{class:"my-3"}),e(h,null,{default:t(()=>{var u;return[o("div",St,[((u=a.value)==null?void 0:u.status_id)!=8&&(!C.value||C.value&&(d.objectdata.profile_id==R.value||q.value=="asset-supervisor"))?(p(),b(D,{key:0,size:"small",color:"primary",onClick:ye,disabled:!k.valid,loading:G.value},{default:t(()=>[m("Submit")]),_:2},1032,["disabled","loading"])):U("",!0)]),o("div",jt," DATE REPORTED: "+V(a.value.created_at?r(O)(a.value.created_at):""),1),o("div",wt," DATE CLOSED: "+V(n.date_closed?r(O)(a.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):U("",!0),g.value=="warranty"?(p(),N("div",Ct,[e(E,null,{default:t(()=>[e(L,null,{default:t(()=>[xt]),_:1})]),_:1}),((ue=(I=a.value.asset)==null?void 0:I.warranty_latest)==null?void 0:ue.length)>0?(p(),b(h,{key:0},{default:t(()=>[o("div",Tt,[(p(!0),N(Z,null,Q(a.value.asset.warranty_latest,k=>(p(),b(E,{class:"my-3 px-5",key:k.id},{default:t(()=>[e(L,null,{default:t(()=>[e(h,null,{default:t(()=>[e(j,{cols:"4"},{default:t(()=>[m("Vendor")]),_:1}),e(j,{cols:"8"},{default:t(()=>[m(V(k.vendor.title),1)]),_:2},1024),e(j,{cols:"4"},{default:t(()=>[m("Warranty Start Date")]),_:1}),e(j,{cols:"8"},{default:t(()=>[m(V(r(O)(k.warranty_start_date)),1)]),_:2},1024),e(j,{cols:"4"},{default:t(()=>[m("Warranty End Date")]),_:1}),e(j,{cols:"8"},{default:t(()=>[m(V(r(O)(k.warranty_end_date)),1)]),_:2},1024),e(j,{cols:"4"},{default:t(()=>[m("AMC Start Date")]),_:1}),e(j,{cols:"8"},{default:t(()=>[m(V(r(O)(k.amc_start_date)),1)]),_:2},1024),e(j,{cols:"4"},{default:t(()=>[m("AMC End Date")]),_:1}),e(j,{cols:"8"},{default:t(()=>[m(V(r(O)(k.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(p(),b(E,{key:1,class:"mt-2"},{default:t(()=>[e(L,null,{default:t(()=>[Dt]),_:1})]),_:1}))])):C.value&&g.value=="attachment"?(p(),b(Ke,{key:2,"incident-id":r(y).params.id,attachment:a.value.attachment,onSave:A,objectdata:a.value},null,8,["incident-id","attachment","objectdata"])):(q.value=="superadmin"||q.value=="admin"||q.value=="technical-operation"||q.value=="facility")&&C.value&&g.value=="facility"?(p(),b(ut,{key:3,objectdata:a.value,onSaved:A},null,8,["objectdata"])):U("",!0)]}),_:1})]),_:1}),e(Le,{options:c.value},null,8,["options"]),e(ve,{width:"500",modelValue:s.value,"onUpdate:modelValue":l[17]||(l[17]=I=>s.value=I)},{default:t(()=>[e(E,null,{default:t(()=>[e(L,null,{default:t(()=>[e(r(Be),{onDecode:_e,onLoaded:fe})]),_:1}),ee.value?U("",!0):(p(),b(L,{key:0},{default:t(()=>[m("Please wait...")]),_:1})),e(Ae,null,{default:t(()=>[e(Re),e(D,{text:"Close",onClick:l[16]||(l[16]=I=>s.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ft=Pe($t,[["__scopeId","data-v-15e35005"]]);export{Ft as D};
