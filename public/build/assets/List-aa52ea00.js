import{r as s,a as ae,u as le,G as se,H as oe,I as ne,c as k,w as p,m as ie,n as D,o as g,d as o,b as l,k as re,V as ue,i as de,h as ce,s as M,J as w,x as pe,e as C,p as O,q as me,af as ve,C as v,t as u,K as fe,B as T,L as ge,M as ye,y as N,F as he,N as _e,O as Ce}from"./app-b45a00ab.js";import{_ as xe}from"./ApppageHeader-097a5b4a.js";import{d as x,e as V}from"./encrypt-23acf495.js";import{_ as Ve}from"./AppSnackBar-07552e7d.js";import{u as K}from"./formatDate-b9aad8c5.js";const be={class:"v-col-12"},Se=l("div",{class:"mr-auto"},"Asset Requests",-1),ke={class:"v-col-12 v-col-md"},we={class:"v-col-12 v-col-md"},qe={class:"v-col-12 v-col-md"},$e={class:"v-col-12 v-col-md"},Ie=l("th",{class:"text-left text-capitalize"},"SN No.",-1),ze=l("br",null,null,-1),De=l("small",null,"PENDING",-1),Ne=l("br",null,null,-1),Re=l("small",null,"(DD/MM/YY)",-1),Le=l("br",null,null,-1),Ae=l("small",null,"(DD/MM/YY)",-1),je=l("th",{class:"text-right text-capitalize last-child-action"},null,-1),Be={class:"last-child-action"},Pe={class:"d-flex align-center justify-end"},Ee={__name:"List",setup(Ue){const E=s({status:!1,type:"primary",text:null}),d=ae(),R=le(),q=se(),r=s({loading:!1,data:[]}),$=s(0),Y=s(0),f=s(""),J=s([10,20,50,100]),y=s(10),n=s({}),G=()=>{localStorage.setItem("request-filter-row",V(y.value)),m()},I=a=>{z.value="",i.value==1?(a=="company"?localStorage.setItem("request-filter-company",V(n.value.company_id)):a=="location"?localStorage.setItem("request-filter-location",V(n.value.location_id)):a=="status"&&localStorage.setItem("request-filter-status",V(n.value.status)),m()):i.value=1},L=()=>{localStorage.setItem("request-asset-search",V(f.value)),m()},b=a=>{a=="search"?(f.value="",localStorage.setItem("request-asset-search",""),m()):a=="company"?localStorage.setItem("request-filter-company",""):a=="location"?localStorage.setItem("request-filter-location",""):a=="status"&&localStorage.setItem("request-filter-status","")},i=s(q.params&&q.params.page?q.params.page:1),S=s([]),z=s(""),A=s(0),c=a=>{r.value.loading=!0,S.value[0]=a,A.value%2?S.value[1]="DESC":S.value[1]="ASC",A.value++,z.value=JSON.stringify(S.value),m()},j=s([]),H=async()=>{await D(d.token).get("/api/fetch/companies").then(a=>{j.value=a.data}).catch(a=>{})},B=s([]),Q=async()=>{await D(d.token).get("/api/fetch/locations/non-paginated/data").then(a=>{B.value=a.data}).catch(a=>{})},W=s([{id:"pending",title:"Pending"},{id:"awaiting-approval",title:"Awaiting Approval"},{id:"reject",title:"Rejected"},{id:"cancelled",title:"Cancelled"},{id:"complete",title:"Completed"}]),X=a=>a=="reject"?"Rejected":a=="complete"?"Completed":a,m=async()=>{r.value.loading=!0,await D(d.token).get("/api/fetch/request-assets/by-requestor/request?userid="+d.user.profile.id+"&role="+d.user.profile.role+"&page="+i.value+"&show="+y.value+"&search="+f.value+"&sort="+z.value+"&filter="+JSON.stringify(n.value)).then(a=>{$.value=a.data.last_page?a.data.last_page:a.data.length,i.value=a.data.current_page?a.data.current_page:i.value,Y.value=a.data.total?a.data.total:a.data.length,r.value.data=a.data.data?a.data.data:a.data,r.value.loading=!1}).catch(a=>{r.value.loading=!1})};oe(i,(a,t)=>{i.value&&a!=t&&(R.push({name:"PaginatedRequestAsset",params:{page:i.value}}).catch(e=>{}),m(i.value))});const Z=a=>{R.push({name:"EditRequestAsset",params:{id:a}}).catch(t=>{console.log(t)})},ee=a=>{console.log("delete",a)},te=(a,t=6)=>{let e="00000"+a;return e.substring(e.length-t)};return ne(()=>{let a=localStorage.getItem("request-asset-search"),t=localStorage.getItem("request-filter-company"),e=localStorage.getItem("request-filter-location"),h=localStorage.getItem("request-filter-status"),_=localStorage.getItem("request-filter-row");a&&(f.value=x(a)),t&&(n.value.company_id=x(t)),e&&(n.value.location_id=x(e)),h&&(n.value.status=x(h)),_&&(y.value=x(_)),m().then(()=>{H().then(()=>{Q()})})}),(a,t)=>(g(),k(ie,null,{default:p(()=>[o(xe,{title:"Asset request page"}),o(M,{class:"mb-3"},{default:p(()=>[l("div",be,[o(re,{loading:r.value.loading},{default:p(()=>[o(ue,{class:"d-flex align-center mb-3 pa-3"},{default:p(()=>[Se,o(de,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=e=>f.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. SN-5000035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":L,onKeydown:ce(L,["enter"]),"onClick:clear":t[1]||(t[1]=e=>b("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(M,{class:"px-3"},{default:p(()=>[l("div",ke,[o(w,{items:j.value,modelValue:n.value.company_id,"onUpdate:modelValue":[t[2]||(t[2]=e=>n.value.company_id=e),t[3]||(t[3]=e=>I("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company","onClick:clear":t[4]||(t[4]=e=>b("company"))},null,8,["items","modelValue"])]),l("div",we,[o(w,{items:B.value,modelValue:n.value.location_id,"onUpdate:modelValue":[t[5]||(t[5]=e=>n.value.location_id=e),t[6]||(t[6]=e=>I("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title","onClick:clear":t[7]||(t[7]=e=>b("location"))},null,8,["items","modelValue"])]),l("div",qe,[o(w,{items:W.value,modelValue:n.value.status,"onUpdate:modelValue":[t[8]||(t[8]=e=>n.value.status=e),t[9]||(t[9]=e=>I("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status","onClick:clear":t[10]||(t[10]=e=>b("status"))},null,8,["items","modelValue"])]),l("div",$e,[o(w,{items:J.value,modelValue:y.value,"onUpdate:modelValue":[t[11]||(t[11]=e=>y.value=e),G],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),o(pe,null,{default:p(()=>[l("thead",null,[l("tr",null,[Ie,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[12]||(t[12]=e=>c("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[13]||(t[13]=e=>c("transferred_to"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[14]||(t[14]=e=>c("subject"))}," Subject "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[15]||(t[15]=e=>c("profile_id"))}," Requestor "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[16]||(t[16]=e=>c("reminder_profile_id"))},[C(" Approval"),ze,De]),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[17]||(t[17]=e=>c("status"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[18]||(t[18]=e=>c("created_at"))},[C(" D.Requested"),Ne,Re]),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[19]||(t[19]=e=>c("date_closed"))},[C(" D.Closed"),Le,Ae]),je])]),l("tbody",null,[(g(!0),O(he,null,me(r.value.data,e=>{var h,_,P,U,F;return g(),O("tr",{key:e.id,class:ve(`${v(d).user.profile.id==e.reminder_profile_id?"bg-blue-lighten-5":""} `)},[l("td",null,"SN-5"+u(te(e.id)),1),l("td",null,u((h=e.company)==null?void 0:h.title),1),l("td",null,u((_=e.transfer_to)==null?void 0:_.title),1),l("td",null,u(e.subject),1),l("td",null,u((P=e.profile)==null?void 0:P.display_name),1),l("td",null,u((U=e.reminder_profile)==null?void 0:U.display_name),1),l("td",null,[o(fe,{class:"text-uppercase",size:"small",color:`${e.status.toLowerCase()=="complete"?"success":e.status.toLowerCase()=="pending"||e.status.toLowerCase()=="awaiting-approval"?"warning":"error"}`},{default:p(()=>[C(u(X(e.status)),1)]),_:2},1032,["color"])]),l("td",null,u(v(K)(e.created_at)),1),l("td",null,u(e.date_closed&&e.date_closed!="0000-00-00"?v(K)(e.date_closed):""),1),l("td",Be,[l("div",Pe,[o(T,{size:"small",onClick:()=>Z(e.id),icon:v(ge),class:"mx-1"},null,8,["onClick","icon"]),v(d).user.role=="superadmin"||(F=v(d).capabilities)!=null&&F.includes("delete")?(g(),k(T,{key:0,size:"small",onClick:()=>ee(e.id),icon:v(ye),class:"mx-1"},null,8,["onClick","icon"])):N("",!0)])])],2)}),128))])]),_:1}),r.value.data.length==0?(g(),k(_e,{key:0,class:"pa-3 text-center w-100"},{default:p(()=>[C("No records found")]),_:1})):N("",!0)]),_:1},8,["loading"]),$.value>1?(g(),k(Ce,{key:0,modelValue:i.value,"onUpdate:modelValue":t[20]||(t[20]=e=>i.value=e),class:"my-4",length:$.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:r.value.loading},null,8,["modelValue","length","disabled"])):N("",!0)])]),_:1}),o(Ve,{options:E.value},null,8,["options"])]),_:1}))}};export{Ee as default};
