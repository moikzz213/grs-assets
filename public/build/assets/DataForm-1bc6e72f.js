import{a as ye,r as u,I as ge,u as Ve,K as be,T as ke,J as Y,o as n,c as _,w as s,d as a,v as Ae,k as j,V as we,b as o,t as y,p as V,y as f,at as J,E as p,H as z,f as F,s as h,j as x,e as S,L as E,i as k,q as W,X as xe,W as Ue,P as Se,D as X,O as Ce,F as I,aE as qe,aF as Te,aG as je,aH as Ee,aI as Oe,m as Re,n as C}from"./app-0f586498.js";import{_ as De}from"./ApppageHeader-288a25fa.js";import{_ as Le}from"./Studio-ff3b0c15.js";import{_ as Ne}from"./AppSnackBar-d4de43c4.js";import{u as Z}from"./formatDate-b9aad8c5.js";import{r as ee}from"./generateRandomString-02c0ba3b.js";const Be={key:0,class:"text-error text-h6"},ze={class:"v-col-8 text-right"},Fe={key:0},Ie={key:1,class:"v-col-8 text-right"},Pe={class:"v-col-12 v-col-md-6"},$e={class:"v-col-12 v-col-md-6"},Ke={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12 v-col-md-6"},Ge={class:"v-col-12"},He={class:"v-col-12"},Qe={class:"v-col-12 v-col-md-1 px-1"},Ye={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},Je={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},We={class:"v-col-12 pt-0 pb-0"},Xe={class:"v-col-12 v-col-md-3"},Ze={class:"v-col-12 v-col-md-2"},et={class:"v-col-12 v-col-md-1"},tt={class:"v-col-12 v-col-md-1"},at={class:"v-col-12 v-col-md-1"},lt={class:"v-col-12 v-col-md-3 d-flex"},st={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},ot=o("div",null,"APPROVAL SETUP",-1),dt={key:0},it=o("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),nt={class:"v-col-12 v-col-md-6"},ut=o("div",{class:"v-col-12 v-col-md-1"},"Status",-1),rt=o("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),ct={class:"v-col-12 v-col-md-2"},pt={class:"v-col-12 v-col-md-7 d-flex"},vt={class:"my-auto"},mt={class:"v-col-12"},_t={class:"v-col-12 text-error"},ft=o("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),At={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(te,{emit:ae}){const b=te,v=ye(),P=u("Note: Administrator needs to setup signatories first."),D=u(!1),A=ge(),le=Ve(),d=u({}),w=u(!1),g=u([{qty:1,attachment:{}}]),se=u(new Date),$=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},oe=u(window.location.origin),de=(t,l)=>{g.value[t].attachment=l[0]},L=u(!1),K=u(1),ie=t=>{K.value=t,L.value=!0},ne=t=>{g.value[t].attachment=""},M=u([]),ue=async()=>{let t="request";b.headertitle=="Transfer Assets"&&(t="transfer"),await C(v.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(l=>{M.value=l.data}).catch(l=>{})},O=u({}),G=u([]),re=async()=>{await C(v.token).get("/api/fetch/companies").then(t=>{G.value=t.data}).catch(t=>{})},N=u([]),ce=async()=>{await C(v.token).get("/api/fetch/locations/non-paginated/data").then(t=>{N.value=t.data}).catch(t=>{})},pe=()=>{g.value.push({qty:1,attachment:{}}),q()},ve=(t,l)=>{g.value.splice(l,1),q()},me=()=>{O.value={status:!0,type:"info",text:"Please wait..."};let t=g.value.map((e,i)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:d.value,assets:t,approval:U.value,profile_id:v.user.profile.id,role:v.user.profile.role,type:"transfer"};C(v.token).post("/api/request-asset/store-update/data",l).then(e=>{let i="",m="";e.data.message?(i=e.data.message,m="success"):e.data.error&&(i=e.data.error,m="error"),O.value={status:!0,type:m,text:i},A.params.id||setTimeout(()=>{le.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(B=>{})},800)}).catch(e=>{console.log(e)})},U=u([]),R=u(!0),H=async()=>{await C(v.token).get("/api/fetch/request-asset/approval-setup-fetch/"+d.value.request_type_id).then(t=>{var l,e;U.value=(l=t.data)==null?void 0:l.stages,A.params.id&&U.value.length>0&&U.value.map((i,m)=>(i.profile_id=T.value[m].profile_id,i.status=T.value[m].status,i.date_approved=T.value[m].date_approved,i.reason_rejected=T.value[m].reason_rejected,i)),((e=t.data)==null?void 0:e.stages.length)>0?R.value=!0:R.value=!1}).catch(t=>{})},q=()=>{let t=!1;D.value=!1,d.value.company_id&&d.value.request_type_id&&d.value.subject&&d.value.transferred_from&&d.value.transferred_to&&(t=!0);let l=!0;g.value.map(i=>{i.item_description&&i.reason_for_request||(l=!1)});let e=!0;U.value.map(i=>{i.profile_id||(e=!1)}),e&&l&&t&&(D.value=!0)},Q=t=>{let l={status:t,profile_id:v.user.profile.id,ID:r.value.id};C(v.token).post("/api/request-asset/change-request/data",l).then(e=>{O.value={status:!0,type:"success",text:e.data.message},r.value.status=t,ae("saved",e.data.message)}).catch(e=>{})},_e=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},T=u([]),r=u({});be(()=>{if(ue().then(()=>{re().then(()=>{ce()})}),A.params.id){w.value=!0;let t=b.objectdata;r.value=t,d.value.company_id=t.company_id,d.value.request_type_id=t.request_type_id,d.value.subject=t.subject,d.value.transferred_from=t.transferred_from,d.value.transferred_to=t.transferred_to,d.value.id=t.id,d.value.requestor_id=t.profile_id,T.value=t.request_approvals,g.value=t.items,H()}else d.value.company_id=v.user.profile.company_id});const fe=u("https://assets.grandiose.ae/"),he=ke(()=>{let t=null,l=fe.value+"pv/employee-signatory",e=ee(50),i=ee(50);return r.value&&(t=l+"/transfer/approvals?o=99&key="+e+"&pid=95&pv="+i+"&id="+r.value.id),t});return Y(d.value,async(t,l)=>{q()}),Y(g.value,async(t,l)=>{q()}),(t,l)=>(n(),_(Re,null,{default:s(()=>[a(De,{title:b.headertitle,class:"no-print"},null,8,["title"]),a(h,{class:"mb-3"},{default:s(()=>[a(Ae,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[a(j,null,{default:s(()=>[a(we,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:s(()=>[o("div",null,y(b.headertitle),1),R.value?f("",!0):(n(),V("div",Be,y(P.value),1)),w.value?(n(),V("div",{key:1,class:J(r.value.status=="cancelled"?"text-error":r.value.status=="complete"?"text-success":"")}," STATUS ("+y(r.value.status)+") ",3)):f("",!0),o("div",null,"DATE: "+y(p(Z)(se.value)),1)]),_:1}),a(z),a(F,null,{default:s(()=>[a(h,null,{default:s(()=>[w.value?(n(),V("div",{key:0,class:J(`${r.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+y(_e(r.value.id)),3)):f("",!0),o("div",ze,[w.value&&(r.value.status=="pending"||r.value.status=="cancelled")?(n(),V("div",Fe,[r.value.status=="pending"?(n(),_(x,{key:0,onClick:l[0]||(l[0]=e=>Q("cancelled")),size:"small",color:"warning"},{default:s(()=>[S("Cancel request")]),_:1})):f("",!0),r.value.status=="cancelled"?(n(),_(x,{key:1,onClick:l[1]||(l[1]=e=>Q("pending")),size:"small",color:"info"},{default:s(()=>[S("Change status to Pending")]),_:1})):f("",!0)])):f("",!0)]),r.value.status=="complete"?(n(),V("div",Ie)):f("",!0),o("div",Pe,[a(E,{items:M.value,modelValue:d.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>d.value.request_type_id=e),H],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:w.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),o("div",$e,[a(E,{items:G.value,modelValue:d.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>d.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),o("div",Ke,[a(E,{items:N.value,modelValue:d.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>d.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),o("div",Me,[a(E,{items:N.value,modelValue:d.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),o("div",Ge,[a(k,{modelValue:d.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>d.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(j,{class:"my-2"},{default:s(()=>[a(F,null,{default:s(()=>[a(h,null,{default:s(()=>{var e;return[o("div",He,[!p(A).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="administrator"?(n(),_(x,{key:0,size:"small",color:"primary",onClick:pe},{default:s(()=>[S("Add")]),_:1})):f("",!0)])]}),_:1}),(n(!0),V(I,null,W(g.value,(e,i)=>(n(),_(h,{key:i},{default:s(()=>{var m,B;return[o("div",Qe,[(m=e.attachment)!=null&&m.id?(n(),_(h,{key:0,class:"px-1"},{default:s(()=>[o("div",Ye,[a(k,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":c=>e.attachment.id=c},null,8,["modelValue","onUpdate:modelValue"]),a(x,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:t.mdiClose,size:"16px",color:"error",onClick:()=>ne(i,e.attachment.id)},null,8,["icon","onClick"]),a(j,{onClick:()=>ie(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(xe,{modelValue:L.value,"onUpdate:modelValue":l[7]||(l[7]=c=>L.value=c),width:"95%","max-width":"900"},{default:s(()=>[a(j,{class:"bg-black"},{default:s(()=>[o("div",Je,[a(Ue,{src:oe.value+"/file/"+K.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(n(),_(h,{key:1,class:"mt-0"},{default:s(()=>[o("div",We,[a(Se,{color:"grey-lighten-4",class:"text-center"},{default:s(()=>[a(Le,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:c=>de(i,c)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),o("div",Xe,[a(k,{modelValue:e.item_description,"onUpdate:modelValue":c=>e.item_description=c,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Ze,[a(k,{modelValue:e.asset_code,"onUpdate:modelValue":c=>e.asset_code=c,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",et,[a(k,{type:"number",modelValue:e.qty,"onUpdate:modelValue":c=>e.qty=c,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",tt,[a(k,{type:"number",modelValue:e.weight,"onUpdate:modelValue":c=>e.weight=c,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",at,[a(k,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":c=>e.item_value=c,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",lt,[a(k,{modelValue:e.reason_for_request,"onUpdate:modelValue":c=>e.reason_for_request=c,variant:"outlined",density:"compact","hide-details":"",label:"REASON FOR REQUEST*"},null,8,["modelValue","onUpdate:modelValue"]),!w.value||w.value&&p(v).user.profile.id==b.objectdata.profile_id&&((B=b.objectdata)==null?void 0:B.status)=="pending"?(n(),_(X,{key:0,size:"small",onClick:()=>ve(e.id,i),icon:p(Ce),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):f("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(j,{class:"my-2"},{default:s(()=>[a(F,null,{default:s(()=>[a(h,null,{default:s(()=>[o("div",st,[ot,p(A).params.id?(n(),V("div",dt,[a(x,{color:"info",size:"small",target:"_blank",href:he.value},{default:s(()=>[S("View Approval Page")]),_:1},8,["href"])])):f("",!0)]),a(z)]),_:1}),a(h,null,{default:s(()=>{var e,i;return[it,o("div",nt,y((i=(e=r.value)==null?void 0:e.profile)==null?void 0:i.display_name),1),ut,rt]}),_:1}),R.value?(n(),V(I,{key:0},[(n(!0),V(I,null,W(U.value,(e,i)=>(n(),_(h,{key:e.id},{default:s(()=>[o("div",ct,y(e.types?$(e.types):$(e.approval_type)),1),o("div",pt,[a(E,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[m=>e.profile_id=m,q],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(x,{variant:"text",size:"x-small"},{default:s(()=>[e.status?(n(),_(X,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?p(qe):e.status=="pending"?p(Te):e.status=="reject"?p(je):p(Ee),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):f("",!0),a(Oe,{activator:"parent",location:"top","max-width":"400"},{default:s(()=>[S(y(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),o("div",vt,y(e.date_approved?p(Z)(e.date_approved):""),1)]),_:2},1024))),128)),a(h,null,{default:s(()=>{var e;return[a(z),o("div",mt,[(!p(A).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||p(v).user.profile.role=="asset-supervisor"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="administrator")&&r.value.status!="complete"?(n(),_(x,{key:0,size:"small",disabled:!D.value,onClick:me,color:"primary"},{default:s(()=>[S(y(p(A).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):f("",!0)])]}),_:1})],64)):(n(),_(h,{key:1},{default:s(()=>[o("div",_t,y(P.value),1)]),_:1})),a(h,null,{default:s(()=>[ft]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Ne,{options:O.value},null,8,["options"])]),_:1}))}};export{At as _};
