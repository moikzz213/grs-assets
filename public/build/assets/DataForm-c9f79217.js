import{i as G,r as u,u as L,N as K,o as M,b as k,j as A,k as l,l as a,G as Y,e as o,z as f,ar as R,m as V,A as H,K as _,V as J,t as Q,q as W,E as g,y as U,a2 as X,ac as Z,M as ee,c as te,d as ae,P as $,as as se,S as le,F as oe,I as ie,C as de,D as w,p as re,g as ne}from"./app-ac6f585e.js";import{_ as ue}from"./ApppageHeader-4a0ba48d.js";import{_ as ce}from"./AppSnackBar-a3d2cc8d.js";import{c as pe,a as ve,F as me,b as fe}from"./index.esm-8c2d7218.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const y=h=>(re("data-v-980a2b05"),h=h(),ne(),h),ge={class:"mb-3"},ye={class:"v-col-12 d-flex my-auto"},he={class:"v-col-12 px-6 pt-0 my-auto"},be={class:"v-col-12 px-6 pt-3"},Ve=y(()=>o("div",{class:"v-col-1 font-weight-bold"},null,-1)),Se=y(()=>o("div",{class:"v-col-3 font-weight-bold"}," TYPES ",-1)),xe=y(()=>o("div",{class:"v-col-5 font-weight-bold"}," SIGNATORIES ",-1)),Ce=y(()=>o("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),ke=y(()=>o("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Requestor ",-1)),we=y(()=>o("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Auto ",-1)),Ae={class:"v-col-12 v-col-md-1"},Te={class:"v-col-12 v-col-md-3"},De={class:"v-col-12 v-col-md-6 d-flex my-auto"},Fe={class:"v-col-12 v-col-md-2 d-flex my-auto"},je={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(h,{emit:Ie}){const v=h,c=G(),m=u([]),b=u({}),n=u({title:v.objectdata.title}),q=u([{id:"approve",value:"Approver"},{id:"receiver",value:"Receiver"},{id:"reviewer",value:"Reviewer"},{id:"verify",value:"Verify"}]),T=u([]),D=L(),p=K(),S=u(p.params.type);let N=pe({Title:ve().required()});const F=s=>{S.value=s,D.push({path:"/approval-setup/"+s})},x=u(0),z=()=>{let s={id:p.params.id,sort:x.value,profile_id:c.user.profile.id,class:"new"};w(c.token).post("/api/approval-setups/store-signatory/update-data",s).then(e=>{m.value.push({id:e.data.id,sort:x.value,types:null,signatories:[]}),x.value+=1,b.value={status:!0,type:"success",text:"New Signatory has been added"}}).catch(e=>{n.value.loading=!1})},E=async()=>{await w(c.token).get("/api/user/fetch/signatories").then(s=>{T.value=s.data}).catch(s=>{n.value.loading=!1,console.log(s)})},C=u(!1),B=u(!!p.params.id),O=(s,e)=>{let i={id:p.params.id,profile_id:c.user.profile.id,stageID:s,class:"deleted"};m.value.splice(e,1),w(c.token).post("/api/approval-setups/store-signatory/update-data",i).then(t=>{b.value={status:!0,type:"success",text:"Signatory has been deleted."}}).catch(t=>{n.value.loading=!1})},j=s=>{C.value=!0,b.value={status:!0,type:"info",text:"Please wait..."};let e="transfer";S.value=="request-asset"&&(e="request");let i=null;p.params.id&&(i=p.params.id);let t={id:i,type:e,signatories:s,profile_id:c.user.profile.id,class:"update"},d="/api/approval-setups/store-signatory/update-data";s=="title"&&(d="/api/approval-setups/store-update/data",t={id:i,type:e,title:n.value.title,signatories:m.value,profile_id:c.user.profile.id}),w(c.token).post(d,t).then(r=>{b.value={status:!0,type:"success",text:"Data has been saved."},C.value=!1,m.value.sort((I,P)=>I.sort-P.sort),p.params.id||setTimeout(()=>{D.push({name:"EditApproval",params:{id:r.data.id}}).catch(I=>{})},800)}).catch(r=>{n.value.loading=!1})};return M(()=>{if(E(),p.params.id&&v.objectdata.stages.length>0){let s=v.objectdata.stages[v.objectdata.stages.length-1].sort;v.objectdata.stages.map((e,i)=>{let t=[];e.signatures.map(d=>{d.profile_id!=0&&t.push(d.profile_id)}),m.value.push({id:e.id,sort:e.sort,types:e.types,signatories:t})}),x.value=s+1}}),(s,e)=>(k(),A(de,null,{default:l(()=>[a(ue,{title:"Global Approval Setup"}),a(g,{class:"mb-3"},{default:l(()=>[a(Y,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[o("div",ge,[a(f,{class:R(`${S.value=="request-asset"?"tab-active":""}  v-col-12 v-col-md-3 mx-2`),onClick:e[0]||(e[0]=i=>F("request-asset"))},{default:l(()=>[V("Request Asset Approvals")]),_:1},8,["class"]),a(f,{class:R(`${S.value=="transfer-asset"?"tab-active":""}   v-col-12 v-col-md-3 mx-2`),onClick:e[1]||(e[1]=i=>F("transfer-asset"))},{default:l(()=>[V("Transfer Asset Approvals")]),_:1},8,["class"])]),a(H,null,{default:l(()=>[a(_(me),{as:"v-form","validation-schema":_(N)},{default:l(({meta:i})=>[a(J,{class:"my-3 ml-3 text-uppercase"},{default:l(()=>[V(Q(v.headertitle),1)]),_:1}),a(W,null,{default:l(()=>[a(g,null,{default:l(()=>[o("div",ye,[a(_(fe),{name:"Title",modelValue:n.value.title,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.title=t)},{default:l(({field:t,errors:d})=>[a(U,X({modelValue:n.value.title,"onUpdate:modelValue":e[2]||(e[2]=r=>n.value.title=r)},t,{"error-messages":d,label:"Title here*",variant:"outlined","hide-details":"auto",density:"compact",class:"v-col-10 pt-0"}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"]),a(f,{size:"small",class:"mt-1",color:"primary",disabled:!i.valid,loading:C.value,onClick:e[4]||(e[4]=t=>j("title"))},{default:l(()=>[V("Save")]),_:2},1032,["disabled","loading"])])]),_:2},1024),B.value?(k(),A(g,{key:0},{default:l(()=>[o("div",he,[a(f,{onClick:z,color:"primary",size:"x-small",icon:_(Z)},null,8,["icon"]),V(" Add Signatories ")]),o("div",be,[a(g,null,{default:l(()=>[Ve,Se,xe]),_:1}),a(ee),a(g,{class:"mt-0"},{default:l(()=>[Ce,ke,we]),_:1}),(k(!0),te(oe,null,ae(m.value,(t,d)=>(k(),A(g,{class:"mt-0",key:d},{default:l(()=>[o("div",Ae,[a(U,{modelValue:t.sort,"onUpdate:modelValue":r=>t.sort=r,label:"Sort*",variant:"outlined","hide-details":"auto",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Te,[a($,{label:"Select Type",modelValue:t.types,"onUpdate:modelValue":r=>t.types=r,"hide-details":"auto",variant:"outlined","item-value":"id","item-title":"value",density:"compact",items:q.value},null,8,["modelValue","onUpdate:modelValue","items"])]),o("div",De,[a($,{label:"Select Signatory",modelValue:t.signatories,"onUpdate:modelValue":r=>t.signatories=r,"hide-details":"auto",variant:"outlined",density:"compact",multiple:"","item-value":"id","item-title":"display_name",items:T.value},null,8,["modelValue","onUpdate:modelValue","items"])]),o("div",Fe,[a(f,{disabled:!t.types||t.signatories.length==0,size:"x-small",onClick:()=>j(t),icon:_(se),loading:C.value,color:"success",class:"mx-1 ml-3 my-auto",title:"Save Signatory"},null,8,["disabled","onClick","icon","loading"]),a(f,{size:"x-small",onClick:()=>O(t.id,d),icon:_(le),color:"error",class:"mx-1 ml-3 my-auto",title:"Delete Signatory"},null,8,["onClick","icon"])])]),_:2},1024))),128))])]),_:1})):ie("",!0)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})]),_:1})]),_:1}),a(ce,{options:b.value},null,8,["options"])]),_:1}))}},ze=_e(je,[["__scopeId","data-v-980a2b05"]]);export{ze as D};
