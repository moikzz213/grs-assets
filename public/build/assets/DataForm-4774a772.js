import{G as K,a as Q,r as _,O as _e,I as X,H,o as c,p as T,b as l,c as y,w as t,d as a,s as k,z as S,F as z,q as G,j as x,y as p,P as fe,k as O,Q as le,R as ye,S as he,T as be,M as ge,e as v,n as E,f as B,t as b,J as P,U as ce,E as se,u as Ve,V as ke,W as we,X as oe,i as ie,v as D,m as je,A as Se,B as De}from"./app-5dd65e17.js";import{_ as $e}from"./AppPageHeader-52a9af7b.js";import{_ as Ce}from"./AppSnackBar-bac5f8bc.js";import{c as Ie,a as de,F as Ae,b as ne}from"./index.esm-708a2087.js";import{d as ue}from"./dayjs.min-95a6eafc.js";import{u as W,a as Re}from"./formatDate-559e9d83.js";import{u as xe}from"./status-755b85a0.js";import{_ as Te}from"./Studio-f753e7b5.js";import{_ as Ue}from"./_plugin-vue_export-helper-c27b6911.js";const Ne={class:"v-col-12 pt-5"},Oe={class:"v-col-12 pb-2"},Ee={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Fe={class:"v-col-12 pt-0 pb-2"},qe={class:"v-col-12"},Me={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup($,{emit:q}){const i=$;K();const f=Q(),e=_(window.location.origin),u=d=>{let n=null;d.map(s=>{n=g.value.find(w=>w.id==s.id),n||g.value.push(s)})},I=_(f.user.profile.id),N=_(!1),m=_(1),M=d=>{m.value=d,N.value=!0},V=d=>{g.value=g.value.filter(n=>n.id!==d)},g=_([]),A=_e(()=>g.value.map(d=>d.id)),L=()=>{let d={id:parseInt(i.incidentId),file_ids:A.value,profile_id:i.objectdata.profile_id};E(f.token).post("/api/incident/sync-images/store-update",d).then(n=>{let s="Attachment has been updated";A.value.length==0&&(s="Attachment has been deleted"),q("save",s)}).catch(n=>{})};return X(()=>{g.value=i.attachment}),H(()=>i.objectdata.attachment,(d,n)=>{g.value=d},{deep:!0}),(d,n)=>(c(),T("div",null,[l("div",Ne,[i.objectdata.profile_id==I.value?(c(),y(k,{key:0},{default:t(()=>[l("div",Oe,[a(Te,{options:{multiSelect:!0,type:"maintenance"},onSelect:u})])]),_:1})):S("",!0),g.value.length>0?(c(),y(k,{key:1,class:"px-1"},{default:t(()=>[(c(!0),T(z,null,G(g.value,(s,w)=>(c(),T("div",{key:s.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[i.objectdata.profile_id==I.value?(c(),y(x,{key:0,style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:p(fe),size:"26px",color:"error",onClick:()=>V(s.id)},null,8,["icon","onClick"])):S("",!0),a(O,{onClick:()=>M(w)},{default:t(()=>[a(le,{src:e.value+"/file/"+s.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),a(ye,{modelValue:N.value,"onUpdate:modelValue":n[1]||(n[1]=s=>N.value=s),width:"95%","max-width":"900"},{default:t(()=>[a(O,{class:"bg-black"},{default:t(()=>[a(he,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=s=>m.value=s)},{default:t(()=>[(c(!0),T(z,null,G(g.value,(s,w)=>(c(),y(be,{key:w,"reverse-transition":"fade",transition:"fade"},{default:t(()=>[l("div",Ee,[a(le,{src:e.value+"/file/"+s.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(c(),y(k,{key:2},{default:t(()=>[l("div",Fe,[a(ge,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:t(()=>[v(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),i.objectdata.profile_id==I.value?(c(),y(k,{key:3},{default:t(()=>[l("div",qe,[a(x,{color:"primary",onClick:L},{default:t(()=>[v("Save")]),_:1})])]),_:1})):S("",!0)])]))}},Le={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Ye={class:"font-weight-bold"},Be={class:"reported-by"},We={class:"reported-by"},Pe={class:"v-col-12"},He={class:"v-col-12 v-col-md-4 pb-0"},ze={class:"v-col-12 v-col-md-8"},Ge={class:"v-col-12"},Je={class:"v-col-12"},Ke={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Qe={class:"v-col-3"},Xe=l("br",null,null,-1),Ze={class:"v-col-9"},et={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup($,{emit:q}){const i=$,f=K(),e=Q(),u=_({}),I=_([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),N=_(f.query.v),m=_([]),M=async()=>{await E(e.token).get("/api/fetch/profile-facility/team").then(d=>{m.value=d.data}).catch(d=>{})},V=()=>{u.value.profile_id=e.user.profile.id,E(e.token).post("/api/incident/update-facility-team",u.value).then(d=>{u.value.remarks_data="",q("saved",d.data.message)}).catch(d=>{})},g=_([]),A=async()=>{await E(e.token).get("/api/fetch-global/incident-status/active").then(d=>{g.value=d.data}).catch(d=>{})},L=(d,n=6)=>{let s="00000"+d;return s.substring(s.length-n)};return X(()=>{M(),A(),u.value=i.objectdata,u.value.priority=i.objectdata.priority?parseInt(i.objectdata.priority):null}),H(()=>i.objectdata.remarks,(d,n)=>{u.value.remarks=d},{deep:!0}),(d,n)=>(c(),T("div",null,[a(O,null,{default:t(()=>[a(B,null,{default:t(()=>[a(k,null,{default:t(()=>{var s;return[l("div",Le,[l("div",Ye," SN: ISR-"+b(L(u.value.id)),1),l("div",Be," REPORTED BY: "+b((s=u.value.profile)==null?void 0:s.display_name),1),l("div",We," DATE REPORTED: "+b(p(W)(u.value.created_at)),1)])]}),_:1}),a(k,null,{default:t(()=>[l("div",Pe,[a(k,null,{default:t(()=>[l("div",He,[a(P,{items:I.value,modelValue:u.value.priority,"onUpdate:modelValue":n[0]||(n[0]=s=>u.value.priority=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*"},null,8,["items","modelValue"]),a(P,{items:m.value,modelValue:u.value.handled_by,"onUpdate:modelValue":n[1]||(n[1]=s=>u.value.handled_by=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue"]),a(P,{items:g.value,modelValue:u.value.status_id,"onUpdate:modelValue":n[2]||(n[2]=s=>u.value.status_id=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),l("div",ze,[a(ce,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:u.value.remarks_data,"onUpdate:modelValue":n[3]||(n[3]=s=>u.value.remarks_data=s)},null,8,["modelValue"])])]),_:1})]),a(se,{class:"mt-3"}),l("div",Ge,[N.value?S("",!0):(c(),y(x,{key:0,class:"",size:"small",disabled:!u.value.priority||!u.value.handled_by||!u.value.status_id,onClick:V,color:"primary"},{default:t(()=>[v("Submit")]),_:1},8,["disabled"]))])]),_:1}),a(k,null,{default:t(()=>[l("div",Je,[v(" Remarks "),a(se)]),l("div",Ke,[(c(!0),T(z,null,G(u.value.remarks,s=>(c(),y(k,{key:d.id},{default:t(()=>{var w;return[l("div",Qe,[v(b((w=s.profile)==null?void 0:w.display_name)+" ",1),Xe,v(),l("small",null,b(p(Re)(s.created_at)),1)]),l("div",Ze,b(s.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const U=$=>(Se("data-v-c993996d"),$=$(),De(),$),tt={class:"v-col py-0"},at={class:"v-col py-0"},lt={class:"v-col-12 v-col-md-4"},st=U(()=>l("div",{class:"font-weight-bold"},"SN:",-1)),ot={class:"v-col-12 v-col-md-4"},it=U(()=>l("div",{class:"font-weight-bold"},"Reported by:",-1)),dt={class:"v-col-12 v-col-md-4"},nt=U(()=>l("div",{class:"font-weight-bold"},"Handled by:",-1)),ut={class:"v-col-12 v-col-md-4"},ct=U(()=>l("div",{class:"font-weight-bold"},"Status",-1)),rt={class:"v-col-12 v-col-md-4"},vt=U(()=>l("div",{class:"font-weight-bold"},"Date Reported",-1)),mt={class:"v-col-12 v-col-md-4"},pt=U(()=>l("div",{class:"font-weight-bold"},"Date Closed",-1)),_t={class:"v-col-12 v-col-md-4"},ft={class:"v-col-12 v-col-md-8"},yt={class:"v-col-12"},ht={class:"v-col-12 v-col-md-6"},bt={class:"v-col-12 v-col-md-6"},gt={class:"v-col-12"},Vt={class:"v-col-12"},kt={key:1},wt=U(()=>l("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),jt={class:"v-col-12 v-col-md-12"},St=U(()=>l("h5",{class:"headline mb-0 text-center"},[v("NO WARRANTY FOUND. "),l("br"),v("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),Dt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup($,{emit:q}){const i=$,f=Q(),e=_({}),u=_({}),I=r=>{u.value={status:!0,type:"success",text:r},q("saved")},N=_(f.user.profile.id),m=K(),M=Ve(),V=_(m.query.type);_(m.query.v);const g=xe(),A=_([]);A.value=Object.assign([],g.urgencies_active_list),g.list.length==0&&g.getStatuses(f.token).then(()=>{A.value=Object.assign([],g.urgencies_active_list)});let L=Ie({Urgency:de().required(),Title:de().required()});const d=new URL(window.location),n=r=>{V.value=r,Z("type",r)},s=_(!1),w=_(f.user.profile.role),re=async()=>{s.value=!0,u.value={status:!0,type:"info",text:"Please wait..."},e.value.type_id=2,e.value.profile_id=f.user.profile.id,await E(f.token).post("/api/store-update/incident",e.value).then(r=>{u.value={status:!0,type:"success",text:r.data.message},m.params.id?s.value=!1:setTimeout(()=>{M.push({name:"EditMaintenance",params:{id:r.data.id},query:{type:"details"}}).catch(o=>{}),s.value=!1},800)}).catch(r=>{})},j=_(!1),Z=(r,o)=>{d.searchParams.set(r,o),window.history.pushState({},"",d)},ee=_([]),ve=async()=>{await E(f.token).get("/api/fetch/companies").then(r=>{ee.value=r.data}).catch(r=>{})},te=_([]),me=async()=>{await E(f.token).get("/api/fetch/locations/non-paginated/data").then(r=>{te.value=r.data}).catch(r=>{})},pe=(r,o=5)=>{let C="0000"+r;return C.substring(C.length-o)};return X(()=>{var r;m.query.asset_code&&(e.value.asset_code=m.query.asset_code),m.query.title&&(e.value.title=m.query.title),m.query.asset_id&&(e.value.asset_id=parseInt(m.query.asset_id)),m.query.comp&&(e.value.company_id=parseInt(m.query.comp)),m.query.loc&&(e.value.location_id=parseInt(m.query.loc)),m.params.id&&(j.value=!0),V.value||(V.value="details",Z("type","details")),ve().then(()=>{me()}),j.value&&(e.value=i.objectdata,e.value.asset_code=(r=i.objectdata.asset)==null?void 0:r.asset_code,e.value.title=i.objectdata.asset?i.objectdata.asset.asset_name:i.objectdata.title,e.value.company_id=i.objectdata.company_id,e.value.location_id=i.objectdata.location_id,e.value.asset_id=i.objectdata.asset_id,e.value.profile_id=i.objectdata.profile_id,e.value.type_id=parseInt(i.objectdata.type_id),e.value.urgency=parseInt(i.objectdata.urgency),e.value.description=i.objectdata.description)}),H(()=>i.objectdata.remarks,(r,o)=>{e.value=i.objectdata},{deep:!0}),H(()=>i.objectdata.attachment,(r,o)=>{e.value=i.objectdata,e.value.attachment=r},{deep:!0}),(r,o)=>(c(),y(je,null,{default:t(()=>[a($e,{title:"Maintenance detail page"}),a(k,{class:"mt-5"},{default:t(()=>[l("div",tt,[a(x,{onClick:o[0]||(o[0]=C=>n("details")),class:"mr-3 mb-3",color:`${V.value=="details"?"primary":"white"}`},{default:t(()=>[v("Details")]),_:1},8,["color"]),j.value?(c(),y(x,{key:0,class:"mr-3 mb-3",color:`${V.value=="attachment"?"primary":"white"}`,onClick:o[1]||(o[1]=C=>n("attachment"))},{default:t(()=>[v("Attachments")]),_:1},8,["color"])):S("",!0),j.value&&(p(f).user.profile.role=="facility"||p(f).user.profile.role=="admin"||p(f).user.profile.role=="superadmin"||p(f).user.profile.role=="technical-operation")?(c(),y(x,{key:1,class:"mr-3 mb-3",color:`${V.value=="warranty"?"primary":"white"}`,onClick:o[2]||(o[2]=C=>n("warranty"))},{default:t(()=>[v("Warranty")]),_:1},8,["color"])):S("",!0),j.value&&(p(f).user.profile.role=="facility"||p(f).user.profile.role=="admin"||p(f).user.profile.role=="superadmin"||p(f).user.profile.role=="technical-operation")?(c(),y(x,{key:2,class:"mr-3 mb-3",color:`${V.value=="facility"?"primary":"white"}`,onClick:o[3]||(o[3]=C=>n("facility"))},{default:t(()=>[v("Facility Team")]),_:1},8,["color"])):S("",!0)])]),_:1}),a(k,{class:"mb-10"},{default:t(()=>{var C,ae;return[l("div",at,[V.value=="details"?(c(),y(O,{key:0},{default:t(()=>[a(p(Ae),{as:"v-form","validation-schema":p(L)},{default:t(({meta:R})=>[a(ke,{class:"text-capitalize my-1"},{default:t(()=>[v(b(i.headertitle),1)]),_:1}),a(B,null,{default:t(()=>[j.value?(c(),y(k,{key:0,class:"bg-background-darken-1 ma-0 rounded"},{default:t(()=>{var Y,h,F;return[l("div",lt,[st,l("div",null,"ISR-2"+b(pe(e.value.id)),1)]),l("div",ot,[it,l("div",null,b((Y=e.value.profile)==null?void 0:Y.display_name),1)]),l("div",dt,[nt,l("div",null,b((h=e.value.handled_by)==null?void 0:h.display_name),1)]),l("div",ut,[ct,l("div",null,b((F=e.value.status)==null?void 0:F.title),1)]),l("div",rt,[vt,l("div",null,b(e.value.created_at?p(ue)(e.value.created_at).format("MMM. DD, YYYY"):"-"),1)]),l("div",mt,[pt,l("div",null,b(e.value.date_closed?p(ue)(e.value.date_closed).format("MMM. DD, YYYY"):"-"),1)])]}),_:1})):S("",!0),a(k,null,{default:t(()=>{var Y;return[l("div",_t,[a(p(ne),{name:"Urgency",modelValue:e.value.urgency_id,"onUpdate:modelValue":o[5]||(o[5]=h=>e.value.urgency_id=h)},{default:t(({field:h,errors:F})=>[a(we,oe({items:A.value,modelValue:e.value.urgency_id,"onUpdate:modelValue":o[4]||(o[4]=J=>e.value.urgency_id=J),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},h,{"error-messages":F}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),l("div",ft,[a(ie,{modelValue:e.value.asset_code,"onUpdate:modelValue":o[6]||(o[6]=h=>e.value.asset_code=h),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code","append-inner-icon":r.mdiMagnify,"onClick:appendInner":o[7]||(o[7]=h=>r.onDecode(e.value.asset_code))},null,8,["modelValue","append-inner-icon"])]),l("div",yt,[a(p(ne),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":o[9]||(o[9]=h=>e.value.title=h)},{default:t(({field:h,errors:F})=>[a(ie,oe({modelValue:e.value.title,"onUpdate:modelValue":o[8]||(o[8]=J=>e.value.title=J),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},h,{"error-messages":F}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),l("div",ht,[a(P,{items:ee.value,modelValue:e.value.company_id,"onUpdate:modelValue":o[10]||(o[10]=h=>e.value.company_id=h),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},null,8,["items","modelValue"])]),l("div",bt,[a(P,{items:te.value,modelValue:e.value.location_id,"onUpdate:modelValue":o[11]||(o[11]=h=>e.value.location_id=h),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},null,8,["items","modelValue"])]),l("div",gt,[a(ce,{rows:"3",variant:"outlined",density:"compact",label:"Incident Description","hide-details":"auto",modelValue:e.value.description,"onUpdate:modelValue":o[12]||(o[12]=h=>e.value.description=h)},null,8,["modelValue"])]),l("div",Vt,[((Y=e.value)==null?void 0:Y.status_id)!=8&&(!j.value||j.value&&(i.objectdata.profile_id==N.value||w.value=="asset-supervisor"))?(c(),y(x,{key:0,color:"primary",onClick:re,disabled:!R.valid,loading:s.value},{default:t(()=>[v(b(j.value?"update":"submit"),1)]),_:2},1032,["disabled","loading"])):S("",!0)])]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):S("",!0),V.value=="warranty"?(c(),T("div",kt,[a(O,null,{default:t(()=>[a(B,null,{default:t(()=>[wt]),_:1})]),_:1}),((ae=(C=e.value.asset)==null?void 0:C.pivot_warranties)==null?void 0:ae.length)>0?(c(),y(k,{key:0},{default:t(()=>[l("div",jt,[(c(!0),T(z,null,G(e.value.asset.pivot_warranties,R=>(c(),y(O,{class:"my-3 px-5",key:R.id},{default:t(()=>[a(B,null,{default:t(()=>[a(k,null,{default:t(()=>[a(D,{cols:"4"},{default:t(()=>[v("Vendor")]),_:1}),a(D,{cols:"8"},{default:t(()=>[v(b(R.vendor.title),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[v("Warranty Start Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[v(b(p(W)(R.warranty_start_date)),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[v("Warranty End Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[v(b(p(W)(R.warranty_end_date)),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[v("AMC Start Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[v(b(p(W)(R.amc_start_date)),1)]),_:2},1024),a(D,{cols:"4"},{default:t(()=>[v("AMC End Date")]),_:1}),a(D,{cols:"8"},{default:t(()=>[v(b(p(W)(R.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(c(),y(O,{key:1,class:"mt-2"},{default:t(()=>[a(B,null,{default:t(()=>[St]),_:1})]),_:1}))])):j.value&&V.value=="attachment"?(c(),y(Me,{key:2,"incident-id":p(m).params.id,attachment:e.value.attachment,onSave:I,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(w.value=="superadmin"||w.value=="admin"||w.value=="technical-operation"||w.value=="facility")&&j.value&&V.value=="facility"?(c(),y(et,{key:3,objectdata:e.value,onSaved:I},null,8,["objectdata"])):S("",!0)])]}),_:1}),a(Ce,{options:u.value},null,8,["options"])]),_:1}))}},Ot=Ue(Dt,[["__scopeId","data-v-c993996d"]]);export{Ot as D};
