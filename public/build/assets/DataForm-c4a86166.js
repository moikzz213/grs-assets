import{a as Ue,r as p,I as Ce,u as Ee,K as Oe,J as se,T as oe,o as n,c as h,w as d,d as l,v as je,k as j,V as Re,b as a,t as u,p as V,y,ag as de,E as v,H as Y,f as $,s as m,j as q,e as C,L as R,i as x,q as F,F as D,U as De,X as Ne,W as Le,P as Ie,D as G,O as Fe,aE as ie,aF as ne,aG as ue,aH as re,aI as Be,m as Pe,n as E}from"./app-c76d4235.js";import{_ as ze}from"./ApppageHeader-f39fd474.js";import{_ as Me}from"./Studio-7deb884c.js";import{_ as Qe}from"./AppSnackBar-83756d2d.js";import{u as ce}from"./formatDate-b9aad8c5.js";import{r as ve}from"./generateRandomString-02c0ba3b.js";const Ye={key:0,class:"text-error text-h6"},$e={class:"col-12 v-col-md-4"},Ge={key:0,class:"v-col-12 v-col-md-8"},He={key:0,class:"text-right no-print"},Ke={class:"v-col-12 v-col-md-6"},Je={class:"v-col-12 v-col-md-6"},We={class:"v-col-12 v-col-md-6"},Xe={class:"v-col-12 v-col-md-6"},Ze={class:"v-col-12"},et={class:"wd-100"},tt={class:"wd-60"},at={class:"wd-40"},lt={class:"wd-60"},st={class:"wd-40"},ot={class:"wd-100"},dt={class:"v-col-12"},it=a("div",{class:"wd-30"},"ITEM DESCRIPTION",-1),nt=a("div",{class:"wd-15"},"ASSET CODE",-1),ut=a("div",{class:"wd-10"},"QTY",-1),rt=a("div",{class:"wd-10"},"WEIGHT",-1),ct=a("div",{class:"wd-10"},"VALUE",-1),vt=a("div",{class:"wd-20"},"REASON FOR REQUEST",-1),pt={class:"wd-30"},_t={class:"wd-15"},mt={class:"wd-10"},ft={class:"wd-10"},ht={class:"wd-10"},yt={class:"wd-20"},gt={class:"v-col-12 v-col-md-1 px-1"},Vt={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},bt={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},wt={class:"v-col-12 pt-0 pb-0"},kt={class:"v-col-12 v-col-md-3"},xt={class:"v-col-12 v-col-md-2"},At={class:"v-col-12 v-col-md-1"},Tt={class:"v-col-12 v-col-md-1"},St={class:"v-col-12 v-col-md-1"},qt={class:"v-col-12 v-col-md-3 d-flex"},Ut={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},Ct=a("div",null,"APPROVAL SETUP",-1),Et={key:0,class:"no-print"},Ot=a("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),jt={class:"v-col-12 v-col-md-6"},Rt=a("div",{class:"v-col-12 v-col-md-1"},"Status",-1),Dt=a("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),Nt=a("div",{class:"wd-20"},"Requestor",-1),Lt={class:"wd-50"},It=a("div",{class:"wd-10"},"Status",-1),Ft=a("div",{class:"wd-20"},"Date Approved",-1),Bt={class:"wd-20"},Pt={class:"wd-50"},zt={class:"wd-10"},Mt={class:"wd-20"},Qt={class:"v-col-12 v-col-md-2"},Yt={class:"v-col-12 v-col-md-7 d-flex"},$t={class:"my-auto"},Gt={key:0,class:"v-col-12"},Ht={class:"v-col-12 text-error"},Kt=a("div",{class:"v-col-12 v-col-md-12 text-info no-print"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),aa={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(pe,{emit:_e}){const A=pe,f=Ue(),B=p(!1),T=Ce(),me=Ee(),r=p({}),S=p(!1),b=p([{qty:1,attachment:{}}]),fe=p(new Date),he=p(window.location.origin),ye=(t,s)=>{b.value[t].attachment=s[0]},P=p(!1),H=p(1),ge=t=>{H.value=t,P.value=!0},Ve=t=>{b.value[t].attachment=""},z=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},K=p(""),J=p([]),be=async()=>{await E(f.token).get("/api/fetch/approval-setups/non-paginated/data/request").then(t=>{var s,e;J.value=t.data,K.value=(e=(s=t.data.filter(o=>o.id==c.value.request_type_id))==null?void 0:s[0])==null?void 0:e.title}).catch(t=>{})},N=p({}),W=p([]),we=async()=>{await E(f.token).get("/api/fetch/companies").then(t=>{W.value=t.data}).catch(t=>{})},X=p(""),Z=p(""),M=p([]),ke=async()=>{await E(f.token).get("/api/fetch/locations/non-paginated/data").then(t=>{var s,e,o,g;M.value=t.data,X.value=(e=(s=t.data.filter(w=>w.id==c.value.transferred_from))==null?void 0:s[0])==null?void 0:e.title,Z.value=(g=(o=t.data.filter(w=>w.id==c.value.transferred_to))==null?void 0:o[0])==null?void 0:g.title}).catch(t=>{})},xe=()=>{b.value.push({qty:1,attachment:{}}),U()},Ae=(t,s)=>{b.value.splice(s,1),U()},ee=p("Note: Administrator needs to setup signatories first."),Te=()=>{N.value={status:!0,type:"info",text:"Please wait..."};let t=b.value.map((e,o)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),s={data:r.value,assets:t,approval:k.value,profile_id:f.user.profile.id,type:"request",role:f.user.profile.role};E(f.token).post("/api/request-asset/store-update/data",s).then(e=>{let o="",g="";e.data.message?(o=e.data.message,g="success"):e.data.error&&(o=e.data.error,g="error"),N.value={status:!0,type:g,text:o},T.params.id||setTimeout(()=>{me.push({name:"EditRequestAsset",params:{id:e.data.id}}).catch(w=>{})},800)}).catch(e=>{console.log(e)})},k=p([]),L=p(!0),te=async()=>{await E(f.token).get("/api/fetch/request-asset/approval-setup-fetch/"+r.value.request_type_id).then(t=>{var s,e,o,g,w,_;console.log("setupApprovals",t),k.value=(s=t.data)==null?void 0:s.stages,T.params.id&&k.value.length>0&&(k.value.map((O,I)=>(O.profile_id=i.value[I].profile_id,O.status=i.value[I].status,O.date_approved=i.value[I].date_approved,O.reason_rejected=i.value[I].reason_rejected,O)),k.value.length>1&&(k.value[i.value.length-1]={id:i.value[i.value.length-1].id,profile_id:i.value[i.value.length-1].profile_id,status:i.value[i.value.length-1].status,date_approved:i.value[i.value.length-1].date_approved,status:i.value[i.value.length-1].status,reason_rejected:"",types:i.value[i.value.length-1].approval_type,sort:i.value[i.value.length-1].orders,request_asset_id:i.value[i.value.length-1].request_asset_id,signatures:[{id:(e=i.value[i.value.length-1])==null?void 0:e.profile.id,display_name:(o=i.value[i.value.length-1])==null?void 0:o.profile.display_name,first_name:(g=i.value[i.value.length-1])==null?void 0:g.profile.first_name,last_name:(w=i.value[i.value.length-1])==null?void 0:w.profile.last_name}]})),((_=t.data)==null?void 0:_.stages.length)>0?L.value=!0:L.value=!1}).catch(t=>{})},U=()=>{let t=!1;B.value=!1,r.value.company_id&&r.value.request_type_id&&r.value.subject&&r.value.transferred_from&&r.value.transferred_to&&(t=!0);let s=!0;b.value.map(o=>{o.item_description&&o.reason_for_request||(s=!1)});let e=!0;k.value.map(o=>{o.profile_id||(e=!1)}),e&&s&&t&&(B.value=!0)},ae=t=>{let s={status:t,profile_id:f.user.profile.id,ID:c.value.id};E(f.token).post("/api/request-asset/change-request/data",s).then(e=>{N.value={status:!0,type:"success",text:e.data.message},c.value.status=t,_e("saved",e.data.message)}).catch(e=>{})},le=(t,s=6)=>{let e="00000"+t;return e.substring(e.length-s)},i=p([]),c=p({});Oe(()=>{if(be().then(()=>{we().then(()=>{ke()})}),T.params.id){S.value=!0;let t=A.objectdata;c.value=t,console.log("vvvv",t),r.value.company_id=t.company_id,r.value.request_type_id=t.request_type_id,r.value.subject=t.subject,r.value.transferred_from=t.transferred_from,r.value.transferred_to=t.transferred_to,r.value.id=t.id,r.value.requestor_id=t.profile_id,i.value=t.request_approvals,b.value=t.items,te()}else r.value.company_id=f.user.profile.company_id}),se(r.value,async(t,s)=>{U()}),se(b.value,async(t,s)=>{U()});const Q=oe(()=>f.user.role=="receiving-releasing"),Se=p("https://assets.grandiose.ae/"),qe=oe(()=>{let t=null,s=Se.value+"pv/employee-signatory",e=ve(50),o=ve(50);return c.value&&(t=s+"/"+c.value.types+"/approvals?o=99&key="+e+"&pid=95&pv="+o+"&id="+c.value.id),t});return(t,s)=>(n(),h(Pe,null,{default:d(()=>[l(ze,{title:A.headertitle,class:"no-print"},null,8,["title"]),l(m,{class:"mb-3"},{default:d(()=>[l(je,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:d(()=>[l(j,null,{default:d(()=>[l(Re,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:d(()=>[a("div",null,u(A.headertitle),1),L.value?y("",!0):(n(),V("div",Ye,u(ee.value),1)),S.value?(n(),V("div",{key:1,class:de(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+u(c.value.status)+") ",3)):y("",!0),a("div",null,"DATE: "+u(v(ce)(fe.value)),1)]),_:1}),l(Y),l($,null,{default:d(()=>[l(m,{class:"no-print"},{default:d(()=>[S.value?(n(),V("div",{key:0,class:de(`${c.value.status=="complete"?"v-col-12":"v-col-md-12"}`)},[l(m,null,{default:d(()=>[a("div",$e," REQUEST NO: SN-5"+u(le(c.value.id)),1),Q.value?y("",!0):(n(),V("div",Ge,[S.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(n(),V("div",He,[c.value.status=="pending"?(n(),h(q,{key:0,onClick:s[0]||(s[0]=e=>ae("cancelled")),color:"warning"},{default:d(()=>[C("Cancel request")]),_:1})):y("",!0),c.value.status=="cancelled"?(n(),h(q,{key:1,onClick:s[1]||(s[1]=e=>ae("pending")),size:"small",color:"info"},{default:d(()=>[C("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)]))]),_:1})],2)):y("",!0),a("div",Ke,[l(R,{items:J.value,modelValue:r.value.request_type_id,"onUpdate:modelValue":[s[2]||(s[2]=e=>r.value.request_type_id=e),te],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:S.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),a("div",Je,[l(R,{items:W.value,modelValue:r.value.company_id,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),a("div",We,[l(R,{items:M.value,modelValue:r.value.transferred_from,"onUpdate:modelValue":s[4]||(s[4]=e=>r.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),a("div",Xe,[l(R,{items:M.value,modelValue:r.value.transferred_to,"onUpdate:modelValue":s[5]||(s[5]=e=>r.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),a("div",Ze,[l(x,{modelValue:r.value.subject,"onUpdate:modelValue":s[6]||(s[6]=e=>r.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1}),l(m,{class:"for-print-flex mx-2 mb-1"},{default:d(()=>{var e,o;return[a("div",et,"REQUEST NO: SN-5"+u(le(c.value.id)),1),a("div",tt,"TYPE OF REQUEST: "+u(K.value),1),a("div",at,"COMPANY: "+u((o=(e=c.value)==null?void 0:e.company)==null?void 0:o.title),1),a("div",lt,"LOCATION FROM: "+u(X.value),1),a("div",st,"LOCATION TO: "+u(Z.value),1),a("div",ot,"SUBJECT: "+u(c.value.subject),1)]}),_:1})]),_:1})]),_:1}),l(j,{class:"my-2"},{default:d(()=>[l($,null,{default:d(()=>[Q.value?y("",!0):(n(),h(m,{key:0},{default:d(()=>{var e;return[a("div",dt,[c.value.status!="complete"&&(!v(T).params.id||((e=A.objectdata)==null?void 0:e.status)=="pending"||v(f).user.profile.role=="superadmin"||v(f).user.profile.role=="administrator")?(n(),h(q,{key:0,color:"primary",class:"no-print",onClick:xe},{default:d(()=>[C("Add")]),_:1})):y("",!0)])]}),_:1})),l(m,{class:"for-print-flex mx-2 header mb-1 mt-0"},{default:d(()=>[it,nt,ut,rt,ct,vt]),_:1}),(n(!0),V(D,null,F(b.value,(e,o)=>(n(),h(m,{key:o,class:"for-print-flex mx-2 row-bordered mb-1"},{default:d(()=>[a("div",pt,u(e.item_description),1),a("div",_t,u(e.asset_code),1),a("div",mt,u(e.qty),1),a("div",ft,u(e.weight),1),a("div",ht,u(e.item_value),1),a("div",yt,u(e.reason_for_request),1)]),_:2},1024))),128)),(n(!0),V(D,null,F(b.value,(e,o)=>(n(),h(m,{key:o,class:"no-print"},{default:d(()=>{var g,w;return[a("div",gt,[(g=e.attachment)!=null&&g.id?(n(),h(m,{key:0,class:"px-1"},{default:d(()=>[a("div",Vt,[l(x,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":_=>e.attachment.id=_},null,8,["modelValue","onUpdate:modelValue"]),l(q,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:v(De),size:"16px",color:"error",onClick:()=>Ve(o,e.attachment.id)},null,8,["icon","onClick"]),l(j,{onClick:()=>ge(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),l(Ne,{modelValue:P.value,"onUpdate:modelValue":s[7]||(s[7]=_=>P.value=_),width:"95%","max-width":"900"},{default:d(()=>[l(j,{class:"bg-black"},{default:d(()=>[a("div",bt,[l(Le,{src:he.value+"/file/"+H.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(n(),h(m,{key:1,class:"mt-0"},{default:d(()=>[a("div",wt,[l(Ie,{color:"grey-lighten-4",class:"text-center"},{default:d(()=>[l(Me,{options:{multiSelect:!1,type:"request-asset"},onSelect:_=>ye(o,_)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),a("div",kt,[l(x,{modelValue:e.item_description,"onUpdate:modelValue":[_=>e.item_description=_,U],variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",xt,[l(x,{modelValue:e.asset_code,"onUpdate:modelValue":_=>e.asset_code=_,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",At,[l(x,{type:"number",modelValue:e.qty,"onUpdate:modelValue":_=>e.qty=_,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Tt,[l(x,{type:"number",modelValue:e.weight,"onUpdate:modelValue":_=>e.weight=_,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",St,[l(x,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":_=>e.item_value=_,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),a("div",qt,[l(x,{modelValue:e.reason_for_request,"onUpdate:modelValue":_=>e.reason_for_request=_,variant:"outlined",density:"compact","hide-details":"",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!S.value||S.value&&v(f).user.profile.id==A.objectdata.profile_id&&((w=A.objectdata)==null?void 0:w.status)=="pending"?(n(),h(G,{key:0,size:"small",onClick:()=>Ae(e.id,o),icon:v(Fe),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(j,{class:"my-2"},{default:d(()=>[l($,null,{default:d(()=>[l(m,null,{default:d(()=>[a("div",Ut,[Ct,v(T).params.id?(n(),V("div",Et,[l(q,{color:"info",size:"small",target:"_blank",href:qe.value},{default:d(()=>[C("View Approval Page")]),_:1},8,["href"])])):y("",!0)]),l(Y)]),_:1}),l(m,{class:"no-print"},{default:d(()=>{var e,o;return[Ot,a("div",jt,u((o=(e=c.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),Rt,Dt]}),_:1}),l(m,{class:"for-print-flex mx-2 mt-5 mb-1"},{default:d(()=>{var e,o;return[Nt,a("div",Lt,u((o=(e=c.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),It,Ft]}),_:1}),(n(!0),V(D,null,F(i.value,e=>(n(),h(m,{class:"for-print-flex mx-2 mb-2 mt-0",key:e.id},{default:d(()=>{var o;return[a("div",Bt,u(z(e.approval_type)),1),a("div",Pt,u((o=e==null?void 0:e.profile)==null?void 0:o.display_name),1),a("div",zt,[e.status?(n(),h(G,{key:0,class:"mx-2 my-0",icon:e.status=="awaiting-approval"?v(ie):e.status=="pending"?v(ne):e.status=="reject"?v(ue):v(re),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0)]),a("div",Mt,u(e.date_approved),1)]}),_:2},1024))),128)),L.value?(n(),V(D,{key:0},[(n(!0),V(D,null,F(k.value,(e,o)=>(n(),h(m,{class:"no-print",key:e.id},{default:d(()=>[a("div",Qt,u(e.types?z(e.types):z(e.approval_type)),1),a("div",Yt,[l(R,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[g=>e.profile_id=g,U],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),l(q,{variant:"text",size:"x-small"},{default:d(()=>[e.status?(n(),h(G,{key:0,class:"mx-2 my-3 no-print",icon:e.status=="awaiting-approval"?v(ie):e.status=="pending"?v(ne):e.status=="reject"?v(ue):v(re),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),l(Be,{activator:"parent",location:"top","max-width":"400"},{default:d(()=>[C(u(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),a("div",$t,u(e.date_approved?v(ce)(e.date_approved):""),1)]),_:2},1024))),128)),l(m,null,{default:d(()=>{var e;return[l(Y),Q.value?y("",!0):(n(),V("div",Gt,[(!v(T).params.id||((e=A.objectdata)==null?void 0:e.status)=="pending"||v(f).user.profile.role=="asset-supervisor"||v(f).user.profile.role=="superadmin"||v(f).user.profile.role=="administrator")&&c.value.status!="complete"?(n(),h(q,{key:0,disabled:!B.value,onClick:Te,class:"no-print",color:"primary"},{default:d(()=>[C(u(v(T).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)]))]}),_:1})],64)):(n(),h(m,{key:1,class:"no-print"},{default:d(()=>[a("div",Ht,u(ee.value),1)]),_:1})),l(m,null,{default:d(()=>[Kt]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Qe,{options:N.value},null,8,["options"])]),_:1}))}};export{aa as _};
