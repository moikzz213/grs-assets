import{i as le,r as f,W as ke,o as se,O as X,b as _,c as L,e as s,l as e,k as t,E as h,j as b,F as Z,d as Q,z as D,K as v,X as Se,A as E,Y as ce,Z as ve,_ as je,$ as we,T as Ce,m as p,D as $,q as N,t as V,P as te,a0 as me,M as ae,N as xe,u as Te,G as w,a1 as K,I as U,V as De,a2 as J,a3 as z,y as re,J as $e,L as Ae,a4 as Re,a5 as Ie,C as Ue,p as Ee,g as Le}from"./app-f3ed5daf.js";import{_ as Ne}from"./ApppageHeader-eab2b98c.js";import{_ as Oe}from"./AppSnackBar-2f356ef2.js";import{c as Fe,a as M,F as Be,b as Y}from"./index.esm-73db56a9.js";import{S as Pe}from"./StreamBarcodeReader-5659f39e.js";import{_ as We}from"./_plugin-vue_export-helper-c27b6911.js";import{u as O,a as qe}from"./formatDate-b9aad8c5.js";import{u as ze}from"./status-0d40081e.js";import{_ as Me}from"./Studio-85b1fa59.js";const Ye={class:"v-col-12 pt-5"},He={class:"v-col-12 pb-2"},Ge={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ke={class:"v-col-12 pt-0 pb-2"},Je={class:"v-col-12"},Xe={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(x,{emit:P}){const i=x,m=le(),a=f(window.location.origin),c=d=>{let r=null;d.map(o=>{r=y.value.find(k=>k.id==o.id),r||y.value.push(o)})},A=f(!1),R=f(1),F=d=>{R.value=d,A.value=!0},W=d=>{y.value=y.value.filter(r=>r.id!==d)},y=f([]),B=ke(()=>y.value.map(d=>d.id)),g=()=>{let d={id:parseInt(i.incidentId),file_ids:B.value,profile_id:i.objectdata.profile_id};$(m.token).post("/api/incident/sync-images/store-update",d).then(r=>{let o="Attachment has been updated";B.value.length==0&&(o="Attachment has been deleted"),P("save",o)}).catch(r=>{})};return se(()=>{y.value=i.attachment}),X(()=>i.objectdata.attachment,(d,r)=>{y.value=d},{deep:!0}),(d,r)=>(_(),L("div",null,[s("div",Ye,[e(h,null,{default:t(()=>[s("div",He,[e(Me,{options:{multiSelect:!0,type:"incident"},onSelect:c})])]),_:1}),y.value.length>0?(_(),b(h,{key:0,class:"px-1"},{default:t(()=>[(_(!0),L(Z,null,Q(y.value,(o,k)=>(_(),L("div",{key:o.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[e(D,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:v(Se),size:"26px",color:"error",onClick:()=>W(o.id)},null,8,["icon","onClick"]),e(E,{onClick:()=>F(k)},{default:t(()=>[e(ce,{src:a.value+"/file/"+o.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),e(ve,{modelValue:A.value,"onUpdate:modelValue":r[1]||(r[1]=o=>A.value=o),width:"95%","max-width":"900"},{default:t(()=>[e(E,{class:"bg-black"},{default:t(()=>[e(je,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:R.value,"onUpdate:modelValue":r[0]||(r[0]=o=>R.value=o)},{default:t(()=>[(_(!0),L(Z,null,Q(y.value,(o,k)=>(_(),b(we,{key:k,"reverse-transition":"fade",transition:"fade"},{default:t(()=>[s("div",Ge,[e(ce,{src:a.value+"/file/"+o.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(_(),b(h,{key:1},{default:t(()=>[s("div",Ke,[e(Ce,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:t(()=>[p(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),e(h,null,{default:t(()=>[s("div",Je,[e(D,{color:"primary",onClick:g},{default:t(()=>[p("Save")]),_:1})])]),_:1})])]))}},Ze={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Qe={class:"font-weight-bold"},et={class:"reported-by"},tt={class:"reported-by"},at={class:"v-col-12"},lt={class:"v-col-12 v-col-md-4 pb-0"},st={class:"v-col-12 v-col-md-8"},ot={class:"v-col-12"},dt={class:"v-col-12"},it={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},nt={class:"v-col-3"},ut=s("br",null,null,-1),ct={class:"v-col-9"},rt={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(x,{emit:P}){const i=x,m=le(),a=f(m.user.profile.role),c=f({}),A=f([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),R=f([]),F=async()=>{await $(m.token).get("/api/fetch/profile-facility/team").then(d=>{R.value=d.data}).catch(d=>{})},W=()=>{c.value.profile_id=m.user.profile.id,$(m.token).post("/api/incident/update-facility-team",c.value).then(d=>{c.value.remarks_data="",P("saved",d.data.message)}).catch(d=>{})},y=f([]),B=async()=>{await $(m.token).get("/api/fetch-global/incident-status/active").then(d=>{y.value=d.data}).catch(d=>{})},g=(d,r=6)=>{let o="00000"+d;return o.substring(o.length-r)};return se(()=>{F(),B(),c.value=i.objectdata,c.value.priority=i.objectdata.priority?parseInt(i.objectdata.priority):null}),X(()=>i.objectdata.remarks,(d,r)=>{c.value.remarks=d},{deep:!0}),(d,r)=>(_(),L("div",null,[e(E,null,{default:t(()=>[e(N,null,{default:t(()=>[e(h,null,{default:t(()=>{var o;return[s("div",Ze,[s("div",Qe," SN: ISR-"+V(g(c.value.id)),1),s("div",et," REPORTED BY: "+V((o=c.value.profile)==null?void 0:o.display_name),1),s("div",tt," DATE REPORTED: "+V(v(O)(c.value.created_at)),1)])]}),_:1}),e(h,null,{default:t(()=>[s("div",at,[e(h,null,{default:t(()=>[s("div",lt,[e(te,{items:A.value,modelValue:c.value.priority,"onUpdate:modelValue":r[0]||(r[0]=o=>c.value.priority=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:a.value=="facility"},null,8,["items","modelValue","disabled"]),e(te,{items:R.value,modelValue:c.value.handled_by,"onUpdate:modelValue":r[1]||(r[1]=o=>c.value.handled_by=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:a.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),e(te,{items:y.value,modelValue:c.value.status_id,"onUpdate:modelValue":r[2]||(r[2]=o=>c.value.status_id=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",st,[e(me,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:c.value.remarks_data,"onUpdate:modelValue":r[3]||(r[3]=o=>c.value.remarks_data=o)},null,8,["modelValue"])])]),_:1})]),e(ae,{class:"mt-3"}),s("div",ot,[e(D,{class:"",size:"small",disabled:!c.value.priority||!c.value.handled_by||!c.value.status_id,onClick:W,color:"primary"},{default:t(()=>[p("Submit")]),_:1},8,["disabled"])])]),_:1}),e(h,null,{default:t(()=>[s("div",dt,[p(" Remarks "),e(ae)]),s("div",it,[(_(!0),L(Z,null,Q(c.value.remarks,o=>(_(),b(h,{key:d.id},{default:t(()=>{var k;return[s("div",nt,[p(V((k=o.profile)==null?void 0:k.display_name)+" ",1),ut,p(),s("small",null,V(v(qe)(o.created_at)),1)]),s("div",ct,V(o.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const pe=x=>(Ee("data-v-8f6a4dad"),x=x(),Le(),x),vt={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},mt={class:"font-weight-bold"},pt={class:"reported-by"},_t={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},ft={class:"v-col-12 v-col-md-3"},yt={class:"v-col-12 v-col-md-3"},ht={class:"v-col-12 v-col-md-6 d-flex"},bt={class:"v-col-12"},Vt={class:"v-col-12 v-col-md-12"},gt={class:"v-col-12 v-col-md-3"},kt={class:"v-col-12"},St={class:"v-col-12"},jt={class:"v-col-12 v-col-md-9"},wt={class:"v-col-12 v-col-md-6"},Ct={class:"v-col-12 v-col-md-3"},xt={class:"v-col-12 v-col-md-3"},Tt={key:1},Dt=pe(()=>s("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),$t={class:"v-col-12 v-col-md-12"},At=pe(()=>s("h5",{class:"headline mb-0 text-center"},[p(" NO WARRANTY FOUND. "),s("br"),p("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),Rt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(x,{emit:P}){const i=x,m=le(),a=f({}),c=f({}),A=n=>{c.value={status:!0,type:"success",text:n},P("saved")},R=f(m.user.profile.id),F=f([]),W=async()=>{await $(m.token).get("/api/fetch-global/incident-types/active").then(n=>{F.value=n.data}).catch(n=>{})},y=xe(),B=Te(),g=f(y.query.type),d=ze(),r=f(d.urgencies_active_list);d.list.length==0&&d.getStatuses(m.token).then(()=>{r.value=d.urgencies_active_list});let o=Fe({Type:M().required(),Urgency:M().required(),Title:M().required(),Company:M().required(),Location:M().required()});const k=f(!1),_e=()=>{ee.value=!1,k.value=!0},fe=async n=>{a.value.asset_code=n,await $(m.token).get("/api/fetch/asset-info/by/asset-code/"+n).then(l=>{a.value.title=l.data.asset_name,a.value.company_id=l.data.company_id,a.value.location_id=l.data.location_id,a.value.asset_id=l.data.id,k.value=!1}).catch(l=>{})},ee=f(!1),ye=()=>{ee.value=!0},oe=new URL(window.location),H=n=>{g.value=n,de("type",n)},G=f(!1),q=f(m.user.profile.role),he=async()=>{G.value=!0,c.value={status:!0,type:"info",text:"Please wait..."},a.value.profile_id=m.user.profile.id,await $(m.token).post("/api/store-update/incident",a.value).then(n=>{c.value={status:!0,type:"success",text:n.data.message},y.params.id?G.value=!1:setTimeout(()=>{B.push({name:"EditIncident",params:{id:n.data.id},query:{type:"details"}}).catch(l=>{}),G.value=!1},800)}).catch(n=>{})},C=f(!1),de=(n,l)=>{oe.searchParams.set(n,l),window.history.pushState({},"",oe)},ie=f([]),be=async()=>{await $(m.token).get("/api/fetch/companies").then(n=>{ie.value=n.data}).catch(n=>{})},ne=f([]),Ve=async()=>{await $(m.token).get("/api/fetch/locations/non-paginated/data").then(n=>{ne.value=n.data}).catch(n=>{})},ge=(n,l=5)=>{let I="0000"+n;return I.substring(I.length-l)};return se(()=>{y.params.id&&(C.value=!0),g.value||(g.value="details",de("type","details")),W().then(()=>{be().then(()=>{Ve()})}),C.value&&(a.value=i.objectdata,a.value.asset_code=i.objectdata.asset?i.objectdata.asset.asset_code:i.objectdata.asset_code,a.value.title=i.objectdata.asset?i.objectdata.asset.asset_name:i.objectdata.title,a.value.company_id=i.objectdata.company_id,a.value.location_id=i.objectdata.location_id,a.value.asset_id=i.objectdata.asset_id,a.value.profile_id=i.objectdata.profile_id,a.value.type_id=parseInt(i.objectdata.type_id),a.value.urgency=parseInt(i.objectdata.urgency),a.value.description=i.objectdata.description)}),X(()=>i.objectdata.remarks,(n,l)=>{a.value=i.objectdata},{deep:!0}),X(()=>i.objectdata.attachment,(n,l)=>{a.value=i.objectdata,a.value.attachment=n},{deep:!0}),(n,l)=>(_(),b(Ue,null,{default:t(()=>[e(Ne,{title:"Incident detail page"}),e(h,{class:"mt-5"},{default:t(()=>[e(w,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:t(()=>{var I,ue;return[e(h,{class:"mb-3"},{default:t(()=>[e(D,{class:K(`${g.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:l[0]||(l[0]=S=>H("details"))},{default:t(()=>[p("Details")]),_:1},8,["class"]),C.value?(_(),b(D,{key:0,class:K(`${g.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:l[1]||(l[1]=S=>H("attachment"))},{default:t(()=>[p("Attachments")]),_:1},8,["class"])):U("",!0),C.value&&(v(m).user.profile.role=="facility"||v(m).user.profile.role=="admin"||v(m).user.profile.role=="superadmin"||v(m).user.profile.role=="technical-operation")?(_(),b(D,{key:1,class:K(`${g.value=="warranty"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:l[2]||(l[2]=S=>H("warranty"))},{default:t(()=>[p("Warranty")]),_:1},8,["class"])):U("",!0),C.value&&(v(m).user.profile.role=="facility"||v(m).user.profile.role=="admin"||v(m).user.profile.role=="superadmin"||v(m).user.profile.role=="technical-operation")?(_(),b(D,{key:2,class:K(`${g.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:l[3]||(l[3]=S=>H("facility"))},{default:t(()=>[p("Facility Team")]),_:1},8,["class"])):U("",!0)]),_:1}),g.value=="details"?(_(),b(E,{key:0},{default:t(()=>[e(v(Be),{as:"v-form","validation-schema":v(o)},{default:t(({meta:S})=>[e(De,{class:"my-3 ml-3 text-uppercase text-h6"},{default:t(()=>[p(V(i.headertitle),1)]),_:1}),e(N,null,{default:t(()=>[C.value?(_(),b(h,{key:0},{default:t(()=>{var u,j;return[s("div",vt,[s("div",mt,"SN: ISR-2"+V(ge(a.value.id)),1),s("div",pt," REPORTED BY: "+V((u=a.value.profile)==null?void 0:u.display_name),1)]),s("div",_t," STATUS: "+V((j=a.value.status)==null?void 0:j.title),1)]}),_:1})):U("",!0),e(h,null,{default:t(()=>[s("div",ft,[e(v(Y),{name:"Type",modelValue:a.value.type_id,"onUpdate:modelValue":l[5]||(l[5]=u=>a.value.type_id=u)},{default:t(({field:u,errors:j})=>[e(J,z({items:F.value,modelValue:a.value.type_id,"onUpdate:modelValue":l[4]||(l[4]=T=>a.value.type_id=T),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},u,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",yt,[e(v(Y),{name:"Urgency",modelValue:a.value.urgency,"onUpdate:modelValue":l[7]||(l[7]=u=>a.value.urgency=u)},{default:t(({field:u,errors:j})=>[e(J,z({items:r.value,modelValue:a.value.urgency,"onUpdate:modelValue":l[6]||(l[6]=T=>a.value.urgency=T),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},u,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",ht,[e(re,{modelValue:a.value.asset_code,"onUpdate:modelValue":l[8]||(l[8]=u=>a.value.asset_code=u),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),e($e,{onClick:_e,class:"ml-2 my-auto",size:"large",icon:v(Ae)},null,8,["icon"])]),s("div",bt,[e(v(Y),{name:"Title",modelValue:a.value.title,"onUpdate:modelValue":l[10]||(l[10]=u=>a.value.title=u)},{default:t(({field:u,errors:j})=>[e(re,z({modelValue:a.value.title,"onUpdate:modelValue":l[9]||(l[9]=T=>a.value.title=T),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},u,{"error-messages":j}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Vt,[e(h,null,{default:t(()=>[s("div",gt,[e(h,null,{default:t(()=>[s("div",kt,[e(v(Y),{name:"Company",modelValue:a.value.company_id,"onUpdate:modelValue":l[12]||(l[12]=u=>a.value.company_id=u)},{default:t(({field:u,errors:j})=>[e(J,z({items:ie.value,modelValue:a.value.company_id,"onUpdate:modelValue":l[11]||(l[11]=T=>a.value.company_id=T),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},u,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",St,[e(v(Y),{name:"Location",modelValue:a.value.location_id,"onUpdate:modelValue":l[14]||(l[14]=u=>a.value.location_id=u)},{default:t(({field:u,errors:j})=>[e(J,z({items:ne.value,modelValue:a.value.location_id,"onUpdate:modelValue":l[13]||(l[13]=T=>a.value.location_id=T),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},u,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",jt,[e(me,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:a.value.description,"onUpdate:modelValue":l[15]||(l[15]=u=>a.value.description=u)},null,8,["modelValue"])])]),_:1})])]),_:1}),e(ae,{class:"my-3"}),e(h,null,{default:t(()=>{var u;return[s("div",wt,[((u=a.value)==null?void 0:u.status_id)!=8&&(!C.value||C.value&&(i.objectdata.profile_id==R.value||q.value=="asset-supervisor"))?(_(),b(D,{key:0,size:"small",color:"primary",onClick:he,disabled:!S.valid,loading:G.value},{default:t(()=>[p("Submit")]),_:2},1032,["disabled","loading"])):U("",!0)]),s("div",Ct," DATE REPORTED: "+V(a.value.created_at?v(O)(a.value.created_at):""),1),s("div",xt," DATE CLOSED: "+V(n.date_closed?v(O)(a.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):U("",!0),g.value=="warranty"?(_(),L("div",Tt,[e(E,null,{default:t(()=>[e(N,null,{default:t(()=>[Dt]),_:1})]),_:1}),((ue=(I=a.value.asset)==null?void 0:I.pivot_warranties)==null?void 0:ue.length)>0?(_(),b(h,{key:0},{default:t(()=>[s("div",$t,[(_(!0),L(Z,null,Q(a.value.asset.pivot_warranties,S=>(_(),b(E,{class:"my-3 px-5",key:S.id},{default:t(()=>[e(N,null,{default:t(()=>[e(h,null,{default:t(()=>[e(w,{cols:"4"},{default:t(()=>[p("Vendor")]),_:1}),e(w,{cols:"8"},{default:t(()=>[p(V(S.vendor.title),1)]),_:2},1024),e(w,{cols:"4"},{default:t(()=>[p("Warranty Start Date")]),_:1}),e(w,{cols:"8"},{default:t(()=>[p(V(v(O)(S.warranty_start_date)),1)]),_:2},1024),e(w,{cols:"4"},{default:t(()=>[p("Warranty End Date")]),_:1}),e(w,{cols:"8"},{default:t(()=>[p(V(v(O)(S.warranty_end_date)),1)]),_:2},1024),e(w,{cols:"4"},{default:t(()=>[p("AMC Start Date")]),_:1}),e(w,{cols:"8"},{default:t(()=>[p(V(v(O)(S.amc_start_date)),1)]),_:2},1024),e(w,{cols:"4"},{default:t(()=>[p("AMC End Date")]),_:1}),e(w,{cols:"8"},{default:t(()=>[p(V(v(O)(S.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(_(),b(E,{key:1,class:"mt-2"},{default:t(()=>[e(N,null,{default:t(()=>[At]),_:1})]),_:1}))])):C.value&&g.value=="attachment"?(_(),b(Xe,{key:2,"incident-id":v(y).params.id,attachment:a.value.attachment,onSave:A,objectdata:a.value},null,8,["incident-id","attachment","objectdata"])):(q.value=="superadmin"||q.value=="admin"||q.value=="technical-operation"||q.value=="facility")&&C.value&&g.value=="facility"?(_(),b(rt,{key:3,objectdata:a.value,onSaved:A},null,8,["objectdata"])):U("",!0)]}),_:1})]),_:1}),e(Oe,{options:c.value},null,8,["options"]),e(ve,{width:"500",modelValue:k.value,"onUpdate:modelValue":l[17]||(l[17]=I=>k.value=I)},{default:t(()=>[e(E,null,{default:t(()=>[e(N,null,{default:t(()=>[e(v(Pe),{onDecode:fe,onLoaded:ye})]),_:1}),ee.value?U("",!0):(_(),b(N,{key:0},{default:t(()=>[p("Please wait...")]),_:1})),e(Re,null,{default:t(()=>[e(Ie),e(D,{text:"Close",onClick:l[16]||(l[16]=I=>k.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Wt=We(Rt,[["__scopeId","data-v-8f6a4dad"]]);export{Wt as D};
