import{r as s,i as Z,u as ee,N as te,O as ae,o as le,j as y,k as u,C as se,D as w,b as f,l as o,e as l,A as oe,V as ne,y as ie,x as ue,E as U,P as _,H as de,m as x,c as B,d as re,t as d,Q as ce,K as g,J as T,R as pe,S as ve,I as D,F as me,T as fe,U as ge}from"./app-e4d77826.js";import{_ as he}from"./ApppageHeader-8b87b5ae.js";import{d as ye,e as _e}from"./encrypt-41ba3cb7.js";import{_ as xe}from"./AppSnackBar-5cb5f575.js";import{u as F}from"./formatDate-b9aad8c5.js";const Ve={class:"v-col-12"},Ce=l("div",{class:"mr-auto"},"Asset Requests",-1),be={class:"v-col-12 v-col-md"},ke={class:"v-col-12 v-col-md"},Se={class:"v-col-12 v-col-md"},we={class:"v-col-12 v-col-md"},De=l("th",{class:"text-left text-capitalize"},"SN No.",-1),Re=l("br",null,null,-1),je=l("small",null,"(DD/MM/YY)",-1),qe=l("br",null,null,-1),ze=l("small",null,"(DD/MM/YY)",-1),Ne=l("th",{class:"text-right text-capitalize"},null,-1),Ae={class:"d-flex align-center justify-end"},Fe={__name:"List",setup($e){const I=s({status:!1,type:"primary",text:null}),r=Z(),R=ee(),V=te(),i=s({loading:!1,data:[]}),C=s(0),O=s(0),m=s(""),K=s([10,20,50,100]),b=s(10),c=s({}),M=()=>{v()},k=()=>{S.value="",n.value==1?v():n.value=1},j=()=>{localStorage.setItem("request-asset-search",_e(m.value)),v()},E=()=>{m.value="",localStorage.setItem("request-asset-search",""),v()},n=s(V.params&&V.params.page?V.params.page:1),h=s([]),S=s(""),q=s(0),p=t=>{i.value.loading=!0,h.value[0]=t,q.value%2?h.value[1]="DESC":h.value[1]="ASC",q.value++,S.value=JSON.stringify(h.value),v()},z=s([]),Y=async()=>{await w(r.token).get("/api/fetch/companies").then(t=>{z.value=t.data}).catch(t=>{})},N=s([]),J=async()=>{await w(r.token).get("/api/fetch/locations/non-paginated/data").then(t=>{N.value=t.data}).catch(t=>{})},H=s([{id:"pending",title:"Pending"},{id:"awaiting-approval",title:"Awaiting Approval"},{id:"reject",title:"Rejected"},{id:"cancelled",title:"Cancelled"},{id:"complete",title:"Completed"}]),Q=t=>t=="reject"?"Rejected":t=="complete"?"Completed":t,v=async()=>{i.value.loading=!0,await w(r.token).get("/api/fetch/request-assets/by-requestor/request?userid="+r.user.profile.id+"&role="+r.user.profile.role+"&page="+n.value+"&show="+b.value+"&search="+m.value+"&sort="+S.value+"&filter="+JSON.stringify(c.value)).then(t=>{console.log("dataobj.value",i.value),C.value=t.data.last_page?t.data.last_page:t.data.length,n.value=t.data.current_page?t.data.current_page:n.value,O.value=t.data.total?t.data.total:t.data.length,i.value.data=t.data.data?t.data.data:t.data,i.value.loading=!1}).catch(t=>{i.value.loading=!1,console.log(t)})};ae(n,(t,a)=>{n.value&&t!=a&&(R.push({name:"PaginatedRequestAsset",params:{page:n.value}}).catch(e=>{}),v(n.value))});const G=t=>{R.push({name:"EditRequestAsset",params:{id:t}}).catch(a=>{console.log(a)})},W=t=>{console.log("delete",t)},X=(t,a=6)=>{let e="00000"+t;return e.substring(e.length-a)};return le(()=>{let t=localStorage.getItem("request-asset-search");t&&(m.value=ye(t)),v().then(()=>{Y().then(()=>{J()})})}),(t,a)=>(f(),y(se,null,{default:u(()=>[o(he,{title:"Asset request page"}),o(U,{class:"mb-3"},{default:u(()=>[l("div",Ve,[o(oe,{loading:i.value.loading},{default:u(()=>[o(ne,{class:"d-flex align-center mb-3 pa-3"},{default:u(()=>[Ce,o(ie,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. SN-5000035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":j,onKeydown:ue(j,["enter"]),"onClick:clear":a[1]||(a[1]=e=>E("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(U,{class:"px-3"},{default:u(()=>[l("div",be,[o(_,{items:z.value,modelValue:c.value.company_id,"onUpdate:modelValue":[a[2]||(a[2]=e=>c.value.company_id=e),k],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",ke,[o(_,{items:N.value,modelValue:c.value.location_id,"onUpdate:modelValue":[a[3]||(a[3]=e=>c.value.location_id=e),k],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",Se,[o(_,{items:H.value,modelValue:c.value.status,"onUpdate:modelValue":[a[4]||(a[4]=e=>c.value.status=e),k],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])]),l("div",we,[o(_,{items:K.value,modelValue:b.value,"onUpdate:modelValue":[a[5]||(a[5]=e=>b.value=e),M],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),o(de,null,{default:u(()=>[l("thead",null,[l("tr",null,[De,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[6]||(a[6]=e=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[7]||(a[7]=e=>p("transferred_to"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[8]||(a[8]=e=>p("subject"))}," Subject "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[9]||(a[9]=e=>p("profile_id"))}," Requestor "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[10]||(a[10]=e=>p("status"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[11]||(a[11]=e=>p("created_at"))},[x(" D.Requested"),Re,je]),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[12]||(a[12]=e=>p("date_closed"))},[x(" D.Closed"),qe,ze]),Ne])]),l("tbody",null,[(f(!0),B(me,null,re(i.value.data,e=>{var A,$,L,P;return f(),B("tr",{key:e.id},[l("td",null,"SN-5"+d(X(e.id)),1),l("td",null,d((A=e.company)==null?void 0:A.title),1),l("td",null,d(($=e.transfer_to)==null?void 0:$.title),1),l("td",null,d(e.subject),1),l("td",null,d((L=e.profile)==null?void 0:L.display_name),1),l("td",null,[o(ce,{class:"text-uppercase",size:"small",color:`${e.status.toLowerCase()=="complete"?"success":"error"}`},{default:u(()=>[x(d(Q(e.status)),1)]),_:2},1032,["color"])]),l("td",null,d(g(F)(e.created_at)),1),l("td",null,d(e.date_closed&&e.date_closed!="0000-00-00"?g(F)(e.date_closed):""),1),l("td",null,[l("div",Ae,[o(T,{size:"small",onClick:()=>G(e.id),icon:g(pe),class:"mx-1"},null,8,["onClick","icon"]),g(r).user.role=="superadmin"||(P=g(r).capabilities)!=null&&P.includes("delete")?(f(),y(T,{key:0,size:"small",onClick:()=>W(e.id),icon:g(ve),class:"mx-1"},null,8,["onClick","icon"])):D("",!0)])])])}),128))])]),_:1}),i.value.data.length==0?(f(),y(fe,{key:0,class:"pa-3 text-center w-100"},{default:u(()=>[x("No records found")]),_:1})):D("",!0)]),_:1},8,["loading"]),C.value>1?(f(),y(ge,{key:0,modelValue:n.value,"onUpdate:modelValue":a[13]||(a[13]=e=>n.value=e),class:"my-4",length:C.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:i.value.loading},null,8,["modelValue","length","disabled"])):D("",!0)])]),_:1}),o(xe,{options:I.value},null,8,["options"])]),_:1}))}};export{Fe as default};
