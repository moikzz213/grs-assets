import{r as s,a as ot,u as st,G as it,H as nt,I as dt,c as D,w as r,m as ct,n as _,o as I,d as i,b as l,k as rt,V as ut,i as pt,h as mt,s as J,J as C,x as vt,e as L,p as j,q as ft,t as d,K as yt,y as q,C as gt,L as ht,F as St,M as xt,z as Y,N as Vt}from"./app-d4dc0ab9.js";import{_ as _t}from"./ApppageHeader-f5b31502.js";import{d as f,e as y}from"./encrypt-299d069b.js";import{_ as It}from"./AppSnackBar-9141c4ac.js";import{u as Ct}from"./formatDate-b9aad8c5.js";const bt={class:"v-col-12"},kt=l("div",{class:"mr-auto"},"Asset Incidents",-1),wt={class:"v-col-12 v-col-md"},$t={class:"v-col-12 v-col-md"},zt={class:"v-col-12 v-col-md"},Dt={class:"v-col-12 v-col-md"},Lt={class:"v-col-12 v-col-md"},Rt=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Bt=l("th",{class:"text-left text-capitalize"},"Urgency",-1),Nt=l("th",{class:"text-left text-capitalize"},"Type",-1),Ut=l("br",null,null,-1),At=l("small",null,"(DD/MM/YY)",-1),Pt=l("th",{class:"text-right text-capitalize last-child-action"},null,-1),Tt={class:"last-child-action"},Ft={class:"d-flex align-center justify-end"},qt={__name:"List",setup(Kt){const G=s({status:!1,type:"primary",text:null}),u=ot(),R=st(),w=it(),c=s({loading:!1,data:[]}),$=s(0),H=s(0),v=s(""),Q=s([10,20,50,100]),g=s(10),o=s({}),W=()=>{localStorage.setItem("incident-filter-row",y(g.value)),m()},b=a=>{z.value="",n.value==1?(a=="company"?localStorage.setItem("incident-filter-company",y(o.value.company_id)):a=="location"?localStorage.setItem("incident-filter-location",y(o.value.location_id)):a=="type"?localStorage.setItem("incident-filter-type",y(o.value.type_id)):a=="status"&&localStorage.setItem("incident-filter-status",y(o.value.status_id)),m()):n.value=1},B=()=>{localStorage.setItem("incident-search",y(v.value)),m()},h=a=>{a=="search"?(v.value="",localStorage.setItem("incident-search",""),m()):a=="company"?localStorage.setItem("incident-filter-company",""):a=="location"?localStorage.setItem("incident-filter-location",""):a=="type"?localStorage.setItem("incident-filter-type",""):a=="status"&&localStorage.setItem("incident-filter-status","")},n=s(w.params&&w.params.page?w.params.page:1),k=s([]),z=s(""),N=s(0),p=a=>{c.value.loading=!0,k.value[0]=a,N.value%2?k.value[1]="DESC":k.value[1]="ASC",N.value++,z.value=JSON.stringify(k.value),m()},U=s([]),X=async()=>{await _(u.token).get("/api/fetch/companies").then(a=>{U.value=a.data}).catch(a=>{})},A=s([]),Z=async()=>{await _(u.token).get("/api/fetch/locations/non-paginated/data").then(a=>{A.value=a.data}).catch(a=>{})},P=s([]),tt=async()=>{await _(u.token).get("/api/fetch-global/incident-types/active").then(a=>{P.value=a.data}).catch(a=>{})},T=s([]),et=async()=>{await _(u.token).get("/api/fetch-global/incident-status/active").then(a=>{T.value=a.data}).catch(a=>{})},m=async()=>{c.value.loading=!0,await _(u.token).get("/api/fetch/incidents-by/users?userid="+u.user.profile.id+"&role="+u.user.profile.role+"&page="+n.value+"&show="+g.value+"&search="+v.value+"&sort="+z.value+"&filter="+JSON.stringify(o.value)).then(a=>{$.value=a.data.last_page?a.data.last_page:a.data.length,n.value=a.data.current_page?a.data.current_page:n.value,H.value=a.data.total?a.data.total:a.data.length,c.value.data=a.data.data?a.data.data:a.data,c.value.loading=!1}).catch(a=>{c.value.loading=!1,localStorage.setItem("incident-search",null),localStorage.setItem("incident-filter-company",null),localStorage.setItem("incident-filter-location",null),localStorage.setItem("incident-filter-type",null),localStorage.setItem("incident-filter-status",null),localStorage.setItem("incident-filter-row",10)})};nt(n,(a,t)=>{n.value&&a!=t&&(R.push({name:"PaginatedIncidents",params:{page:n.value}}).catch(e=>{}),m(n.value))});const at=a=>{R.push({name:"EditIncident",params:{id:a},query:{type:"details"}}).catch(t=>{})},lt=(a,t=5)=>{let e="0000"+a;return e.substring(e.length-t)};return dt(()=>{let a=localStorage.getItem("incident-search"),t=localStorage.getItem("incident-filter-company"),e=localStorage.getItem("incident-filter-location"),S=localStorage.getItem("incident-filter-type"),x=localStorage.getItem("incident-filter-status"),V=localStorage.getItem("incident-filter-row");a&&(v.value=f(a)),t&&(o.value.company_id=f(t)),e&&(o.value.location_id=f(e)),S&&(o.value.type_id=f(S)),x&&(o.value.status_id=f(x)),V&&(g.value=f(V)),m().then(()=>{X(),Z(),tt().then(()=>{et()})})}),(a,t)=>(I(),D(ct,null,{default:r(()=>[i(_t,{title:"Asset Incident Page"}),i(J,{class:"mb-3"},{default:r(()=>[l("div",bt,[i(rt,{loading:c.value.loading},{default:r(()=>[i(ut,{class:"d-flex align-center mb-3 pa-3"},{default:r(()=>[kt,i(pt,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-200035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":B,onKeydown:mt(B,["enter"]),"onClick:clear":t[1]||(t[1]=e=>h("search"))},null,8,["modelValue","onKeydown"])]),_:1}),i(J,{class:"px-3"},{default:r(()=>[l("div",wt,[i(C,{items:U.value,modelValue:o.value.company_id,"onUpdate:modelValue":[t[2]||(t[2]=e=>o.value.company_id=e),t[3]||(t[3]=e=>b("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company","onClick:clear":t[4]||(t[4]=e=>h("company"))},null,8,["items","modelValue"])]),l("div",$t,[i(C,{items:A.value,modelValue:o.value.location_id,"onUpdate:modelValue":[t[5]||(t[5]=e=>o.value.location_id=e),t[6]||(t[6]=e=>b("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title","onClick:clear":t[7]||(t[7]=e=>h("location"))},null,8,["items","modelValue"])]),l("div",zt,[i(C,{items:P.value,modelValue:o.value.type_id,"onUpdate:modelValue":[t[8]||(t[8]=e=>o.value.type_id=e),t[9]||(t[9]=e=>b("type"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"","onClick:clear":t[10]||(t[10]=e=>h("type")),label:"Type"},null,8,["items","modelValue"])]),l("div",Dt,[i(C,{items:T.value,modelValue:o.value.status_id,"onUpdate:modelValue":[t[11]||(t[11]=e=>o.value.status_id=e),t[12]||(t[12]=e=>b("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"","onClick:clear":t[13]||(t[13]=e=>h("status")),label:"Status"},null,8,["items","modelValue"])]),l("div",Lt,[i(C,{items:Q.value,modelValue:g.value,"onUpdate:modelValue":[t[14]||(t[14]=e=>g.value=e),W],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),i(vt,null,{default:r(()=>[l("thead",null,[l("tr",null,[Rt,Bt,Nt,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[15]||(t[15]=e=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[16]||(t[16]=e=>p("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[17]||(t[17]=e=>p("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[18]||(t[18]=e=>p("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[19]||(t[19]=e=>p("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[20]||(t[20]=e=>p("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[21]||(t[21]=e=>p("created_at"))},[L(" D.Created"),Ut,At]),Pt])]),l("tbody",null,[(I(!0),j(St,null,ft(c.value.data,e=>{var S,x,V,F,K,O,M;return I(),j("tr",{key:e.id},[l("td",null,"ISR-2"+d(lt(e.id)),1),l("td",null,d((S=e.urgency)==null?void 0:S.title),1),l("td",null,d((x=e.type)==null?void 0:x.title),1),l("td",null,d((V=e.company)==null?void 0:V.title),1),l("td",null,d((F=e.location)==null?void 0:F.title),1),l("td",null,d(e.asset?e.asset.asset_name:e.title),1),l("td",null,d((K=e.asset)==null?void 0:K.asset_code),1),l("td",null,d((O=e.profile)==null?void 0:O.display_name),1),l("td",null,[i(yt,{class:"text-uppercase",size:"small",color:`${(M=e.status)==null?void 0:M.color}`},{default:r(()=>{var E;return[L(d((E=e.status)==null?void 0:E.title),1)]}),_:2},1032,["color"])]),l("td",null,d(q(Ct)(e.created_at)),1),l("td",Tt,[l("div",Ft,[i(gt,{size:"small",onClick:()=>at(e.id),icon:q(ht),class:"mx-1"},null,8,["onClick","icon"])])])])}),128))])]),_:1}),c.value.data.length==0?(I(),D(xt,{key:0,class:"pa-3 text-center w-100"},{default:r(()=>[L("No records found")]),_:1})):Y("",!0)]),_:1},8,["loading"]),$.value>1?(I(),D(Vt,{key:0,modelValue:n.value,"onUpdate:modelValue":t[22]||(t[22]=e=>n.value=e),class:"my-4",length:$.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:c.value.loading},null,8,["modelValue","length","disabled"])):Y("",!0)])]),_:1}),i(It,{options:G.value},null,8,["options"])]),_:1}))}};export{qt as default};
