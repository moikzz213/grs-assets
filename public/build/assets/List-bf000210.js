import{r as o,a as ae,u as se,G as oe,H as ie,I as ne,c as I,w as m,m as re,n as $,o as g,d as i,b as a,k as ue,V as de,i as ce,h as me,s as K,J as b,x as pe,e as q,p as O,q as ve,ad as fe,y as v,t as d,K as ge,C as E,L as ye,j as he,af as xe,z as A,F as Ce,M as Se,N as Ve}from"./app-94f44a31.js";import{_ as _e}from"./AppPageHeader-2639af27.js";import{d as y,e as h}from"./encrypt-ebec46d8.js";import{_ as be}from"./AppSnackBar-583d19ac.js";import{u as Y}from"./formatDate-559e9d83.js";const qe={class:"v-col-12"},ke=a("div",{class:"mr-auto"},"Asset Requests",-1),we={class:"v-col-12 v-col-md"},Ie={class:"v-col-12 v-col-md"},$e={class:"v-col-12 v-col-md"},ze={class:"v-col-12 v-col-md-2"},De={class:"v-col-12 v-col-md-2"},Ne=a("th",{class:"text-left text-capitalize"},"SN No.",-1),Re=a("br",null,null,-1),Le=a("small",null,"PENDING",-1),je=a("br",null,null,-1),Ae=a("small",null,"(DD/MM/YY)",-1),Pe=a("br",null,null,-1),Be=a("small",null,"(DD/MM/YY)",-1),Te=a("th",{class:"text-right text-capitalize last-child-action"},null,-1),Fe={class:"last-child-action"},Ue={class:"d-flex align-center justify-end"},Ge={__name:"List",setup(Me){const z=o({status:!1,type:"primary",text:null}),r=ae(),P=se(),D=oe(),u=o({loading:!1,data:[]}),N=o(0),J=o(0),f=o(""),G=o([10,20,50,100]),x=o(10),s=o({}),H=()=>{localStorage.setItem("request-filter-row",h(x.value)),p()},k=l=>{R.value="",n.value==1?(l=="company"?localStorage.setItem("request-filter-company",h(s.value.company_id)):l=="location"?localStorage.setItem("request-filter-location",h(s.value.location_id)):l=="from"?localStorage.setItem("request-filter-from",h(s.value.from)):l=="status"&&localStorage.setItem("request-filter-status",h(s.value.status)),p()):n.value=1},B=()=>{localStorage.setItem("request-asset-search",h(f.value)),p()},C=l=>{l=="search"?(f.value="",localStorage.setItem("request-asset-search",""),p()):l=="company"?localStorage.setItem("request-filter-company",""):l=="location"?localStorage.setItem("request-filter-location",""):l=="from"?localStorage.setItem("request-filter-from",""):l=="status"&&localStorage.setItem("request-filter-status","")},n=o(D.params&&D.params.page?D.params.page:1),w=o([]),R=o(""),T=o(0),c=l=>{u.value.loading=!0,w.value[0]=l,T.value%2?w.value[1]="DESC":w.value[1]="ASC",T.value++,R.value=JSON.stringify(w.value),p()},F=o([]),Q=async()=>{await $(r.token).get("/api/fetch/companies").then(l=>{F.value=l.data}).catch(l=>{})},L=o([]),W=async()=>{await $(r.token).get("/api/fetch/locations/non-paginated/data").then(l=>{L.value=l.data}).catch(l=>{})},X=o([{id:"pending",title:"Pending"},{id:"awaiting-approval",title:"Awaiting Approval"},{id:"reject",title:"Rejected"},{id:"cancelled",title:"Cancelled"},{id:"complete",title:"Completed"},{id:"trash",title:"Trashed"}]),Z=l=>l=="reject"?"Rejected":l=="complete"?"Completed":l,p=async()=>{u.value.loading=!0,await $(r.token).get("/api/fetch/request-assets/by-requestor/request?userid="+r.user.profile.id+"&role="+r.user.profile.role+"&page="+n.value+"&show="+x.value+"&search="+f.value+"&sort="+R.value+"&filter="+JSON.stringify(s.value)).then(l=>{N.value=l.data.last_page?l.data.last_page:l.data.length,n.value=l.data.current_page?l.data.current_page:n.value,J.value=l.data.total?l.data.total:l.data.length,u.value.data=l.data.data?l.data.data:l.data,u.value.loading=!1}).catch(l=>{u.value.loading=!1,localStorage.setItem("request-filter-company",null),localStorage.setItem("request-filter-location",null),localStorage.setItem("request-filter-from",null),localStorage.setItem("request-filter-status",null),localStorage.setItem("request-filter-row",10)})};ie(n,(l,e)=>{n.value&&l!=e&&(P.push({name:"PaginatedRequestAsset",params:{page:n.value}}).catch(t=>{}),p(n.value))});const ee=l=>{P.push({name:"EditRequestAsset",params:{id:l}}).catch(e=>{console.log(e)})},j=o(!1),te=async l=>{z.value={status:!0,type:"info",text:"Removing data...Please wait."},j.value=!0,await $(r.token).put("/api/remove/asset/"+l).then(e=>{p().then(()=>{j.value=!1,z.value={status:!0,type:"success",text:"Data has been deleted."}})}).catch(e=>{u.value.loading=!1})},le=(l,e=6)=>{let t="00000"+l;return t.substring(t.length-e)};return ne(()=>{let l=localStorage.getItem("request-asset-search"),e=localStorage.getItem("request-filter-company"),t=localStorage.getItem("request-filter-location"),S=localStorage.getItem("request-filter-from"),V=localStorage.getItem("request-filter-status"),_=localStorage.getItem("request-filter-row");l&&(f.value=y(l)),e&&(s.value.company_id=y(e)),t&&(s.value.location_id=y(t)),S&&(s.value.from=y(S)),V&&(s.value.status=y(V)),_&&(x.value=y(_)),p().then(()=>{Q().then(()=>{W()})})}),(l,e)=>(g(),I(re,null,{default:m(()=>[i(_e,{title:"Asset request page"}),i(K,{class:"mb-3"},{default:m(()=>[a("div",qe,[i(ue,{loading:u.value.loading},{default:m(()=>[i(de,{class:"d-flex align-center mb-3 pa-3"},{default:m(()=>[ke,i(ce,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. SN-5000035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":B,onKeydown:me(B,["enter"]),"onClick:clear":e[1]||(e[1]=t=>C("search"))},null,8,["modelValue","onKeydown"])]),_:1}),i(K,{class:"px-3"},{default:m(()=>[a("div",we,[i(b,{items:F.value,modelValue:s.value.company_id,"onUpdate:modelValue":[e[2]||(e[2]=t=>s.value.company_id=t),e[3]||(e[3]=t=>k("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company","onClick:clear":e[4]||(e[4]=t=>C("company"))},null,8,["items","modelValue"])]),a("div",Ie,[i(b,{items:L.value,modelValue:s.value.from,"onUpdate:modelValue":[e[5]||(e[5]=t=>s.value.from=t),e[6]||(e[6]=t=>k("from"))],variant:"outlined",density:"compact","hide-details":"",label:"Location From","item-value":"id",clearable:"","item-title":"title","onClick:clear":e[7]||(e[7]=t=>C("from"))},null,8,["items","modelValue"])]),a("div",$e,[i(b,{items:L.value,modelValue:s.value.location_id,"onUpdate:modelValue":[e[8]||(e[8]=t=>s.value.location_id=t),e[9]||(e[9]=t=>k("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location To","item-value":"id",clearable:"","item-title":"title","onClick:clear":e[10]||(e[10]=t=>C("location"))},null,8,["items","modelValue"])]),a("div",ze,[i(b,{items:X.value,modelValue:s.value.status,"onUpdate:modelValue":[e[11]||(e[11]=t=>s.value.status=t),e[12]||(e[12]=t=>k("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status","onClick:clear":e[13]||(e[13]=t=>C("status"))},null,8,["items","modelValue"])]),a("div",De,[i(b,{items:G.value,modelValue:x.value,"onUpdate:modelValue":[e[14]||(e[14]=t=>x.value=t),H],variant:"outlined",density:"compact","hide-details":"",label:"Show"},null,8,["items","modelValue"])])]),_:1}),i(pe,null,{default:m(()=>[a("thead",null,[a("tr",null,[Ne,a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[15]||(e[15]=t=>c("company_id"))}," Company "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[16]||(e[16]=t=>c("transferred_from"))}," From "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[17]||(e[17]=t=>c("transferred_to"))}," To "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[18]||(e[18]=t=>c("subject"))}," Subject "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[19]||(e[19]=t=>c("profile_id"))}," Requestor "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[20]||(e[20]=t=>c("reminder_profile_id"))},[q(" Approval"),Re,Le]),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[21]||(e[21]=t=>c("status"))}," Status "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[22]||(e[22]=t=>c("created_at"))},[q(" D.Requested"),je,Ae]),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[23]||(e[23]=t=>c("date_closed"))},[q(" D.Closed"),Pe,Be]),Te])]),a("tbody",null,[(g(!0),O(Ce,null,ve(u.value.data,t=>{var S,V,_,U,M;return g(),O("tr",{key:t.id,class:fe(`${v(r).user.profile.id==t.reminder_profile_id?"bg-blue-lighten-5":""} `)},[a("td",null,"SN-5"+d(le(t.id)),1),a("td",null,d((S=t.company)==null?void 0:S.title),1),a("td",null,d((V=t.transfer_from)==null?void 0:V.title),1),a("td",null,d((_=t.transfer_to)==null?void 0:_.title),1),a("td",null,d(t.subject),1),a("td",null,d((U=t.profile)==null?void 0:U.display_name),1),a("td",null,d((M=t.reminder_profile)==null?void 0:M.display_name),1),a("td",null,[i(ge,{class:"text-uppercase",size:"small",color:`${t.status.toLowerCase()=="complete"?"success":t.status.toLowerCase()=="pending"||t.status.toLowerCase()=="awaiting-approval"?"warning":"error"}`},{default:m(()=>[q(d(Z(t.status)),1)]),_:2},1032,["color"])]),a("td",null,d(v(Y)(t.created_at)),1),a("td",null,d(t.date_closed&&t.date_closed!="0000-00-00"?v(Y)(t.date_closed):""),1),a("td",Fe,[a("div",Ue,[i(E,{size:"small",onClick:()=>ee(t.id),icon:v(ye),class:"mr-3"},null,8,["onClick","icon"]),v(r).user.role=="superadmin"||v(r).user.role=="asset-supervisor"||v(r).user.role=="commercial-manager"?(g(),I(he,{key:0,size:"x-small",loading:j.value,text:"",variant:"text",onClick:()=>te(t.id)},{default:m(()=>[i(E,{icon:v(xe),class:"mx-1"},null,8,["icon"])]),_:2},1032,["loading","onClick"])):A("",!0)])])],2)}),128))])]),_:1}),u.value.data.length==0?(g(),I(Se,{key:0,class:"pa-3 text-center w-100"},{default:m(()=>[q("No records found")]),_:1})):A("",!0)]),_:1},8,["loading"]),N.value>1?(g(),I(Ve,{key:0,modelValue:n.value,"onUpdate:modelValue":e[24]||(e[24]=t=>n.value=t),class:"my-4",length:N.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:u.value.loading},null,8,["modelValue","length","disabled"])):A("",!0)])]),_:1}),i(be,{options:z.value},null,8,["options"])]),_:1}))}};export{Ge as default};
