import{i as te,r as m,X as ye,o as ae,O as Y,b as _,c as I,e as o,l as t,k as l,E as y,j as b,F as X,d as Z,z as D,K as p,Y as he,A as q,Z as de,_ as ue,$ as be,a0 as Ve,U as ge,m as g,D as w,q as H,t as k,P as J,a1 as ce,M as W,N as ke,u as je,G as xe,a2 as Q,I as R,V as Se,a3 as M,a4 as N,y as ne,J as $e,L as we,a5 as Ce,Q as Ue,C as De}from"./app-228560df.js";import{_ as Te}from"./AppPageHeader-476ce8e2.js";import{_ as Ae}from"./AppSnackBar-c33aa6d2.js";import{c as Re,a as O,F as Ie,b as P}from"./index.esm-15d57521.js";import{S as Le}from"./StreamBarcodeReader-a11301ff.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{u as ee,a as Fe}from"./formatDate-e2fbee14.js";import{_ as Be}from"./Studio-ffa2900c.js";const Ne={class:"v-col-12 pt-5"},Oe={class:"v-col-12 pb-2"},Pe={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},qe={class:"v-col-12 pt-0 pb-2"},ze={class:"v-col-12"},Me={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(L,{emit:E}){const i=L,v=te(),e=m(window.location.origin),c=d=>{let r=null;d.map(s=>{r=f.value.find(j=>j.id==s.id),r||f.value.push(s)})},C=m(!1),U=m(1),T=d=>{U.value=d,C.value=!0},F=d=>{f.value=f.value.filter(r=>r.id!==d)},f=m([]),A=ye(()=>f.value.map(d=>d.id)),h=()=>{let d={id:parseInt(i.incidentId),file_ids:A.value,profile_id:i.objectdata.profile_id};w(v.token).post("/api/incident/sync-images/store-update",d).then(r=>{let s="Attachment has been updated";A.value.length==0&&(s="Attachment has been deleted"),E("save",s)}).catch(r=>{})};return ae(()=>{f.value=i.attachment}),Y(()=>i.objectdata.attachment,(d,r)=>{f.value=d},{deep:!0}),(d,r)=>(_(),I("div",null,[o("div",Ne,[t(y,null,{default:l(()=>[o("div",Oe,[t(Be,{options:{multiSelect:!0,type:"incident"},onSelect:c})])]),_:1}),f.value.length>0?(_(),b(y,{key:0,class:"px-1"},{default:l(()=>[(_(!0),I(X,null,Z(f.value,(s,j)=>(_(),I("div",{key:s.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[t(D,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:p(he),size:"26px",color:"error",onClick:()=>F(s.id)},null,8,["icon","onClick"]),t(q,{onClick:()=>T(j)},{default:l(()=>[t(de,{src:e.value+"/file/"+s.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(ue,{modelValue:C.value,"onUpdate:modelValue":r[1]||(r[1]=s=>C.value=s),width:"95%","max-width":"900"},{default:l(()=>[t(q,{class:"bg-black"},{default:l(()=>[t(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:U.value,"onUpdate:modelValue":r[0]||(r[0]=s=>U.value=s)},{default:l(()=>[(_(!0),I(X,null,Z(f.value,(s,j)=>(_(),b(Ve,{key:j,"reverse-transition":"fade",transition:"fade"},{default:l(()=>[o("div",Pe,[t(de,{src:e.value+"/file/"+s.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(_(),b(y,{key:1},{default:l(()=>[o("div",qe,[t(ge,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:l(()=>[g(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),t(y,null,{default:l(()=>[o("div",ze,[t(D,{color:"primary",onClick:h},{default:l(()=>[g("Save")]),_:1})])]),_:1})])]))}},He={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Ye={class:"font-weight-bold"},Ke={class:"reported-by"},Ge={class:"reported-by"},Je={class:"v-col-12"},Qe={class:"v-col-12 v-col-md-4 pb-0"},Xe={class:"v-col-12 v-col-md-8"},Ze={class:"v-col-12"},We={class:"v-col-12"},et={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},tt={class:"v-col-3"},at=o("br",null,null,-1),lt={class:"v-col-9"},st={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(L,{emit:E}){const i=L,v=te(),e=m(v.user.profile.role),c=m({}),C=m([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),U=m([]),T=async()=>{await w(v.token).get("/api/fetch/profile-facility/team").then(d=>{U.value=d.data}).catch(d=>{})},F=()=>{c.value.profile_id=v.user.profile.id,w(v.token).post("/api/incident/update-facility-team",c.value).then(d=>{c.value.remarks_data="",E("saved",d.data.message)}).catch(d=>{})},f=m([]),A=async()=>{await w(v.token).get("/api/fetch-global/incident-status/active").then(d=>{f.value=d.data}).catch(d=>{})},h=(d,r=6)=>{let s="00000"+d;return s.substring(s.length-r)};return ae(()=>{T(),A(),c.value=i.objectdata,c.value.priority=i.objectdata.priority?parseInt(i.objectdata.priority):null}),Y(()=>i.objectdata.remarks,(d,r)=>{c.value.remarks=d},{deep:!0}),(d,r)=>(_(),I("div",null,[t(q,null,{default:l(()=>[t(H,null,{default:l(()=>[t(y,null,{default:l(()=>{var s;return[o("div",He,[o("div",Ye," SN: ISR-"+k(h(c.value.id)),1),o("div",Ke," REPORTED BY: "+k((s=c.value.profile)==null?void 0:s.display_name),1),o("div",Ge," DATE REPORTED: "+k(p(ee)(c.value.created_at)),1)])]}),_:1}),t(y,null,{default:l(()=>[o("div",Je,[t(y,null,{default:l(()=>[o("div",Qe,[t(J,{items:C.value,modelValue:c.value.priority,"onUpdate:modelValue":r[0]||(r[0]=s=>c.value.priority=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:e.value=="facility"},null,8,["items","modelValue","disabled"]),t(J,{items:U.value,modelValue:c.value.handled_by,"onUpdate:modelValue":r[1]||(r[1]=s=>c.value.handled_by=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:e.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),t(J,{items:f.value,modelValue:c.value.status_id,"onUpdate:modelValue":r[2]||(r[2]=s=>c.value.status_id=s),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),o("div",Xe,[t(ce,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:c.value.remarks_data,"onUpdate:modelValue":r[3]||(r[3]=s=>c.value.remarks_data=s)},null,8,["modelValue"])])]),_:1})]),t(W,{class:"mt-3"}),o("div",Ze,[t(D,{class:"",size:"small",disabled:!c.value.priority||!c.value.handled_by||!c.value.status_id,onClick:F,color:"primary"},{default:l(()=>[g("Submit")]),_:1},8,["disabled"])])]),_:1}),t(y,null,{default:l(()=>[o("div",We,[g(" Remarks "),t(W)]),o("div",et,[(_(!0),I(X,null,Z(c.value.remarks,s=>(_(),b(y,{key:d.id},{default:l(()=>{var j;return[o("div",tt,[g(k((j=s.profile)==null?void 0:j.display_name)+" ",1),at,g(),o("small",null,k(p(Fe)(s.created_at)),1)]),o("div",lt,k(s.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const ot={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},it={class:"font-weight-bold"},dt={class:"reported-by"},nt={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},ut={class:"v-col-12 v-col-md-3"},ct={class:"v-col-12 v-col-md-3"},rt={class:"v-col-12 v-col-md-6 d-flex"},mt={class:"v-col-12"},vt={class:"v-col-12 v-col-md-12"},pt={class:"v-col-12 v-col-md-3"},_t={class:"v-col-12"},ft={class:"v-col-12"},yt={class:"v-col-12 v-col-md-9"},ht={class:"v-col-12 v-col-md-6"},bt={class:"v-col-12 v-col-md-3"},Vt={class:"v-col-12 v-col-md-3"},gt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(L,{emit:E}){const i=L,v=te(),e=m({}),c=m({}),C=n=>{c.value={status:!0,type:"success",text:n},E("saved")},U=m(v.user.profile.id),T=m([]),F=async()=>{await w(v.token).get("/api/fetch-global/incident-types/active").then(n=>{T.value=n.data}).catch(n=>{})},f=ke(),A=je(),h=m(f.query.type),d=m([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let r=Re({Type:O().required(),Urgency:O().required(),Title:O().required(),Company:O().required(),Location:O().required()});const s=m(!1),j=()=>{K.value=!1,s.value=!0},re=async n=>{e.value.asset_code=n,await w(v.token).get("/api/fetch/asset-info/by/asset-code/"+n).then(a=>{e.value.title=a.data.asset_name,e.value.company_id=a.data.company_id,e.value.location_id=a.data.location_id,e.value.asset_id=a.data.id,s.value=!1}).catch(a=>{})},K=m(!1),me=()=>{K.value=!0},le=new URL(window.location),G=n=>{h.value=n,se("type",n)},z=m(!1),B=m(v.user.profile.role),ve=async()=>{z.value=!0,c.value={status:!0,type:"info",text:"Please wait..."},e.value.profile_id=v.user.profile.id,await w(v.token).post("/api/store-update/incident",e.value).then(n=>{c.value={status:!0,type:"success",text:n.data.message},f.params.id?z.value=!1:setTimeout(()=>{A.push({name:"EditIncident",params:{id:n.data.id},query:{type:"details"}}).catch(a=>{}),z.value=!1},800)}).catch(n=>{})},S=m(!1),se=(n,a)=>{le.searchParams.set(n,a),window.history.pushState({},"",le)},oe=m([]),pe=async()=>{await w(v.token).get("/api/fetch/companies").then(n=>{oe.value=n.data}).catch(n=>{})},ie=m([]),_e=async()=>{await w(v.token).get("/api/fetch/locations/non-paginated/data").then(n=>{ie.value=n.data}).catch(n=>{})},fe=(n,a=5)=>{let x="0000"+n;return x.substring(x.length-a)};return ae(()=>{f.params.id&&(S.value=!0),h.value||(h.value="details",se("type","details")),F().then(()=>{pe().then(()=>{_e()})}),S.value&&(e.value=i.objectdata,e.value.asset_code=i.objectdata.asset?i.objectdata.asset.asset_code:i.objectdata.asset_code,e.value.title=i.objectdata.asset?i.objectdata.asset.asset_name:i.objectdata.title,e.value.company_id=i.objectdata.company_id,e.value.location_id=i.objectdata.location_id,e.value.asset_id=i.objectdata.asset_id,e.value.profile_id=i.objectdata.profile_id,e.value.type_id=parseInt(i.objectdata.type_id),e.value.urgency=parseInt(i.objectdata.urgency),e.value.description=i.objectdata.description)}),Y(()=>i.objectdata.remarks,(n,a)=>{e.value=i.objectdata},{deep:!0}),Y(()=>i.objectdata.attachment,(n,a)=>{e.value=i.objectdata,e.value.attachment=n},{deep:!0}),(n,a)=>(_(),b(De,null,{default:l(()=>[t(Te,{title:"Incident detail page"}),t(y,{class:"mb-3"},{default:l(()=>[t(xe,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[t(y,{class:"mb-3"},{default:l(()=>[t(D,{class:Q(`${h.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:a[0]||(a[0]=x=>G("details"))},{default:l(()=>[g("Details")]),_:1},8,["class"]),S.value?(_(),b(D,{key:0,class:Q(`${h.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:a[1]||(a[1]=x=>G("attachment"))},{default:l(()=>[g("Attachments")]),_:1},8,["class"])):R("",!0),S.value&&(p(v).user.profile.role=="facility"||p(v).user.profile.role=="admin"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="technical-operation")?(_(),b(D,{key:1,class:Q(`${h.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:a[2]||(a[2]=x=>G("facility"))},{default:l(()=>[g("Facility Team")]),_:1},8,["class"])):R("",!0)]),_:1}),h.value=="details"?(_(),b(q,{key:0},{default:l(()=>[t(p(Ie),{as:"v-form","validation-schema":p(r)},{default:l(({meta:x})=>[t(Se,{class:"my-3 ml-3 text-uppercase text-h6"},{default:l(()=>[g(k(i.headertitle),1)]),_:1}),t(H,null,{default:l(()=>[S.value?(_(),b(y,{key:0},{default:l(()=>{var u,V;return[o("div",ot,[o("div",it," SN: ISR-2"+k(fe(e.value.id)),1),o("div",dt," REPORTED BY: "+k((u=e.value.profile)==null?void 0:u.display_name),1)]),o("div",nt," STATUS: "+k((V=e.value.status)==null?void 0:V.title),1)]}),_:1})):R("",!0),t(y,null,{default:l(()=>[o("div",ut,[t(p(P),{name:"Type",modelValue:e.value.type_id,"onUpdate:modelValue":a[4]||(a[4]=u=>e.value.type_id=u)},{default:l(({field:u,errors:V})=>[t(M,N({items:T.value,modelValue:e.value.type_id,"onUpdate:modelValue":a[3]||(a[3]=$=>e.value.type_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},u,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",ct,[t(p(P),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":a[6]||(a[6]=u=>e.value.urgency=u)},{default:l(({field:u,errors:V})=>[t(M,N({items:d.value,modelValue:e.value.urgency,"onUpdate:modelValue":a[5]||(a[5]=$=>e.value.urgency=$),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},u,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",rt,[t(ne,{modelValue:e.value.asset_code,"onUpdate:modelValue":a[7]||(a[7]=u=>e.value.asset_code=u),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),t($e,{onClick:j,class:"ml-2 my-auto",size:"large",icon:p(we)},null,8,["icon"])]),o("div",mt,[t(p(P),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":a[9]||(a[9]=u=>e.value.title=u)},{default:l(({field:u,errors:V})=>[t(ne,N({modelValue:e.value.title,"onUpdate:modelValue":a[8]||(a[8]=$=>e.value.title=$),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},u,{"error-messages":V}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",vt,[t(y,null,{default:l(()=>[o("div",pt,[t(y,null,{default:l(()=>[o("div",_t,[t(p(P),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":a[11]||(a[11]=u=>e.value.company_id=u)},{default:l(({field:u,errors:V})=>[t(M,N({items:oe.value,modelValue:e.value.company_id,"onUpdate:modelValue":a[10]||(a[10]=$=>e.value.company_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},u,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),o("div",ft,[t(p(P),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":a[13]||(a[13]=u=>e.value.location_id=u)},{default:l(({field:u,errors:V})=>[t(M,N({items:ie.value,modelValue:e.value.location_id,"onUpdate:modelValue":a[12]||(a[12]=$=>e.value.location_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},u,{"error-messages":V}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),o("div",yt,[t(ce,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":a[14]||(a[14]=u=>e.value.description=u)},null,8,["modelValue"])])]),_:1})])]),_:1}),t(W,{class:"my-3"}),t(y,null,{default:l(()=>{var u;return[o("div",ht,[((u=e.value)==null?void 0:u.status_id)!=8&&(!S.value||S.value&&(i.objectdata.profile_id==U.value||B.value=="asset-supervisor"))?(_(),b(D,{key:0,size:"small",color:"primary",onClick:ve,disabled:!x.valid,loading:z.value},{default:l(()=>[g("Submit")]),_:2},1032,["disabled","loading"])):R("",!0)]),o("div",bt," DATE REPORTED: "+k(e.value.created_at?p(ee)(e.value.created_at):""),1),o("div",Vt," DATE CLOSED: "+k(n.date_closed?p(ee)(e.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):S.value&&h.value=="attachment"?(_(),b(Me,{key:1,"incident-id":p(f).params.id,attachment:e.value.attachment,onSave:C,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(B.value=="superadmin"||B.value=="admin"||B.value=="technical-operation"||B.value=="facility")&&S.value&&h.value=="facility"?(_(),b(st,{key:2,objectdata:e.value,onSaved:C},null,8,["objectdata"])):R("",!0)]),_:1})]),_:1}),t(Ae,{options:c.value},null,8,["options"]),t(ue,{width:"500",modelValue:s.value,"onUpdate:modelValue":a[16]||(a[16]=x=>s.value=x)},{default:l(()=>[t(q,null,{default:l(()=>[t(H,null,{default:l(()=>[t(p(Le),{onDecode:re,onLoaded:me})]),_:1}),K.value?R("",!0):(_(),b(H,{key:0},{default:l(()=>[g("Please wait...")]),_:1})),t(Ce,null,{default:l(()=>[t(Ue),t(D,{text:"Close",onClick:a[15]||(a[15]=x=>s.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Dt=Ee(gt,[["__scopeId","data-v-2ddd8607"]]);export{Dt as D};
