import{i as le,r as c,o as se,b as v,c as H,j as h,k as l,l as e,q as L,G as m,z as T,m as x,A as M,I,D as g,F as ne,d as ue,X as fe,Y as ye,Z as be,_ as ce,f as s,K as U,M as re,t as D,O as Q,$ as me,J as ae,L as ge,u as he,N as Ve,a0 as ee,V as ke,a1 as Z,a2 as X,y as de,E as je,H as xe,a3 as De,P as $e,C as we}from"./app-c2d9837f.js";import{_ as Ce}from"./AppPageHeader-a7651d1c.js";import{_ as Fe}from"./AppSnackBar-92a635ef.js";import{c as Se,a as G,F as Ie,b as W}from"./index.esm-4de613b4.js";import{S as Te}from"./StreamBarcodeReader-f8694c57.js";import{_ as Ue}from"./_plugin-vue_export-helper-c27b6911.js";import{u as te,a as Re}from"./formatDate-e2fbee14.js";import{v as Le}from"./filepond.min-22956b12.js";const Ae=s("div",{class:"v-col-12 text-uppercase font-weight-bold"}," Uploaded Files ",-1),Ee=s("div",{class:"v-col-12"},"No file found.",-1),Ne=["src"],Pe={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},files:{type:Array,default:[]}},emits:["deleted"],setup(Y,{emit:J}){const u=Y;console.log("objectdata",u.objectdata.profile_id);const r=le(),a=c([]),i=c(null),A=Le(),E={process:(k,_,f,F,B,K,O,q,oe)=>{const b=new FormData;b.append(k,_,_.name),b.append("profile_id",r.user.profile.id),b.append("ID",u.incidentId),b.append("type","incident");const w=new XMLHttpRequest;return w.open("POST","/api/upload-files/docs-images"),w.upload.onprogress=z=>{K(z.lengthComputable,z.loaded,z.total)},w.onload=function(){w.status>=200&&w.status<300?F(w.responseText):B("oh no")},w.send(b),{abort:()=>{w.abort(),O()}}}},N=c(r.user.profile.id),R=c(""),$=c(!1),P=(k,_)=>{$.value=_,R.value=k},V=()=>{console.log("initialised")},p=()=>{i.value.processFiles().then(k=>{let _={};k.map((f,F)=>{_=JSON.parse(f.serverId)[0][0],o.value.push(_)})})},y=(k,_)=>{let f={data:k,ID:u.incidentId};U(r.token).post("/api/delete/uploaded-file",f).then(F=>{o.value.splice(_,1),J("deleted",F.data.msg)}).catch(F=>{})},o=c([]);return se(()=>{o.value=u.files}),(k,_)=>(v(),H("div",null,[u.objectdata.profile_id==N.value?(v(),h(M,{key:0},{default:l(()=>[e(L,null,{default:l(()=>[e(m(A),{name:"filename",ref_key:"pond",ref:i,credits:"","label-idle":"Select or Drop image (jpeg, jpg, png) here... max 6 files only","allow-multiple":!0,"accepted-file-types":"image/jpeg, image/png",files:a.value,server:E,onInit:V,"max-files":"6",instantUpload:"false"},null,8,["files"]),e(T,{onClick:p},{default:l(()=>[x("Upload")]),_:1})]),_:1})]),_:1})):I("",!0),e(M,{class:"mt-2"},{default:l(()=>[e(L,null,{default:l(()=>[e(g,null,{default:l(()=>[Ae]),_:1}),o.value&&o.value.length>0?(v(),h(g,{key:0},{default:l(()=>[(v(!0),H(ne,null,ue(o.value,(f,F)=>(v(),H("div",{class:"v-col-12 v-col-md-3 text-center parent-row-show",key:f.id},[e(fe,{onClick:B=>P(f,!0),class:"mx-3 cursor-pointer",src:`/storage/uploads/${f.path}`,alt:"File",maxHeight:"150",style:{border:"1px solid #e2e2e2"}},null,8,["onClick","src"]),m(r).user.profile.id==f.profile_id?(v(),h(T,{key:0,onClick:B=>y(f,F),class:"show-hover mx-auto mt-2",size:"small",color:"error"},{default:l(()=>[x("Delete Image")]),_:2},1032,["onClick"])):I("",!0)]))),128))]),_:1})):(v(),h(g,{key:1},{default:l(()=>[Ee]),_:1}))]),_:1})]),_:1}),e(ce,{maxWidth:"900",modelValue:$.value,"onUpdate:modelValue":_[1]||(_[1]=f=>$.value=f)},{default:l(()=>[e(T,{size:"small",onClick:_[0]||(_[0]=()=>P("",!1)),icon:m(ye),style:{position:"absolute",right:"-10px",top:"-10px","z-index":"9999"},color:"error"},null,8,["icon"]),e(M,{class:"text-center"},{default:l(()=>[e(be,{color:"primary",title:`Filename: ${R.value.original_name}`},null,8,["title"]),e(L,null,{default:l(()=>[R.value?(v(),H("img",{key:0,src:`/storage/uploads/${R.value.path}`,alt:"Image"},null,8,Ne)):I("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Be={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Oe={class:"font-weight-bold"},qe={class:"reported-by"},ze={class:"reported-by"},He={class:"v-col-12"},Me={class:"v-col-12 v-col-md-4 pb-0"},Ye={class:"v-col-12 v-col-md-8"},Je={class:"v-col-12"},Ke={class:"v-col-12"},Xe={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Ge={class:"v-col-3"},We=s("br",null,null,-1),Ze={class:"v-col-9"},Qe={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(Y,{emit:J}){const u=Y,r=le(),a=c(r.user.profile.role),i=c({}),A=c([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),E=c([]),N=async()=>{await U(r.token).get("/api/fetch/profile-facility/team").then(p=>{E.value=p.data}).catch(p=>{})},R=()=>{i.value.profile_id=r.user.profile.id,U(r.token).post("/api/incident/update-facility-team",i.value).then(p=>{i.value.remarks_data="",J("saved",p.data.message)}).catch(p=>{})},$=c([]),P=async()=>{await U(r.token).get("/api/fetch-global/incident-status/active").then(p=>{$.value=p.data}).catch(p=>{})},V=(p,y=6)=>{let o="00000"+p;return o.substring(o.length-y)};return se(()=>{N(),P(),i.value=u.objectdata,i.value.priority=u.objectdata.priority?parseInt(u.objectdata.priority):null}),re(()=>u.objectdata.remarks,(p,y)=>{i.value.remarks=p},{deep:!0}),(p,y)=>(v(),H("div",null,[e(M,null,{default:l(()=>[e(L,null,{default:l(()=>[e(g,null,{default:l(()=>{var o;return[s("div",Be,[s("div",Oe," SN: ISR-"+D(V(i.value.id)),1),s("div",qe," REPORTED BY: "+D((o=i.value.profile)==null?void 0:o.display_name),1),s("div",ze," DATE REPORTED: "+D(m(te)(i.value.created_at)),1)])]}),_:1}),e(g,null,{default:l(()=>[s("div",He,[e(g,null,{default:l(()=>[s("div",Me,[e(Q,{items:A.value,modelValue:i.value.priority,"onUpdate:modelValue":y[0]||(y[0]=o=>i.value.priority=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:a.value=="facility"},null,8,["items","modelValue","disabled"]),e(Q,{items:E.value,modelValue:i.value.handled_by,"onUpdate:modelValue":y[1]||(y[1]=o=>i.value.handled_by=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:a.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),e(Q,{items:$.value,modelValue:i.value.status_id,"onUpdate:modelValue":y[2]||(y[2]=o=>i.value.status_id=o),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",Ye,[e(me,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:i.value.remarks_data,"onUpdate:modelValue":y[3]||(y[3]=o=>i.value.remarks_data=o)},null,8,["modelValue"])])]),_:1})]),e(ae,{class:"mt-3"}),s("div",Je,[e(T,{class:"",size:"small",disabled:!i.value.priority||!i.value.handled_by||!i.value.status_id,onClick:R,color:"primary"},{default:l(()=>[x("Submit")]),_:1},8,["disabled"])])]),_:1}),e(g,null,{default:l(()=>[s("div",Ke,[x(" Remarks "),e(ae)]),s("div",Xe,[(v(!0),H(ne,null,ue(i.value.remarks,o=>(v(),h(g,{key:p.id},{default:l(()=>{var k;return[s("div",Ge,[x(D((k=o.profile)==null?void 0:k.display_name)+" ",1),We,x(),s("small",null,D(m(Re)(o.created_at)),1)]),s("div",Ze,D(o.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const ea={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},aa={class:"font-weight-bold"},ta={class:"reported-by"},la={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},sa={class:"v-col-12 v-col-md-3"},oa={class:"v-col-12 v-col-md-3"},ia={class:"v-col-12 v-col-md-6 d-flex"},da={class:"v-col-12"},na={class:"v-col-12 v-col-md-12"},ua={class:"v-col-12 v-col-md-3"},ca={class:"v-col-12"},ra={class:"v-col-12"},ma={class:"v-col-12 v-col-md-9"},va={class:"v-col-12 v-col-md-6"},pa={class:"v-col-12 v-col-md-3"},_a={class:"v-col-12 v-col-md-3"},fa={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(Y,{emit:J}){const u=Y,r=le(),a=c({}),i=c({}),A=d=>{i.value={status:!0,type:"success",text:d},J("saved")},E=c(r.user.profile.id),N=c([]),R=async()=>{await U(r.token).get("/api/fetch-global/incident-types/active").then(d=>{N.value=d.data}).catch(d=>{})},$=ge(),P=he(),V=c($.query.type),p=c([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let y=Se({Type:G().required(),Urgency:G().required(),Title:G().required(),Company:G().required(),Location:G().required()});const o=c(!1),k=()=>{f.value=!1,o.value=!0},_=async d=>{await U(r.token).get("/api/fetch/asset-info/by/asset-code/"+d).then(t=>{a.value.asset_code=t.data.asset_code,a.value.title=t.data.asset_name,a.value.company_id=t.data.company_id,a.value.location_id=t.data.location_id,a.value.asset_id=t.data.id,o.value=!1}).catch(t=>{})},f=c(!1),F=()=>{f.value=!0},B=new URL(window.location),K=d=>{V.value=d,w("type",d)},O=c(!1),q=c(r.user.profile.role),oe=async()=>{O.value=!0,i.value={status:!0,type:"info",text:"Please wait..."},a.value.profile_id=r.user.profile.id,await U(r.token).post("/api/store-update/incident",a.value).then(d=>{i.value={status:!0,type:"success",text:d.data.message},$.params.id?O.value=!1:setTimeout(()=>{P.push({name:"EditIncident",params:{id:d.data.id},query:{type:"details"}}).catch(t=>{}),O.value=!1},800)}).catch(d=>{})},b=c(!1),w=(d,t)=>{B.searchParams.set(d,t),window.history.pushState({},"",B)},z=c([]),ve=async()=>{await U(r.token).get("/api/fetch/companies").then(d=>{z.value=d.data}).catch(d=>{})},ie=c([]),pe=async()=>{await U(r.token).get("/api/fetch/locations/non-paginated/data").then(d=>{ie.value=d.data}).catch(d=>{})},_e=(d,t=6)=>{let C="00000"+d;return C.substring(C.length-t)};return se(()=>{var d;$.params.id&&(b.value=!0),V.value||(V.value="details",w("type","details")),R().then(()=>{ve().then(()=>{pe()})}),b.value&&(a.value=u.objectdata,a.value.asset_code=(d=u.objectdata.asset)==null?void 0:d.asset_code,a.value.title=u.objectdata.asset?u.objectdata.asset.asset_name:u.objectdata.title,a.value.company_id=u.objectdata.company_id,a.value.location_id=u.objectdata.location_id,a.value.asset_id=u.objectdata.id,a.value.profile_id=u.objectdata.profile_id,a.value.type_id=parseInt(u.objectdata.type_id),a.value.urgency=parseInt(u.objectdata.urgency),a.value.description=u.objectdata.description)}),re(()=>u.objectdata.remarks,(d,t)=>{a.value=u.objectdata},{deep:!0}),(d,t)=>(v(),h(we,null,{default:l(()=>[e(Ce,{title:"Incident detail page"}),e(g,{class:"mb-3"},{default:l(()=>[e(Ve,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[e(g,{class:"mb-3"},{default:l(()=>[e(T,{class:ee(`${V.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:t[0]||(t[0]=C=>K("details"))},{default:l(()=>[x("Details")]),_:1},8,["class"]),b.value?(v(),h(T,{key:0,class:ee(`${V.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[1]||(t[1]=C=>K("attachment"))},{default:l(()=>[x("Attachments")]),_:1},8,["class"])):I("",!0),b.value&&(m(r).user.profile.role=="facility"||m(r).user.profile.role=="admin"||m(r).user.profile.role=="superadmin"||m(r).user.profile.role=="technical-operation")?(v(),h(T,{key:1,class:ee(`${V.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[2]||(t[2]=C=>K("facility"))},{default:l(()=>[x("Facility Team")]),_:1},8,["class"])):I("",!0)]),_:1}),V.value=="details"?(v(),h(M,{key:0},{default:l(()=>[e(m(Ie),{as:"v-form","validation-schema":m(y)},{default:l(({meta:C})=>[e(ke,{class:"my-3 ml-3 text-uppercase text-h6"},{default:l(()=>[x(D(u.headertitle),1)]),_:1}),e(L,null,{default:l(()=>[b.value?(v(),h(g,{key:0},{default:l(()=>{var n,j;return[s("div",ea,[s("div",aa," SN: ISR-2"+D(_e(a.value.id)),1),s("div",ta," REPORTED BY: "+D((n=a.value.profile)==null?void 0:n.display_name),1)]),s("div",la," STATUS: "+D((j=a.value.status)==null?void 0:j.title),1)]}),_:1})):I("",!0),e(g,null,{default:l(()=>[s("div",sa,[e(m(W),{name:"Type",modelValue:a.value.type_id,"onUpdate:modelValue":t[4]||(t[4]=n=>a.value.type_id=n)},{default:l(({field:n,errors:j})=>[e(Z,X({items:N.value,modelValue:a.value.type_id,"onUpdate:modelValue":t[3]||(t[3]=S=>a.value.type_id=S),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},n,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",oa,[e(m(W),{name:"Urgency",modelValue:a.value.urgency,"onUpdate:modelValue":t[6]||(t[6]=n=>a.value.urgency=n)},{default:l(({field:n,errors:j})=>[e(Z,X({items:p.value,modelValue:a.value.urgency,"onUpdate:modelValue":t[5]||(t[5]=S=>a.value.urgency=S),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},n,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",ia,[e(de,{modelValue:a.value.asset_code,"onUpdate:modelValue":t[7]||(t[7]=n=>a.value.asset_code=n),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),e(je,{onClick:k,class:"ml-2 my-auto",size:"large",icon:m(xe)},null,8,["icon"])]),s("div",da,[e(m(W),{name:"Title",modelValue:a.value.title,"onUpdate:modelValue":t[9]||(t[9]=n=>a.value.title=n)},{default:l(({field:n,errors:j})=>[e(de,X({modelValue:a.value.title,"onUpdate:modelValue":t[8]||(t[8]=S=>a.value.title=S),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},n,{"error-messages":j}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",na,[e(g,null,{default:l(()=>[s("div",ua,[e(g,null,{default:l(()=>[s("div",ca,[e(m(W),{name:"Company",modelValue:a.value.company_id,"onUpdate:modelValue":t[11]||(t[11]=n=>a.value.company_id=n)},{default:l(({field:n,errors:j})=>[e(Z,X({items:z.value,modelValue:a.value.company_id,"onUpdate:modelValue":t[10]||(t[10]=S=>a.value.company_id=S),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},n,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",ra,[e(m(W),{name:"Location",modelValue:a.value.location_id,"onUpdate:modelValue":t[13]||(t[13]=n=>a.value.location_id=n)},{default:l(({field:n,errors:j})=>[e(Z,X({items:ie.value,modelValue:a.value.location_id,"onUpdate:modelValue":t[12]||(t[12]=S=>a.value.location_id=S),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},n,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",ma,[e(me,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:a.value.description,"onUpdate:modelValue":t[14]||(t[14]=n=>a.value.description=n)},null,8,["modelValue"])])]),_:1})])]),_:1}),e(ae,{class:"my-3"}),e(g,null,{default:l(()=>{var n;return[s("div",va,[((n=a.value)==null?void 0:n.status_id)!=8&&(!b.value||b.value&&(u.objectdata.profile_id==E.value||q.value=="asset-supervisor"))?(v(),h(T,{key:0,size:"small",color:"primary",onClick:oe,disabled:!C.valid,loading:O.value},{default:l(()=>[x("Submit")]),_:2},1032,["disabled","loading"])):I("",!0)]),s("div",pa," DATE REPORTED: "+D(m(te)(a.value.created_at)),1),s("div",_a," DATE CLOSED: "+D(d.date_closed?m(te)(a.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):b.value&&V.value=="attachment"?(v(),h(Pe,{key:1,"incident-id":m($).params.id,files:a.value.files,onDeleted:A,objectdata:a.value},null,8,["incident-id","files","objectdata"])):(q.value=="superadmin"||q.value=="admin"||q.value=="technical-operation"||q.value=="facility")&&b.value&&V.value=="facility"?(v(),h(Qe,{key:2,objectdata:a.value,onSaved:A},null,8,["objectdata"])):I("",!0)]),_:1})]),_:1}),e(Fe,{options:i.value},null,8,["options"]),e(ce,{width:"500",modelValue:o.value,"onUpdate:modelValue":t[16]||(t[16]=C=>o.value=C)},{default:l(()=>[e(M,null,{default:l(()=>[e(L,null,{default:l(()=>[e(m(Te),{onDecode:_,onLoaded:F})]),_:1}),f.value?I("",!0):(v(),h(L,{key:0},{default:l(()=>[x("Please wait...")]),_:1})),e(De,null,{default:l(()=>[e($e),e(T,{text:"Close",onClick:t[15]||(t[15]=C=>o.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Da=Ue(fa,[["__scopeId","data-v-92342411"]]);export{Da as D};
