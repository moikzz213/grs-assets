import{i as ee,r as c,X as ye,o as ae,b as m,c as L,e as s,l as a,k as l,D as h,j as k,F as X,d as Z,z as D,A as O,Y as ie,Z as ue,_ as be,$ as he,U as Ve,m as $,M as ne,q as M,t as S,G as v,O as G,a0 as ce,J as Q,K as U,L as ge,u as ke,N as je,a1 as J,I as A,V as Se,a2 as H,a3 as I,y as de,E as $e,H as Ce,a4 as we,P as xe,C as Ue}from"./app-2c5a49eb.js";import{_ as De}from"./AppPageHeader-aab5a62f.js";import{_ as Te}from"./AppSnackBar-abe71aae.js";import{c as Re,a as B,F as Ae,b as N}from"./index.esm-7f8f3b3c.js";import{S as Le}from"./StreamBarcodeReader-6d8945cd.js";import{_ as Ee}from"./_plugin-vue_export-helper-c27b6911.js";import{u as W,a as Fe}from"./formatDate-e2fbee14.js";import"./vue-filepond.esm-70028a9b.js";import{_ as Ie}from"./Studio-98788741.js";const Be={class:"v-col-12 pt-5"},Ne={class:"v-col-12 pb-2"},Oe={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Pe={class:"v-col-12 pt-0 pb-2"},qe={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},files:{type:Array,default:[]}},emits:["deleted"],setup(E,{emit:P}){const u=E;ee();const r=p=>{let _=null;p.map(y=>{_=V.value.find(f=>f.id==y.id),_||V.value.push(y)})},e=c(!1),d=p=>{currentSlider.value=p,e.value=!0},T=p=>{V.value=V.value.filter(_=>_.id!==p)},V=c([]);ye(()=>V.value.map(p=>p.id));const R=c([]);return ae(()=>{R.value=u.files}),(p,_)=>(m(),L("div",null,[s("div",Be,[a(h,null,{default:l(()=>[s("div",Ne,[a(Ie,{options:{multiSelect:!0,type:"incident"},onSelect:r})])]),_:1}),V.value.length>0?(m(),k(h,{key:0,class:"px-1"},{default:l(()=>[(m(!0),L(X,null,Z(V.value,(y,f)=>(m(),L("div",{key:y.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[a(D,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:p.mdiClose,size:"26px",color:"error",onClick:()=>T(y.id)},null,8,["icon","onClick"]),a(O,{onClick:()=>d(f)},{default:l(()=>[a(ie,{src:p.baseURL+"/file/"+y.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),a(ue,{modelValue:e.value,"onUpdate:modelValue":_[1]||(_[1]=y=>e.value=y),width:"95%","max-width":"900"},{default:l(()=>[a(O,{class:"bg-black"},{default:l(()=>[a(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:p.currentSlider,"onUpdate:modelValue":_[0]||(_[0]=y=>p.currentSlider=y)},{default:l(()=>[(m(!0),L(X,null,Z(V.value,(y,f)=>(m(),k(he,{key:f,"reverse-transition":"fade",transition:"fade"},{default:l(()=>[s("div",Oe,[a(ie,{src:p.baseURL+"/file/"+y.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(m(),k(h,{key:1},{default:l(()=>[s("div",Pe,[a(Ve,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:l(()=>[$(" Attachment is empty at the moment. ")]),_:1})])]),_:1}))])]))}},ze={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},He={class:"font-weight-bold"},Me={class:"reported-by"},Ye={class:"reported-by"},Ke={class:"v-col-12"},Ge={class:"v-col-12 v-col-md-4 pb-0"},Je={class:"v-col-12 v-col-md-8"},Xe={class:"v-col-12"},Ze={class:"v-col-12"},Qe={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},We={class:"v-col-3"},ea=s("br",null,null,-1),aa={class:"v-col-9"},ta={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(E,{emit:P}){const u=E,r=ee(),e=c(r.user.profile.role),d=c({}),T=c([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),V=c([]),R=async()=>{await U(r.token).get("/api/fetch/profile-facility/team").then(b=>{V.value=b.data}).catch(b=>{})},p=()=>{d.value.profile_id=r.user.profile.id,U(r.token).post("/api/incident/update-facility-team",d.value).then(b=>{d.value.remarks_data="",P("saved",b.data.message)}).catch(b=>{})},_=c([]),y=async()=>{await U(r.token).get("/api/fetch-global/incident-status/active").then(b=>{_.value=b.data}).catch(b=>{})},f=(b,g=6)=>{let n="00000"+b;return n.substring(n.length-g)};return ae(()=>{R(),y(),d.value=u.objectdata,d.value.priority=u.objectdata.priority?parseInt(u.objectdata.priority):null}),ne(()=>u.objectdata.remarks,(b,g)=>{d.value.remarks=b},{deep:!0}),(b,g)=>(m(),L("div",null,[a(O,null,{default:l(()=>[a(M,null,{default:l(()=>[a(h,null,{default:l(()=>{var n;return[s("div",ze,[s("div",He," SN: ISR-"+S(f(d.value.id)),1),s("div",Me," REPORTED BY: "+S((n=d.value.profile)==null?void 0:n.display_name),1),s("div",Ye," DATE REPORTED: "+S(v(W)(d.value.created_at)),1)])]}),_:1}),a(h,null,{default:l(()=>[s("div",Ke,[a(h,null,{default:l(()=>[s("div",Ge,[a(G,{items:T.value,modelValue:d.value.priority,"onUpdate:modelValue":g[0]||(g[0]=n=>d.value.priority=n),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:e.value=="facility"},null,8,["items","modelValue","disabled"]),a(G,{items:V.value,modelValue:d.value.handled_by,"onUpdate:modelValue":g[1]||(g[1]=n=>d.value.handled_by=n),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:e.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),a(G,{items:_.value,modelValue:d.value.status_id,"onUpdate:modelValue":g[2]||(g[2]=n=>d.value.status_id=n),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",Je,[a(ce,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:d.value.remarks_data,"onUpdate:modelValue":g[3]||(g[3]=n=>d.value.remarks_data=n)},null,8,["modelValue"])])]),_:1})]),a(Q,{class:"mt-3"}),s("div",Xe,[a(D,{class:"",size:"small",disabled:!d.value.priority||!d.value.handled_by||!d.value.status_id,onClick:p,color:"primary"},{default:l(()=>[$("Submit")]),_:1},8,["disabled"])])]),_:1}),a(h,null,{default:l(()=>[s("div",Ze,[$(" Remarks "),a(Q)]),s("div",Qe,[(m(!0),L(X,null,Z(d.value.remarks,n=>(m(),k(h,{key:b.id},{default:l(()=>{var q;return[s("div",We,[$(S((q=n.profile)==null?void 0:q.display_name)+" ",1),ea,$(),s("small",null,S(v(Fe)(n.created_at)),1)]),s("div",aa,S(n.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const la={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},sa={class:"font-weight-bold"},oa={class:"reported-by"},ia={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},da={class:"v-col-12 v-col-md-3"},ua={class:"v-col-12 v-col-md-3"},na={class:"v-col-12 v-col-md-6 d-flex"},ca={class:"v-col-12"},ra={class:"v-col-12 v-col-md-12"},ma={class:"v-col-12 v-col-md-3"},va={class:"v-col-12"},pa={class:"v-col-12"},_a={class:"v-col-12 v-col-md-9"},fa={class:"v-col-12 v-col-md-6"},ya={class:"v-col-12 v-col-md-3"},ba={class:"v-col-12 v-col-md-3"},ha={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(E,{emit:P}){const u=E,r=ee(),e=c({}),d=c({}),T=o=>{d.value={status:!0,type:"success",text:o},P("saved")},V=c(r.user.profile.id),R=c([]),p=async()=>{await U(r.token).get("/api/fetch-global/incident-types/active").then(o=>{R.value=o.data}).catch(o=>{})},_=ge(),y=ke(),f=c(_.query.type),b=c([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let g=Re({Type:B().required(),Urgency:B().required(),Title:B().required(),Company:B().required(),Location:B().required()});const n=c(!1),q=()=>{Y.value=!1,n.value=!0},re=async o=>{await U(r.token).get("/api/fetch/asset-info/by/asset-code/"+o).then(t=>{e.value.asset_code=t.data.asset_code,e.value.title=t.data.asset_name,e.value.company_id=t.data.company_id,e.value.location_id=t.data.location_id,e.value.asset_id=t.data.id,n.value=!1}).catch(t=>{})},Y=c(!1),me=()=>{Y.value=!0},te=new URL(window.location),K=o=>{f.value=o,le("type",o)},z=c(!1),F=c(r.user.profile.role),ve=async()=>{z.value=!0,d.value={status:!0,type:"info",text:"Please wait..."},e.value.profile_id=r.user.profile.id,await U(r.token).post("/api/store-update/incident",e.value).then(o=>{d.value={status:!0,type:"success",text:o.data.message},_.params.id?z.value=!1:setTimeout(()=>{y.push({name:"EditIncident",params:{id:o.data.id},query:{type:"details"}}).catch(t=>{}),z.value=!1},800)}).catch(o=>{})},w=c(!1),le=(o,t)=>{te.searchParams.set(o,t),window.history.pushState({},"",te)},se=c([]),pe=async()=>{await U(r.token).get("/api/fetch/companies").then(o=>{se.value=o.data}).catch(o=>{})},oe=c([]),_e=async()=>{await U(r.token).get("/api/fetch/locations/non-paginated/data").then(o=>{oe.value=o.data}).catch(o=>{})},fe=(o,t=5)=>{let C="0000"+o;return C.substring(C.length-t)};return ae(()=>{var o;_.params.id&&(w.value=!0),f.value||(f.value="details",le("type","details")),p().then(()=>{pe().then(()=>{_e()})}),w.value&&(e.value=u.objectdata,e.value.asset_code=(o=u.objectdata.asset)==null?void 0:o.asset_code,e.value.title=u.objectdata.asset?u.objectdata.asset.asset_name:u.objectdata.title,e.value.company_id=u.objectdata.company_id,e.value.location_id=u.objectdata.location_id,e.value.asset_id=u.objectdata.asset_id,e.value.profile_id=u.objectdata.profile_id,e.value.type_id=parseInt(u.objectdata.type_id),e.value.urgency=parseInt(u.objectdata.urgency),e.value.description=u.objectdata.description)}),ne(()=>u.objectdata.remarks,(o,t)=>{e.value=u.objectdata},{deep:!0}),(o,t)=>(m(),k(Ue,null,{default:l(()=>[a(De,{title:"Incident detail page"}),a(h,{class:"mb-3"},{default:l(()=>[a(je,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[a(h,{class:"mb-3"},{default:l(()=>[a(D,{class:J(`${f.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:t[0]||(t[0]=C=>K("details"))},{default:l(()=>[$("Details")]),_:1},8,["class"]),w.value?(m(),k(D,{key:0,class:J(`${f.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[1]||(t[1]=C=>K("attachment"))},{default:l(()=>[$("Attachments")]),_:1},8,["class"])):A("",!0),w.value&&(v(r).user.profile.role=="facility"||v(r).user.profile.role=="admin"||v(r).user.profile.role=="superadmin"||v(r).user.profile.role=="technical-operation")?(m(),k(D,{key:1,class:J(`${f.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[2]||(t[2]=C=>K("facility"))},{default:l(()=>[$("Facility Team")]),_:1},8,["class"])):A("",!0)]),_:1}),f.value=="details"?(m(),k(O,{key:0},{default:l(()=>[a(v(Ae),{as:"v-form","validation-schema":v(g)},{default:l(({meta:C})=>[a(Se,{class:"my-3 ml-3 text-uppercase text-h6"},{default:l(()=>[$(S(u.headertitle),1)]),_:1}),a(M,null,{default:l(()=>[w.value?(m(),k(h,{key:0},{default:l(()=>{var i,j;return[s("div",la,[s("div",sa," SN: ISR-2"+S(fe(e.value.id)),1),s("div",oa," REPORTED BY: "+S((i=e.value.profile)==null?void 0:i.display_name),1)]),s("div",ia," STATUS: "+S((j=e.value.status)==null?void 0:j.title),1)]}),_:1})):A("",!0),a(h,null,{default:l(()=>[s("div",da,[a(v(N),{name:"Type",modelValue:e.value.type_id,"onUpdate:modelValue":t[4]||(t[4]=i=>e.value.type_id=i)},{default:l(({field:i,errors:j})=>[a(H,I({items:R.value,modelValue:e.value.type_id,"onUpdate:modelValue":t[3]||(t[3]=x=>e.value.type_id=x),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},i,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",ua,[a(v(N),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":t[6]||(t[6]=i=>e.value.urgency=i)},{default:l(({field:i,errors:j})=>[a(H,I({items:b.value,modelValue:e.value.urgency,"onUpdate:modelValue":t[5]||(t[5]=x=>e.value.urgency=x),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},i,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",na,[a(de,{modelValue:e.value.asset_code,"onUpdate:modelValue":t[7]||(t[7]=i=>e.value.asset_code=i),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"]),a($e,{onClick:q,class:"ml-2 my-auto",size:"large",icon:v(Ce)},null,8,["icon"])]),s("div",ca,[a(v(N),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":t[9]||(t[9]=i=>e.value.title=i)},{default:l(({field:i,errors:j})=>[a(de,I({modelValue:e.value.title,"onUpdate:modelValue":t[8]||(t[8]=x=>e.value.title=x),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},i,{"error-messages":j}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",ra,[a(h,null,{default:l(()=>[s("div",ma,[a(h,null,{default:l(()=>[s("div",va,[a(v(N),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":t[11]||(t[11]=i=>e.value.company_id=i)},{default:l(({field:i,errors:j})=>[a(H,I({items:se.value,modelValue:e.value.company_id,"onUpdate:modelValue":t[10]||(t[10]=x=>e.value.company_id=x),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},i,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",pa,[a(v(N),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":t[13]||(t[13]=i=>e.value.location_id=i)},{default:l(({field:i,errors:j})=>[a(H,I({items:oe.value,modelValue:e.value.location_id,"onUpdate:modelValue":t[12]||(t[12]=x=>e.value.location_id=x),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},i,{"error-messages":j}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",_a,[a(ce,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":t[14]||(t[14]=i=>e.value.description=i)},null,8,["modelValue"])])]),_:1})])]),_:1}),a(Q,{class:"my-3"}),a(h,null,{default:l(()=>{var i;return[s("div",fa,[((i=e.value)==null?void 0:i.status_id)!=8&&(!w.value||w.value&&(u.objectdata.profile_id==V.value||F.value=="asset-supervisor"))?(m(),k(D,{key:0,size:"small",color:"primary",onClick:ve,disabled:!C.valid,loading:z.value},{default:l(()=>[$("Submit")]),_:2},1032,["disabled","loading"])):A("",!0)]),s("div",ya," DATE REPORTED: "+S(v(W)(e.value.created_at)),1),s("div",ba," DATE CLOSED: "+S(o.date_closed?v(W)(e.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):w.value&&f.value=="attachment"?(m(),k(qe,{key:1,"incident-id":v(_).params.id,files:e.value.files,onDeleted:T,objectdata:e.value},null,8,["incident-id","files","objectdata"])):(F.value=="superadmin"||F.value=="admin"||F.value=="technical-operation"||F.value=="facility")&&w.value&&f.value=="facility"?(m(),k(ta,{key:2,objectdata:e.value,onSaved:T},null,8,["objectdata"])):A("",!0)]),_:1})]),_:1}),a(Te,{options:d.value},null,8,["options"]),a(ue,{width:"500",modelValue:n.value,"onUpdate:modelValue":t[16]||(t[16]=C=>n.value=C)},{default:l(()=>[a(O,null,{default:l(()=>[a(M,null,{default:l(()=>[a(v(Le),{onDecode:re,onLoaded:me})]),_:1}),Y.value?A("",!0):(m(),k(M,{key:0},{default:l(()=>[$("Please wait...")]),_:1})),a(we,null,{default:l(()=>[a(xe),a(D,{text:"Close",onClick:t[15]||(t[15]=C=>n.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ua=Ee(ha,[["__scopeId","data-v-b9606560"]]);export{Ua as D};
