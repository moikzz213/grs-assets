import{a as Ve,r as p,I as be,u as ke,K as Ae,J as X,T as Z,o as r,c as _,w as s,d as a,v as qe,k as D,V as we,b as d,t as g,p as b,y as f,as as ee,E as m,H as $,f as M,s as h,j as S,e as E,L as O,i as A,q as te,U as Ce,X as Ue,Y as xe,Z as Se,W as je,P as Te,D as ae,O as De,F as Y,aC as Ee,aD as Oe,aE as Re,aF as Le,aG as Ne,m as Be,n as j}from"./app-7ac3839f.js";import{_ as Ie}from"./AppPageHeader-6a78d3e1.js";import{_ as Fe}from"./Studio-e3a048e7.js";import{_ as Pe}from"./AppSnackBar-f4b6c737.js";import{u as le}from"./formatDate-b9aad8c5.js";const ze={key:0,class:"text-error text-h6"},$e={class:"col-12 v-col-md-4"},Me={key:0,class:"v-col-12 v-col-md-8"},Ye={key:0,class:"text-right"},Ge={class:"v-col-12 v-col-md-6"},Ke={class:"v-col-12 v-col-md-6"},He={class:"v-col-12 v-col-md-6"},Qe={class:"v-col-12 v-col-md-6"},Je={class:"v-col-12"},We={class:"v-col-12"},Xe={class:"v-col-12 v-col-md-1 px-1"},Ze={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},et={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},tt={class:"v-col-12 pt-0 pb-0"},at={class:"v-col-12 v-col-md-3"},lt={class:"v-col-12 v-col-md-2"},st={class:"v-col-12 v-col-md-1"},ot={class:"v-col-12 v-col-md-1"},dt={class:"v-col-12 v-col-md-1"},ut={class:"v-col-12 v-col-md-3 d-flex"},it=d("div",{class:"v-col-12 font-weight-bold text-uppercase"},"APPROVAL SETUP",-1),nt=d("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),rt={class:"v-col-12 v-col-md-6"},ct=d("div",{class:"v-col-12 v-col-md-1"},"Status",-1),vt=d("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),pt={class:"v-col-12 v-col-md-2"},mt={class:"v-col-12 v-col-md-7 d-flex"},_t={class:"my-auto"},ft={key:0,class:"v-col-12"},ht={class:"v-col-12 text-error"},yt=d("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),qt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(se,{emit:oe}){const q=se,v=Ve(),B=p(!1),C=be(),de=ke(),u=p({}),w=p(!1),V=p([{qty:1,attachment:{}}]),ue=p(new Date),ie=p(window.location.origin),ne=(t,l)=>{V.value[t].attachment=l[0]},I=p(!1),F=p(1),re=t=>{F.value=t,I.value=!0},ce=t=>{V.value[t].attachment=""},G=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},K=p([]),ve=async()=>{await j(v.token).get("/api/fetch/approval-setups/non-paginated/data/request").then(t=>{K.value=t.data}).catch(t=>{})},R=p({}),H=p([]),pe=async()=>{await j(v.token).get("/api/fetch/companies").then(t=>{H.value=t.data}).catch(t=>{})},P=p([]),me=async()=>{await j(v.token).get("/api/fetch/locations/non-paginated/data").then(t=>{P.value=t.data}).catch(t=>{})},_e=()=>{V.value.push({qty:1,attachment:{}}),U()},fe=(t,l)=>{V.value.splice(l,1),U()},Q=p("Note: Administrator needs to setup signatories first."),he=()=>{R.value={status:!0,type:"info",text:"Please wait..."};let t=V.value.map((e,i)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:u.value,assets:t,approval:k.value,profile_id:v.user.profile.id,type:"request",role:v.user.profile.role};j(v.token).post("/api/request-asset/store-update/data",l).then(e=>{let i="",y="";e.data.message?(i=e.data.message,y="success"):e.data.error&&(i=e.data.error,y="error"),R.value={status:!0,type:y,text:i},C.params.id||setTimeout(()=>{de.push({name:"EditRequestAsset",params:{id:e.data.id}}).catch(x=>{})},800)}).catch(e=>{console.log(e)})},k=p([]),L=p(!0),J=async()=>{await j(v.token).get("/api/fetch/request-asset/approval-setup-fetch/"+u.value.request_type_id).then(t=>{var l,e,i,y,x,n;console.log("setupApprovals",t),k.value=(l=t.data)==null?void 0:l.stages,C.params.id&&k.value.length>0&&(k.value.map((T,N)=>(T.profile_id=o.value[N].profile_id,T.status=o.value[N].status,T.date_approved=o.value[N].date_approved,T.reason_rejected=o.value[N].reason_rejected,T)),k.value.length>1&&(k.value[o.value.length-1]={id:o.value[o.value.length-1].id,profile_id:o.value[o.value.length-1].profile_id,status:o.value[o.value.length-1].status,date_approved:o.value[o.value.length-1].date_approved,status:o.value[o.value.length-1].status,reason_rejected:"",types:o.value[o.value.length-1].approval_type,sort:o.value[o.value.length-1].orders,request_asset_id:o.value[o.value.length-1].request_asset_id,signatures:[{id:(e=o.value[o.value.length-1])==null?void 0:e.profile.id,display_name:(i=o.value[o.value.length-1])==null?void 0:i.profile.display_name,first_name:(y=o.value[o.value.length-1])==null?void 0:y.profile.first_name,last_name:(x=o.value[o.value.length-1])==null?void 0:x.profile.last_name}]})),((n=t.data)==null?void 0:n.stages.length)>0?L.value=!0:L.value=!1}).catch(t=>{})},U=()=>{let t=!1;B.value=!1,u.value.company_id&&u.value.request_type_id&&u.value.subject&&u.value.transferred_from&&u.value.transferred_to&&(t=!0);let l=!0;V.value.map(i=>{i.item_description&&i.reason_for_request||(l=!1)});let e=!0;k.value.map(i=>{i.profile_id||(e=!1)}),e&&l&&t&&(B.value=!0)},W=t=>{let l={status:t,profile_id:v.user.profile.id,ID:c.value.id};j(v.token).post("/api/request-asset/change-request/data",l).then(e=>{R.value={status:!0,type:"success",text:e.data.message},c.value.status=t,oe("saved",e.data.message)}).catch(e=>{})},ye=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},o=p([]),c=p({});Ae(()=>{if(ve().then(()=>{pe().then(()=>{me()})}),C.params.id){w.value=!0;let t=q.objectdata;c.value=t,u.value.company_id=t.company_id,u.value.request_type_id=t.request_type_id,u.value.subject=t.subject,u.value.transferred_from=t.transferred_from,u.value.transferred_to=t.transferred_to,u.value.id=t.id,u.value.requestor_id=t.profile_id,o.value=t.request_approvals,V.value=t.items,J()}else u.value.company_id=v.user.profile.company_id}),X(u.value,async(t,l)=>{U()}),X(V.value,async(t,l)=>{U()});const z=Z(()=>v.user.role=="receiving-releasing"),ge=p("https://assets.grandiose.ae");return Z(()=>{let t=null,l=ge.value+"/pv/employee-signatory",e="4889547454",i=v.user.profile.id;return c.value&&(console.log("formObjData.value",c.value),t=l+"/"+c.value.types+"/approvals?o=0&key="+e+"&pid="+i+"&pv="+e+"&id="+c.value.id,console.log("requestSignatureUrl",t)),t}),(t,l)=>(r(),_(Be,null,{default:s(()=>[a(Ie,{title:q.headertitle},null,8,["title"]),a(h,{class:"mb-3"},{default:s(()=>[a(qe,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[a(D,null,{default:s(()=>[a(we,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:s(()=>[d("div",null,g(q.headertitle),1),L.value?f("",!0):(r(),b("div",ze,g(Q.value),1)),w.value?(r(),b("div",{key:1,class:ee(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+g(c.value.status)+") ",3)):f("",!0),d("div",null,"DATE: "+g(m(le)(ue.value)),1)]),_:1}),a($),a(M,null,{default:s(()=>[a(h,null,{default:s(()=>[w.value?(r(),b("div",{key:0,class:ee(`${c.value.status=="complete"?"v-col-12":"v-col-md-12"}`)},[a(h,null,{default:s(()=>[d("div",$e," REQUEST NO: SN-5"+g(ye(c.value.id)),1),z.value?f("",!0):(r(),b("div",Me,[w.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(r(),b("div",Ye,[c.value.status=="pending"?(r(),_(S,{key:0,onClick:l[0]||(l[0]=e=>W("cancelled")),color:"warning"},{default:s(()=>[E("Cancel request")]),_:1})):f("",!0),c.value.status=="cancelled"?(r(),_(S,{key:1,onClick:l[1]||(l[1]=e=>W("pending")),size:"small",color:"info"},{default:s(()=>[E("Change status to Pending")]),_:1})):f("",!0)])):f("",!0)]))]),_:1})],2)):f("",!0),d("div",Ge,[a(O,{items:K.value,modelValue:u.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>u.value.request_type_id=e),J],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:w.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),d("div",Ke,[a(O,{items:H.value,modelValue:u.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>u.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),d("div",He,[a(O,{items:P.value,modelValue:u.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>u.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),d("div",Qe,[a(O,{items:P.value,modelValue:u.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>u.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),d("div",Je,[a(A,{modelValue:u.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>u.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(D,{class:"my-2"},{default:s(()=>[a(M,null,{default:s(()=>[z.value?f("",!0):(r(),_(h,{key:0},{default:s(()=>{var e;return[d("div",We,[c.value.status!="complete"&&(!m(C).params.id||((e=q.objectdata)==null?void 0:e.status)=="pending"||m(v).user.profile.role=="superadmin"||m(v).user.profile.role=="administrator")?(r(),_(S,{key:0,color:"primary",onClick:_e},{default:s(()=>[E("Add")]),_:1})):f("",!0)])]}),_:1})),(r(!0),b(Y,null,te(V.value,(e,i)=>(r(),_(h,{key:i},{default:s(()=>{var y,x;return[d("div",Xe,[(y=e.attachment)!=null&&y.id?(r(),_(h,{key:0,class:"px-1"},{default:s(()=>[d("div",Ze,[a(A,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":n=>e.attachment.id=n},null,8,["modelValue","onUpdate:modelValue"]),a(S,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:m(Ce),size:"16px",color:"error",onClick:()=>ce(i,e.attachment.id)},null,8,["icon","onClick"]),a(D,{onClick:()=>re(i),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(Ue,{modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=n=>I.value=n),width:"95%","max-width":"900"},{default:s(()=>[a(D,{class:"bg-black"},{default:s(()=>[a(xe,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:F.value,"onUpdate:modelValue":l[7]||(l[7]=n=>F.value=n)},{default:s(()=>[a(Se,{"reverse-transition":"fade",transition:"fade"},{default:s(()=>[d("div",et,[a(je,{src:ie.value+"/file/"+e.attachment.path},null,8,["src"])])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)):(r(),_(h,{key:1,class:"mt-0"},{default:s(()=>[d("div",tt,[a(Te,{color:"grey-lighten-4",class:"text-center"},{default:s(()=>[a(Fe,{options:{multiSelect:!1,type:"request-asset"},onSelect:n=>ne(i,n)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),d("div",at,[a(A,{modelValue:e.item_description,"onUpdate:modelValue":[n=>e.item_description=n,U],variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",lt,[a(A,{modelValue:e.asset_code,"onUpdate:modelValue":n=>e.asset_code=n,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",st,[a(A,{type:"number",modelValue:e.qty,"onUpdate:modelValue":n=>e.qty=n,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",ot,[a(A,{type:"number",modelValue:e.weight,"onUpdate:modelValue":n=>e.weight=n,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",dt,[a(A,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":n=>e.item_value=n,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",ut,[a(A,{modelValue:e.reason_for_request,"onUpdate:modelValue":n=>e.reason_for_request=n,variant:"outlined",density:"compact","hide-details":"",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!w.value||w.value&&m(v).user.profile.id==q.objectdata.profile_id&&((x=q.objectdata)==null?void 0:x.status)=="pending"?(r(),_(ae,{key:0,size:"small",onClick:()=>fe(e.id,i),icon:m(De),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):f("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(D,{class:"my-2"},{default:s(()=>[a(M,null,{default:s(()=>[a(h,null,{default:s(()=>[it,a($)]),_:1}),a(h,null,{default:s(()=>{var e,i;return[nt,d("div",rt,g((i=(e=c.value)==null?void 0:e.profile)==null?void 0:i.display_name),1),ct,vt]}),_:1}),L.value?(r(),b(Y,{key:0},[(r(!0),b(Y,null,te(k.value,(e,i)=>(r(),_(h,{key:e.id},{default:s(()=>[d("div",pt,g(e.types?G(e.types):G(e.approval_type)),1),d("div",mt,[a(O,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[y=>e.profile_id=y,U],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(S,{variant:"text",size:"x-small"},{default:s(()=>[e.status?(r(),_(ae,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?m(Ee):e.status=="pending"?m(Oe):e.status=="reject"?m(Re):m(Le),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):f("",!0),a(Ne,{activator:"parent",location:"top","max-width":"400"},{default:s(()=>[E(g(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),d("div",_t,g(e.date_approved?m(le)(e.date_approved):""),1)]),_:2},1024))),128)),a(h,null,{default:s(()=>{var e;return[a($),z.value?f("",!0):(r(),b("div",ft,[(!m(C).params.id||((e=q.objectdata)==null?void 0:e.status)=="pending"||m(v).user.profile.role=="asset-supervisor"||m(v).user.profile.role=="superadmin"||m(v).user.profile.role=="administrator")&&c.value.status!="complete"?(r(),_(S,{key:0,disabled:!B.value,onClick:he,color:"primary"},{default:s(()=>[E(g(m(C).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):f("",!0)]))]}),_:1})],64)):(r(),_(h,{key:1},{default:s(()=>[d("div",ht,g(Q.value),1)]),_:1})),a(h,null,{default:s(()=>[yt]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Pe,{options:R.value},null,8,["options"])]),_:1}))}};export{qt as _};
