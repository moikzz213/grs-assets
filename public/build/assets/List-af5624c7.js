import{r as s,a as ot,u as nt,G as it,H as dt,I as ut,c as g,w as p,m as ct,n as _,o as v,d as o,b as l,k as rt,V as pt,i as vt,h as mt,s as Y,J as V,x as ft,e as S,p as q,q as yt,t as i,K as gt,C as m,B as z,L as ht,aY as xt,M as _t,y as B,F as Vt,N as Ct,O as kt}from"./app-9890d8ad.js";import{_ as bt}from"./ApppageHeader-672a3ea3.js";import{d as wt,e as St}from"./encrypt-2a64e3a1.js";import{_ as zt}from"./AppSnackBar-d1c561e7.js";import{u as Bt}from"./formatDate-b9aad8c5.js";const Nt={class:"v-col-12"},Lt=l("div",{class:"mr-auto"},"Maintenance",-1),Rt={class:"v-col-12 v-col-md"},$t={class:"v-col-12 v-col-md"},Dt={class:"v-col-12 v-col-md"},It={class:"v-col-12 v-col-md"},Mt=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Pt=l("th",{class:"text-left text-capitalize"},"Urgency",-1),Ft=l("th",{class:"text-left text-capitalize"},"Priority",-1),Kt=l("br",null,null,-1),Ot=l("small",null,"(DD/MM/YY)",-1),Ut=l("th",{class:"text-right text-capitalize"},null,-1),At={class:"d-flex align-center justify-end"},Ht={__name:"List",setup(jt){const H=s({status:!1,type:"primary",text:null}),u=ot(),N=nt(),C=it(),d=s({loading:!1,data:[]}),k=s(0),G=s(0),y=s(""),W=s([10,20,50,100]),b=s(10),c=s({}),X=()=>{f()},w=()=>{n.value==1?f():n.value=1},L=()=>{localStorage.setItem("maintenance-search",St(y.value)),f()},Q=()=>{y.value="",localStorage.setItem("maintenance-search",""),f()},n=s(C.params&&C.params.page?C.params.page:1),Z=e=>e?e==1?"Normal":e==2?"Medium":"High":"",h=s([]),R=s(""),$=s(0),r=e=>{d.value.loading=!0,h.value[0]=e,$.value%2?h.value[1]="DESC":h.value[1]="ASC",$.value++,R.value=JSON.stringify(h.value),f()},D=s([]),tt=async()=>{await _(u.token).get("/api/fetch/companies").then(e=>{D.value=e.data}).catch(e=>{})},I=s([]),et=async()=>{await _(u.token).get("/api/fetch/locations/non-paginated/data").then(e=>{I.value=e.data}).catch(e=>{})},M=s([]),at=async()=>{await _(u.token).get("/api/fetch-global/incident-status/active").then(e=>{M.value=e.data}).catch(e=>{})},f=async()=>{console.log("objFIlter",c.value),d.value.loading=!0,await _(u.token).get("/api/fetch/maintenance-assets/data?page="+n.value+"&show="+b.value+"&search="+y.value+"&sort="+R.value+"&filter="+JSON.stringify(c.value)).then(e=>{k.value=e.data.last_page?e.data.last_page:e.data.length,n.value=e.data.current_page?e.data.current_page:n.value,G.value=e.data.total?e.data.total:e.data.length,d.value.data=e.data.data?e.data.data:e.data,d.value.loading=!1}).catch(e=>{d.value.loading=!1,console.log(e)})};dt(n,(e,a)=>{n.value&&e!=a&&(N.push({name:"PaginatedMaintenance",params:{page:n.value}}).catch(t=>{}),f(n.value))});const P=(e,a)=>{let t={type:"details"};a=="view"&&(t={type:"details",pd:"ox2rKaIYFhBOQW31j6kkiMrJ4KfnYpLmwJhMzBFwPBlVjgGR4g",v:1,vv:"xK2sX1sDL1BBAvmuoPpWoNRgc4wzbdZ9F2OXAKrS3N2g65xNgy"}),N.push({name:"EditMaintenance",params:{id:e},query:t}).catch(x=>{console.log(x)})},lt=e=>{console.log("delete",e)},st=(e,a=5)=>{let t="0000"+e;return t.substring(t.length-a)};return ut(()=>{let e=localStorage.getItem("maintenance-search");e&&(y.value=wt(e)),f().then(()=>{tt(),et(),at()})}),(e,a)=>(v(),g(ct,null,{default:p(()=>[o(bt,{title:"Maintenance list page"}),o(Y,{class:"mb-3"},{default:p(()=>[l("div",Nt,[o(rt,{loading:d.value.loading},{default:p(()=>[o(pt,{class:"d-flex align-center mb-3 pa-3"},{default:p(()=>[Lt,o(vt,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=t=>y.value=t),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":L,onKeydown:mt(L,["enter"]),"onClick:clear":a[1]||(a[1]=t=>Q("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(Y,{class:"px-3"},{default:p(()=>[l("div",Rt,[o(V,{items:D.value,modelValue:c.value.company_id,"onUpdate:modelValue":[a[2]||(a[2]=t=>c.value.company_id=t),w],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",$t,[o(V,{items:I.value,modelValue:c.value.location_id,"onUpdate:modelValue":[a[3]||(a[3]=t=>c.value.location_id=t),w],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",Dt,[o(V,{items:M.value,modelValue:c.value.status_id,"onUpdate:modelValue":[a[4]||(a[4]=t=>c.value.status_id=t),w],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])]),l("div",It,[o(V,{items:W.value,modelValue:b.value,"onUpdate:modelValue":[a[5]||(a[5]=t=>b.value=t),X],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])])]),_:1}),o(ft,null,{default:p(()=>[l("thead",null,[l("tr",null,[Mt,Pt,Ft,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[6]||(a[6]=t=>r("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[7]||(a[7]=t=>r("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[8]||(a[8]=t=>r("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[9]||(a[9]=t=>r("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[10]||(a[10]=t=>r("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[11]||(a[11]=t=>r("handled_by"))}," HandledBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[12]||(a[12]=t=>r("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[13]||(a[13]=t=>r("created_at"))},[S(" D.Created"),Kt,Ot]),Ut])]),l("tbody",null,[(v(!0),q(Vt,null,yt(d.value.data,t=>{var x,F,K,O,U,A,j,E,J;return v(),q("tr",{key:t.id},[l("td",null,"ISR-2"+i(st(t.id)),1),l("td",null,i((x=t.urgency)==null?void 0:x.title),1),l("td",null,i(Z(t.priority)),1),l("td",null,i((F=t.company)==null?void 0:F.title),1),l("td",null,i((K=t.location)==null?void 0:K.title),1),l("td",null,i(t.asset?t.asset.asset_name:t.title),1),l("td",null,i((O=t.asset)==null?void 0:O.asset_code),1),l("td",null,i((U=t.profile)==null?void 0:U.display_name),1),l("td",null,i((A=t.handled_by)==null?void 0:A.display_name),1),l("td",null,[o(gt,{class:"text-uppercase",size:"small",color:`${((j=t.status)==null?void 0:j.title.toLowerCase())=="completed"?"success":"error"}`},{default:p(()=>{var T;return[S(i((T=t.status)==null?void 0:T.title),1)]}),_:2},1032,["color"])]),l("td",null,i(m(Bt)(t.created_at)),1),l("td",null,[l("div",At,[m(u).user.role=="superadmin"||(E=m(u).capabilities)!=null&&E.includes("edit")?(v(),g(z,{key:0,size:"small",onClick:()=>P(t.id,"edit"),icon:m(ht),class:"mx-1"},null,8,["onClick","icon"])):(v(),g(z,{key:1,size:"small",onClick:()=>P(t.id,"view"),icon:m(xt),class:"mx-1"},null,8,["onClick","icon"])),m(u).user.role=="superadmin"||(J=m(u).capabilities)!=null&&J.includes("delete")?(v(),g(z,{key:2,size:"small",onClick:()=>lt(t.id),icon:m(_t),class:"mx-1"},null,8,["onClick","icon"])):B("",!0)])])])}),128))])]),_:1}),d.value.data.length==0?(v(),g(Ct,{key:0,class:"pa-3 text-center w-100"},{default:p(()=>[S("No records found")]),_:1})):B("",!0)]),_:1},8,["loading"]),k.value>1?(v(),g(kt,{key:0,modelValue:n.value,"onUpdate:modelValue":a[14]||(a[14]=t=>n.value=t),class:"my-4",length:k.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:d.value.loading},null,8,["modelValue","length","disabled"])):B("",!0)])]),_:1}),o(zt,{options:H.value},null,8,["options"])]),_:1}))}};export{Ht as default};
