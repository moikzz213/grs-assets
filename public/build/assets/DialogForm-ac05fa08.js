import{i as ne,r,W as re,O as K,aW as ie,b as n,c,l as a,k as u,A as q,E as _,e as m,ap as ce,K as g,V as ve,m as V,t as S,a4 as z,q as B,F as A,d as D,j,y as me,a2 as J,x as X,I as k,P as Y,M as pe,z as U,G as fe,J as he,S as ye,X as _e,Y as Z,Z as H,_ as be,$ as ge,D as T}from"./app-8e01dea9.js";import{a as Ve,c as ke,F as we,b as xe}from"./index.esm-633d08bf.js";import{_ as Ce}from"./Studio-54818f6e.js";const Fe={class:"text-error"},Se={class:"d-flex pa-3"},Ae={key:0,class:"v-col-4",style:{"border-left":"1px solid #ccc"}},De=m("h5",null,"ADD ASSET",-1),je={key:1,class:"v-col-4 text-center",style:{"border-left":"1px solid #ccc","background-color":"#e0e0e0"}},Ue={class:"d-flex mb-5 justify-center"},Oe={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ne=m("div",{class:"mb-5",style:{position:"absolute",bottom:"0"}}," Note: Dont forget to click the save button at the top ",-1),qe={__name:"DialogForm",props:{dataObject:{type:Object,default:{}},addNewDialog:{type:Boolean,default:!1},title:{type:String,default:""},freeForm:{type:Array,default:[]}},emits:["savedResponse","fileSave","save"],setup(Q,{emit:O}){const v=Q,w=ne(),N=r(""),ee=e=>{let l=null;e.map(d=>{l=i.value.find(o=>o.id==d.id),l||i.value.push(d)})},R=r([]),x=r(""),$=r(!1),I=r(1),ae=e=>{I.value=e,$.value=!0},le=e=>{i.value=i.value.filter(l=>l.id!==e)},i=r([]),W=re(()=>i.value.map(e=>e.id)),te=()=>{let e={id:parseInt(G.value),file_ids:W.value,profile_id:w.user.profile.id};T(w.token).post("/api/warranty/sync-images/store-update",e).then(l=>{let d="Attachment has been updated";W.value.length==0&&(d="Attachment has been deleted"),O("fileSave",d)}).catch(l=>{})},se=e=>{let l=s.value.display_assets,d=s.value.assets;l.splice(e,1),s.value.display_assets=[...l],d.splice(e,1),console.log("index",e),s.value.assets=[...d],console.log("dataObj.value",s.value)},h=r(!1),s=r({}),C=r(v.freeForm);K(()=>v.freeForm,e=>{C.value=[...e],console.log("props.freeForm",v.freeForm),console.log("freeForm.value",C.value)});const E=()=>{h.value=!1,s.value={},O("cancelled",h.value)},L=()=>{h.value=!1,O("save",s.value),s.value={}},M=r({});C.value.map((e,l)=>{e.required&&(M.value[e.name]=Ve().required())});let oe=ke(M.value);const y=r(!1),ue=e=>{T(w.token).post("/api/fetch/warranty/by/id/"+e).then(l=>{var d,o,t,p,f;((t=(o=(d=l==null?void 0:l.data)==null?void 0:d.data)==null?void 0:o.pivot_assets)==null?void 0:t.length)>0&&l.data.data.pivot_assets.map((b,F)=>{s.value.assets.push(b.id),s.value.display_assets.push(b)}),i.value=(f=(p=l.data)==null?void 0:p.data)==null?void 0:f.attachment}).catch(l=>{})},P=r(window.location.origin),G=r(0);K(()=>v.addNewDialog,e=>{y.value=!1,s.value={},h.value=e,N.value="New "+v.title,v.dataObject.type&&(s.value=v.dataObject,N.value="Edit "+v.title,v.title=="Warranty"&&(s.value.assets=[],s.value.display_assets=[],s.value.pivot_assets=[],ue(s.value.id),G.value=s.value.id,y.value=!0))});const de=e=>{e.length<4||T(w.token).get("/api/search-assets/warranty/"+e).then(l=>{let d=[];l.data&&l.data.length>0&&l.data.map((o,t)=>{d[t]=o,d[t].new_title=o.asset_name+" ("+o.asset_code+")"}),R.value=d}).catch(l=>{})};return K(()=>x.value,e=>{e&&(s.value.assets.includes(e.id)||(s.value.assets.push(e.id),s.value.display_assets.push(e)),x.value=""),console.log("dataObj.value",e)}),(e,l)=>{const d=ie("v-card-action");return n(),c("div",null,[a(H,{width:y.value?1200:600,persistent:"",modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=o=>h.value=o),onKeydown:X(E,["esc"]),class:"d-flex",style:{overflow:"auto"}},{default:u(()=>[a(q,{class:"py-3"},{default:u(()=>[a(_,null,{default:u(()=>[m("div",{class:ce(`${y.value?"v-col-4":"v-col-12"}`)},[a(g(we),{as:"v-form","validation-schema":g(oe)},{default:u(({meta:o})=>[a(ve,{class:"text-h6 d-flex"},{default:u(()=>[V(S(N.value),1),a(z),m("small",Fe,S(e.errorMessage),1),a(z)]),_:1}),a(B,null,{default:u(()=>[a(_,null,{default:u(()=>[(n(!0),c(A,null,D(C.value,(t,p)=>(n(),c("div",{class:"v-col-12",key:p},[a(g(xe),{name:t.name,modelValue:s.value[t.name],"onUpdate:modelValue":f=>s.value[t.name]=f},{default:u(({field:f,errors:b})=>[t.type=="text"||t.type=="number"||t.type=="date"||t.type=="email"?(n(),j(me,J({key:0,type:t.type,autofocus:p===0,modelValue:s.value[t.name],"onUpdate:modelValue":F=>s.value[t.name]=F,density:"compact",variant:"outlined",label:`${t.label}${t.required?"*":" (Optional)"}`,"hide-details":""},f,{onKeydown:X(L,["enter"]),"error-messages":b}),null,16,["type","autofocus","modelValue","onUpdate:modelValue","label","onKeydown","error-messages"])):k("",!0),t.type=="select"?(n(),j(Y,J({key:1,autofocus:p===0,modelValue:s.value[t.name],"onUpdate:modelValue":F=>s.value[t.name]=F,density:"compact",variant:"outlined",label:`${t.label}${t.required?"*":""}`,items:t.data,"hide-details":"","item-value":"id","item-title":"title"},f,{"error-messages":b}),null,16,["autofocus","modelValue","onUpdate:modelValue","label","items","error-messages"])):k("",!0)]),_:2},1032,["name","modelValue","onUpdate:modelValue"])]))),128))]),_:1})]),_:1}),a(pe,{class:"mt-2"}),m("div",Se,[a(z),a(U,{size:"small",text:"cancel",onClick:E,class:"mx-1"}),a(U,{size:"small",color:"primary",onClick:L,disabled:!o.valid},{default:u(()=>[V("Save")]),_:2},1032,["disabled"])])]),_:1},8,["validation-schema"])],2),y.value?(n(),c("div",Ae,[a(B,null,{default:u(()=>[De,a(_,{class:"mt-1"},{default:u(()=>[a(fe,null,{default:u(()=>[a(Y,{density:"compact",label:"Search asset name or code",variant:"outlined",items:R.value,"onUpdate:search":de,"item-value":"id","item-title":"new_title",modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=o=>x.value=o),"hide-details":"",clearable:"","return-object":""},null,8,["items","modelValue"])]),_:1})]),_:1}),a(_,{style:{"max-height":"460px",overflow:"auto"}},{default:u(()=>[(n(!0),c(A,null,D(s.value.display_assets,(o,t)=>(n(),c("div",{class:"v-col-12 v-col-md-12 text-caption py-1",key:t},[V(" - "+S(o.asset_name)+" ",1),m("b",null,"("+S(o.asset_code)+")",1),a(he,{onClick:p=>se(t),class:"ml-2 cursor-pointer",color:"error",icon:g(ye)},null,8,["onClick","icon"])]))),128))]),_:1})]),_:1}),a(d,{class:"mb-5",style:{position:"absolute",bottom:"0"}},{default:u(()=>[V(" Note: Dont forget to click the save button ")]),_:1})])):k("",!0),y.value?(n(),c("div",je,[a(B,null,{default:u(()=>[m("div",Ue,[a(Ce,{options:{multiSelect:!0,type:"warranty"},onSelect:ee}),a(U,{color:"primary",onClick:te,disabled:i.value.length==0},{default:u(()=>[V("Save Images")]),_:1},8,["disabled"])]),i.value.length>0?(n(),j(_,{key:0,class:"px-1"},{default:u(()=>[(n(!0),c(A,null,D(i.value,(o,t)=>(n(),c("div",{key:o.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[a(U,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:g(_e),size:"18px",color:"error",onClick:()=>le(o.id)},null,8,["icon","onClick"]),a(q,{onClick:()=>ae(t)},{default:u(()=>[a(Z,{src:P.value+"/file/"+o.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),a(H,{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=o=>$.value=o),width:"95%","max-width":"900"},{default:u(()=>[a(q,{class:"bg-black"},{default:u(()=>[a(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:I.value,"onUpdate:modelValue":l[1]||(l[1]=o=>I.value=o)},{default:u(()=>[(n(!0),c(A,null,D(i.value,(o,t)=>(n(),j(ge,{key:t,"reverse-transition":"fade",transition:"fade"},{default:u(()=>[m("div",Oe,[a(Z,{src:P.value+"/file/"+o.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):k("",!0),a(_,null,{default:u(()=>[Ne]),_:1})]),_:1})])):k("",!0)]),_:1})]),_:1})]),_:1},8,["width","modelValue","onKeydown"])])}}};export{qe as _};
