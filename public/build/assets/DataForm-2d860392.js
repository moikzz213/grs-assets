import{a as ye,r,I as ge,u as Ve,K as be,T as ke,J as W,o as n,c as h,w as o,d as a,v as we,k as E,V as Ae,b as l,t as p,p as V,y,ag as J,E as v,H as F,f as z,s as _,j as S,e as T,L as O,i as k,q as P,F as D,X as Se,W as xe,P as Te,D as X,O as Ue,aE as Ce,aF as qe,aG as Ee,aH as Oe,aI as Re,m as je,n as U}from"./app-a94ba3ec.js";import{_ as De}from"./ApppageHeader-4863d590.js";import{_ as Le}from"./Studio-ea60e765.js";import{_ as Ne}from"./AppSnackBar-94a750b1.js";import{u as Z}from"./formatDate-b9aad8c5.js";import{r as ee}from"./generateRandomString-02c0ba3b.js";const Ie={key:0,class:"text-error text-h6"},Be={class:"v-col-8 text-right"},Fe={key:0,class:"no-print"},ze={key:1,class:"v-col-8 text-right"},Pe={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12 v-col-md-6"},Qe={class:"v-col-12 v-col-md-6"},$e={class:"v-col-12 v-col-md-6"},Ge={class:"v-col-12"},He={class:"v-col-12"},Ke=l("div",{class:"w-30"},"ITEM DESCRIPTION",-1),Ye=l("div",{class:"w-15"},"ASSET CODE",-1),We=l("div",{class:"w-10"},"QTY",-1),Je=l("div",{class:"w-10"},"WEIGHT",-1),Xe=l("div",{class:"w-10"},"VALUE",-1),Ze=l("div",{class:"w-20"},"REASON FOR REQUEST",-1),et={class:"w-30"},tt={class:"w-15"},at={class:"w-10"},lt={class:"w-10"},st={class:"w-10"},ot={class:"w-20"},dt={class:"v-col-12 v-col-md-1 px-1 no-print"},it={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},nt={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},rt={class:"v-col-12 pt-0 pb-0"},ut={class:"v-col-12 v-col-md-3"},ct={class:"v-col-12 v-col-md-2"},pt={class:"v-col-12 v-col-md-1"},vt={class:"v-col-12 v-col-md-1"},mt={class:"v-col-12 v-col-md-1"},_t={class:"v-col-12 v-col-md-3 d-flex"},ft={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},ht=l("div",null,"APPROVAL SETUP",-1),yt={key:0,class:"no-print"},gt=l("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),Vt={class:"v-col-12 v-col-md-6"},bt=l("div",{class:"v-col-12 v-col-md-1"},"Status",-1),kt=l("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),wt={class:"v-col-12 v-col-md-2"},At={class:"v-col-12 v-col-md-7 d-flex"},St={class:"my-auto"},xt={class:"v-col-12 no-print"},Tt={class:"v-col-12 text-error"},Ut=l("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),Dt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(te,{emit:ae}){const b=te,m=ye(),M=r("Note: Administrator needs to setup signatories first."),L=r(!1),w=ge(),le=Ve(),i=r({}),A=r(!1),g=r([{qty:1,attachment:{}}]),se=r(new Date),Q=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},oe=r(window.location.origin),de=(t,s)=>{g.value[t].attachment=s[0]},N=r(!1),$=r(1),ie=t=>{$.value=t,N.value=!0},ne=t=>{g.value[t].attachment=""},G=r([]),re=async()=>{let t="request";b.headertitle=="Transfer Assets"&&(t="transfer"),await U(m.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(s=>{G.value=s.data}).catch(s=>{})},R=r({}),H=r([]),ue=async()=>{await U(m.token).get("/api/fetch/companies").then(t=>{H.value=t.data}).catch(t=>{})},I=r([]),ce=async()=>{await U(m.token).get("/api/fetch/locations/non-paginated/data").then(t=>{I.value=t.data}).catch(t=>{})},pe=()=>{g.value.push({qty:1,attachment:{}}),C()},ve=(t,s)=>{g.value.splice(s,1),C()},me=()=>{R.value={status:!0,type:"info",text:"Please wait..."};let t=g.value.map((e,d)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),s={data:i.value,assets:t,approval:x.value,profile_id:m.user.profile.id,role:m.user.profile.role,type:"transfer"};U(m.token).post("/api/request-asset/store-update/data",s).then(e=>{let d="",f="";e.data.message?(d=e.data.message,f="success"):e.data.error&&(d=e.data.error,f="error"),R.value={status:!0,type:f,text:d},w.params.id||setTimeout(()=>{le.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(B=>{})},800)}).catch(e=>{console.log(e)})},x=r([]),j=r(!0),K=async()=>{await U(m.token).get("/api/fetch/request-asset/approval-setup-fetch/"+i.value.request_type_id).then(t=>{var s,e;x.value=(s=t.data)==null?void 0:s.stages,w.params.id&&x.value.length>0&&x.value.map((d,f)=>(d.profile_id=q.value[f].profile_id,d.status=q.value[f].status,d.date_approved=q.value[f].date_approved,d.reason_rejected=q.value[f].reason_rejected,d)),((e=t.data)==null?void 0:e.stages.length)>0?j.value=!0:j.value=!1}).catch(t=>{})},C=()=>{let t=!1;L.value=!1,i.value.company_id&&i.value.request_type_id&&i.value.subject&&i.value.transferred_from&&i.value.transferred_to&&(t=!0);let s=!0;g.value.map(d=>{d.item_description&&d.reason_for_request||(s=!1)});let e=!0;x.value.map(d=>{d.profile_id||(e=!1)}),e&&s&&t&&(L.value=!0)},Y=t=>{let s={status:t,profile_id:m.user.profile.id,ID:u.value.id};U(m.token).post("/api/request-asset/change-request/data",s).then(e=>{R.value={status:!0,type:"success",text:e.data.message},u.value.status=t,ae("saved",e.data.message)}).catch(e=>{})},_e=(t,s=6)=>{let e="00000"+t;return e.substring(e.length-s)},q=r([]),u=r({});be(()=>{if(re().then(()=>{ue().then(()=>{ce()})}),w.params.id){A.value=!0;let t=b.objectdata;u.value=t,i.value.company_id=t.company_id,i.value.request_type_id=t.request_type_id,i.value.subject=t.subject,i.value.transferred_from=t.transferred_from,i.value.transferred_to=t.transferred_to,i.value.id=t.id,i.value.requestor_id=t.profile_id,q.value=t.request_approvals,g.value=t.items,K()}else i.value.company_id=m.user.profile.company_id});const fe=r("https://assets.grandiose.ae/"),he=ke(()=>{let t=null,s=fe.value+"pv/employee-signatory",e=ee(50),d=ee(50);return u.value&&(t=s+"/transfer/approvals?o=99&key="+e+"&pid=95&pv="+d+"&id="+u.value.id),t});return W(i.value,async(t,s)=>{C()}),W(g.value,async(t,s)=>{C()}),(t,s)=>(n(),h(je,null,{default:o(()=>[a(De,{title:b.headertitle,class:"no-print"},null,8,["title"]),a(_,{class:"mb-3"},{default:o(()=>[a(we,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:o(()=>[a(E,null,{default:o(()=>[a(Ae,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:o(()=>[l("div",null,p(b.headertitle),1),j.value?y("",!0):(n(),V("div",Ie,p(M.value),1)),A.value?(n(),V("div",{key:1,class:J(u.value.status=="cancelled"?"text-error":u.value.status=="complete"?"text-success":"")}," STATUS ("+p(u.value.status)+") ",3)):y("",!0),l("div",null,"DATE: "+p(v(Z)(se.value)),1)]),_:1}),a(F),a(z,null,{default:o(()=>[a(_,null,{default:o(()=>[A.value?(n(),V("div",{key:0,class:J(`${u.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+p(_e(u.value.id)),3)):y("",!0),l("div",Be,[A.value&&(u.value.status=="pending"||u.value.status=="cancelled")?(n(),V("div",Fe,[u.value.status=="pending"?(n(),h(S,{key:0,onClick:s[0]||(s[0]=e=>Y("cancelled")),size:"small",color:"warning"},{default:o(()=>[T("Cancel request")]),_:1})):y("",!0),u.value.status=="cancelled"?(n(),h(S,{key:1,onClick:s[1]||(s[1]=e=>Y("pending")),size:"small",color:"info"},{default:o(()=>[T("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)]),u.value.status=="complete"?(n(),V("div",ze)):y("",!0),l("div",Pe,[a(O,{items:G.value,modelValue:i.value.request_type_id,"onUpdate:modelValue":[s[2]||(s[2]=e=>i.value.request_type_id=e),K],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:A.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),l("div",Me,[a(O,{items:H.value,modelValue:i.value.company_id,"onUpdate:modelValue":s[3]||(s[3]=e=>i.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),l("div",Qe,[a(O,{items:I.value,modelValue:i.value.transferred_from,"onUpdate:modelValue":s[4]||(s[4]=e=>i.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),l("div",$e,[a(O,{items:I.value,modelValue:i.value.transferred_to,"onUpdate:modelValue":s[5]||(s[5]=e=>i.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),l("div",Ge,[a(k,{modelValue:i.value.subject,"onUpdate:modelValue":s[6]||(s[6]=e=>i.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(E,{class:"my-2"},{default:o(()=>[a(z,null,{default:o(()=>[a(_,null,{default:o(()=>{var e;return[l("div",He,[!v(w).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||v(m).user.profile.role=="superadmin"||v(m).user.profile.role=="administrator"?(n(),h(S,{key:0,size:"small",color:"primary",class:"no-print",onClick:pe},{default:o(()=>[T("Add")]),_:1})):y("",!0)])]}),_:1}),a(_,{class:"for-print-flex header mb-1"},{default:o(()=>[Ke,Ye,We,Je,Xe,Ze]),_:1}),(n(!0),V(D,null,P(g.value,(e,d)=>(n(),h(_,{key:d,class:"for-print-flex row-bordered"},{default:o(()=>[l("div",et,p(e.item_description),1),l("div",tt,p(e.asset_code),1),l("div",at,p(e.qty),1),l("div",lt,p(e.weight),1),l("div",st,p(e.item_value),1),l("div",ot,p(e.reason_for_request),1)]),_:2},1024))),128)),(n(!0),V(D,null,P(g.value,(e,d)=>(n(),h(_,{key:d,class:"no-print"},{default:o(()=>{var f,B;return[l("div",dt,[(f=e.attachment)!=null&&f.id?(n(),h(_,{key:0,class:"px-1"},{default:o(()=>[l("div",it,[a(k,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":c=>e.attachment.id=c},null,8,["modelValue","onUpdate:modelValue"]),a(S,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:t.mdiClose,size:"16px",color:"error",onClick:()=>ne(d,e.attachment.id)},null,8,["icon","onClick"]),a(E,{onClick:()=>ie(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(Se,{modelValue:N.value,"onUpdate:modelValue":s[7]||(s[7]=c=>N.value=c),width:"95%","max-width":"900"},{default:o(()=>[a(E,{class:"bg-black"},{default:o(()=>[l("div",nt,[a(xe,{src:oe.value+"/file/"+$.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(n(),h(_,{key:1,class:"mt-0"},{default:o(()=>[l("div",rt,[a(Te,{color:"grey-lighten-4",class:"text-center"},{default:o(()=>[a(Le,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:c=>de(d,c)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),l("div",ut,[a(k,{modelValue:e.item_description,"onUpdate:modelValue":c=>e.item_description=c,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ct,[a(k,{modelValue:e.asset_code,"onUpdate:modelValue":c=>e.asset_code=c,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",pt,[a(k,{type:"number",modelValue:e.qty,"onUpdate:modelValue":c=>e.qty=c,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",vt,[a(k,{type:"number",modelValue:e.weight,"onUpdate:modelValue":c=>e.weight=c,variant:"outlined",density:"compact",class:"no-print","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",mt,[a(k,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":c=>e.item_value=c,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",_t,[a(k,{modelValue:e.reason_for_request,"onUpdate:modelValue":c=>e.reason_for_request=c,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"REASON FOR REQUEST*"},null,8,["modelValue","onUpdate:modelValue"]),!A.value||A.value&&v(m).user.profile.id==b.objectdata.profile_id&&((B=b.objectdata)==null?void 0:B.status)=="pending"?(n(),h(X,{key:0,size:"small",onClick:()=>ve(e.id,d),icon:v(Ue),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(E,{class:"my-2 page-break"},{default:o(()=>[a(z,null,{default:o(()=>[a(_,null,{default:o(()=>[l("div",ft,[ht,v(w).params.id?(n(),V("div",yt,[a(S,{color:"info",size:"small",target:"_blank",href:he.value},{default:o(()=>[T("View Approval Page")]),_:1},8,["href"])])):y("",!0)]),a(F)]),_:1}),a(_,null,{default:o(()=>{var e,d;return[gt,l("div",Vt,p((d=(e=u.value)==null?void 0:e.profile)==null?void 0:d.display_name),1),bt,kt]}),_:1}),j.value?(n(),V(D,{key:0},[(n(!0),V(D,null,P(x.value,(e,d)=>(n(),h(_,{key:e.id},{default:o(()=>[l("div",wt,p(e.types?Q(e.types):Q(e.approval_type)),1),l("div",At,[a(O,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[f=>e.profile_id=f,C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(S,{variant:"text",size:"x-small",class:"no-print"},{default:o(()=>[e.status?(n(),h(X,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?v(Ce):e.status=="pending"?v(qe):e.status=="reject"?v(Ee):v(Oe),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),a(Re,{activator:"parent",location:"top","max-width":"400"},{default:o(()=>[T(p(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),l("div",St,p(e.date_approved?v(Z)(e.date_approved):""),1)]),_:2},1024))),128)),a(_,null,{default:o(()=>{var e;return[a(F),l("div",xt,[(!v(w).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||v(m).user.profile.role=="asset-supervisor"||v(m).user.profile.role=="superadmin"||v(m).user.profile.role=="administrator")&&u.value.status!="complete"?(n(),h(S,{key:0,size:"small",disabled:!L.value,onClick:me,color:"primary"},{default:o(()=>[T(p(v(w).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)])]}),_:1})],64)):(n(),h(_,{key:1},{default:o(()=>[l("div",Tt,p(M.value),1)]),_:1})),a(_,null,{default:o(()=>[Ut]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Ne,{options:R.value},null,8,["options"])]),_:1}))}};export{Dt as _};
