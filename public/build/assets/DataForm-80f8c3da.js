import{a as ke,r as v,I as we,u as Ae,K as qe,J as Z,T as ee,o as u,c as h,w as o,d as a,v as xe,k as O,V as Se,b as l,t as m,p as V,y,ag as te,E as p,H as M,f as $,s as f,j as S,e as T,L as R,i as w,q as G,F as I,U as Ue,X as Ce,W as Te,P as Ee,D as ae,O as je,aE as Oe,aF as Re,aG as De,aH as Le,aI as Ne,m as Ie,n as E}from"./app-a94ba3ec.js";import{_ as Be}from"./ApppageHeader-4863d590.js";import{_ as Fe}from"./Studio-ea60e765.js";import{_ as Pe}from"./AppSnackBar-94a750b1.js";import{u as le}from"./formatDate-b9aad8c5.js";import{r as se}from"./generateRandomString-02c0ba3b.js";const ze={key:0,class:"text-error text-h6"},Me={class:"col-12 v-col-md-4"},$e={key:0,class:"v-col-12 v-col-md-8"},Ge={key:0,class:"text-right no-print"},He={class:"v-col-12 v-col-md-6"},Ke={class:"v-col-12 v-col-md-6"},Qe={class:"v-col-12 v-col-md-6"},Ye={class:"v-col-12 v-col-md-6"},We={class:"v-col-12"},Je={class:"v-col-12"},Xe=l("div",{class:"w-30"},"ITEM DESCRIPTION",-1),Ze=l("div",{class:"w-15"},"ASSET CODE",-1),et=l("div",{class:"w-10"},"QTY",-1),tt=l("div",{class:"w-10"},"WEIGHT",-1),at=l("div",{class:"w-10"},"VALUE",-1),lt=l("div",{class:"w-20"},"REASON FOR REQUEST",-1),st={class:"w-30"},ot={class:"w-15"},dt={class:"w-10"},it={class:"w-10"},nt={class:"w-10"},ut={class:"w-20"},rt={class:"v-col-12 v-col-md-1 px-1"},ct={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},vt={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},pt={class:"v-col-12 pt-0 pb-0"},_t={class:"v-col-12 v-col-md-3"},mt={class:"v-col-12 v-col-md-2"},ft={class:"v-col-12 v-col-md-1"},ht={class:"v-col-12 v-col-md-1"},yt={class:"v-col-12 v-col-md-1"},gt={class:"v-col-12 v-col-md-3 d-flex"},Vt={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},bt=l("div",null,"APPROVAL SETUP",-1),kt={key:0,class:"no-print"},wt=l("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),At={class:"v-col-12 v-col-md-6"},qt=l("div",{class:"v-col-12 v-col-md-1"},"Status",-1),xt=l("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),St={class:"v-col-12 v-col-md-2"},Ut={class:"v-col-12 v-col-md-7 d-flex"},Ct={class:"my-auto"},Tt={key:0,class:"v-col-12"},Et={class:"v-col-12 text-error"},jt=l("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),Bt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(oe,{emit:de}){const A=oe,_=ke(),B=v(!1),q=we(),ie=Ae(),i=v({}),x=v(!1),b=v([{qty:1,attachment:{}}]),ne=v(new Date),ue=v(window.location.origin),re=(t,s)=>{b.value[t].attachment=s[0]},F=v(!1),H=v(1),ce=t=>{H.value=t,F.value=!0},ve=t=>{b.value[t].attachment=""},K=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},Q=v([]),pe=async()=>{await E(_.token).get("/api/fetch/approval-setups/non-paginated/data/request").then(t=>{Q.value=t.data}).catch(t=>{})},D=v({}),Y=v([]),_e=async()=>{await E(_.token).get("/api/fetch/companies").then(t=>{Y.value=t.data}).catch(t=>{})},P=v([]),me=async()=>{await E(_.token).get("/api/fetch/locations/non-paginated/data").then(t=>{P.value=t.data}).catch(t=>{})},fe=()=>{b.value.push({qty:1,attachment:{}}),U()},he=(t,s)=>{b.value.splice(s,1),U()},W=v("Note: Administrator needs to setup signatories first."),ye=()=>{D.value={status:!0,type:"info",text:"Please wait..."};let t=b.value.map((e,n)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),s={data:i.value,assets:t,approval:k.value,profile_id:_.user.profile.id,type:"request",role:_.user.profile.role};E(_.token).post("/api/request-asset/store-update/data",s).then(e=>{let n="",g="";e.data.message?(n=e.data.message,g="success"):e.data.error&&(n=e.data.error,g="error"),D.value={status:!0,type:g,text:n},q.params.id||setTimeout(()=>{ie.push({name:"EditRequestAsset",params:{id:e.data.id}}).catch(C=>{})},800)}).catch(e=>{console.log(e)})},k=v([]),L=v(!0),J=async()=>{await E(_.token).get("/api/fetch/request-asset/approval-setup-fetch/"+i.value.request_type_id).then(t=>{var s,e,n,g,C,r;console.log("setupApprovals",t),k.value=(s=t.data)==null?void 0:s.stages,q.params.id&&k.value.length>0&&(k.value.map((j,N)=>(j.profile_id=d.value[N].profile_id,j.status=d.value[N].status,j.date_approved=d.value[N].date_approved,j.reason_rejected=d.value[N].reason_rejected,j)),k.value.length>1&&(k.value[d.value.length-1]={id:d.value[d.value.length-1].id,profile_id:d.value[d.value.length-1].profile_id,status:d.value[d.value.length-1].status,date_approved:d.value[d.value.length-1].date_approved,status:d.value[d.value.length-1].status,reason_rejected:"",types:d.value[d.value.length-1].approval_type,sort:d.value[d.value.length-1].orders,request_asset_id:d.value[d.value.length-1].request_asset_id,signatures:[{id:(e=d.value[d.value.length-1])==null?void 0:e.profile.id,display_name:(n=d.value[d.value.length-1])==null?void 0:n.profile.display_name,first_name:(g=d.value[d.value.length-1])==null?void 0:g.profile.first_name,last_name:(C=d.value[d.value.length-1])==null?void 0:C.profile.last_name}]})),((r=t.data)==null?void 0:r.stages.length)>0?L.value=!0:L.value=!1}).catch(t=>{})},U=()=>{let t=!1;B.value=!1,i.value.company_id&&i.value.request_type_id&&i.value.subject&&i.value.transferred_from&&i.value.transferred_to&&(t=!0);let s=!0;b.value.map(n=>{n.item_description&&n.reason_for_request||(s=!1)});let e=!0;k.value.map(n=>{n.profile_id||(e=!1)}),e&&s&&t&&(B.value=!0)},X=t=>{let s={status:t,profile_id:_.user.profile.id,ID:c.value.id};E(_.token).post("/api/request-asset/change-request/data",s).then(e=>{D.value={status:!0,type:"success",text:e.data.message},c.value.status=t,de("saved",e.data.message)}).catch(e=>{})},ge=(t,s=6)=>{let e="00000"+t;return e.substring(e.length-s)},d=v([]),c=v({});qe(()=>{if(pe().then(()=>{_e().then(()=>{me()})}),q.params.id){x.value=!0;let t=A.objectdata;c.value=t,i.value.company_id=t.company_id,i.value.request_type_id=t.request_type_id,i.value.subject=t.subject,i.value.transferred_from=t.transferred_from,i.value.transferred_to=t.transferred_to,i.value.id=t.id,i.value.requestor_id=t.profile_id,d.value=t.request_approvals,b.value=t.items,J()}else i.value.company_id=_.user.profile.company_id}),Z(i.value,async(t,s)=>{U()}),Z(b.value,async(t,s)=>{U()});const z=ee(()=>_.user.role=="receiving-releasing"),Ve=v("https://assets.grandiose.ae/"),be=ee(()=>{let t=null,s=Ve.value+"pv/employee-signatory",e=se(50),n=se(50);return c.value&&(t=s+"/"+c.value.types+"/approvals?o=99&key="+e+"&pid=95&pv="+n+"&id="+c.value.id),t});return(t,s)=>(u(),h(Ie,null,{default:o(()=>[a(Be,{title:A.headertitle,class:"no-print"},null,8,["title"]),a(f,{class:"mb-3"},{default:o(()=>[a(xe,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:o(()=>[a(O,null,{default:o(()=>[a(Se,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:o(()=>[l("div",null,m(A.headertitle),1),L.value?y("",!0):(u(),V("div",ze,m(W.value),1)),x.value?(u(),V("div",{key:1,class:te(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+m(c.value.status)+") ",3)):y("",!0),l("div",null,"DATE: "+m(p(le)(ne.value)),1)]),_:1}),a(M),a($,null,{default:o(()=>[a(f,null,{default:o(()=>[x.value?(u(),V("div",{key:0,class:te(`${c.value.status=="complete"?"v-col-12":"v-col-md-12"}`)},[a(f,null,{default:o(()=>[l("div",Me," REQUEST NO: SN-5"+m(ge(c.value.id)),1),z.value?y("",!0):(u(),V("div",$e,[x.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(u(),V("div",Ge,[c.value.status=="pending"?(u(),h(S,{key:0,onClick:s[0]||(s[0]=e=>X("cancelled")),color:"warning"},{default:o(()=>[T("Cancel request")]),_:1})):y("",!0),c.value.status=="cancelled"?(u(),h(S,{key:1,onClick:s[1]||(s[1]=e=>X("pending")),size:"small",color:"info"},{default:o(()=>[T("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)]))]),_:1})],2)):y("",!0),l("div",He,[a(R,{items:Q.value,modelValue:i.value.request_type_id,"onUpdate:modelValue":[s[2]||(s[2]=e=>i.value.request_type_id=e),J],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:x.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),l("div",Ke,[a(R,{items:Y.value,modelValue:i.value.company_id,"onUpdate:modelValue":s[3]||(s[3]=e=>i.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),l("div",Qe,[a(R,{items:P.value,modelValue:i.value.transferred_from,"onUpdate:modelValue":s[4]||(s[4]=e=>i.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),l("div",Ye,[a(R,{items:P.value,modelValue:i.value.transferred_to,"onUpdate:modelValue":s[5]||(s[5]=e=>i.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),l("div",We,[a(w,{modelValue:i.value.subject,"onUpdate:modelValue":s[6]||(s[6]=e=>i.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(O,{class:"my-2"},{default:o(()=>[a($,null,{default:o(()=>[z.value?y("",!0):(u(),h(f,{key:0},{default:o(()=>{var e;return[l("div",Je,[c.value.status!="complete"&&(!p(q).params.id||((e=A.objectdata)==null?void 0:e.status)=="pending"||p(_).user.profile.role=="superadmin"||p(_).user.profile.role=="administrator")?(u(),h(S,{key:0,color:"primary",class:"no-print",onClick:fe},{default:o(()=>[T("Add")]),_:1})):y("",!0)])]}),_:1})),a(f,{class:"for-print-flex header mb-1"},{default:o(()=>[Xe,Ze,et,tt,at,lt]),_:1}),(u(!0),V(I,null,G(b.value,(e,n)=>(u(),h(f,{key:n,class:"for-print-flex row-bordered"},{default:o(()=>[l("div",st,m(e.item_description),1),l("div",ot,m(e.asset_code),1),l("div",dt,m(e.qty),1),l("div",it,m(e.weight),1),l("div",nt,m(e.item_value),1),l("div",ut,m(e.reason_for_request),1)]),_:2},1024))),128)),(u(!0),V(I,null,G(b.value,(e,n)=>(u(),h(f,{key:n,class:"no-print"},{default:o(()=>{var g,C;return[l("div",rt,[(g=e.attachment)!=null&&g.id?(u(),h(f,{key:0,class:"px-1"},{default:o(()=>[l("div",ct,[a(w,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":r=>e.attachment.id=r},null,8,["modelValue","onUpdate:modelValue"]),a(S,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:p(Ue),size:"16px",color:"error",onClick:()=>ve(n,e.attachment.id)},null,8,["icon","onClick"]),a(O,{onClick:()=>ce(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(Ce,{modelValue:F.value,"onUpdate:modelValue":s[7]||(s[7]=r=>F.value=r),width:"95%","max-width":"900"},{default:o(()=>[a(O,{class:"bg-black"},{default:o(()=>[l("div",vt,[a(Te,{src:ue.value+"/file/"+H.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(u(),h(f,{key:1,class:"mt-0"},{default:o(()=>[l("div",pt,[a(Ee,{color:"grey-lighten-4",class:"text-center"},{default:o(()=>[a(Fe,{options:{multiSelect:!1,type:"request-asset"},onSelect:r=>re(n,r)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),l("div",_t,[a(w,{modelValue:e.item_description,"onUpdate:modelValue":[r=>e.item_description=r,U],variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",mt,[a(w,{modelValue:e.asset_code,"onUpdate:modelValue":r=>e.asset_code=r,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ft,[a(w,{type:"number",modelValue:e.qty,"onUpdate:modelValue":r=>e.qty=r,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ht,[a(w,{type:"number",modelValue:e.weight,"onUpdate:modelValue":r=>e.weight=r,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",yt,[a(w,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":r=>e.item_value=r,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",gt,[a(w,{modelValue:e.reason_for_request,"onUpdate:modelValue":r=>e.reason_for_request=r,variant:"outlined",density:"compact","hide-details":"",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!x.value||x.value&&p(_).user.profile.id==A.objectdata.profile_id&&((C=A.objectdata)==null?void 0:C.status)=="pending"?(u(),h(ae,{key:0,size:"small",onClick:()=>he(e.id,n),icon:p(je),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(O,{class:"my-2"},{default:o(()=>[a($,null,{default:o(()=>[a(f,null,{default:o(()=>[l("div",Vt,[bt,p(q).params.id?(u(),V("div",kt,[a(S,{color:"info",size:"small",target:"_blank",href:be.value},{default:o(()=>[T("View Approval Page")]),_:1},8,["href"])])):y("",!0)]),a(M)]),_:1}),a(f,null,{default:o(()=>{var e,n;return[wt,l("div",At,m((n=(e=c.value)==null?void 0:e.profile)==null?void 0:n.display_name),1),qt,xt]}),_:1}),L.value?(u(),V(I,{key:0},[(u(!0),V(I,null,G(k.value,(e,n)=>(u(),h(f,{key:e.id},{default:o(()=>[l("div",St,m(e.types?K(e.types):K(e.approval_type)),1),l("div",Ut,[a(R,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[g=>e.profile_id=g,U],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(S,{variant:"text",size:"x-small"},{default:o(()=>[e.status?(u(),h(ae,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?p(Oe):e.status=="pending"?p(Re):e.status=="reject"?p(De):p(Le),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),a(Ne,{activator:"parent",location:"top","max-width":"400"},{default:o(()=>[T(m(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),l("div",Ct,m(e.date_approved?p(le)(e.date_approved):""),1)]),_:2},1024))),128)),a(f,null,{default:o(()=>{var e;return[a(M),z.value?y("",!0):(u(),V("div",Tt,[(!p(q).params.id||((e=A.objectdata)==null?void 0:e.status)=="pending"||p(_).user.profile.role=="asset-supervisor"||p(_).user.profile.role=="superadmin"||p(_).user.profile.role=="administrator")&&c.value.status!="complete"?(u(),h(S,{key:0,disabled:!B.value,onClick:ye,color:"primary"},{default:o(()=>[T(m(p(q).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)]))]}),_:1})],64)):(u(),h(f,{key:1},{default:o(()=>[l("div",Et,m(W.value),1)]),_:1})),a(f,null,{default:o(()=>[jt]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Pe,{options:D.value},null,8,["options"])]),_:1}))}};export{Bt as _};
