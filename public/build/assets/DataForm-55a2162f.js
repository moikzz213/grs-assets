import{a as G,r as u,u as L,G as J,I as K,o as k,c as D,w as l,d as t,v as M,b as o,j as m,ae as $,e as y,k as X,y as h,V as Y,t as H,f as Q,s as f,i as q,X as W,a6 as Z,E as ee,p as te,q as ae,J as U,aw as se,ag as le,F as oe,z as ie,m as de,n as A,A as re,B as ne}from"./app-59e124a4.js";import{_ as ue}from"./ApppageHeader-28c99593.js";import{_ as ce}from"./AppSnackBar-cb4229f2.js";import{c as ve,a as pe,F as me,b as fe}from"./index.esm-9205b9d3.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const c=b=>(re("data-v-98527287"),b=b(),ne(),b),ge={class:"mb-3"},ye={class:"v-col-12 d-flex my-auto"},he={class:"v-col-12 px-6 pt-0 my-auto"},be={class:"v-col-12 px-6 pt-3"},Ve=c(()=>o("div",{class:"v-col-1 font-weight-bold"},null,-1)),Se=c(()=>o("div",{class:"v-col-3 font-weight-bold"}," TYPES ",-1)),xe=c(()=>o("div",{class:"v-col-5 font-weight-bold"}," SIGNATORIES ",-1)),we=c(()=>o("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),Ce=c(()=>o("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Requestor ",-1)),ke=c(()=>o("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Auto ",-1)),Ae={class:"v-col-12 v-col-md-1"},Te={class:"v-col-12 v-col-md-3"},De={class:"v-col-12 v-col-md-6 d-flex my-auto"},Re={class:"v-col-12 v-col-md-2 d-flex my-auto"},Fe=c(()=>o("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),je=c(()=>o("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Receiver ",-1)),Ie=c(()=>o("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Requestor ",-1)),$e={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(b,{emit:qe}){const _=b,v=G(),g=u([]),V=u({}),n=u({title:_.objectdata.title}),S=u([{id:"approve",value:"Approval"},{id:"releasing",value:"Asset Releasing"},{id:"receiver",value:"Asset Receiving"},{id:"reviewer",value:"Reviewer"},{id:"transport",value:"Transport Arrangement"},{id:"verify",value:"Verify"}]),R=u([]),F=L(),p=J(),x=u(p.params.type);let N=ve({Title:pe().required()});const T=s=>{x.value=s,F.push({path:"/approval-setup/"+s}),s=="transfer-asset"&&(S.value=S.value.filter(e=>e.id!=="releasing"))},w=u(0),z=()=>{let s={id:p.params.id,sort:w.value,profile_id:v.user.profile.id,class:"new"};A(v.token).post("/api/approval-setups/store-signatory/update-data",s).then(e=>{g.value.push({id:e.data.id,sort:w.value,types:null,signatories:[]}),w.value+=1,V.value={status:!0,type:"success",text:"New Signatory has been added"}}).catch(e=>{n.value.loading=!1})},B=async()=>{await A(v.token).get("/api/user/fetch/signatories").then(s=>{R.value=s.data}).catch(s=>{n.value.loading=!1,console.log(s)})},C=u(!1),E=u(!!p.params.id),O=(s,e)=>{let i={id:p.params.id,profile_id:v.user.profile.id,stageID:s,class:"deleted"};g.value.splice(e,1),A(v.token).post("/api/approval-setups/store-signatory/update-data",i).then(a=>{V.value={status:!0,type:"success",text:"Signatory has been deleted."}}).catch(a=>{n.value.loading=!1})},j=s=>{C.value=!0,V.value={status:!0,type:"info",text:"Please wait..."};let e="transfer";x.value=="request-asset"&&(e="request");let i=null;p.params.id&&(i=p.params.id);let a={id:i,type:e,signatories:s,profile_id:v.user.profile.id,class:"update"},d="/api/approval-setups/store-signatory/update-data";s=="title"&&(d="/api/approval-setups/store-update/data",a={id:i,type:e,title:n.value.title,signatories:g.value,profile_id:v.user.profile.id}),A(v.token).post(d,a).then(r=>{V.value={status:!0,type:"success",text:"Data has been saved."},C.value=!1,g.value.sort((I,P)=>I.sort-P.sort),p.params.id||setTimeout(()=>{F.push({name:"EditApproval",params:{id:r.data.id}}).catch(I=>{})},800)}).catch(r=>{n.value.loading=!1})};return K(()=>{if(B(),p.params.id&&(x.value=="transfer-asset"&&(S.value=S.value.filter(s=>s.id!=="releasing")),_.objectdata.stages.length>0)){let s=_.objectdata.stages[_.objectdata.stages.length-1].sort;_.objectdata.stages.map((e,i)=>{let a=[];e.signatures.map(d=>{d.profile_id!=0&&a.push(d.profile_id)}),g.value.push({id:e.id,sort:e.sort,types:e.types,signatories:a})}),w.value=s+1}}),(s,e)=>(k(),D(de,null,{default:l(()=>[t(ue,{title:"Global Approval Setup"}),t(f,{class:"mb-3"},{default:l(()=>[t(M,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[o("div",ge,[t(m,{class:$(`${x.value=="request-asset"?"tab-active":""}  v-col-12 v-col-md-3 mx-2`),onClick:e[0]||(e[0]=i=>T("request-asset"))},{default:l(()=>[y("Request Asset Approvals")]),_:1},8,["class"]),t(m,{class:$(`${x.value=="transfer-asset"?"tab-active":""}   v-col-12 v-col-md-3 mx-2`),onClick:e[1]||(e[1]=i=>T("transfer-asset"))},{default:l(()=>[y("Transfer Asset Approvals")]),_:1},8,["class"]),t(m,{class:"v-col-12 v-col-md-3 mx-2",color:"primary",onClick:e[2]||(e[2]=i=>T("change-approval"))},{default:l(()=>[y("Change / Assign Approvals")]),_:1})]),t(X,null,{default:l(()=>[t(h(me),{as:"v-form","validation-schema":h(N)},{default:l(({meta:i})=>[t(Y,{class:"my-3 ml-3 text-uppercase"},{default:l(()=>[y(H(_.headertitle),1)]),_:1}),t(Q,null,{default:l(()=>[t(f,null,{default:l(()=>[o("div",ye,[t(h(fe),{name:"Title",modelValue:n.value.title,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.title=a)},{default:l(({field:a,errors:d})=>[t(q,W({modelValue:n.value.title,"onUpdate:modelValue":e[3]||(e[3]=r=>n.value.title=r)},a,{"error-messages":d,label:"Title here*",variant:"outlined","hide-details":"auto",density:"compact",class:"v-col-10 pt-0"}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"]),t(m,{size:"small",class:"mt-1",color:"primary",disabled:!i.valid,loading:C.value,onClick:e[5]||(e[5]=a=>j("title"))},{default:l(()=>[y("Save")]),_:2},1032,["disabled","loading"])])]),_:2},1024),E.value?(k(),D(f,{key:0},{default:l(()=>[o("div",he,[t(m,{onClick:z,color:"primary",size:"x-small",icon:h(Z)},null,8,["icon"]),y(" Add Signatories ")]),o("div",be,[t(f,null,{default:l(()=>[Ve,Se,xe]),_:1}),t(ee),t(f,{class:"mt-0"},{default:l(()=>[we,Ce,ke]),_:1}),(k(!0),te(oe,null,ae(g.value,(a,d)=>(k(),D(f,{class:"mt-0",key:d},{default:l(()=>[o("div",Ae,[t(q,{modelValue:a.sort,"onUpdate:modelValue":r=>a.sort=r,label:"Sort*",variant:"outlined","hide-details":"auto",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",Te,[t(U,{label:"Select Type",modelValue:a.types,"onUpdate:modelValue":r=>a.types=r,"hide-details":"auto",variant:"outlined","item-value":"id","item-title":"value",density:"compact",items:S.value},null,8,["modelValue","onUpdate:modelValue","items"])]),o("div",De,[t(U,{label:"Select Signatory",modelValue:a.signatories,"onUpdate:modelValue":r=>a.signatories=r,"hide-details":"auto",variant:"outlined",density:"compact",multiple:"","item-value":"id","item-title":"display_name",items:R.value},null,8,["modelValue","onUpdate:modelValue","items"])]),o("div",Re,[t(m,{disabled:!a.types||a.signatories.length==0,size:"x-small",onClick:()=>j(a),icon:h(se),loading:C.value,color:"success",class:"mx-1 ml-3 my-auto",title:"Save Signatory"},null,8,["disabled","onClick","icon","loading"]),t(m,{size:"x-small",onClick:()=>O(a.id,d),icon:h(le),color:"error",class:"mx-1 ml-3 my-auto",title:"Delete Signatory"},null,8,["onClick","icon"])])]),_:2},1024))),128)),t(f,{class:"mt-0"},{default:l(()=>[Fe,je,Ie]),_:1})])]),_:1})):ie("",!0)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})]),_:1})]),_:1}),t(ce,{options:V.value},null,8,["options"])]),_:1}))}},Oe=_e($e,[["__scopeId","data-v-98527287"]]);export{Oe as D};
