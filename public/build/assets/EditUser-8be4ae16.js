import{r as i,o as g,c as C,w as s,d as l,j as _,Y as W,k as N,f as P,J as j,Z as Y,_ as Z,e as b,S as H,G as Q,a as X,I as ee,n as z,m as le,b as u,s as V,$ as D,a0 as F,ae as O,y as B,E as I,p as T,q as ae,F as te}from"./app-b23a62eb.js";import{_ as se}from"./ApppageHeader-241cded0.js";import{_ as ie,a as oe,b as ue}from"./ChangePassword-64aa0271.js";import{_ as de}from"./AppSnackBar-cfbd1a9f.js";import"./index.esm-20d7d6b9.js";const ce={__name:"Capability",props:["item"],emits:["saved"],setup(E,{emit:x}){const d=E,n=i(!1),o=i(d.item.capabilities),y=i(d.item.capabilities),k=i(["add","edit","delete"]),r=async()=>{n.value=!1,x("saved",{id:d.item.id,capabilities:o.value})},h=()=>{n.value=!1,o.value=y.value};return(p,c)=>(g(),C(H,{width:"500",persistent:"",modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=f=>n.value=f)},{activator:s(({props:f})=>[l(_,W(f,{text:"Capability",size:"small",color:"primary"}),null,16)]),default:s(({isActive:f})=>[l(N,{title:"Capabilities"},{default:s(()=>[l(P,null,{default:s(()=>[l(j,{variant:"outlined",density:"compact","hide-details":"",multiple:"","item-title":"name","item-value":"name",label:"- Select -",modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=v=>o.value=v),items:k.value},null,8,["modelValue","items"])]),_:1}),l(Y,null,{default:s(()=>[l(Z),l(_,{size:"small",text:"cancel",onClick:h}),l(_,{size:"small",color:"secondary",onClick:r},{default:s(()=>[b("Confirm")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ne={class:"v-col-12"},re={class:"d-flex flex-wrap"},pe={class:"v-col-12 v-col-md-5"},ve={class:"v-col-12"},me={class:"v-col-12 v-col-md-4"},fe={class:"v-col-12 v-col-md-12 d-flex"},ge={class:"v-col-12 v-col-md-12 py-0 d-flex"},_e={class:"my-auto"},be={key:0,class:"v-col-12 v-col-md-3"},ye=u("div",{class:"v-col-12 v-col-md-12"},[b(" Capabilities "),u("br"),u("small",{class:"text-error"},"Warning: it will override the capabilities of all page."),u("br"),u("small",{class:"text-error"},"Select only here if all pages have same capabilities")],-1),he={class:"v-col-12 v-col-md-12 my-auto"},$e={__name:"EditUser",setup(E){var R,J;const x=Q(),d=X(),n=i(!0),o=i({loading:!1,data:{}}),y=async()=>{n.value=!0,await z(d.token).get("/api/admin/user/single/"+x.params.id).then(e=>{o.value.data=e.data,n.value=!1}).catch(e=>{o.value.loading=!1,n.value=!1})},k=e=>{y().then(()=>{U.value={status:!0,type:"success",text:e}})};ee(()=>{y().then(()=>{f()})});const r=i("profile"),h=async e=>{r.value=e},p=i([]),c=i(!1),f=()=>{z(d.token).get("/api/fetch/pages-slug").then(e=>{var t;p.value=e.data,((t=o.value.data)==null?void 0:t.access.length)>0&&o.value.data.access.map((a,w)=>{p.value.map(($,Se)=>{a.slug==$.slug&&($.isSelected=a.slug,$.capabilities=a.capabilities?JSON.parse(a.capabilities):[],m.value.push(a.slug),v.value=!0)})})}).catch(e=>{})},v=i(!1),q=()=>{p.value.map((e,t)=>(e.capabilities||(e.capabilities=[]),c.value?(e.isSelected=e.slug,m.value.push(e.slug),v.value=!0):(e.isSelected="",m.value=[],v.value=!1),e))},A=i(!1),m=i([]),G=e=>{e.isSelected?(m.value.splice(m.value.findIndex(a=>a===e.isSelected),1),e.isSelected="",e.capabilities=""):(!e.isSelected||e.isSelected==null||e.isSelected=="")&&(m.value.push(e.slug),e.isSelected=e.slug),v.value=!0,p.value.filter((a,w)=>!a.isSelected).length>0?c.value=!1:c.value=!0},S=i([]),K=i(["add","edit","delete"]),U=i({status:!0,type:"info",text:null}),L=e=>{p.value.map((t,a)=>{t.id==e.id&&(t.capabilities=e.capabilities)})};i((J=(R=d==null?void 0:d.user)==null?void 0:R.profile)==null?void 0:J.id);const M=()=>{A.value=!0,S.value.length>0&&p.value.map((a,w)=>{a.isSelected?a.capabilities=S.value:a.capabilities=[]});let e=p.value.filter(a=>a.isSelected),t={profileID:x.params.id,data:e,profile_id:d.user.profile.id};z(d.token).post("/api/store-page/settings-capabilities/profile",t).then(a=>{m.value=[],S.value=[],U.value={status:!0,type:"success",text:a.data.message},A.value=!1,y().then(()=>{f()})})};return(e,t)=>(g(),C(le,null,{default:s(()=>[l(se,{title:"Edit User"}),l(V,{class:"mb-3",disabled:n.value},{default:s(()=>[u("div",ne,[u("div",re,[l(_,{color:`${r.value=="profile"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[0]||(t[0]=()=>h("profile"))},{default:s(()=>[b("profile")]),_:1},8,["color","loading"]),l(_,{color:`${r.value=="account"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[1]||(t[1]=()=>h("account"))},{default:s(()=>[b("Account")]),_:1},8,["color","loading"]),l(_,{color:`${r.value=="change_password"?"primary":"white"} `,size:"large",class:"mr-3 my-1",loading:o.value.loading,onClick:t[2]||(t[2]=()=>h("change_password"))},{default:s(()=>[b("Change Password")]),_:1},8,["color","loading"])])]),u("div",pe,[l(V,null,{default:s(()=>[u("div",ve,[D(l(ie,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,r.value=="account"]]),D(l(oe,{user:o.value.data,onSaved:k},null,8,["user"]),[[F,r.value=="profile"]]),D(l(ue,{user:o.value.data},null,8,["user"]),[[F,r.value=="change_password"]])])]),_:1})]),u("div",me,[l(N,null,{default:s(()=>[l(P,null,{default:s(()=>[l(V,null,{default:s(()=>[u("div",fe,[l(O,{modelValue:c.value,"onUpdate:modelValue":[t[3]||(t[3]=a=>c.value=a),q],"hide-details":"",variant:"outlined",density:"compact",label:" Access / View Pages"},null,8,["modelValue"]),v.value?(g(),C(_,{key:0,class:"ml-5",size:"small",loading:A.value,color:"secondary",onClick:M},{default:s(()=>[b("Save")]),_:1},8,["loading"])):B("",!0)])]),_:1}),l(I,{class:"mb-3"}),(g(!0),T(te,null,ae(p.value,(a,w)=>(g(),C(V,{key:a.id},{default:s(()=>[u("div",ge,[l(O,{"model-value":m.value.includes(a.slug),"hide-details":"",variant:"outlined","onUpdate:modelValue":$=>G(a,w),label:a.title,density:"compact"},null,8,["model-value","onUpdate:modelValue","label"]),u("div",_e,[a.isSelected?(g(),C(ce,{key:0,item:a,onSaved:L},null,8,["item"])):B("",!0)])]),l(I)]),_:2},1024))),128))]),_:1})]),_:1})]),v.value?(g(),T("div",be,[l(N,null,{default:s(()=>[l(P,null,{default:s(()=>[l(V,null,{default:s(()=>[ye,l(I),u("div",he,[l(j,{variant:"outlined",density:"compact","hide-details":"",multiple:"",label:"- Select -",modelValue:S.value,"onUpdate:modelValue":t[4]||(t[4]=a=>S.value=a),items:K.value},null,8,["modelValue","items"])])]),_:1})]),_:1})]),_:1})])):B("",!0)]),_:1},8,["disabled"]),l(de,{options:U.value},null,8,["options"])]),_:1}))}};export{$e as default};
