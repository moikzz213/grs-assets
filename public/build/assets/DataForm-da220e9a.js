import{a as je,r as p,I as Re,u as De,K as Ne,J as ie,T as ne,o as n,c as y,w as d,d as l,v as Le,k as R,V as Ie,b as t,t as u,p as w,y as g,ag as ue,E as _,H as $,f as G,s as f,j as q,e as O,L as D,i as C,q as B,F as N,U as Fe,X as Be,W as Pe,P as Me,_ as re,D as K,O as ze,aE as ce,aF as ve,aG as pe,aH as _e,aI as Qe,m as Ye,n as j}from"./app-b41d2809.js";import{_ as $e}from"./ApppageHeader-09d9dac2.js";import{_ as Ge}from"./Studio-a13b7939.js";import{_ as Ke}from"./AppSnackBar-065bed84.js";import{u as me}from"./formatDate-b9aad8c5.js";import{r as fe}from"./generateRandomString-02c0ba3b.js";const He={key:0,class:"text-error text-h6"},Je={class:"col-12 v-col-md-4"},We={key:0,class:"v-col-12 v-col-md-8"},Xe={key:0,class:"text-right no-print"},Ze={class:"v-col-12 v-col-md-6"},et={class:"v-col-12 v-col-md-6"},tt={class:"v-col-12 v-col-md-6"},at={class:"v-col-12 v-col-md-6"},lt={class:"v-col-12"},st={class:"wd-100"},ot={class:"wd-60"},dt={class:"wd-40"},it={class:"wd-60"},nt={class:"wd-40"},ut={class:"wd-100"},rt={class:"v-col-12"},ct=t("div",{class:"wd-30"},"ITEM DESCRIPTION",-1),vt=t("div",{class:"wd-15"},"ASSET CODE",-1),pt=t("div",{class:"wd-5"},"QTY",-1),_t=t("div",{class:"wd-10"},"UOM",-1),mt=t("div",{class:"wd-10"},"WEIGHT",-1),ft=t("div",{class:"wd-10"},"VALUE",-1),ht=t("div",{class:"wd-15"},"REASON FOR REQUEST",-1),yt={class:"wd-30"},gt={class:"wd-15"},Vt={class:"wd-5"},wt={class:"wd-10"},bt={class:"wd-10"},kt={class:"wd-10"},xt={class:"wd-15"},At={class:"v-col-12 v-col-md-1 px-1"},Tt={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},Ut={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},St={class:"v-col-12 pt-0 pb-0"},qt={class:"v-col-12 v-col-md-3"},Ct={class:"v-col-12 v-col-md-2"},Et={class:"v-col-12 v-col-md-1"},Ot={class:"v-col-12 v-col-md-1"},jt={class:"v-col-12 v-col-md-1"},Rt={class:"v-col-12 v-col-md-1"},Dt={class:"v-col-12 v-col-md-2 d-flex"},Nt={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},Lt=t("div",null,"APPROVAL SETUP",-1),It={key:0,class:"no-print"},Ft=t("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),Bt={class:"v-col-12 v-col-md-6"},Pt=t("div",{class:"v-col-12 v-col-md-1"},"Status",-1),Mt=t("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),zt=t("div",{class:"wd-20"},"Requestor",-1),Qt={class:"wd-50"},Yt=t("div",{class:"wd-10"},"Status",-1),$t=t("div",{class:"wd-20"},"Date Approved",-1),Gt={class:"wd-20"},Kt={class:"wd-50"},Ht={class:"wd-10"},Jt={class:"wd-20"},Wt={class:"v-col-12 v-col-md-2"},Xt={class:"v-col-12 v-col-md-7 d-flex"},Zt={class:"my-auto"},ea={key:0,class:"v-col-12"},ta={class:"v-col-12 text-error"},aa=t("div",{class:"v-col-12 v-col-md-12 text-info no-print"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),ua={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(he,{emit:ye}){const A=he,m=je(),P=p(!1),T=Re(),ge=De(),r=p({}),U=p(!1),b=p([{qty:1,attachment:{}}]),Ve=p(new Date),we=p(window.location.origin),be=(a,s)=>{b.value[a].attachment=s[0]},M=p(!1),H=p(1),ke=a=>{H.value=a,M.value=!0},xe=a=>{b.value[a].attachment=""},z=a=>{if(a=="approve")return"Approved By";if(a=="reviewer")return"Reviewed By";if(a=="receiver")return"Received By";if(a=="transport")return"Trasport Arranged By";if(a=="releasing")return"Released By";if(a=="verify")return"Verified By"},J=p(""),W=p([]),Ae=async()=>{await j(m.token).get("/api/fetch/approval-setups/non-paginated/data/request").then(a=>{var s,e;W.value=a.data,J.value=(e=(s=a.data.filter(o=>o.id==v.value.request_type_id))==null?void 0:s[0])==null?void 0:e.title}).catch(a=>{})},L=p({}),X=p([]),Te=async()=>{await j(m.token).get("/api/fetch/companies").then(a=>{X.value=a.data}).catch(a=>{})},Z=p(""),ee=p(""),Q=p([]),Ue=async()=>{await j(m.token).get("/api/fetch/locations/non-paginated/data").then(a=>{var s,e,o,h;Q.value=a.data,Z.value=(e=(s=a.data.filter(V=>V.id==v.value.transferred_from))==null?void 0:s[0])==null?void 0:e.title,ee.value=(h=(o=a.data.filter(V=>V.id==v.value.transferred_to))==null?void 0:o[0])==null?void 0:h.title}).catch(a=>{})},Se=()=>{b.value.push({qty:1,attachment:{}}),E()},qe=(a,s)=>{b.value.splice(s,1),E()},te=p("Note: Administrator needs to setup signatories first."),Ce=()=>{L.value={status:!0,type:"info",text:"Please wait..."};let a=b.value.map((e,o)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),s={data:r.value,assets:a,approval:k.value,profile_id:m.user.profile.id,type:"request",role:m.user.profile.role};j(m.token).post("/api/request-asset/store-update/data",s).then(e=>{let o="",h="";e.data.message?(o=e.data.message,h="success"):e.data.error&&(o=e.data.error,h="error"),L.value={status:!0,type:h,text:o},T.params.id||setTimeout(()=>{ge.push({name:"EditRequestAsset",params:{id:e.data.id}}).catch(V=>{})},800)}).catch(e=>{console.log(e)})},k=p([]),I=p(!0),ae=async()=>{await j(m.token).get("/api/fetch/request-asset/approval-setup-fetch/"+r.value.request_type_id).then(a=>{var s,e,o,h,V,c;console.log("setupApprovals",a),k.value=(s=a.data)==null?void 0:s.stages,T.params.id&&k.value.length>0&&(k.value.map((x,S)=>(x.profile_id=i.value[S].profile_id,x.status=i.value[S].status,x.date_approved=i.value[S].date_approved,x.reason_rejected=i.value[S].reason_rejected,x)),k.value.length>1&&(k.value[i.value.length-1]={id:i.value[i.value.length-1].id,profile_id:i.value[i.value.length-1].profile_id,status:i.value[i.value.length-1].status,date_approved:i.value[i.value.length-1].date_approved,status:i.value[i.value.length-1].status,reason_rejected:"",types:i.value[i.value.length-1].approval_type,sort:i.value[i.value.length-1].orders,request_asset_id:i.value[i.value.length-1].request_asset_id,signatures:[{id:(e=i.value[i.value.length-1])==null?void 0:e.profile.id,display_name:(o=i.value[i.value.length-1])==null?void 0:o.profile.display_name,first_name:(h=i.value[i.value.length-1])==null?void 0:h.profile.first_name,last_name:(V=i.value[i.value.length-1])==null?void 0:V.profile.last_name}]})),((c=a.data)==null?void 0:c.stages.length)>0?I.value=!0:I.value=!1}).catch(a=>{})},E=()=>{let a=!1;P.value=!1,r.value.company_id&&r.value.request_type_id&&r.value.subject&&r.value.transferred_from&&r.value.transferred_to&&(a=!0);let s=!0;b.value.map(o=>{o.item_description&&o.reason_for_request||(s=!1)});let e=!0;k.value.map(o=>{o.profile_id||(e=!1)}),e&&s&&a&&(P.value=!0)},le=a=>{let s={status:a,profile_id:m.user.profile.id,ID:v.value.id};j(m.token).post("/api/request-asset/change-request/data",s).then(e=>{L.value={status:!0,type:"success",text:e.data.message},v.value.status=a,ye("saved",e.data.message)}).catch(e=>{})},se=(a,s=6)=>{let e="00000"+a;return e.substring(e.length-s)},i=p([]),v=p({}),F=p({});Ne(()=>{var a,s;if(Ae().then(()=>{Te().then(()=>{Ue()})}),T.params.id){U.value=!0;let e=A.objectdata;v.value=e,console.log("vvvv",e),r.value.company_id=e.company_id,r.value.request_type_id=e.request_type_id,r.value.subject=e.subject,r.value.transferred_from=e.transferred_from,r.value.transferred_to=e.transferred_to,r.value.id=e.id,r.value.requestor_id=e.profile_id,i.value=e.request_approvals,b.value=e.items,F.value=(s=(a=e.request_approvals)==null?void 0:a.filter(o=>o.status=="awaiting-approval"))==null?void 0:s[0],ae()}else r.value.company_id=m.user.profile.company_id}),ie(r.value,async(a,s)=>{E()}),ie(b.value,async(a,s)=>{E()});const Y=ne(()=>m.user.role=="receiving-releasing"||m.user.role=="facility"),Ee=p("https://assets.grandiose.ae"),Oe=ne(()=>{var c,x,S,oe,de;let a=null,s=Ee.value+"pv/employee-signatory",e=fe(50),o=fe(50),h=95,V=99;return((x=(c=m.user)==null?void 0:c.profile)==null?void 0:x.id)==((S=F.value)==null?void 0:S.profile_id)&&(h=(oe=F.value)==null?void 0:oe.profile_id,V=(de=F.value)==null?void 0:de.orders),v.value&&(a=s+"/transfer/approvals?o="+V+"&key="+e+"&pid="+h+"&pv="+o+"&id="+v.value.id),a});return(a,s)=>(n(),y(Ye,null,{default:d(()=>[l($e,{title:A.headertitle,class:"no-print"},null,8,["title"]),l(f,{class:"mb-3"},{default:d(()=>[l(Le,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:d(()=>[l(R,null,{default:d(()=>[l(Ie,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:d(()=>[t("div",null,u(A.headertitle),1),I.value?g("",!0):(n(),w("div",He,u(te.value),1)),U.value?(n(),w("div",{key:1,class:ue(v.value.status=="cancelled"?"text-error":v.value.status=="complete"?"text-success":"")}," STATUS ("+u(v.value.status)+") ",3)):g("",!0),t("div",null,"DATE: "+u(_(me)(Ve.value)),1)]),_:1}),l($),l(G,null,{default:d(()=>[l(f,{class:"no-print"},{default:d(()=>[U.value?(n(),w("div",{key:0,class:ue(`${v.value.status=="complete"?"v-col-12":"v-col-md-12"}`)},[l(f,null,{default:d(()=>[t("div",Je," REQUEST NO: SN-5"+u(se(v.value.id)),1),Y.value?g("",!0):(n(),w("div",We,[U.value&&(v.value.status=="pending"||v.value.status=="cancelled")?(n(),w("div",Xe,[v.value.status=="pending"?(n(),y(q,{key:0,onClick:s[0]||(s[0]=e=>le("cancelled")),color:"warning"},{default:d(()=>[O("Cancel request")]),_:1})):g("",!0),v.value.status=="cancelled"?(n(),y(q,{key:1,onClick:s[1]||(s[1]=e=>le("pending")),size:"small",color:"info"},{default:d(()=>[O("Change status to Pending")]),_:1})):g("",!0)])):g("",!0)]))]),_:1})],2)):g("",!0),t("div",Ze,[l(D,{items:W.value,modelValue:r.value.request_type_id,"onUpdate:modelValue":[s[2]||(s[2]=e=>r.value.request_type_id=e),ae],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:U.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),t("div",et,[l(D,{items:X.value,modelValue:r.value.company_id,"onUpdate:modelValue":s[3]||(s[3]=e=>r.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),t("div",tt,[l(D,{items:Q.value,modelValue:r.value.transferred_from,"onUpdate:modelValue":s[4]||(s[4]=e=>r.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),t("div",at,[l(D,{items:Q.value,modelValue:r.value.transferred_to,"onUpdate:modelValue":s[5]||(s[5]=e=>r.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),t("div",lt,[l(C,{modelValue:r.value.subject,"onUpdate:modelValue":s[6]||(s[6]=e=>r.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1}),l(f,{class:"for-print-flex mx-2 mb-1"},{default:d(()=>{var e,o;return[t("div",st,"REQUEST NO: SN-5"+u(se(v.value.id)),1),t("div",ot,"TYPE OF REQUEST: "+u(J.value),1),t("div",dt,"COMPANY: "+u((o=(e=v.value)==null?void 0:e.company)==null?void 0:o.title),1),t("div",it,"LOCATION FROM: "+u(Z.value),1),t("div",nt,"LOCATION TO: "+u(ee.value),1),t("div",ut,"SUBJECT: "+u(v.value.subject),1)]}),_:1})]),_:1})]),_:1}),l(R,{class:"my-2"},{default:d(()=>[l(G,null,{default:d(()=>[Y.value?g("",!0):(n(),y(f,{key:0},{default:d(()=>{var e;return[t("div",rt,[v.value.status!="complete"&&(!_(T).params.id||((e=A.objectdata)==null?void 0:e.status)=="pending"||_(m).user.profile.role=="superadmin"||_(m).user.profile.role=="administrator")?(n(),y(q,{key:0,color:"primary",class:"no-print",onClick:Se},{default:d(()=>[O("Add")]),_:1})):g("",!0)])]}),_:1})),l(f,{class:"for-print-flex mx-2 header mb-1 mt-0"},{default:d(()=>[ct,vt,pt,_t,mt,ft,ht]),_:1}),(n(!0),w(N,null,B(b.value,(e,o)=>(n(),y(f,{key:o,class:"for-print-flex mx-2 row-bordered mb-1"},{default:d(()=>[t("div",yt,u(e.item_description),1),t("div",gt,u(e.asset_code),1),t("div",Vt,u(e.qty),1),t("div",wt,u(e.uom),1),t("div",bt,u(e.weight),1),t("div",kt,u(e.item_value),1),t("div",xt,u(e.reason_for_request),1)]),_:2},1024))),128)),(n(!0),w(N,null,B(b.value,(e,o)=>(n(),y(f,{key:o,class:"no-print"},{default:d(()=>{var h,V;return[t("div",At,[(h=e.attachment)!=null&&h.id?(n(),y(f,{key:0,class:"px-1"},{default:d(()=>[t("div",Tt,[l(C,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":c=>e.attachment.id=c},null,8,["modelValue","onUpdate:modelValue"]),l(q,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:_(Fe),size:"16px",color:"error",onClick:()=>xe(o,e.attachment.id)},null,8,["icon","onClick"]),l(R,{onClick:()=>ke(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),l(Be,{modelValue:M.value,"onUpdate:modelValue":s[7]||(s[7]=c=>M.value=c),width:"95%","max-width":"900"},{default:d(()=>[l(R,{class:"bg-black"},{default:d(()=>[t("div",Ut,[l(Pe,{src:we.value+"/file/"+H.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(n(),y(f,{key:1,class:"mt-0"},{default:d(()=>[t("div",St,[l(Me,{color:"grey-lighten-4",class:"text-center"},{default:d(()=>[l(Ge,{options:{multiSelect:!1,type:"request-asset"},onSelect:c=>be(o,c)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),t("div",qt,[l(re,{modelValue:e.item_description,"onUpdate:modelValue":[c=>e.item_description=c,E],variant:"outlined",density:"compact","hide-details":"",clearable:"",rows:"2",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ct,[l(C,{modelValue:e.asset_code,"onUpdate:modelValue":c=>e.asset_code=c,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Et,[l(C,{type:"number",modelValue:e.qty,"onUpdate:modelValue":c=>e.qty=c,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ot,[l(C,{modelValue:e.uom,"onUpdate:modelValue":c=>e.uom=c,variant:"outlined",density:"compact","hide-details":"",label:"UOM"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",jt,[l(C,{type:"number",modelValue:e.weight,"onUpdate:modelValue":c=>e.weight=c,variant:"outlined",density:"compact","hide-details":"",label:"WGT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Rt,[l(C,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":c=>e.item_value=c,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Dt,[l(re,{modelValue:e.reason_for_request,"onUpdate:modelValue":c=>e.reason_for_request=c,variant:"outlined",density:"compact","hide-details":"",rows:"2",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!U.value||U.value&&_(m).user.profile.id==A.objectdata.profile_id&&((V=A.objectdata)==null?void 0:V.status)=="pending"?(n(),y(K,{key:0,size:"small",onClick:()=>qe(e.id,o),icon:_(ze),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):g("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),l(R,{class:"my-2"},{default:d(()=>[l(G,null,{default:d(()=>[l(f,null,{default:d(()=>[t("div",Nt,[Lt,_(T).params.id?(n(),w("div",It,[l(q,{color:"info",size:"small",target:"_blank",href:Oe.value},{default:d(()=>[O("View Approval Page")]),_:1},8,["href"])])):g("",!0)]),l($)]),_:1}),l(f,{class:"no-print"},{default:d(()=>{var e,o;return[Ft,t("div",Bt,u((o=(e=v.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),Pt,Mt]}),_:1}),l(f,{class:"for-print-flex mx-2 mt-5 mb-1"},{default:d(()=>{var e,o;return[zt,t("div",Qt,u((o=(e=v.value)==null?void 0:e.profile)==null?void 0:o.display_name),1),Yt,$t]}),_:1}),(n(!0),w(N,null,B(i.value,e=>(n(),y(f,{class:"for-print-flex mx-2 mb-2 mt-0",key:e.id},{default:d(()=>{var o;return[t("div",Gt,u(z(e.approval_type)),1),t("div",Kt,u((o=e==null?void 0:e.profile)==null?void 0:o.display_name),1),t("div",Ht,[e.status?(n(),y(K,{key:0,class:"mx-2 my-0",icon:e.status=="awaiting-approval"?_(ce):e.status=="pending"?_(ve):e.status=="reject"?_(pe):_(_e),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):g("",!0)]),t("div",Jt,u(e.date_approved),1)]}),_:2},1024))),128)),I.value?(n(),w(N,{key:0},[(n(!0),w(N,null,B(k.value,(e,o)=>(n(),y(f,{class:"no-print",key:e.id},{default:d(()=>[t("div",Wt,u(e.types?z(e.types):z(e.approval_type)),1),t("div",Xt,[l(D,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[h=>e.profile_id=h,E],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),l(q,{variant:"text",size:"x-small"},{default:d(()=>[e.status?(n(),y(K,{key:0,class:"mx-2 my-3 no-print",icon:e.status=="awaiting-approval"?_(ce):e.status=="pending"?_(ve):e.status=="reject"?_(pe):_(_e),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):g("",!0),l(Qe,{activator:"parent",location:"top","max-width":"400"},{default:d(()=>[O(u(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),t("div",Zt,u(e.date_approved?_(me)(e.date_approved):""),1)]),_:2},1024))),128)),l(f,null,{default:d(()=>{var e;return[l($),Y.value?g("",!0):(n(),w("div",ea,[(!_(T).params.id||((e=A.objectdata)==null?void 0:e.status)=="pending"||_(m).user.profile.role=="asset-supervisor"||_(m).user.profile.role=="superadmin"||_(m).user.profile.role=="administrator")&&v.value.status!="complete"?(n(),y(q,{key:0,disabled:!P.value,onClick:Ce,class:"no-print",color:"primary"},{default:d(()=>[O(u(_(T).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):g("",!0)]))]}),_:1})],64)):(n(),y(f,{key:1,class:"no-print"},{default:d(()=>[t("div",ta,u(te.value),1)]),_:1})),l(f,null,{default:d(()=>[aa]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Ke,{options:L.value},null,8,["options"])]),_:1}))}};export{ua as _};
