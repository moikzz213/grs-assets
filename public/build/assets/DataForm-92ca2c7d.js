import{a as Re,r as v,I as De,u as Ne,K as Le,T as ie,J as ne,o as n,c as f,w as d,d as o,v as Pe,k as j,V as Fe,b as t,t as r,p as g,y,ag as re,E as u,H as Q,f as Y,s as h,j as A,e as U,L as C,i as O,q as P,F as R,X as Ie,W as Be,P as Me,_ as ue,D as $,O as ze,aF as ce,aG as pe,aH as ve,aI as _e,aJ as Qe,m as Ye,n as E}from"./app-d2aeeebd.js";import{_ as $e}from"./ApppageHeader-7a1e3bca.js";import{_ as Ge,r as me}from"./Studio-9bf43a75.js";import{_ as Ke}from"./AppSnackBar-889d340c.js";import{u as fe}from"./formatDate-b9aad8c5.js";const He={key:0,class:"text-error text-h6"},Je={key:1,class:"v-col-12 v-col-md-8"},We={key:0,class:"no-print"},Xe={class:"v-col-12 v-col-md-6"},Ze={class:"v-col-12 v-col-md-6"},et={class:"v-col-12 v-col-md-6"},tt={class:"v-col-12 v-col-md-6"},at={class:"v-col-12"},st={class:"wd-100"},lt={class:"wd-60 text-caption"},ot={class:"wd-40"},dt={class:"wd-60"},it={class:"wd-40"},nt={class:"wd-100"},rt={class:"v-col-12"},ut=t("small",{class:"mx-5 text-info"},"UOM: ( pcs, pack, box, etc.. )",-1),ct=t("div",{class:"wd-30"},"ITEM DESCRIPTION",-1),pt=t("div",{class:"wd-15"},"ASSET CODE",-1),vt=t("div",{class:"wd-5"},"QTY",-1),_t=t("div",{class:"wd-10"},"UOM",-1),mt=t("div",{class:"wd-10"},"WEIGHT",-1),ft=t("div",{class:"wd-10"},"VALUE",-1),ht=t("div",{class:"wd-15"},"REASON FOR REQUEST",-1),yt={class:"wd-30"},gt={class:"wd-15"},Vt={class:"wd-5"},bt={class:"wd-10"},wt={class:"wd-10"},kt={class:"wd-10"},xt={class:"wd-15"},Tt={class:"v-col-12 v-col-md-1 px-1 no-print"},At={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},qt={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},St={class:"v-col-12 pt-0 pb-0"},Ut={class:"v-col-12 v-col-md-1 custom-width-description"},Ct={class:"v-col-12 v-col-md-2"},Ot={class:"v-col-12 v-col-md-1"},Et={class:"v-col-12 v-col-md-1 custom-width-uom"},jt={class:"v-col-12 v-col-md-1"},Rt={class:"v-col-12 v-col-md-1"},Dt={class:"v-col-12 v-col-md-2 d-flex"},Nt={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},Lt=t("div",null,"APPROVAL SETUP",-1),Pt={key:0,class:"no-print"},Ft=t("div",{class:"wd-20"},"Requestor",-1),It={class:"wd-50"},Bt=t("div",{class:"wd-10"},"Status",-1),Mt=t("div",{class:"wd-20"},"Date Approved",-1),zt={class:"wd-20"},Qt={class:"wd-50"},Yt={class:"wd-10"},$t={class:"wd-20"},Gt=t("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),Kt={class:"v-col-12 v-col-md-6"},Ht=t("div",{class:"v-col-12 v-col-md-1"},"Status",-1),Jt=t("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),Wt={class:"v-col-12 v-col-md-2"},Xt={class:"v-col-12 v-col-md-7 d-flex"},Zt={class:"my-auto"},ea={key:0,class:"v-col-12 no-print"},ta={class:"v-col-12 text-error"},aa=t("div",{class:"v-col-12 no-print v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),na={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(he,{emit:ye}){const k=he,p=Re(),G=v("Note: Administrator needs to setup signatories first."),F=v(!1),x=De(),ge=Ne(),i=v({}),w=v(!1),V=v([{qty:1,attachment:{}}]),Ve=v(new Date),be=v(["Nos","Set","Pcs","Pack","Pallet","SqM"]),I=a=>{if(a=="approve")return"Approved By";if(a=="reviewer")return"Reviewed By";if(a=="receiver")return"Received By";if(a=="transport")return"Transport Arranged By";if(a=="releasing")return"Released By";if(a=="verify")return"Verified By"},we=v(window.location.origin),ke=(a,l)=>{V.value[a].attachment=l[0]},B=v(!1),K=v(1),xe=a=>{K.value=a,B.value=!0},Te=a=>{V.value[a].attachment=""},H=v(""),J=v([]),Ae=async()=>{let a="request";k.headertitle=="Transfer Assets"&&(a="transfer"),await E(p.token).get("/api/fetch/approval-setups/non-paginated/data/"+a).then(l=>{var e,s;J.value=l.data,H.value=(s=(e=l.data.filter(m=>m.id==c.value.request_type_id))==null?void 0:e[0])==null?void 0:s.title}).catch(l=>{})},D=v({}),W=v([]),qe=async()=>{await E(p.token).get("/api/fetch/companies").then(a=>{W.value=a.data}).catch(a=>{})},X=v(""),Z=v(""),M=v([]),Se=async()=>{await E(p.token).get("/api/fetch/locations/non-paginated/data").then(a=>{var l,e,s,m;M.value=a.data,X.value=(e=(l=a.data.filter(b=>b.id==c.value.transferred_from))==null?void 0:l[0])==null?void 0:e.title,Z.value=(m=(s=a.data.filter(b=>b.id==c.value.transferred_to))==null?void 0:s[0])==null?void 0:m.title}).catch(a=>{})},Ue=()=>{V.value.push({qty:1,attachment:{}}),T()},Ce=(a,l)=>{V.value.splice(l,1),T()},Oe=()=>{D.value={status:!0,type:"info",text:"Please wait..."};let a=V.value.map((e,s)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:i.value,assets:a,approval:q.value,profile_id:p.user.profile.id,role:p.user.profile.role,type:"transfer"};E(p.token).post("/api/request-asset/store-update/data",l).then(e=>{let s="",m="";e.data.message?(s=e.data.message,m="success"):e.data.error&&(s=e.data.error,m="error"),D.value={status:!0,type:m,text:s},x.params.id||setTimeout(()=>{ge.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(b=>{})},800)}).catch(e=>{console.log(e)})},q=v([]),N=v(!0),ee=async()=>{await E(p.token).get("/api/fetch/request-asset/approval-setup-fetch/"+i.value.request_type_id).then(a=>{var l,e;q.value=(l=a.data)==null?void 0:l.stages,x.params.id&&q.value.length>0&&q.value.map((s,m)=>(s.profile_id=S.value[m].profile_id,s.status=S.value[m].status,s.date_approved=S.value[m].date_approved,s.reason_rejected=S.value[m].reason_rejected,s)),((e=a.data)==null?void 0:e.stages.length)>0?N.value=!0:N.value=!1}).catch(a=>{})},T=()=>{let a=!1;F.value=!1,i.value.company_id&&i.value.request_type_id&&i.value.subject&&i.value.transferred_from&&i.value.transferred_to&&(a=!0);let l=!0;V.value.map(s=>{(!s.item_description||!s.reason_for_request||!s.uom||!s.qty||s.qty<=0)&&(l=!1)}),console.log("assetDataObj.value",V.value);let e=!0;q.value.map(s=>{s.profile_id||(e=!1)}),e&&l&&a&&(F.value=!0)},te=a=>{let l={status:a,profile_id:p.user.profile.id,ID:c.value.id};E(p.token).post("/api/request-asset/change-request/data",l).then(e=>{D.value={status:!0,type:"success",text:e.data.message},c.value.status=a,ye("saved",e.data.message)}).catch(e=>{})},ae=(a,l=6)=>{let e="00000"+a;return e.substring(e.length-l)},S=v([]),c=v({}),L=v({});Le(()=>{var a,l;if(Ae().then(()=>{qe().then(()=>{Se()})}),x.params.id){w.value=!0;let e=k.objectdata;c.value=e,i.value.company_id=e.company_id,i.value.request_type_id=e.request_type_id,i.value.subject=e.subject,i.value.transferred_from=e.transferred_from,i.value.transferred_to=e.transferred_to,i.value.id=e.id,i.value.requestor_id=e.profile_id,S.value=e.request_approvals,V.value=e.items,L.value=(l=(a=e.request_approvals)==null?void 0:a.filter(s=>s.status=="awaiting-approval"))==null?void 0:l[0],ee()}else i.value.company_id=p.user.profile.company_id});const Ee=v("https://assets.grandiose.ae"),je=ie(()=>{var _,se,le,oe,de;let a=null,l=Ee.value+"/pv/employee-signatory",e=me(50),s=me(50),m=95,b=99;return((se=(_=p.user)==null?void 0:_.profile)==null?void 0:se.id)==((le=L.value)==null?void 0:le.profile_id)&&(m=(oe=L.value)==null?void 0:oe.profile_id,b=(de=L.value)==null?void 0:de.orders),c.value&&(a=l+"/transfer/approvals?o="+b+"&key="+e+"&pid="+m+"&pv="+s+"&id="+c.value.id),a}),z=ie(()=>p.user.role=="receiving-releasing"||p.user.role=="facility");return ne(i.value,async(a,l)=>{T()}),ne(V.value,async(a,l)=>{T()}),(a,l)=>(n(),f(Ye,null,{default:d(()=>[o($e,{title:k.headertitle,class:"no-print"},null,8,["title"]),o(h,{class:"mb-3"},{default:d(()=>[o(Pe,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:d(()=>[o(j,null,{default:d(()=>[o(Fe,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:d(()=>[t("div",null,r(k.headertitle),1),N.value?y("",!0):(n(),g("div",He,r(G.value),1)),w.value?(n(),g("div",{key:1,class:re(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+r(c.value.status)+") ",3)):y("",!0),t("div",null,"DATE: "+r(u(fe)(Ve.value)),1)]),_:1}),o(Q),o(Y,null,{default:d(()=>[o(h,{class:"no-print"},{default:d(()=>[w.value?(n(),g("div",{key:0,class:re(`${c.value.status=="complete"?"v-col-12":"v-col-md-12"}`)}," REQUEST NO: SN-3"+r(ae(c.value.id)),3)):y("",!0),z.value?y("",!0):(n(),g("div",Je,[w.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(n(),g("div",We,[c.value.status=="pending"&&i.value.requestor_id==u(p).user.profile.id?(n(),f(A,{key:0,onClick:l[0]||(l[0]=e=>te("cancelled")),size:"small",color:"warning"},{default:d(()=>[U("Cancel request")]),_:1})):y("",!0),i.value.requestor_id==u(p).user.profile.id&&c.value.status=="cancelled"?(n(),f(A,{key:1,onClick:l[1]||(l[1]=e=>te("pending")),size:"small",color:"info"},{default:d(()=>[U("Change status to Pending")]),_:1})):y("",!0)])):y("",!0)])),t("div",Xe,[o(C,{items:J.value,modelValue:i.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>i.value.request_type_id=e),ee],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:w.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),t("div",Ze,[o(C,{items:W.value,modelValue:i.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),t("div",et,[o(C,{items:M.value,modelValue:i.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),t("div",tt,[o(C,{items:M.value,modelValue:i.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),t("div",at,[o(O,{modelValue:i.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>i.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1}),o(h,{class:"for-print-flex mx-2 mb-1"},{default:d(()=>{var e,s;return[t("div",st,"REQUEST NO: SN-3"+r(ae(c.value.id)),1),t("div",lt,"TYPE OF REQUEST: "+r(H.value),1),t("div",ot,"COMPANY: "+r((s=(e=c.value)==null?void 0:e.company)==null?void 0:s.title),1),t("div",dt,"LOCATION FROM: "+r(X.value),1),t("div",it,"LOCATION TO: "+r(Z.value),1),t("div",nt,"SUBJECT: "+r(c.value.subject),1)]}),_:1})]),_:1})]),_:1}),o(j,{class:"my-2"},{default:d(()=>[o(Y,null,{default:d(()=>[z.value?y("",!0):(n(),f(h,{key:0},{default:d(()=>{var e;return[t("div",rt,[c.value.status!="complete"&&(!u(x).params.id||i.value.requestor_id==u(p).user.profile.id&&((e=k.objectdata)==null?void 0:e.status)=="pending"||u(p).user.profile.role=="superadmin"||u(p).user.profile.role=="administrator")?(n(),f(A,{key:0,size:"small",color:"primary",class:"no-print",onClick:Ue},{default:d(()=>[U("Add")]),_:1})):y("",!0),ut])]}),_:1})),o(h,{class:"for-print-flex mx-2 header mb-1"},{default:d(()=>[ct,pt,vt,_t,mt,ft,ht]),_:1}),(n(!0),g(R,null,P(V.value,(e,s)=>(n(),f(h,{key:s,class:"for-print-flex mx-2 row-bordered"},{default:d(()=>[t("div",yt,r(e.item_description),1),t("div",gt,r(e.asset_code),1),t("div",Vt,r(e.qty),1),t("div",bt,r(e.uom),1),t("div",wt,r(e.weight),1),t("div",kt,r(e.item_value),1),t("div",xt,r(e.reason_for_request),1)]),_:2},1024))),128)),(n(!0),g(R,null,P(V.value,(e,s)=>(n(),f(h,{key:s,class:"no-print"},{default:d(()=>{var m,b;return[t("div",Tt,[(m=e.attachment)!=null&&m.id?(n(),f(h,{key:0,class:"px-1"},{default:d(()=>[t("div",At,[o(O,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":_=>e.attachment.id=_},null,8,["modelValue","onUpdate:modelValue"]),!w.value||w.value&&i.value.requestor_id==u(p).user.profile.id?(n(),f(A,{key:0,style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:a.mdiClose,size:"16px",color:"error",onClick:()=>Te(s,e.attachment.id)},null,8,["icon","onClick"])):y("",!0),o(j,{onClick:()=>xe(e),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),o(Ie,{modelValue:B.value,"onUpdate:modelValue":l[7]||(l[7]=_=>B.value=_),width:"95%","max-width":"900"},{default:d(()=>[o(j,{class:"bg-black"},{default:d(()=>[t("div",qt,[o(Be,{src:we.value+"/file/"+K.value.attachment.path},null,8,["src"])])]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)):(n(),f(h,{key:1,class:"mt-0"},{default:d(()=>[t("div",St,[o(Me,{color:"grey-lighten-4",class:"text-center"},{default:d(()=>[o(Ge,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:_=>ke(s,_)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),t("div",Ut,[o(ue,{modelValue:e.item_description,"onUpdate:modelValue":_=>e.item_description=_,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*",rows:"2",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ct,[o(O,{modelValue:e.asset_code,"onUpdate:modelValue":_=>e.asset_code=_,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE",class:"no-print"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ot,[o(O,{type:"number","onUpdate:modelValue":[T,_=>e.qty=_],modelValue:e.qty,variant:"outlined",density:"compact","hide-details":"",class:"no-print",label:"QTY*"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Et,[o(C,{items:be.value,modelValue:e.uom,"onUpdate:modelValue":[_=>e.uom=_,T],variant:"outlined",density:"compact","hide-details":"",label:"UOM*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"])]),t("div",jt,[o(O,{type:"number",modelValue:e.weight,"onUpdate:modelValue":_=>e.weight=_,variant:"outlined",density:"compact",class:"no-print","hide-details":"",disabled:"",label:"WGT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Rt,[o(O,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":_=>e.item_value=_,variant:"outlined",density:"compact","hide-details":"",disabled:"",class:"no-print",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Dt,[o(ue,{modelValue:e.reason_for_request,"onUpdate:modelValue":_=>e.reason_for_request=_,variant:"outlined",density:"compact","hide-details":"",rows:"2",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!w.value||w.value&&u(p).user.profile.id==k.objectdata.profile_id&&((b=k.objectdata)==null?void 0:b.status)=="pending"?(n(),f($,{key:0,size:"small",onClick:()=>Ce(e.id,s),icon:u(ze),class:"my-auto ml-2 no-print",color:"error"},null,8,["onClick","icon"])):y("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),o(j,{class:"my-2 page-break"},{default:d(()=>[o(Y,null,{default:d(()=>[o(h,null,{default:d(()=>[t("div",Nt,[Lt,u(x).params.id?(n(),g("div",Pt,[o(A,{color:"info",size:"small",target:"_blank",href:je.value},{default:d(()=>[U("View Approval Page")]),_:1},8,["href"])])):y("",!0)]),o(Q)]),_:1}),o(h,{class:"for-print-flex mx-2 mt-5 mb-1"},{default:d(()=>{var e,s;return[Ft,t("div",It,r((s=(e=c.value)==null?void 0:e.profile)==null?void 0:s.display_name),1),Bt,Mt]}),_:1}),(n(!0),g(R,null,P(S.value,e=>(n(),f(h,{class:"for-print-flex mx-2 mb-2 mt-0",key:e.id},{default:d(()=>{var s;return[t("div",zt,r(I(e.approval_type)),1),t("div",Qt,r((s=e==null?void 0:e.profile)==null?void 0:s.display_name),1),t("div",Yt,[e.status?(n(),f($,{key:0,class:"mx-2 my-0",icon:e.status=="awaiting-approval"?u(ce):e.status=="pending"?u(pe):e.status=="reject"?u(ve):u(_e),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0)]),t("div",$t,r(e.date_approved),1)]}),_:2},1024))),128)),o(h,{class:"no-print"},{default:d(()=>{var e,s;return[Gt,t("div",Kt,r((s=(e=c.value)==null?void 0:e.profile)==null?void 0:s.display_name),1),Ht,Jt]}),_:1}),N.value?(n(),g(R,{key:0},[(n(!0),g(R,null,P(q.value,(e,s)=>(n(),f(h,{key:e.id,class:"no-print"},{default:d(()=>[t("div",Wt,r(e.types?I(e.types):I(e.approval_type)),1),t("div",Xt,[o(C,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[m=>e.profile_id=m,T],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),o(A,{variant:"text",size:"x-small",class:"no-print"},{default:d(()=>[e.status?(n(),f($,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?u(ce):e.status=="pending"?u(pe):e.status=="reject"?u(ve):u(_e),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):y("",!0),o(Qe,{activator:"parent",location:"top","max-width":"400"},{default:d(()=>[U(r(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),t("div",Zt,r(e.date_approved?u(fe)(e.date_approved):""),1)]),_:2},1024))),128)),o(h,{class:"no-print"},{default:d(()=>{var e;return[o(Q),z.value?y("",!0):(n(),g("div",ea,[(!u(x).params.id||i.value.requestor_id==u(p).user.profile.id&&((e=k.objectdata)==null?void 0:e.status)=="pending"||u(p).user.profile.role=="superadmin"||u(p).user.profile.role=="administrator")&&c.value.status!="complete"?(n(),f(A,{key:0,size:"small",disabled:!F.value,onClick:Oe,color:"primary"},{default:d(()=>[U(r(u(x).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):y("",!0)]))]}),_:1})],64)):(n(),f(h,{key:1},{default:d(()=>[t("div",ta,r(G.value),1)]),_:1})),o(h,null,{default:d(()=>[aa]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(Ke,{options:D.value},null,8,["options"])]),_:1}))}};export{na as _};
