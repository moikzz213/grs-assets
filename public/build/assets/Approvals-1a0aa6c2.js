import{I as Ve,r as f,c as R,w as n,m as xe,o as r,s as x,b as e,d as l,e as v,j as Q,y as V,t as m,E as c,H as P,af as W,p as _,q as oe,D as b,ah as be,k as L,Y as ke,Z as Ee,W as Ce,X as de,ax as Re,i as k,as as F,ay as X,az as Z,aA as re,aB as ce,F as ie,aC as qe,ae as K,f as Ae,_ as we,a2 as Oe,a3 as ne}from"./app-da803e10.js";import{u as ee}from"./formatDate-b9aad8c5.js";import{_ as Te}from"./AppSnackBar-f4381c54.js";const Ie={class:"v-col-3 mt-auto font-weight-bold"},Ue={class:"d-flex"},je=e("div",{class:"mr-2"},"FROM:",-1),Se={class:"d-flex"},Be=e("div",{class:"mr-6 pr-2"},"TO:",-1),Ne={class:"v-col-6 text-center"},Pe=e("img",{src:"/assets/images/grandiose-logo.jpg",style:{"max-height":"100px"}},null,-1),De=e("br",null,null,-1),$e={class:"v-col-3 mt-auto font-weight-bold text-right"},Le=e("br",null,null,-1),Fe=e("div",{class:"v-col-12 v-col-md-1 py-1"},"IMAGE",-1),ze=e("div",{class:"v-col-12 v-col-md-2 py-1"},"ITEM DESCRIPTION",-1),Ke=e("div",{class:"v-col-12 v-col-md-1 py-1"},"ASSET NO",-1),He=e("div",{class:"v-col-12 v-col-md-1 py-1"},"QTY",-1),Me=e("div",{class:"v-col-12 v-col-md-1 py-1"},"WEIGHT",-1),Ye=e("div",{class:"v-col-12 v-col-md-1 py-1"},"ITEM VALUE",-1),Ge=e("div",{class:"v-col-12 v-col-md-1 py-1"},"COUNTRY OF ORIGIN",-1),Je=e("div",{class:"v-col-12 v-col-md-2 py-1"},[v(" REMARKS"),e("br"),v("REASON FOR REQUEST ")],-1),Qe={class:"v-col-12 v-col-md-2 py-1 d-flex justify-space-between"},We={class:"v-col-12 v-col-md-3 py-1 d-flex"},Xe={key:0},Ze={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},ea={class:"v-col-12 v-col-md-1 py-1"},aa={class:"v-col-12 v-col-md-1 py-1"},la={class:"v-col-12 v-col-md-1 py-1"},ta={class:"v-col-12 v-col-md-1 py-1"},sa={class:"v-col-12 v-col-md-1 py-1"},oa={class:"v-col-12 v-col-md-2 py-1"},da={key:0,class:"v-col-12 v-col-md-2 py-1 d-flex justify-space-between"},ra={key:1,class:"v-col-12 v-col-md-2 py-1 d-flex justify-space-between"},ca={key:0},ia={key:2,class:"v-col-12 v-col-md-2 py-1 d-flex justify-space-between"},na={key:0},ua={key:1},va=e("div",{class:"v-col-12 text-center font-weight-bold text-info"},[v(" YOU CAN UPDATE SOME DATA AND"),e("br"),v(" PLEASE TICK CHECKBOX IF ASSET IS AVAILABLE BEFORE CLICKING THE APPROVE BUTTON ")],-1),pa={key:0,class:"ml-5 d-flex"},_a=e("div",{class:"px-2 mr-5"},"|",-1),ya={key:1,class:"ml-6"},fa={class:"v-col-12 px-0 my-0"},ma={class:"v-col-12 v-col-md-3 pa-0 mb-4"},ha=e("div",{class:"text-center mx-2 py-4 font-weight-bold",style:{color:"rgb(3, 167, 3)",border:"1px solid #ccc","font-size":"17px"}}," APPROVED ",-1),ga=e("div",{class:"text-center py-1 font-weight-bold"}," Requested By ",-1),Va={class:"text-center py-1"},xa={class:"text-center py-1"},ba={class:"text-center"},ka={key:0},Ea={key:0,class:"d-flex"},Ca=["onClick"],Ra=["onClick"],qa={key:1},Aa=["onClick"],wa=["onClick"],Oa={class:"text-center py-1"},Ta={class:"text-center py-1"},Ia={class:"text-center"},Ua={key:2,class:"v-col-12",style:{border:"1px solid red"}},ja={class:"v-col-12 text-center"},Sa=e("div",{class:"v-col-12 text-center mt-3 font-weight-bold"}," REASON FOR REJECTION ",-1),Ba={class:"v-col-12"},La={__name:"Approvals",setup(Na){const o=Ve(),ae=f(!0),s=f({}),H=f({}),h=f(!1),ue=f(!1),q=f(!1),B=f([]),D=f(!1),N=f(""),M=f(!1),le=async()=>{let d={id:o.query.id,profile_id:o.query.pid,order:o.query.o};if(!o.query.id||!o.query.pv){ae.value=!1;return}await axios.post("/api/pv/fetch/request-assets/data",d).then(i=>{var g,A,w,y,E;if(s.value=i.data,!s.value.access){ae.value=!1;return}((w=(A=(g=s.value)==null?void 0:g.data)==null?void 0:A.request_approvals)==null?void 0:w.length)>0&&(h.value=s.value.data.request_approvals.filter(p=>{var a;return p.profile_id==o.query.pid&&p.orders==o.query.o&&p.status=="awaiting-approval"&&((a=p.profile)==null?void 0:a.role)=="asset-supervisor"})[0],ue.value=s.value.data.request_approvals.filter(p=>{var a;return p.profile_id==o.query.pid&&p.orders==o.query.o&&p.status=="awaiting-approval"&&((a=p.profile)==null?void 0:a.role)=="commercial-manager"})[0],q.value=s.value.data.request_approvals.filter(p=>p.profile_id==o.query.pid&&p.orders==o.query.o&&p.status=="awaiting-approval"&&p.approval_type=="receiver")[0],J.value=s.value.data.request_approvals[s.value.data.request_approvals.length-1].approval_type,(q.value||h.value)&&(M.value=!0)),B.value=(E=(y=s.value)==null?void 0:y.data)==null?void 0:E.items}).catch(i=>{console.log(i.response.data)})},ve=()=>{window.print()},pe=f(window.location.origin),Y=f(!1),G=f(1),_e=d=>{G.value=d,Y.value=!0},J=f(""),te=f({}),ye=d=>{D.value=!0,te.value=d},fe=()=>{D.value=!1,N.value=""},z=(d,i=null)=>{if(D.value=!1,(d.status=="awaiting-approval"||d.status=="reject")&&o.query.pid==d.profile_id&&o.query.o==d.orders){H.value={status:!0,type:"info",text:"Please wait..."};let g=[];(h.value||q.value)&&(g=B.value.map((y,E)=>(delete y.created_at,delete y.assets,delete y.updated_at,delete y.attachment,y)));let A={},w="";N.value&&i&&(w=N.value),A={profile_id:o.query.pid,id:o.query.id,order:o.query.o,type:s.value.data.types,assets:g,is_reject:w,requestor_id:s.value.data.profile_id},axios.post("/api/pv/store/request-asset/approve-data",A).then(y=>{let E="success";y.data.success||(E="error"),H.value={status:!0,type:E,text:y.data.message},M.value=!1,setTimeout(()=>{le()},500)}).catch(y=>{console.log(y.response.data)});return}},me=d=>{if(d=="approve")return"Approved";if(d=="reviewer")return"Reviewed";if(d=="receiver")return"Received";if(d=="transport")return"Trasport Arranged";if(d=="releasing")return"Released";if(d=="verify")return"Verified"},he=()=>{let d=q.value;B.value.map(i=>{d?i.is_received=$.value:i.is_available=$.value})},ge=(d,i=6)=>{let g="00000"+d;return g.substring(g.length-i)},se=()=>{let d=!0,i=q.value;B.value.map(g=>{i?g.is_received||(d=!1):g.is_available||(d=!1)}),$.value=d},$=f(!1);return le(),(d,i)=>(r(),R(xe,{style:{"max-width":"1200px"},class:"mt-0 pt-0"},{default:n(()=>{var g,A,w,y,E,p;return[((g=B.value)==null?void 0:g.length)>0?(r(),R(x,{key:0,class:"mt-0 pt-0 no-print mt-2"},{default:n(()=>[e("div",null,[l(Q,{color:"primary",size:"small",onClick:ve},{default:n(()=>[v("Print")]),_:1})])]),_:1})):V("",!0),l(x,{class:"mt-0 pt-0"},{default:n(()=>{var a,S,O,T,I,t,U,j,C;return[e("div",Ie,[e("div",Ue,[je,e("div",null,m((S=(a=s.value.data)==null?void 0:a.transfer_from)==null?void 0:S.title),1)]),e("div",Se,[Be,e("div",null,m((T=(O=s.value.data)==null?void 0:O.transfer_to)==null?void 0:T.title),1)])]),e("div",Ne,[Pe,De,e("strong",null,m((t=(I=s.value.data)==null?void 0:I.setup)==null?void 0:t.title),1)]),e("div",$e,[v(" SN-"+m(((j=(U=s.value)==null?void 0:U.data)==null?void 0:j.types)=="request"?"5":"3")+m(ge(1)),1),Le,v(" "+m(c(ee)((C=s.value.data)==null?void 0:C.created_at)),1)])]}),_:1}),l(P,{class:"my-5"}),l(x,null,{default:n(()=>[Fe,ze,Ke,He,Me,Ye,Ge,Je,e("div",Qe,[v(" REMARKS "),h.value||q.value?(r(),R(W,{key:0,modelValue:$.value,"onUpdate:modelValue":[i[0]||(i[0]=a=>$.value=a),he],class:"pa-0 ma-0 v-col-1","hide-details":"",variant:"underlined",density:"compact"},null,8,["modelValue"])):V("",!0)])]),_:1}),(r(!0),_(ie,null,oe(B.value,(a,S)=>(r(),R(x,{class:"mt-1",key:a.id},{default:n(()=>{var O,T,I,t,U,j,C;return[e("div",We,[(O=a.attachment)!=null&&O.id?(r(),_("div",Xe,[l(L,{onClick:()=>_e(S),maxHeight:"40",variant:"text",class:"ma-2"},{default:n(()=>[l(b,{size:"large",icon:c(be),color:"success"},null,8,["icon"])]),_:2},1032,["onClick"]),l(de,{modelValue:Y.value,"onUpdate:modelValue":i[2]||(i[2]=u=>Y.value=u),width:"95%","max-width":"900"},{default:n(()=>[l(L,{class:"bg-black"},{default:n(()=>[l(ke,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:G.value,"onUpdate:modelValue":i[1]||(i[1]=u=>G.value=u)},{default:n(()=>[l(Ee,{"reverse-transition":"fade",transition:"fade"},{default:n(()=>[e("div",Ze,[l(Ce,{src:pe.value+"/file/"+a.attachment.path},null,8,["src"])])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["modelValue"])])):(r(),R(L,{key:1,maxHeight:"40",variant:"text",class:"ma-2"},{default:n(()=>[l(b,{size:"large",icon:c(Re)},null,8,["icon"])]),_:1})),l(k,{value:a.item_description,variant:"underlined",density:"compact","hide-details":"",class:"bg-light-gray",readonly:!0},null,8,["value"])]),e("div",ea,[l(k,{modelValue:a.asset_code,"onUpdate:modelValue":u=>a.asset_code=u,variant:"underlined",density:"compact","hide-details":"",readonly:!h.value,class:F(`${h.value?"":"bg-light-gray"}`)},null,8,["modelValue","onUpdate:modelValue","readonly","class"])]),e("div",aa,[l(k,{value:a.qty,variant:"underlined",density:"compact","hide-details":"",class:"bg-light-gray",type:"number",readonly:!0},null,8,["value"])]),e("div",la,[l(k,{modelValue:a.weight,"onUpdate:modelValue":u=>a.weight=u,variant:"underlined",density:"compact","hide-details":"",readonly:!h.value,class:F(`${h.value?"":"bg-light-gray"}`)},null,8,["modelValue","onUpdate:modelValue","readonly","class"])]),e("div",ta,[l(k,{modelValue:a.item_value,"onUpdate:modelValue":u=>a.item_value=u,variant:"underlined",density:"compact","hide-details":"",readonly:!h.value,class:F(`${h.value?"":"bg-light-gray"}`)},null,8,["modelValue","onUpdate:modelValue","readonly","class"])]),e("div",sa,[l(k,{modelValue:a.country_of_origin,"onUpdate:modelValue":u=>a.country_of_origin=u,variant:"underlined",density:"compact","hide-details":"",readonly:!h.value,class:F(`${h.value?"":"bg-light-gray"}`)},null,8,["modelValue","onUpdate:modelValue","readonly","class"])]),e("div",oa,[l(k,{value:a.reason_for_request,variant:"underlined",density:"compact","hide-details":"",class:"bg-light-gray",readonly:!0},null,8,["value"])]),h.value?(r(),_("div",da,[l(k,{modelValue:a.remarks,"onUpdate:modelValue":u=>a.remarks=u,variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(W,{modelValue:a.is_available,"onUpdate:modelValue":[u=>a.is_available=u,se],class:"pa-0 ma-0 v-col-1","hide-details":"",variant:"underlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])])):q.value?(r(),_("div",ra,[l(k,{modelValue:a.remarks,"onUpdate:modelValue":u=>a.remarks=u,variant:"underlined",density:"compact","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),(I=(T=s.value)==null?void 0:T.data)!=null&&I.is_available?(r(),_("div",ca,[l(b,{class:"mt-3",icon:a.is_available?c(X):c(Z),color:`${a.is_available?"success":"error"}`},null,8,["icon","color"])])):V("",!0),l(W,{modelValue:a.is_received,"onUpdate:modelValue":[u=>a.is_received=u,se],class:"pa-0 ma-0 v-col-1","hide-details":"",variant:"underlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])])):(r(),_("div",ia,[l(k,{value:a.remarks,variant:"underlined",density:"compact","hide-details":"",class:"bg-light-gray",readonly:!0},null,8,["value"]),(U=(t=s.value)==null?void 0:t.data)!=null&&U.is_available?(r(),_("div",na,[l(b,{class:"mt-3",icon:a.is_available?c(X):c(Z),color:`${a.is_available?"success":"error"}`},null,8,["icon","color"])])):V("",!0),((C=(j=s.value)==null?void 0:j.data)==null?void 0:C.status)=="complete"&&J.value=="receiver"?(r(),_("div",ua,[l(b,{class:"mt-3",icon:a.is_received?c(re):c(ce),color:`${a.is_received?"success":"error"}`},null,8,["icon","color"])])):V("",!0)]))]}),_:2},1024))),128)),h.value?(r(),R(x,{key:1,class:"mt-3"},{default:n(()=>[va]),_:1})):V("",!0),(w=(A=s.value)==null?void 0:A.data)!=null&&w.is_available?(r(),R(x,{key:2,class:"mt-6 mb-2"},{default:n(()=>[l(L,{loading:M.value,variant:"text",class:"v-col-12 text-center pt-2 font-weight-bold pb-0 d-flex justify-center"},{default:n(()=>{var a;return[e("div",null,[l(b,{icon:c(X),color:"success"},null,8,["icon"]),v(" AVAILABLE "),l(b,{icon:c(Z),color:"error",class:"ml-5"},null,8,["icon"]),v(" NOT AVAILABLE ")]),q.value?(r(),_("div",pa,[_a,l(b,{icon:c(qe)},null,8,["icon"]),v(" TICK RECEIVED ASSETS ")])):V("",!0),((a=s.value.data)==null?void 0:a.status)=="complete"&&J.value=="receiver"?(r(),_("div",ya,[l(b,{icon:c(re),color:"success"},null,8,["icon"]),v(" RECEIVED "),l(b,{icon:c(ce),color:"error",class:"ml-5"},null,8,["icon"]),v(" NOT RECEIVE ")])):V("",!0)]}),_:1},8,["loading"])]),_:1})):V("",!0),l(x,{class:"mt-3"},{default:n(()=>[e("div",fa,[l(P),l(P)])]),_:1}),((y=s.value.data)==null?void 0:y.request_approvals.length)>0?(r(),R(x,{key:3},{default:n(()=>{var a,S,O,T,I;return[e("div",ma,[ha,ga,e("div",Va,m((S=(a=s.value.data)==null?void 0:a.profile)==null?void 0:S.display_name),1),e("div",xa,m((T=(O=s.value.data)==null?void 0:O.profile)==null?void 0:T.designation),1),e("div",ba,m(c(ee)((I=s.value.data)==null?void 0:I.created_at)),1)]),(r(!0),_(ie,null,oe(s.value.data.request_approvals,t=>{var U,j;return r(),_("div",{class:"v-col-12 v-col-md-3 pa-0 mb-4",key:t.id},[t.profile.role=="commercial-manager"&&c(o).query.pid==t.profile_id&&c(o).query.o==t.orders?(r(),_("div",ka,[t.status=="awaiting-approval"?(r(),_("div",Ea,[e("div",{onClick:C=>ye(t),class:"cursor-pointer text-center py-5 v-col-6",style:K(`border:1px solid #ccc; ${c(o).query.pid==t.profile_id&&c(o).query.o==t.orders?"background-color: rgb(182, 3, 3);color:#fff;":"background-color: none;"}`)}," REJECT ",12,Ca),e("div",{onClick:C=>z(t,"reject"),class:"cursor-pointer text-center py-5 v-col-6",style:K(`border:1px solid #ccc; ${c(o).query.pid==t.profile_id&&c(o).query.o==t.orders?"background-color: rgb(3, 167, 3);color:#fff;":"background-color: none"}`)}," APPROVE ",12,Ra)])):t.status=="reject"||t.status=="done"||t.status=="pending"?(r(),_("div",qa,[e("div",{onClick:C=>z(t),class:"cursor-pointer text-center mx-2 py-5",style:K(`border:1px solid #ccc; ${t.status=="reject"&&c(o).query.pid==t.profile_id&&c(o).query.o==t.orders?"background-color: rgb(182, 3, 3);color:#fff;":t.status=="done"?"background-color: none;color:rgb(3, 167, 3); font-weight:bold;font-size:17px;padding-top:16px !important;padding-bottom:16px !important;":"background-color: gray; color:#fff;"}`)},m(t.status=="done"?"APPROVED":"CLICK TO APPROVE"),13,Aa)])):V("",!0)])):(r(),_("div",{key:1,onClick:C=>z(t),class:"cursor-pointer text-center mx-2 py-5",style:K(`border:1px solid #ccc; ${t.status=="awaiting-approval"&&c(o).query.pid==t.profile_id&&c(o).query.o==t.orders?"background-color: rgb(182, 3, 3);color:#fff;":t.status=="done"?"background-color: none;color:rgb(3, 167, 3); font-weight:bold;font-size:17px;padding-top:16px !important;padding-bottom:16px !important;":"background-color: gray; color:#fff;"}`)},m(t.status=="done"?"APPROVED":"CLICK TO APPROVE"),13,wa)),e("div",{class:F(`text-center py-1 font-weight-bold ${t.status=="reject"?"text-error text-uppercase":""}`)},m(t.status=="reject"?"Rejected":me(t.approval_type))+" By ",3),e("div",Oa,m((U=t.profile)==null?void 0:U.display_name),1),e("div",Ta,m((j=t.profile)==null?void 0:j.designation),1),e("div",Ia,m(t.date_approved?c(ee)(t.date_approved):""),1),t.reason_rejected?(r(),_("div",Ua,[v(" Reason "),l(P,{class:"my-2"}),v(" "+m(t.reason_rejected),1)])):V("",!0)])}),128))]}),_:1})):V("",!0),((p=(E=s.value)==null?void 0:E.data)==null?void 0:p.status)!=="complete"?(r(),R(x,{key:4,class:"no-print"},{default:n(()=>[e("div",ja,[l(P),v(" You will receive a notification once you click the button. "),l(P)])]),_:1})):V("",!0),l(de,{width:"500",modelValue:D.value,"onUpdate:modelValue":i[5]||(i[5]=a=>D.value=a),persistent:""},{default:n(()=>[l(L,null,{default:n(()=>[l(Ae,null,{default:n(()=>[l(x,null,{default:n(()=>[Sa,e("div",Ba,[l(we,{modelValue:N.value,"onUpdate:modelValue":i[3]||(i[3]=a=>N.value=a),label:"STATE YOUR REASON HERE",variant:"outlined"},null,8,["modelValue"])])]),_:1})]),_:1}),l(Oe,null,{default:n(()=>[l(ne),l(Q,{onClick:fe},{default:n(()=>[v("Cancel")]),_:1}),l(Q,{color:"success",disabled:!N.value,onClick:i[4]||(i[4]=a=>z(te.value,"reject"))},{default:n(()=>[v("Confirm")]),_:1},8,["disabled"]),l(ne)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Te,{options:H.value},null,8,["options"])]}),_:1}))}};export{La as default};
