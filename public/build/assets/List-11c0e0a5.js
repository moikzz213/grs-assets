import{r as s,a as ot,u as it,G as rt,H as ct,I as ut,c as _,w as u,m as dt,n as k,o as v,d as o,b as l,k as mt,V as pt,j as vt,e as w,i as ft,h as gt,s as T,J as b,x as yt,p as Y,q as ht,t as r,K as _t,y as x,C as q,L as xt,b3 as St,F as Vt,M as Ct,z as H,N as kt}from"./app-c615ec96.js";import{_ as wt}from"./AppPageHeader-80e2343a.js";import{d as S,e as V}from"./encrypt-9b455361.js";import{_ as bt}from"./AppSnackBar-ad4028b4.js";import{u as It}from"./formatDate-559e9d83.js";const zt={class:"v-col-12"},Bt=l("div",{class:"mr-2"},"Maintenance",-1),Nt={class:"v-col-12 v-col-md"},$t={class:"v-col-12 v-col-md"},Lt={class:"v-col-12 v-col-md"},Mt={class:"v-col-12 v-col-md"},Rt=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Dt=l("th",{class:"text-left text-capitalize"},"Urgency",-1),Pt=l("th",{class:"text-left text-capitalize"},"Priority",-1),Ft=l("br",null,null,-1),Kt=l("small",null,"(DD/MM/YY)",-1),At=l("th",{class:"text-right text-capitalize"},null,-1),Ot={class:"d-flex align-center justify-end"},qt={__name:"List",setup(Ut){const W=s({status:!1,type:"primary",text:null}),d=ot(),I=it(),z=rt(),c=s({loading:!1,data:[]}),B=s(0),G=s(0),f=s(""),X=s([10,20,50,100]),y=s(10),n=s({}),Q=()=>{localStorage.setItem("maintenance-filter-row",V(y.value)),p()},N=a=>{$.value="",i.value==1?(a=="company"?n.value.company_id==""?localStorage.setItem("maintenance-filter-company",""):localStorage.setItem("maintenance-filter-company",V(n.value.company_id)):a=="location"?n.value.location_id==""?localStorage.setItem("maintenance-filter-location",""):localStorage.setItem("maintenance-filter-location",V(n.value.location_id)):a=="status"&&(n.value.location_id==""?localStorage.setItem("maintenance-filter-status",""):localStorage.setItem("maintenance-filter-status",V(n.value.status_id))),p()):i.value=1},Z=()=>{I.push({name:"NewMaintenance"}).catch(a=>{})},L=()=>{localStorage.setItem("maintenance-search",V(f.value)),p()},tt=()=>{f.value="",localStorage.setItem("maintenance-search",""),p()},i=s(z.params&&z.params.page?z.params.page:1),et=a=>a?a==1?"Normal":a==2?"Medium":"High":"",C=s([]),$=s(""),M=s(0),m=a=>{c.value.loading=!0,C.value[0]=a,M.value%2?C.value[1]="DESC":C.value[1]="ASC",M.value++,$.value=JSON.stringify(C.value),p()},R=s([]),at=async()=>{await k(d.token).get("/api/fetch/companies").then(a=>{R.value=a.data}).catch(a=>{})},D=s([]),lt=async()=>{await k(d.token).get("/api/fetch/locations/non-paginated/data").then(a=>{D.value=a.data}).catch(a=>{})},P=s([]),nt=async()=>{await k(d.token).get("/api/fetch-global/incident-status/active").then(a=>{P.value=a.data}).catch(a=>{})},p=async()=>{c.value.loading=!0,await k(d.token).get("/api/fetch/maintenance-assets/data?userid="+d.user.profile.id+"&role="+d.user.profile.role+"&page="+i.value+"&show="+y.value+"&search="+f.value+"&sort="+$.value+"&filter="+JSON.stringify(n.value)).then(a=>{B.value=a.data.last_page?a.data.last_page:a.data.length,i.value=a.data.current_page?a.data.current_page:i.value,G.value=a.data.total?a.data.total:a.data.length,c.value.data=a.data.data?a.data.data:a.data,c.value.loading=!1}).catch(a=>{c.value.loading=!1,localStorage.setItem("maintenance-filter-company",null),localStorage.setItem("maintenance-filter-location",null),localStorage.setItem("maintenance-filter-status",null),localStorage.setItem("maintenance-filter-row",10)})};ct(i,(a,e)=>{i.value&&a!=e&&(I.push({name:"PaginatedMaintenance",params:{page:i.value}}).catch(t=>{}),p(i.value))});const F=(a,e)=>{let t={type:"details"};e=="view"&&(t={type:"details",pd:"ox2rKaIYFhBOQW31j6kkiMrJ4KfnYpLmwJhMzBFwPBlVjgGR4g",v:1,vv:"xK2sX1sDL1BBAvmuoPpWoNRgc4wzbdZ9F2OXAKrS3N2g65xNgy"}),I.push({name:"EditMaintenance",params:{id:a},query:t}).catch(g=>{})},st=(a,e=5)=>{let t="0000"+a;return t.substring(t.length-e)};return ut(()=>{let a=localStorage.getItem("maintenance-search"),e=localStorage.getItem("maintenance-filter-company"),t=localStorage.getItem("maintenance-filter-location"),g=localStorage.getItem("maintenance-filter-status"),h=localStorage.getItem("maintenance-filter-row");a&&(f.value=S(a)),e&&(n.value.company_id=S(e)),t&&(n.value.location_id=S(t)),g&&(n.value.status_id=S(g)),h&&(y.value=S(h)),p().then(()=>{at(),lt(),nt()})}),(a,e)=>(v(),_(dt,null,{default:u(()=>[o(wt,{title:"Maintenance list page"}),o(T,{class:"mb-3"},{default:u(()=>[l("div",zt,[o(mt,{loading:c.value.loading},{default:u(()=>[o(pt,{class:"d-flex align-center mb-3 pa-3"},{default:u(()=>[Bt,o(vt,{color:"primary",size:"small",onClick:Z,class:"mr-auto"},{default:u(()=>[w("NEW")]),_:1}),o(ft,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=t=>f.value=t),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":L,onKeydown:gt(L,["enter"]),"onClick:clear":e[1]||(e[1]=t=>tt("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(T,{class:"px-3"},{default:u(()=>[l("div",Nt,[o(b,{items:R.value,modelValue:n.value.company_id,"onUpdate:modelValue":[e[2]||(e[2]=t=>n.value.company_id=t),e[3]||(e[3]=t=>N("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",$t,[o(b,{items:D.value,modelValue:n.value.location_id,"onUpdate:modelValue":[e[4]||(e[4]=t=>n.value.location_id=t),e[5]||(e[5]=t=>N("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",Lt,[o(b,{items:P.value,modelValue:n.value.status_id,"onUpdate:modelValue":[e[6]||(e[6]=t=>n.value.status_id=t),e[7]||(e[7]=t=>N("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])]),l("div",Mt,[o(b,{items:X.value,modelValue:y.value,"onUpdate:modelValue":[e[8]||(e[8]=t=>y.value=t),Q],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])])]),_:1}),o(yt,null,{default:u(()=>[l("thead",null,[l("tr",null,[Rt,Dt,Pt,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[9]||(e[9]=t=>m("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[10]||(e[10]=t=>m("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[11]||(e[11]=t=>m("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[12]||(e[12]=t=>m("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[13]||(e[13]=t=>m("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[14]||(e[14]=t=>m("handled_by"))}," HandledBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[15]||(e[15]=t=>m("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[16]||(e[16]=t=>m("created_at"))},[w(" D.Created"),Ft,Kt]),At])]),l("tbody",null,[(v(!0),Y(Vt,null,ht(c.value.data,t=>{var g,h,K,A,O,U,E,j;return v(),Y("tr",{key:t.id},[l("td",null,"ISR-2"+r(st(t.id)),1),l("td",null,r((g=t.urgency)==null?void 0:g.title),1),l("td",null,r(et(t.priority)),1),l("td",null,r((h=t.company)==null?void 0:h.title),1),l("td",null,r((K=t.location)==null?void 0:K.title),1),l("td",null,r(t.asset?t.asset.asset_name:t.title),1),l("td",null,r((A=t.asset)==null?void 0:A.asset_code),1),l("td",null,r((O=t.profile)==null?void 0:O.display_name),1),l("td",null,r((U=t.handled_by)==null?void 0:U.display_name),1),l("td",null,[o(_t,{class:"text-uppercase",size:"small",color:`${((E=t.status)==null?void 0:E.title.toLowerCase())=="completed"?"success":"error"}`},{default:u(()=>{var J;return[w(r((J=t.status)==null?void 0:J.title),1)]}),_:2},1032,["color"])]),l("td",null,r(x(It)(t.created_at)),1),l("td",null,[l("div",Ot,[x(d).user.role=="superadmin"||(j=x(d).capabilities)!=null&&j.includes("edit")?(v(),_(q,{key:0,size:"small",onClick:()=>F(t.id,"edit"),icon:x(xt),class:"mx-1"},null,8,["onClick","icon"])):(v(),_(q,{key:1,size:"small",onClick:()=>F(t.id,"view"),icon:x(St),class:"mx-1"},null,8,["onClick","icon"]))])])])}),128))])]),_:1}),c.value.data.length==0?(v(),_(Ct,{key:0,class:"pa-3 text-center w-100"},{default:u(()=>[w("No records found")]),_:1})):H("",!0)]),_:1},8,["loading"]),B.value>1?(v(),_(kt,{key:0,modelValue:i.value,"onUpdate:modelValue":e[17]||(e[17]=t=>i.value=t),class:"my-4",length:B.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:c.value.loading},null,8,["modelValue","length","disabled"])):H("",!0)])]),_:1}),o(bt,{options:W.value},null,8,["options"])]),_:1}))}};export{qt as default};
