import{i as ne,r,X as re,O as Y,aY as ie,b as n,c,l as a,k as u,A as I,E as _,e as v,a2 as ce,K as V,V as ve,m as b,t as k,Q as K,q as T,F as D,d as S,j as F,y as me,a4 as G,x as J,I as w,P as Q,M as pe,z as j,G as fe,J as he,T as ye,Y as _e,Z as X,_ as Z,$ as be,a0 as ge,D as q}from"./app-d45ea034.js";import{a as Ve,c as ke,F as we,b as xe}from"./index.esm-a4b6eac8.js";import{_ as Ce}from"./Studio-f4c83174.js";const Ae={class:"text-error"},De={class:"d-flex pa-3"},Se={key:0,class:"v-col-4",style:{"border-left":"1px solid #ccc"}},Fe=v("h5",null,"ADD ASSET",-1),je={key:1,class:"v-col-4 text-center",style:{"border-left":"1px solid #ccc","background-color":"#e0e0e0"}},Ue={class:"d-flex mb-5 justify-center"},Ne={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Oe=v("div",{class:"mb-5",style:{position:"absolute",bottom:"0"}}," Note: Dont forget to click the save button at the top ",-1),Te={__name:"DialogForm",props:{dataObject:{type:Object,default:{}},addNewDialog:{type:Boolean,default:!1},title:{type:String,default:""},freeForm:{type:Array,default:[]}},emits:["savedResponse","fileSave","save"],setup(H,{emit:U}){const m=H,x=ne(),N=r(""),ee=l=>{let t=null;l.map(d=>{t=i.value.find(s=>s.id==d.id),t||i.value.push(d)})},z=r([]),C=r(""),O=r(!1),$=r(1),ae=l=>{$.value=l,O.value=!0},te=l=>{i.value=i.value.filter(t=>t.id!==l)},i=r([]),B=re(()=>i.value.map(l=>l.id)),le=()=>{let l={id:parseInt(W.value),file_ids:B.value,profile_id:x.user.profile.id};q(x.token).post("/api/warranty/sync-images/store-update",l).then(t=>{let d="Attachment has been updated";B.value.length==0&&(d="Attachment has been deleted"),U("fileSave",d)}).catch(t=>{})},se=l=>{let t=o.value.display_assets,d=o.value.assets;t.splice(l,1),d.splice(l,1),o.value.display_assets=[...t],o.value.assets=[...d]},h=r(!1),o=r({}),R=r(m.freeForm),E=()=>{h.value=!1,o.value={},U("cancelled",h.value)},L=()=>{h.value=!1,U("save",o.value),o.value={}},M=r({});R.value.map((l,t)=>{l.required&&(M.value[l.name]=Ve().required())});let oe=ke(M.value);const y=r(!1),ue=l=>{q(x.token).post("/api/fetch/warranty/by/id/"+l).then(t=>{var d,s,e,p,f;((e=(s=(d=t==null?void 0:t.data)==null?void 0:d.data)==null?void 0:s.pivot_assets)==null?void 0:e.length)>0&&t.data.data.pivot_assets.map((g,A)=>{o.value.assets.push(g.id),o.value.display_assets.push(g)}),i.value=(f=(p=t.data)==null?void 0:p.data)==null?void 0:f.attachment}).catch(t=>{})},P=r(window.location.origin),W=r(0);Y(()=>m.addNewDialog,l=>{y.value=!1,o.value={},h.value=l,N.value="New "+m.title,m.dataObject.type&&(o.value=m.dataObject,N.value="Edit "+m.title,m.title=="Warranty"&&(o.value.assets=[],o.value.display_assets=[],o.value.pivot_assets=[],ue(o.value.id),W.value=o.value.id,y.value=!0))});const de=l=>{l.length<4||q(x.token).get("/api/search-assets/warranty/"+l).then(t=>{let d=[];t.data&&t.data.length>0&&t.data.map((s,e)=>{d[e]=s,d[e].new_title=s.asset_name+" ("+s.asset_code+")"}),z.value=d}).catch(t=>{})};return Y(()=>C.value,l=>{l&&(o.value.assets.includes(l.id)||(o.value.assets.push(l.id),o.value.display_assets.push(l)),C.value=""),console.log("dataObj.value",l)}),(l,t)=>{const d=ie("v-card-action");return n(),c("div",null,[a(Z,{width:y.value?1200:600,persistent:"",modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),onKeydown:J(E,["esc"]),class:"d-flex",style:{overflow:"auto"}},{default:u(()=>[a(I,{class:"py-3"},{default:u(()=>[a(_,null,{default:u(()=>[v("div",{class:ce(`${y.value?"v-col-4":"v-col-12"}`)},[a(V(we),{as:"v-form","validation-schema":V(oe)},{default:u(({meta:s})=>[a(ve,{class:"text-h6 d-flex"},{default:u(()=>[b(k(N.value),1),a(K),v("small",Ae,k(l.errorMessage),1),a(K)]),_:1}),a(T,null,{default:u(()=>[a(_,null,{default:u(()=>[(n(!0),c(D,null,S(R.value,(e,p)=>(n(),c("div",{class:"v-col-12",key:p},[a(V(xe),{name:e.name,modelValue:o.value[e.name],"onUpdate:modelValue":f=>o.value[e.name]=f},{default:u(({field:f,errors:g})=>[e.type=="text"||e.type=="number"||e.type=="date"||e.type=="email"?(n(),F(me,G({key:0,type:e.type,autofocus:p===0,modelValue:o.value[e.name],"onUpdate:modelValue":A=>o.value[e.name]=A,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,"hide-details":""},f,{onKeydown:J(L,["enter"]),"error-messages":g}),null,16,["type","autofocus","modelValue","onUpdate:modelValue","label","onKeydown","error-messages"])):w("",!0),e.type=="select"?(n(),F(Q,G({key:1,autofocus:p===0,modelValue:o.value[e.name],"onUpdate:modelValue":A=>o.value[e.name]=A,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":""}`,items:e.data,"hide-details":"","item-value":"id","item-title":"title"},f,{"error-messages":g}),null,16,["autofocus","modelValue","onUpdate:modelValue","label","items","error-messages"])):w("",!0)]),_:2},1032,["name","modelValue","onUpdate:modelValue"])]))),128))]),_:1})]),_:1}),a(pe,{class:"mt-2"}),v("div",De,[a(K),a(j,{size:"small",text:"cancel",onClick:E,class:"mx-1"}),a(j,{size:"small",color:"primary",onClick:L,disabled:!s.valid},{default:u(()=>[b("Save")]),_:2},1032,["disabled"])])]),_:1},8,["validation-schema"])],2),y.value?(n(),c("div",Se,[a(T,null,{default:u(()=>[Fe,a(_,{class:"mt-1"},{default:u(()=>[a(fe,null,{default:u(()=>[a(Q,{density:"compact",label:"Search asset name or code",variant:"outlined",items:z.value,"onUpdate:search":de,"item-value":"id","item-title":"new_title",modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=s=>C.value=s),"hide-details":"",clearable:"","return-object":""},null,8,["items","modelValue"])]),_:1})]),_:1}),a(_,{style:{"max-height":"460px",overflow:"auto"}},{default:u(()=>[(n(!0),c(D,null,S(o.value.display_assets,(s,e)=>(n(),c("div",{class:"v-col-12 v-col-md-12 text-caption py-1",key:e},[b(k(e+=1)+". "+k(s.asset_name)+" ",1),v("b",null,"("+k(s.asset_code)+")",1),b(),a(he,{onClick:p=>se(e),class:"ml-2 cursor-pointer",color:"error",icon:V(ye)},null,8,["onClick","icon"])]))),128))]),_:1})]),_:1}),a(d,{class:"mb-5",style:{position:"absolute",bottom:"0"}},{default:u(()=>[b(" Note: Dont forget to click the save button ")]),_:1})])):w("",!0),y.value?(n(),c("div",je,[a(T,null,{default:u(()=>[v("div",Ue,[a(Ce,{options:{multiSelect:!0,type:"warranty"},onSelect:ee}),a(j,{color:"primary",onClick:le,disabled:i.value.length==0},{default:u(()=>[b("Save Images")]),_:1},8,["disabled"])]),i.value.length>0?(n(),F(_,{key:0,class:"px-1"},{default:u(()=>[(n(!0),c(D,null,S(i.value,(s,e)=>(n(),c("div",{key:s.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[a(j,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:V(_e),size:"18px",color:"error",onClick:()=>te(s.id)},null,8,["icon","onClick"]),a(I,{onClick:()=>ae(e)},{default:u(()=>[a(X,{src:P.value+"/file/"+s.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),a(Z,{modelValue:O.value,"onUpdate:modelValue":t[2]||(t[2]=s=>O.value=s),width:"95%","max-width":"900"},{default:u(()=>[a(I,{class:"bg-black"},{default:u(()=>[a(be,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:$.value,"onUpdate:modelValue":t[1]||(t[1]=s=>$.value=s)},{default:u(()=>[(n(!0),c(D,null,S(i.value,(s,e)=>(n(),F(ge,{key:e,"reverse-transition":"fade",transition:"fade"},{default:u(()=>[v("div",Ne,[a(X,{src:P.value+"/file/"+s.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),a(_,null,{default:u(()=>[Oe]),_:1})]),_:1})])):w("",!0)]),_:1})]),_:1})]),_:1},8,["width","modelValue","onKeydown"])])}}};export{Te as _};
