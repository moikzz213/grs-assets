import{i as Q,r as m,o as ee,b as p,c as A,j as k,k as l,l as a,q as P,G as f,z as I,m as D,A as B,I as F,D as V,F as se,d as oe,Y as ne,aV as ue,aW as re,Z as ce,e as s,K as S,M as ie,t as j,O as K,a0 as de,J as X,L as me,u as ve,N as pe,a1 as W,V as _e,a2 as G,a3 as M,y as le,C as fe}from"./app-2c5a49eb.js";import{_ as ye}from"./AppPageHeader-aab5a62f.js";import{_ as be}from"./AppSnackBar-abe71aae.js";import{c as ge,a as H,F as he,b as Y}from"./index.esm-7f8f3b3c.js";import{u as Z,a as Ve}from"./formatDate-e2fbee14.js";import{v as ke}from"./vue-filepond.esm-70028a9b.js";import{_ as je}from"./_plugin-vue_export-helper-c27b6911.js";const xe=s("div",{class:"v-col-12 text-uppercase font-weight-bold"}," Uploaded Files ",-1),De=s("div",{class:"v-col-12"},"No file found.",-1),$e=["src"],we={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},files:{type:Array,default:[]}},emits:["deleted"],setup(L,{emit:N}){const n=L;console.log("objectdata",n.objectdata.profile_id);const c=Q(),e=m([]),i=m(null),T=ke(),q={process:(b,h,r,$,E,J,z,ae,te)=>{const o=new FormData;o.append(b,h,h.name),o.append("profile_id",c.user.profile.id),o.append("ID",n.incidentId),o.append("type","incident");const t=new XMLHttpRequest;return t.open("POST","/api/upload-files/docs-images"),t.upload.onprogress=x=>{J(x.lengthComputable,x.loaded,x.total)},t.onload=function(){t.status>=200&&t.status<300?$(t.responseText):E("oh no")},t.send(o),{abort:()=>{t.abort(),z()}}}},_=m(c.user.profile.id),C=m(""),g=m(!1),R=(b,h)=>{g.value=h,C.value=b},O=()=>{console.log("initialised")},v=()=>{i.value.processFiles().then(b=>{let h={};b.map((r,$)=>{h=JSON.parse(r.serverId)[0][0],d.value.push(h)})})},y=(b,h)=>{let r={data:b,ID:n.incidentId};S(c.token).post("/api/delete/uploaded-file",r).then($=>{d.value.splice(h,1),N("deleted",$.data.msg)}).catch($=>{})},d=m([]);return ee(()=>{d.value=n.files}),(b,h)=>(p(),A("div",null,[n.objectdata.profile_id==_.value?(p(),k(B,{key:0},{default:l(()=>[a(P,null,{default:l(()=>[a(f(T),{name:"filename",ref_key:"pond",ref:i,credits:"","label-idle":"Select or Drop image (jpeg, jpg, png) here... max 6 files only","allow-multiple":!0,"accepted-file-types":"image/jpeg, image/png",files:e.value,server:q,onInit:O,"max-files":"6",instantUpload:"false"},null,8,["files"]),a(I,{onClick:v},{default:l(()=>[D("Upload")]),_:1})]),_:1})]),_:1})):F("",!0),a(B,{class:"mt-2"},{default:l(()=>[a(P,null,{default:l(()=>[a(V,null,{default:l(()=>[xe]),_:1}),d.value&&d.value.length>0?(p(),k(V,{key:0},{default:l(()=>[(p(!0),A(se,null,oe(d.value,(r,$)=>(p(),A("div",{class:"v-col-12 v-col-md-3 text-center parent-row-show",key:r.id},[a(ne,{onClick:E=>R(r,!0),class:"mx-3 cursor-pointer",src:`/storage/uploads/${r.path}`,alt:"File",maxHeight:"150",style:{border:"1px solid #e2e2e2"}},null,8,["onClick","src"]),f(c).user.profile.id==r.profile_id?(p(),k(I,{key:0,onClick:E=>y(r,$),class:"show-hover mx-auto mt-2",size:"small",color:"error"},{default:l(()=>[D("Delete Image")]),_:2},1032,["onClick"])):F("",!0)]))),128))]),_:1})):(p(),k(V,{key:1},{default:l(()=>[De]),_:1}))]),_:1})]),_:1}),a(ce,{maxWidth:"900",modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=r=>g.value=r)},{default:l(()=>[a(I,{size:"small",onClick:h[0]||(h[0]=()=>R("",!1)),icon:f(ue),style:{position:"absolute",right:"-10px",top:"-10px","z-index":"9999"},color:"error"},null,8,["icon"]),a(B,{class:"text-center"},{default:l(()=>[a(re,{color:"primary",title:`Filename: ${C.value.original_name}`},null,8,["title"]),a(P,null,{default:l(()=>[C.value?(p(),A("img",{key:0,src:`/storage/uploads/${C.value.path}`,alt:"Image"},null,8,$e)):F("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Ce={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},Fe={class:"font-weight-bold"},Ie={class:"reported-by"},Ue={class:"reported-by"},Se={class:"v-col-12"},Te={class:"v-col-12 v-col-md-4 pb-0"},qe={class:"v-col-12 v-col-md-8"},Re={class:"v-col-12"},Ee={class:"v-col-12"},Ae={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},Le={class:"v-col-3"},Ne=s("br",null,null,-1),Oe={class:"v-col-9"},Pe={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(L,{emit:N}){const n=L,c=Q(),e=m(c.user.profile.role),i=m({}),T=m([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),q=m([]),_=async()=>{await S(c.token).get("/api/fetch/profile-facility/team").then(v=>{q.value=v.data}).catch(v=>{})},C=()=>{i.value.profile_id=c.user.profile.id,S(c.token).post("/api/incident/update-facility-team",i.value).then(v=>{i.value.remarks_data="",N("saved",v.data.message)}).catch(v=>{})},g=m([]),R=async()=>{await S(c.token).get("/api/fetch-global/incident-status/active").then(v=>{g.value=v.data}).catch(v=>{})},O=(v,y=6)=>{let d="00000"+v;return d.substring(d.length-y)};return ee(()=>{_(),R(),i.value=n.objectdata,i.value.priority=n.objectdata.priority?parseInt(n.objectdata.priority):null}),ie(()=>n.objectdata.remarks,(v,y)=>{i.value.remarks=v},{deep:!0}),(v,y)=>(p(),A("div",null,[a(B,null,{default:l(()=>[a(P,null,{default:l(()=>[a(V,null,{default:l(()=>{var d;return[s("div",Ce,[s("div",Fe," SN: ISR-"+j(O(i.value.id)),1),s("div",Ie," REPORTED BY: "+j((d=i.value.profile)==null?void 0:d.display_name),1),s("div",Ue," DATE REPORTED: "+j(f(Z)(i.value.created_at)),1)])]}),_:1}),a(V,null,{default:l(()=>[s("div",Se,[a(V,null,{default:l(()=>[s("div",Te,[a(K,{items:T.value,modelValue:i.value.priority,"onUpdate:modelValue":y[0]||(y[0]=d=>i.value.priority=d),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*",disabled:e.value=="facility"},null,8,["items","modelValue","disabled"]),a(K,{items:q.value,modelValue:i.value.handled_by,"onUpdate:modelValue":y[1]||(y[1]=d=>i.value.handled_by=d),variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:e.value=="facility","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue","disabled"]),a(K,{items:g.value,modelValue:i.value.status_id,"onUpdate:modelValue":y[2]||(y[2]=d=>i.value.status_id=d),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",qe,[a(de,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:i.value.remarks_data,"onUpdate:modelValue":y[3]||(y[3]=d=>i.value.remarks_data=d)},null,8,["modelValue"])])]),_:1})]),a(X,{class:"mt-3"}),s("div",Re,[a(I,{class:"",size:"small",disabled:!i.value.priority||!i.value.handled_by||!i.value.status_id,onClick:C,color:"primary"},{default:l(()=>[D("Submit")]),_:1},8,["disabled"])])]),_:1}),a(V,null,{default:l(()=>[s("div",Ee,[D(" Remarks "),a(X)]),s("div",Ae,[(p(!0),A(se,null,oe(i.value.remarks,d=>(p(),k(V,{key:v.id},{default:l(()=>{var b;return[s("div",Le,[D(j((b=d.profile)==null?void 0:b.display_name)+" ",1),Ne,D(),s("small",null,j(f(Ve)(d.created_at)),1)]),s("div",Oe,j(d.remarks),1)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const Be={class:"v-col-12 v-col-md-6 d-flex justify-space-between"},ze={class:"font-weight-bold"},Me={class:"reported-by"},He={class:"v-col-12 v-col-md-6 text-right font-weight-bold"},Ye={class:"v-col-12 v-col-md-3"},Je={class:"v-col-12 v-col-md-6 d-flex"},Ke={class:"v-col-12"},We={class:"v-col-12 v-col-md-12"},Ge={class:"v-col-12 v-col-md-3"},Xe={class:"v-col-12"},Ze={class:"v-col-12"},Qe={class:"v-col-12 v-col-md-9"},ea={class:"v-col-12 v-col-md-6"},aa={class:"v-col-12 v-col-md-3"},ta={class:"v-col-12 v-col-md-3"},la={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(L,{emit:N}){const n=L,c=Q(),e=m({}),i=m({}),T=o=>{i.value={status:!0,type:"success",text:o},N("saved")},q=m(c.user.profile.id),_=me(),C=ve(),g=m(_.query.type),R=m([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]);let O=ge({Urgency:H().required(),Title:H().required(),Company:H().required(),Location:H().required()});const v=new URL(window.location),y=o=>{g.value=o,$("type",o)},d=m(!1),b=m(c.user.profile.role),h=async()=>{d.value=!0,i.value={status:!0,type:"info",text:"Please wait..."},e.value.type_id=2,e.value.profile_id=c.user.profile.id,await S(c.token).post("/api/store-update/incident",e.value).then(o=>{i.value={status:!0,type:"success",text:o.data.message},_.params.id?d.value=!1:setTimeout(()=>{C.push({name:"EditMaintenance",params:{id:o.data.id},query:{type:"details"}}).catch(t=>{}),d.value=!1},800)}).catch(o=>{})},r=m(!1),$=(o,t)=>{v.searchParams.set(o,t),window.history.pushState({},"",v)},E=m([]),J=async()=>{await S(c.token).get("/api/fetch/companies").then(o=>{E.value=o.data}).catch(o=>{})},z=m([]),ae=async()=>{await S(c.token).get("/api/fetch/locations/non-paginated/data").then(o=>{z.value=o.data}).catch(o=>{})},te=(o,t=5)=>{let x="50000"+o;return x.substring(x.length-t)};return ee(()=>{var o;_.query.asset_code&&(e.value.asset_code=_.query.asset_code),_.query.title&&(e.value.title=_.query.title),_.query.asset_id&&(e.value.asset_id=parseInt(_.query.asset_id)),_.query.comp&&(e.value.company_id=parseInt(_.query.comp)),_.query.loc&&(e.value.location_id=parseInt(_.query.loc)),_.params.id&&(r.value=!0),g.value||(g.value="details",$("type","details")),J().then(()=>{ae()}),console.log("isEdit.value",r.value),r.value&&(e.value=n.objectdata,e.value.asset_code=(o=n.objectdata.asset)==null?void 0:o.asset_code,e.value.title=n.objectdata.asset?n.objectdata.asset.asset_name:n.objectdata.title,e.value.company_id=n.objectdata.company_id,e.value.location_id=n.objectdata.location_id,e.value.asset_id=n.objectdata.asset_id,e.value.profile_id=n.objectdata.profile_id,e.value.type_id=parseInt(n.objectdata.type_id),e.value.urgency=parseInt(n.objectdata.urgency),e.value.description=n.objectdata.description),console.log("objData.value",e.value)}),ie(()=>n.objectdata.remarks,(o,t)=>{e.value=n.objectdata},{deep:!0}),(o,t)=>(p(),k(fe,null,{default:l(()=>[a(ye,{title:"Maintenance detail page"}),a(V,{class:"mb-3"},{default:l(()=>[a(pe,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[a(V,{class:"mb-3"},{default:l(()=>[a(I,{class:W(`${g.value=="details"?"tab-active":""}  v-col-12 v-col-md-2 mx-2`),onClick:t[0]||(t[0]=x=>y("details"))},{default:l(()=>[D("Details")]),_:1},8,["class"]),r.value?(p(),k(I,{key:0,class:W(`${g.value=="attachment"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[1]||(t[1]=x=>y("attachment"))},{default:l(()=>[D("Attachments")]),_:1},8,["class"])):F("",!0),r.value&&(f(c).user.profile.role=="facility"||f(c).user.profile.role=="admin"||f(c).user.profile.role=="superadmin"||f(c).user.profile.role=="technical-operation")?(p(),k(I,{key:1,class:W(`${g.value=="facility"?"tab-active":""}   v-col-12 v-col-md-2 mx-2`),onClick:t[2]||(t[2]=x=>y("facility"))},{default:l(()=>[D("Facility Team")]),_:1},8,["class"])):F("",!0)]),_:1}),g.value=="details"?(p(),k(B,{key:0},{default:l(()=>[a(f(he),{as:"v-form","validation-schema":f(O)},{default:l(({meta:x})=>[a(_e,{class:"my-3 ml-3 text-uppercase text-h6"},{default:l(()=>[D(j(n.headertitle),1)]),_:1}),a(P,null,{default:l(()=>[r.value?(p(),k(V,{key:0},{default:l(()=>{var u,w;return[s("div",Be,[s("div",ze," SN: ISR-2"+j(te(e.value.id)),1),s("div",Me," REPORTED BY: "+j((u=e.value.profile)==null?void 0:u.display_name),1)]),s("div",He," STATUS: "+j((w=e.value.status)==null?void 0:w.title),1)]}),_:1})):F("",!0),a(V,null,{default:l(()=>[s("div",Ye,[a(f(Y),{name:"Urgency",modelValue:e.value.urgency,"onUpdate:modelValue":t[4]||(t[4]=u=>e.value.urgency=u)},{default:l(({field:u,errors:w})=>[a(G,M({items:R.value,modelValue:e.value.urgency,"onUpdate:modelValue":t[3]||(t[3]=U=>e.value.urgency=U),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},u,{"error-messages":w}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Je,[a(le,{modelValue:e.value.asset_code,"onUpdate:modelValue":t[5]||(t[5]=u=>e.value.asset_code=u),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code"},null,8,["modelValue"])]),s("div",Ke,[a(f(Y),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":t[7]||(t[7]=u=>e.value.title=u)},{default:l(({field:u,errors:w})=>[a(le,M({modelValue:e.value.title,"onUpdate:modelValue":t[6]||(t[6]=U=>e.value.title=U),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},u,{"error-messages":w}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",We,[a(V,null,{default:l(()=>[s("div",Ge,[a(V,null,{default:l(()=>[s("div",Xe,[a(f(Y),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":t[9]||(t[9]=u=>e.value.company_id=u)},{default:l(({field:u,errors:w})=>[a(G,M({items:E.value,modelValue:e.value.company_id,"onUpdate:modelValue":t[8]||(t[8]=U=>e.value.company_id=U),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},u,{"error-messages":w}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Ze,[a(f(Y),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":t[11]||(t[11]=u=>e.value.location_id=u)},{default:l(({field:u,errors:w})=>[a(G,M({items:z.value,modelValue:e.value.location_id,"onUpdate:modelValue":t[10]||(t[10]=U=>e.value.location_id=U),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},u,{"error-messages":w}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])])]),_:1})]),s("div",Qe,[a(de,{variant:"outlined",density:"compact",label:"Description","hide-details":"",modelValue:e.value.description,"onUpdate:modelValue":t[12]||(t[12]=u=>e.value.description=u)},null,8,["modelValue"])])]),_:1})])]),_:1}),a(X,{class:"my-3"}),a(V,null,{default:l(()=>{var u;return[s("div",ea,[((u=e.value)==null?void 0:u.status_id)!=8&&(!r.value||r.value&&(n.objectdata.profile_id==q.value||b.value=="asset-supervisor"))?(p(),k(I,{key:0,size:"small",color:"primary",onClick:h,disabled:!x.valid,loading:d.value},{default:l(()=>[D("Submit")]),_:2},1032,["disabled","loading"])):F("",!0)]),s("div",aa," DATE REPORTED: "+j(f(Z)(e.value.created_at)),1),s("div",ta," DATE CLOSED: "+j(o.date_closed?f(Z)(e.value.date_closed):""),1)]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):r.value&&g.value=="attachment"?(p(),k(we,{key:1,"incident-id":f(_).params.id,files:e.value.files,onDeleted:T,objectdata:e.value},null,8,["incident-id","files","objectdata"])):(b.value=="superadmin"||b.value=="admin"||b.value=="technical-operation"||b.value=="facility")&&r.value&&g.value=="facility"?(p(),k(Pe,{key:2,objectdata:e.value,onSaved:T},null,8,["objectdata"])):F("",!0)]),_:1})]),_:1}),a(be,{options:i.value},null,8,["options"])]),_:1}))}},ca=je(la,[["__scopeId","data-v-f0b8c455"]]);export{ca as D};
