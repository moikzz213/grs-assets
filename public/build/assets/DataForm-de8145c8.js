import{a as ye,r,I as Ve,u as ge,K as be,T as ke,J as Q,o as n,c as _,w as s,d as a,v as Ae,k as j,V as we,b as o,t as y,p as g,y as f,at as J,E as p,H as F,f as I,s as h,j as x,e as C,L as E,i as k,q as W,X as xe,Y as Ue,Z as Ce,W as Se,P as qe,D as X,O as Te,F as P,aE as je,aF as Ee,aG as Oe,aH as Re,aI as De,m as Le,n as S}from"./app-9eb203a8.js";import{_ as Ne}from"./ApppageHeader-eccc6bd0.js";import{_ as Be}from"./Studio-60b21855.js";import{_ as ze}from"./AppSnackBar-03a1caf4.js";import{u as Z}from"./formatDate-b9aad8c5.js";import{r as ee}from"./generateRandomString-02c0ba3b.js";const Fe={key:0,class:"text-error text-h6"},Ie={class:"v-col-8 text-right"},Pe={key:0},$e={key:1,class:"v-col-8 text-right"},Ke={class:"v-col-12 v-col-md-6"},Me={class:"v-col-12 v-col-md-6"},Ye={class:"v-col-12 v-col-md-6"},Ge={class:"v-col-12 v-col-md-6"},He={class:"v-col-12"},Qe={class:"v-col-12"},Je={class:"v-col-12 v-col-md-1 px-1"},We={class:"v-col-12 v-col-md-12 pa-2",style:{position:"relative"}},Xe={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Ze={class:"v-col-12 pt-0 pb-0"},et={class:"v-col-12 v-col-md-3"},tt={class:"v-col-12 v-col-md-2"},at={class:"v-col-12 v-col-md-1"},lt={class:"v-col-12 v-col-md-1"},st={class:"v-col-12 v-col-md-1"},ot={class:"v-col-12 v-col-md-3 d-flex"},dt={class:"v-col-12 font-weight-bold text-uppercase d-flex justify-space-between"},it=o("div",null,"APPROVAL SETUP",-1),nt={key:0},ut=o("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),rt={class:"v-col-12 v-col-md-6"},ct=o("div",{class:"v-col-12 v-col-md-1"},"Status",-1),pt=o("div",{class:"v-col-12 v-col-md-2"},"Date Approved",-1),vt={class:"v-col-12 v-col-md-2"},mt={class:"v-col-12 v-col-md-7 d-flex"},_t={class:"my-auto"},ft={class:"v-col-12"},ht={class:"v-col-12 text-error"},yt=o("div",{class:"v-col-12 v-col-md-12 text-info"}," Note: Once submitted and approval is on-going, you will no longer allowed to update the request. ",-1),xt={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(te,{emit:ae}){const b=te,v=ye(),$=r("Note: Administrator needs to setup signatories first."),D=r(!1),A=Ve(),le=ge(),i=r({}),w=r(!1),V=r([{qty:1,attachment:{}}]),se=r(new Date),K=t=>{if(t=="approve")return"Approved By";if(t=="reviewer")return"Reviewed By";if(t=="receiver")return"Received By";if(t=="transport")return"Trasport Arranged By";if(t=="releasing")return"Released By";if(t=="verify")return"Verified By"},oe=r(window.location.origin),de=(t,l)=>{V.value[t].attachment=l[0]},L=r(!1),N=r(1),ie=t=>{N.value=t,L.value=!0},ne=t=>{V.value[t].attachment=""},M=r([]),ue=async()=>{let t="request";b.headertitle=="Transfer Assets"&&(t="transfer"),await S(v.token).get("/api/fetch/approval-setups/non-paginated/data/"+t).then(l=>{M.value=l.data}).catch(l=>{})},O=r({}),Y=r([]),re=async()=>{await S(v.token).get("/api/fetch/companies").then(t=>{Y.value=t.data}).catch(t=>{})},B=r([]),ce=async()=>{await S(v.token).get("/api/fetch/locations/non-paginated/data").then(t=>{B.value=t.data}).catch(t=>{})},pe=()=>{V.value.push({qty:1,attachment:{}}),q()},ve=(t,l)=>{V.value.splice(l,1),q()},me=()=>{O.value={status:!0,type:"info",text:"Please wait..."};let t=V.value.map((e,d)=>(e.file_id="",e.attachment&&(e.file_id=e.attachment.id),delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,delete e.attachment,e)),l={data:i.value,assets:t,approval:U.value,profile_id:v.user.profile.id,role:v.user.profile.role,type:"transfer"};S(v.token).post("/api/request-asset/store-update/data",l).then(e=>{let d="",m="";e.data.message?(d=e.data.message,m="success"):e.data.error&&(d=e.data.error,m="error"),O.value={status:!0,type:m,text:d},A.params.id||setTimeout(()=>{le.push({name:"EditTransferAsset",params:{id:e.data.id}}).catch(z=>{})},800)}).catch(e=>{console.log(e)})},U=r([]),R=r(!0),G=async()=>{await S(v.token).get("/api/fetch/request-asset/approval-setup-fetch/"+i.value.request_type_id).then(t=>{var l,e;U.value=(l=t.data)==null?void 0:l.stages,A.params.id&&U.value.length>0&&U.value.map((d,m)=>(d.profile_id=T.value[m].profile_id,d.status=T.value[m].status,d.date_approved=T.value[m].date_approved,d.reason_rejected=T.value[m].reason_rejected,d)),((e=t.data)==null?void 0:e.stages.length)>0?R.value=!0:R.value=!1}).catch(t=>{})},q=()=>{let t=!1;D.value=!1,i.value.company_id&&i.value.request_type_id&&i.value.subject&&i.value.transferred_from&&i.value.transferred_to&&(t=!0);let l=!0;V.value.map(d=>{d.item_description&&d.reason_for_request||(l=!1)});let e=!0;U.value.map(d=>{d.profile_id||(e=!1)}),e&&l&&t&&(D.value=!0)},H=t=>{let l={status:t,profile_id:v.user.profile.id,ID:c.value.id};S(v.token).post("/api/request-asset/change-request/data",l).then(e=>{O.value={status:!0,type:"success",text:e.data.message},c.value.status=t,ae("saved",e.data.message)}).catch(e=>{})},_e=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},T=r([]),c=r({});be(()=>{if(ue().then(()=>{re().then(()=>{ce()})}),A.params.id){w.value=!0;let t=b.objectdata;c.value=t,i.value.company_id=t.company_id,i.value.request_type_id=t.request_type_id,i.value.subject=t.subject,i.value.transferred_from=t.transferred_from,i.value.transferred_to=t.transferred_to,i.value.id=t.id,i.value.requestor_id=t.profile_id,T.value=t.request_approvals,V.value=t.items,G()}else i.value.company_id=v.user.profile.company_id});const fe=r("https://assets.grandiose.ae/"),he=ke(()=>{let t=null,l=fe.value+"pv/employee-signatory",e=ee(50),d=ee(50);return c.value&&(t=l+"/transfer/approvals?o=99&key="+e+"&pid=95&pv="+d+"&id="+c.value.id),t});return Q(i.value,async(t,l)=>{q()}),Q(V.value,async(t,l)=>{q()}),(t,l)=>(n(),_(Le,null,{default:s(()=>[a(Ne,{title:b.headertitle,class:"no-print"},null,8,["title"]),a(h,{class:"mb-3"},{default:s(()=>[a(Ae,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:s(()=>[a(j,null,{default:s(()=>[a(we,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:s(()=>[o("div",null,y(b.headertitle),1),R.value?f("",!0):(n(),g("div",Fe,y($.value),1)),w.value?(n(),g("div",{key:1,class:J(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+y(c.value.status)+") ",3)):f("",!0),o("div",null,"DATE: "+y(p(Z)(se.value)),1)]),_:1}),a(F),a(I,null,{default:s(()=>[a(h,null,{default:s(()=>[w.value?(n(),g("div",{key:0,class:J(`${c.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-3"+y(_e(c.value.id)),3)):f("",!0),o("div",Ie,[w.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(n(),g("div",Pe,[c.value.status=="pending"?(n(),_(x,{key:0,onClick:l[0]||(l[0]=e=>H("cancelled")),size:"small",color:"warning"},{default:s(()=>[C("Cancel request")]),_:1})):f("",!0),c.value.status=="cancelled"?(n(),_(x,{key:1,onClick:l[1]||(l[1]=e=>H("pending")),size:"small",color:"info"},{default:s(()=>[C("Change status to Pending")]),_:1})):f("",!0)])):f("",!0)]),c.value.status=="complete"?(n(),g("div",$e)):f("",!0),o("div",Ke,[a(E,{items:M.value,modelValue:i.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>i.value.request_type_id=e),G],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:w.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),o("div",Me,[a(E,{items:Y.value,modelValue:i.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>i.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),o("div",Ye,[a(E,{items:B.value,modelValue:i.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>i.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),o("div",Ge,[a(E,{items:B.value,modelValue:i.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>i.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),o("div",He,[a(k,{modelValue:i.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>i.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(j,{class:"my-2"},{default:s(()=>[a(I,null,{default:s(()=>[a(h,null,{default:s(()=>{var e;return[o("div",Qe,[!p(A).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="administrator"?(n(),_(x,{key:0,size:"small",color:"primary",onClick:pe},{default:s(()=>[C("Add")]),_:1})):f("",!0)])]}),_:1}),(n(!0),g(P,null,W(V.value,(e,d)=>(n(),_(h,{key:d},{default:s(()=>{var m,z;return[o("div",Je,[(m=e.attachment)!=null&&m.id?(n(),_(h,{key:0,class:"px-1"},{default:s(()=>[o("div",We,[a(k,{style:{display:"none"},type:"hidden",class:"hidden",modelValue:e.attachment.id,"onUpdate:modelValue":u=>e.attachment.id=u},null,8,["modelValue","onUpdate:modelValue"]),a(x,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:t.mdiClose,size:"16px",color:"error",onClick:()=>ne(d,e.attachment.id)},null,8,["icon","onClick"]),a(j,{onClick:()=>ie(d),maxHeight:"40",style:{"background-image":"url('/assets/images/fav.png')","background-size":"cover",height:"100px",width:"100px"}},null,8,["onClick"])]),a(xe,{modelValue:L.value,"onUpdate:modelValue":l[8]||(l[8]=u=>L.value=u),width:"95%","max-width":"900"},{default:s(()=>[a(j,{class:"bg-black"},{default:s(()=>[a(Ue,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:N.value,"onUpdate:modelValue":l[7]||(l[7]=u=>N.value=u)},{default:s(()=>[a(Ce,{"reverse-transition":"fade",transition:"fade"},{default:s(()=>[o("div",Xe,[a(Se,{src:oe.value+"/file/"+e.attachment.path},null,8,["src"])])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024)):(n(),_(h,{key:1,class:"mt-0"},{default:s(()=>[o("div",Ze,[a(qe,{color:"grey-lighten-4",class:"text-center"},{default:s(()=>[a(Be,{options:{multiSelect:!1,type:"transfer-asset"},onSelect:u=>de(d,u)},null,8,["onSelect"])]),_:2},1024)])]),_:2},1024))]),o("div",et,[a(k,{modelValue:e.item_description,"onUpdate:modelValue":u=>e.item_description=u,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",tt,[a(k,{modelValue:e.asset_code,"onUpdate:modelValue":u=>e.asset_code=u,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",at,[a(k,{type:"number",modelValue:e.qty,"onUpdate:modelValue":u=>e.qty=u,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",lt,[a(k,{type:"number",modelValue:e.weight,"onUpdate:modelValue":u=>e.weight=u,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",st,[a(k,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":u=>e.item_value=u,variant:"outlined",density:"compact","hide-details":"",label:"VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",ot,[a(k,{modelValue:e.reason_for_request,"onUpdate:modelValue":u=>e.reason_for_request=u,variant:"outlined",density:"compact","hide-details":"",label:"REASON FOR REQUEST*"},null,8,["modelValue","onUpdate:modelValue"]),!w.value||w.value&&p(v).user.profile.id==b.objectdata.profile_id&&((z=b.objectdata)==null?void 0:z.status)=="pending"?(n(),_(X,{key:0,size:"small",onClick:()=>ve(e.id,d),icon:p(Te),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):f("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(j,{class:"my-2"},{default:s(()=>[a(I,null,{default:s(()=>[a(h,null,{default:s(()=>[o("div",dt,[it,p(A).params.id?(n(),g("div",nt,[a(x,{color:"info",size:"small",target:"_blank",href:he.value},{default:s(()=>[C("View Approval Page")]),_:1},8,["href"])])):f("",!0)]),a(F)]),_:1}),a(h,null,{default:s(()=>{var e,d;return[ut,o("div",rt,y((d=(e=c.value)==null?void 0:e.profile)==null?void 0:d.display_name),1),ct,pt]}),_:1}),R.value?(n(),g(P,{key:0},[(n(!0),g(P,null,W(U.value,(e,d)=>(n(),_(h,{key:e.id},{default:s(()=>[o("div",vt,y(e.types?K(e.types):K(e.approval_type)),1),o("div",mt,[a(E,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[m=>e.profile_id=m,q],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(x,{variant:"text",size:"x-small"},{default:s(()=>[e.status?(n(),_(X,{key:0,class:"mx-2 my-3",icon:e.status=="awaiting-approval"?p(je):e.status=="pending"?p(Ee):e.status=="reject"?p(Oe):p(Re),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):f("",!0),a(De,{activator:"parent",location:"top","max-width":"400"},{default:s(()=>[C(y(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),o("div",_t,y(e.date_approved?p(Z)(e.date_approved):""),1)]),_:2},1024))),128)),a(h,null,{default:s(()=>{var e;return[a(F),o("div",ft,[(!p(A).params.id||((e=b.objectdata)==null?void 0:e.status)=="pending"||p(v).user.profile.role=="asset-supervisor"||p(v).user.profile.role=="superadmin"||p(v).user.profile.role=="administrator")&&c.value.status!="complete"?(n(),_(x,{key:0,size:"small",disabled:!D.value,onClick:me,color:"primary"},{default:s(()=>[C(y(p(A).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):f("",!0)])]}),_:1})],64)):(n(),_(h,{key:1},{default:s(()=>[o("div",ht,y($.value),1)]),_:1})),a(h,null,{default:s(()=>[yt]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(ze,{options:O.value},null,8,["options"])]),_:1}))}};export{xt as _};
