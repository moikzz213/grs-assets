import{e as de,d as c,R as ne,J as I,aW as re,o as r,c as p,g as t,w as o,q,z as _,b as f,aq as ie,E as V,V as ce,h as g,t as S,a0 as T,i as K,F as A,y as U,f as k,l as ve,_ as pe,k as P,C as b,L as X,Y as me,H as fe,m as D,A as he,D as ye,O as _e,S as be,T as Y,U as G,W as Ve,X as ge,x as z}from"./app-8ce6e96b.js";import{a as ke,c as we,F as xe,b as Ce}from"./index.esm-68a7cf85.js";import{_ as Se}from"./Studio-0dd015cf.js";const Ae={class:"text-error"},Ue={class:"d-flex pa-3"},De={key:0,class:"v-col-4",style:{"border-left":"1px solid #ccc","border-right":"1px solid #ccc"}},Fe=f("h5",null,"LINK ASSET",-1),je={key:1,class:"v-col-4 text-center",style:{"border-left":"1px solid #ccc","background-color":"#e0e0e0"}},Oe={class:"d-flex mb-5 justify-center"},Ne={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},$e=f("div",{class:"mb-5",style:{position:"absolute",bottom:"0"}}," Note: Dont forget to click the save button at the top ",-1),Ke={__name:"DialogForm",props:{dataObject:{type:Object,default:{}},addNewDialog:{type:Boolean,default:!1},title:{type:String,default:""},freeForm:{type:Array,default:[]}},emits:["savedResponse","fileSave","save"],setup(Q,{emit:F}){const m=Q,w=de(),j=c(""),v=c([]),Z=a=>{let l=null;a.map(n=>{l=v.value.find(u=>u.id==n.id),l||v.value.push(n)})},B=c([]),x=c(""),O=c(!1),N=c(1),ee=a=>{N.value=a,O.value=!0},ae=a=>{v.value=v.value.filter(l=>l.id!==a)},R=ne(()=>v.value.map(a=>a.id)),te=()=>{let a={id:parseInt(J.value),file_ids:R.value,profile_id:w.user.profile.id};z(w.token).post("/api/warranty/sync-images/store-update",a).then(l=>{let n="Attachment has been updated";R.value.length==0&&(n="Attachment has been deleted"),F("fileSave",n)}).catch(l=>{})},le=a=>{let l=s.value.display_assets,n=s.value.assets;l.splice(a,1),s.value.display_assets=[...l],n.splice(a,1),s.value.assets=[...n]},h=c(!1),s=c({}),$=c(m.freeForm);I(()=>m.freeForm,a=>{$.value=[...a]});const L=()=>{h.value=!1,s.value={},F("cancelled",h.value)},W=()=>{h.value=!1,F("save",s.value),s.value={}},E=c({});$.value.map((a,l)=>{a.required&&(E.value[a.name]=ke().required())});let se=we(E.value);const y=c(!1),oe=a=>{v.value=[],a&&z(w.token).post("/api/fetch/warranty/by/id/"+a).then(l=>{var n,u,e,d,i;((e=(u=(n=l==null?void 0:l.data)==null?void 0:n.data)==null?void 0:u.pivot_assets)==null?void 0:e.length)>0&&l.data.data.pivot_assets.map((C,M)=>{s.value.assets.push(C.id),s.value.display_assets.push(C)}),v.value=(i=(d=l.data)==null?void 0:d.data)==null?void 0:i.attachment}).catch(l=>{})},H=c(window.location.origin),J=c(0);I(()=>m.addNewDialog,a=>{y.value=!1,s.value={},h.value=a,j.value="New "+m.title,m.dataObject.type&&(s.value=m.dataObject,j.value="Edit "+m.title),m.title=="Warranty"&&(s.value.assets=[],s.value.display_assets=[],s.value.pivot_assets=[],oe(s.value.id),J.value=s.value.id,y.value=!0)});const ue=a=>{a.length<4||z(w.token).get("/api/search-assets/warranty/"+a).then(l=>{let n=[];l.data&&l.data.length>0&&l.data.map((u,e)=>{n[e]=u,n[e].new_title=u.asset_name+" ("+u.asset_code+")"}),B.value=n}).catch(l=>{})};return I(()=>x.value,a=>{a&&(s.value.assets.includes(a.id)||(s.value.assets.push(a.id),s.value.display_assets.push(a)),x.value=""),console.log("dataObj.value",a)}),(a,l)=>{const n=re("v-card-action");return r(),p("div",null,[t(G,{width:y.value?1200:600,persistent:"",modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=u=>h.value=u),onKeydown:P(L,["esc"]),class:"d-flex",style:{overflow:"auto"}},{default:o(()=>[t(q,{class:"py-3"},{default:o(()=>[t(_,null,{default:o(()=>[f("div",{class:ie(`${y.value?"v-col-4":"v-col-12"}`)},[t(V(xe),{as:"v-form","validation-schema":V(se)},{default:o(({meta:u})=>[t(ce,{class:"text-h6 d-flex"},{default:o(()=>[g(S(j.value),1),t(T),f("small",Ae,S(a.errorMessage),1),t(T)]),_:1}),t(K,null,{default:o(()=>[t(_,null,{default:o(()=>[(r(!0),p(A,null,U($.value,(e,d)=>(r(),p("div",{class:"v-col-12",key:d},[t(V(Ce),{name:e.name,modelValue:s.value[e.name],"onUpdate:modelValue":i=>s.value[e.name]=i},{default:o(({field:i,errors:C})=>[e.type=="text"||e.type=="number"||e.type=="date"||e.type=="email"?(r(),k(ve,pe({key:0,type:e.type,autofocus:d===0,modelValue:s.value[e.name],"onUpdate:modelValue":M=>s.value[e.name]=M,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,"hide-details":""},i,{onKeydown:P(W,["enter"]),"error-messages":C}),null,16,["type","autofocus","modelValue","onUpdate:modelValue","label","onKeydown","error-messages"])):b("",!0)]),_:2},1032,["name","modelValue","onUpdate:modelValue"]),e.type=="select"?(r(),k(X,{key:0,autofocus:d===0,modelValue:s.value[e.name],"onUpdate:modelValue":i=>s.value[e.name]=i,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":""}`,items:e.data,"hide-details":"","item-value":"id","item-title":"title"},null,8,["autofocus","modelValue","onUpdate:modelValue","label","items"])):b("",!0),e.type=="textarea"?(r(),k(me,{key:1,autofocus:d===0,modelValue:s.value[e.name],"onUpdate:modelValue":i=>s.value[e.name]=i,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,items:e.data,"hide-details":""},null,8,["autofocus","modelValue","onUpdate:modelValue","label","items"])):b("",!0)]))),128))]),_:1})]),_:1}),t(fe,{class:"mt-2"}),f("div",Ue,[t(T),t(D,{size:"small",text:"cancel",onClick:L,class:"mx-1"}),t(D,{size:"small",color:"primary",onClick:W,disabled:!u.valid},{default:o(()=>[g("Save")]),_:2},1032,["disabled"])])]),_:1},8,["validation-schema"])],2),y.value?(r(),p("div",De,[t(K,null,{default:o(()=>[Fe,t(_,{class:"mt-1"},{default:o(()=>[t(he,null,{default:o(()=>[t(X,{density:"compact",label:"Search asset name or code",variant:"outlined",items:B.value,"onUpdate:search":ue,"item-value":"id","item-title":"new_title",modelValue:x.value,"onUpdate:modelValue":l[0]||(l[0]=u=>x.value=u),"hide-details":"",clearable:"","return-object":""},null,8,["items","modelValue"])]),_:1})]),_:1}),t(_,{style:{"max-height":"460px",overflow:"auto"}},{default:o(()=>[(r(!0),p(A,null,U(s.value.display_assets,(u,e)=>(r(),p("div",{class:"v-col-12 v-col-md-12 text-caption py-1",key:e},[g(" - "+S(u.asset_name)+" ",1),f("b",null,"("+S(u.asset_code)+")",1),t(ye,{onClick:d=>le(e),class:"ml-2 cursor-pointer",color:"error",icon:V(_e)},null,8,["onClick","icon"])]))),128))]),_:1})]),_:1}),t(n,{class:"mb-5",style:{position:"absolute",bottom:"0"}},{default:o(()=>[g(" Note: Dont forget to click the save button ")]),_:1})])):b("",!0),y.value&&m.dataObject.type?(r(),p("div",je,[t(K,null,{default:o(()=>{var u,e;return[f("div",Oe,[t(Se,{options:{multiSelect:!0,type:"warranty"},onSelect:Z}),t(D,{color:"primary",onClick:te,disabled:((u=v.value)==null?void 0:u.length)==0},{default:o(()=>[g("Save Images")]),_:1},8,["disabled"])]),((e=v.value)==null?void 0:e.length)>0?(r(),k(_,{key:0,class:"px-1"},{default:o(()=>[(r(!0),p(A,null,U(v.value,(d,i)=>(r(),p("div",{key:d.id,class:"v-col-12 v-col-md-4 pa-2",style:{position:"relative"}},[t(D,{style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:V(be),size:"20px",color:"error",onClick:()=>ae(d.id)},null,8,["icon","onClick"]),t(q,{onClick:()=>ee(i)},{default:o(()=>[t(Y,{src:H.value+"/file/"+d.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(G,{modelValue:O.value,"onUpdate:modelValue":l[2]||(l[2]=d=>O.value=d),width:"95%","max-width":"900"},{default:o(()=>[t(q,{class:"bg-black"},{default:o(()=>[t(Ve,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:N.value,"onUpdate:modelValue":l[1]||(l[1]=d=>N.value=d)},{default:o(()=>[(r(!0),p(A,null,U(v.value,(d,i)=>(r(),k(ge,{key:i,"reverse-transition":"fade",transition:"fade"},{default:o(()=>[f("div",Ne,[t(Y,{src:H.value+"/file/"+d.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):b("",!0),t(_,null,{default:o(()=>[$e]),_:1})]}),_:1})])):b("",!0)]),_:1})]),_:1})]),_:1},8,["width","modelValue","onKeydown"])])}}};export{Ke as _};
