import{r as o,i as ot,u as nt,L as it,M as ut,o as dt,j as g,k as n,C as ct,K as _,b as v,l as s,N as w,A as z,q as rt,D,e as l,O as x,P as pt,y as mt,x as vt,Q as ft,m as R,c as q,d as yt,t as d,R as gt,G as f,E as J,S as ht,I as V,T as _t,F as xt,U as Vt,W as Ct}from"./app-e956ae53.js";import{_ as bt}from"./AppPageHeader-359ae530.js";import{d as kt,e as St}from"./encrypt-2cfec236.js";import{_ as wt}from"./AppSnackBar-99cf2772.js";import{u as zt}from"./formatDate-e2fbee14.js";const Dt=l("div",{class:"my-auto"},"Filter",-1),Rt={class:"v-col-md-2 py-1"},$t={class:"v-col-md-2 py-1"},It={class:"v-col-md-2 py-1"},Lt=l("div",{class:"mt-2 mr-2"},"Show",-1),Nt={class:"v-col-12"},Ut=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Bt=l("th",{class:"text-left text-capitalize"}," Urgency ",-1),Ft=l("br",null,null,-1),Mt=l("small",null,"(DD/MM/YY)",-1),Pt=l("th",{class:"text-right text-capitalize"},null,-1),At={class:"d-flex align-center justify-end"},Jt={__name:"List",setup(Ot){const Y=o({status:!1,type:"primary",text:null}),c=ot(),$=nt(),C=it(),u=o({loading:!1,data:[]}),b=o(0),G=o(0),y=o(""),H=o([10,20,50,100]),k=o(10),r=o({}),Q=()=>{m()},S=()=>{i.value==1?m():i.value=1},I=()=>{localStorage.setItem("maintenance-search",St(y.value)),m()},W=()=>{y.value="",localStorage.setItem("maintenance-search",""),m()},i=o(C.params&&C.params.page?C.params.page:1),X=t=>t==1?"Normal":t==2?"Medium":"High",h=o([]),L=o(""),N=o(0),p=t=>{u.value.loading=!0,h.value[0]=t,N.value%2?h.value[1]="DESC":h.value[1]="ASC",N.value++,L.value=JSON.stringify(h.value),m()},U=o([]),Z=async()=>{await _(c.token).get("/api/fetch/companies").then(t=>{U.value=t.data}).catch(t=>{})},B=o([]),tt=async()=>{await _(c.token).get("/api/fetch/locations/non-paginated/data").then(t=>{B.value=t.data}).catch(t=>{})},F=o([]),et=async()=>{await _(c.token).get("/api/fetch-global/incident-status/active").then(t=>{F.value=t.data}).catch(t=>{})},m=async()=>{console.log("objFIlter",r.value),u.value.loading=!0,await _(c.token).get("/api/fetch/maintenance-assets/data?page="+i.value+"&show="+k.value+"&search="+y.value+"&sort="+L.value+"&filter="+JSON.stringify(r.value)).then(t=>{b.value=t.data.last_page?t.data.last_page:t.data.length,i.value=t.data.current_page?t.data.current_page:i.value,G.value=t.data.total?t.data.total:t.data.length,u.value.data=t.data.data?t.data.data:t.data,u.value.loading=!1}).catch(t=>{u.value.loading=!1,console.log(t)})};ut(i,(t,a)=>{i.value&&t!=a&&($.push({name:"PaginatedMaintenance",params:{page:i.value}}).catch(e=>{}),m(i.value))});const at=t=>{$.push({name:"EditMaintenance",params:{id:t},query:{type:"details"}}).catch(a=>{console.log(a)})},lt=t=>{console.log("delete",t)},st=(t,a=5)=>{let e="50000"+t;return e.substring(e.length-a)};return dt(()=>{let t=localStorage.getItem("maintenance-search");t&&(y.value=kt(t)),m().then(()=>{Z(),tt(),et()})}),(t,a)=>(v(),g(ct,null,{default:n(()=>[s(bt,{title:"Maintenance list page"}),s(D,{class:"mb-3"},{default:n(()=>[s(w,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:n(()=>[s(z,{class:"px-5 mb-1"},{default:n(()=>[s(rt,null,{default:n(()=>[s(D,null,{default:n(()=>[Dt,l("div",Rt,[s(x,{items:U.value,modelValue:r.value.company_id,"onUpdate:modelValue":[a[0]||(a[0]=e=>r.value.company_id=e),S],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",$t,[s(x,{items:B.value,modelValue:r.value.location_id,"onUpdate:modelValue":[a[1]||(a[1]=e=>r.value.location_id=e),S],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",It,[s(x,{items:F.value,modelValue:r.value.status_id,"onUpdate:modelValue":[a[2]||(a[2]=e=>r.value.status_id=e),S],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])])]),_:1})]),_:1})]),_:1}),s(z,{class:"px-5"},{default:n(()=>[s(D,null,{default:n(()=>[s(w,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:n(()=>[Lt,s(x,{items:H.value,modelValue:k.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>k.value=e),Q],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),s(pt),s(w,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:n(()=>[s(mt,{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>y.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"","onClick:appendOuter":I,onKeydown:vt(I,["enter"]),"onClick:clear":a[5]||(a[5]=e=>W("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]),_:1}),l("div",Nt,[s(z,{loading:u.value.loading},{default:n(()=>[s(ft,null,{default:n(()=>[l("thead",null,[l("tr",null,[Ut,Bt,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[6]||(a[6]=e=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[7]||(a[7]=e=>p("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[8]||(a[8]=e=>p("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[9]||(a[9]=e=>p("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[10]||(a[10]=e=>p("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[11]||(a[11]=e=>p("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[12]||(a[12]=e=>p("created_at"))},[R(" D.Created"),Ft,Mt]),Pt])]),l("tbody",null,[(v(!0),q(xt,null,yt(u.value.data,e=>{var M,P,A,O,T,E,K;return v(),q("tr",{key:e.id},[l("td",null,"ISR-2"+d(st(e.id)),1),l("td",null,d(X(e.urgency)),1),l("td",null,d((M=e.company)==null?void 0:M.title),1),l("td",null,d((P=e.location)==null?void 0:P.title),1),l("td",null,d(e.asset?e.asset.asset_name:e.title),1),l("td",null,d((A=e.asset)==null?void 0:A.asset_code),1),l("td",null,d((O=e.profile)==null?void 0:O.display_name),1),l("td",null,[s(gt,{class:"text-uppercase",size:"small",color:`${((T=e.status)==null?void 0:T.title.toLowerCase())=="completed"?"success":"error"}`},{default:n(()=>{var j;return[R(d((j=e.status)==null?void 0:j.title),1)]}),_:2},1032,["color"])]),l("td",null,d(f(zt)(e.created_at)),1),l("td",null,[l("div",At,[f(c).user.role=="superadmin"||(E=f(c).capabilities)!=null&&E.includes("edit")?(v(),g(J,{key:0,size:"small",onClick:()=>at(e.id),icon:f(ht),class:"mx-1"},null,8,["onClick","icon"])):V("",!0),f(c).user.role=="superadmin"||(K=f(c).capabilities)!=null&&K.includes("delete")?(v(),g(J,{key:1,size:"small",onClick:()=>lt(e.id),icon:f(_t),class:"mx-1"},null,8,["onClick","icon"])):V("",!0)])])])}),128))])]),_:1}),u.value.data.length==0?(v(),g(Vt,{key:0,class:"pa-3 text-center w-100"},{default:n(()=>[R("No records found")]),_:1})):V("",!0)]),_:1},8,["loading"]),b.value>1?(v(),g(Ct,{key:0,modelValue:i.value,"onUpdate:modelValue":a[13]||(a[13]=e=>i.value=e),class:"my-4",length:b.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:u.value.loading},null,8,["modelValue","length","disabled"])):V("",!0)])]),_:1}),s(wt,{options:Y.value},null,8,["options"])]),_:1}))}};export{Jt as default};
