import{r as o,i as dt,u as ut,N as ct,O as rt,o as pt,j as V,k as n,C as mt,D as f,b as y,l as s,G as z,z as vt,m as C,A as I,q as yt,E as N,e as l,P as h,Q as ft,y as ht,x as gt,H as _t,c as J,d as xt,t as u,R as Vt,K as g,J as H,S as Ct,T as bt,I as R,F as kt,U as St,W as wt}from"./app-f61a3e86.js";import{_ as zt}from"./ApppageHeader-9c4d56a0.js";import{d as It,e as Nt}from"./encrypt-6faf7bf1.js";import{_ as Rt}from"./AppSnackBar-c985287c.js";import{u as Dt}from"./formatDate-e2fbee14.js";const Ut=l("div",{class:"my-auto"},"Filter",-1),$t={class:"v-col-md-2 py-1"},Bt={class:"v-col-md-2 py-1"},Lt={class:"v-col-md-2 py-1"},Tt={class:"v-col-md-2 py-1"},Ft=l("div",{class:"mt-2 mr-2"},"Show",-1),Pt={class:"v-col-12"},At=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Ot=l("th",{class:"text-left text-capitalize"}," Urgency ",-1),Et=l("th",{class:"text-left text-capitalize"}," Type ",-1),Kt=l("br",null,null,-1),jt=l("small",null,"(DD/MM/YY)",-1),Mt=l("th",{class:"text-right text-capitalize"},null,-1),qt={class:"d-flex align-center justify-end"},Xt={__name:"List",setup(Jt){const Y=o({status:!1,type:"primary",text:null}),c=dt(),b=ut(),k=ct(),r=o({loading:!1,data:[]}),S=o(0),G=o(0),v=o(""),Q=o([10,20,50,100]),w=o(10),d=o({}),W=()=>{m()},_=()=>{i.value==1?m():i.value=1},D=()=>{localStorage.setItem("incident-search",Nt(v.value)),m()},X=()=>{v.value="",localStorage.setItem("incident-search",""),m()},i=o(k.params&&k.params.page?k.params.page:1),x=o([]),U=o(""),$=o(0),p=t=>{r.value.loading=!0,x.value[0]=t,$.value%2?x.value[1]="DESC":x.value[1]="ASC",$.value++,U.value=JSON.stringify(x.value),m()},B=o([]),Z=async()=>{await f(c.token).get("/api/fetch/companies").then(t=>{B.value=t.data}).catch(t=>{})},L=o([]),tt=async()=>{await f(c.token).get("/api/fetch/locations/non-paginated/data").then(t=>{L.value=t.data}).catch(t=>{})},T=o([]),et=async()=>{await f(c.token).get("/api/fetch-global/incident-types/active").then(t=>{T.value=t.data}).catch(t=>{})},F=o([]),at=async()=>{await f(c.token).get("/api/fetch-global/incident-status/active").then(t=>{F.value=t.data}).catch(t=>{})},lt=t=>t==1?"Normal":t==2?"Medium":"High",m=async()=>{console.log("objFIlter",d.value),r.value.loading=!0,await f(c.token).get("/api/fetch/incidents-by/users?userid="+c.user.profile.id+"&role="+c.user.profile.role+"&page="+i.value+"&show="+w.value+"&search="+v.value+"&sort="+U.value+"&filter="+JSON.stringify(d.value)).then(t=>{S.value=t.data.last_page?t.data.last_page:t.data.length,i.value=t.data.current_page?t.data.current_page:i.value,G.value=t.data.total?t.data.total:t.data.length,r.value.data=t.data.data?t.data.data:t.data,r.value.loading=!1}).catch(t=>{r.value.loading=!1,console.log(t)})};rt(i,(t,a)=>{i.value&&t!=a&&(b.push({name:"PaginatedIncidents",params:{page:i.value}}).catch(e=>{}),m(i.value))});const st=t=>{b.push({name:"EditIncident",params:{id:t},query:{type:"details"}}).catch(a=>{console.log(a)})},ot=t=>{console.log("delete",t)},nt=()=>{b.push({name:"NewIncident",query:{type:"details"}}).catch(t=>{console.log(t)})},it=(t,a=5)=>{let e="0000"+t;return e.substring(e.length-a)};return pt(()=>{let t=localStorage.getItem("incident-search");t&&(v.value=It(t)),m().then(()=>{Z(),tt(),et().then(()=>{at()})})}),(t,a)=>(y(),V(mt,null,{default:n(()=>[s(zt,{title:"Incident list page"}),s(N,{class:"mb-3"},{default:n(()=>[s(z,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:n(()=>[s(vt,{size:"small",color:"primary",onClick:nt},{default:n(()=>[C("Report New Incident")]),_:1}),s(I,{class:"px-5 mb-1"},{default:n(()=>[s(yt,null,{default:n(()=>[s(N,null,{default:n(()=>[Ut,l("div",$t,[s(h,{items:B.value,modelValue:d.value.company_id,"onUpdate:modelValue":[a[0]||(a[0]=e=>d.value.company_id=e),_],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",Bt,[s(h,{items:L.value,modelValue:d.value.location_id,"onUpdate:modelValue":[a[1]||(a[1]=e=>d.value.location_id=e),_],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",Lt,[s(h,{items:T.value,modelValue:d.value.type_id,"onUpdate:modelValue":[a[2]||(a[2]=e=>d.value.type_id=e),_],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Type"},null,8,["items","modelValue"])]),l("div",Tt,[s(h,{items:F.value,modelValue:d.value.status_id,"onUpdate:modelValue":[a[3]||(a[3]=e=>d.value.status_id=e),_],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])])]),_:1})]),_:1})]),_:1}),s(I,{class:"px-5"},{default:n(()=>[s(N,null,{default:n(()=>[s(z,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:n(()=>[Ft,s(h,{items:Q.value,modelValue:w.value,"onUpdate:modelValue":[a[4]||(a[4]=e=>w.value=e),W],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),s(ft),s(z,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:n(()=>[s(ht,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"","onClick:appendOuter":D,onKeydown:gt(D,["enter"]),"onClick:clear":a[6]||(a[6]=e=>X("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]),_:1}),l("div",Pt,[s(I,{loading:r.value.loading},{default:n(()=>[s(_t,null,{default:n(()=>[l("thead",null,[l("tr",null,[At,Ot,Et,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[7]||(a[7]=e=>p("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[8]||(a[8]=e=>p("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[9]||(a[9]=e=>p("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[10]||(a[10]=e=>p("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[11]||(a[11]=e=>p("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[12]||(a[12]=e=>p("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:a[13]||(a[13]=e=>p("created_at"))},[C(" D.Created"),Kt,jt]),Mt])]),l("tbody",null,[(y(!0),J(kt,null,xt(r.value.data,e=>{var P,A,O,E,K,j,M;return y(),J("tr",{key:e.id},[l("td",null,"ISR-2"+u(it(e.id)),1),l("td",null,u(lt(e.urgency)),1),l("td",null,u((P=e.type)==null?void 0:P.title),1),l("td",null,u((A=e.company)==null?void 0:A.title),1),l("td",null,u((O=e.location)==null?void 0:O.title),1),l("td",null,u(e.asset?e.asset.asset_name:e.title),1),l("td",null,u((E=e.asset)==null?void 0:E.asset_code),1),l("td",null,u((K=e.profile)==null?void 0:K.display_name),1),l("td",null,[s(Vt,{class:"text-uppercase",size:"small",color:`${((j=e.status)==null?void 0:j.title.toLowerCase())=="completed"?"success":"error"}`},{default:n(()=>{var q;return[C(u((q=e.status)==null?void 0:q.title),1)]}),_:2},1032,["color"])]),l("td",null,u(g(Dt)(e.created_at)),1),l("td",null,[l("div",qt,[s(H,{size:"small",onClick:()=>st(e.id),icon:g(Ct),class:"mx-1"},null,8,["onClick","icon"]),g(c).user.role=="superadmin"||(M=g(c).capabilities)!=null&&M.includes("delete")?(y(),V(H,{key:0,size:"small",onClick:()=>ot(e.id),icon:g(bt),class:"mx-1"},null,8,["onClick","icon"])):R("",!0)])])])}),128))])]),_:1}),r.value.data.length==0?(y(),V(St,{key:0,class:"pa-3 text-center w-100"},{default:n(()=>[C("No records found")]),_:1})):R("",!0)]),_:1},8,["loading"]),S.value>1?(y(),V(wt,{key:0,modelValue:i.value,"onUpdate:modelValue":a[14]||(a[14]=e=>i.value=e),class:"my-4",length:S.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:r.value.loading},null,8,["modelValue","length","disabled"])):R("",!0)])]),_:1}),s(Rt,{options:Y.value},null,8,["options"])]),_:1}))}};export{Xt as default};
