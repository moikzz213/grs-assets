import{r as o,i as ue,u as ce,L as re,M as pe,o as me,j as g,k as i,C as ve,K as _,b as v,l as s,N,G as m,z as ye,m as k,I as x,A as R,q as fe,D,e as a,O as V,P as he,y as ge,x as _e,Q as xe,c as Y,d as Ve,t as r,R as Ce,E as G,S as be,T as ke,F as Se,U as we,W as ze}from"./app-edab498a.js";import{_ as Ie}from"./ApppageHeader-bc7f800f.js";import{d as Ne,e as Re}from"./encrypt-b50d1bc4.js";import{_ as De}from"./AppSnackBar-ba9e6af0.js";import{u as Le}from"./formatDate-e2fbee14.js";const Ue=a("div",{class:"my-auto"},"Filter",-1),$e={class:"v-col-md-2 py-1"},Be={class:"v-col-md-2 py-1"},Te={class:"v-col-md-2 py-1"},Fe={class:"v-col-md-2 py-1"},Pe=a("div",{class:"mt-2 mr-2"},"Show",-1),Ae={class:"v-col-12"},Oe=a("th",{class:"text-left text-capitalize"},"ISR No.",-1),Ee=a("th",{class:"text-left text-capitalize"}," Urgency ",-1),Ke=a("th",{class:"text-left text-capitalize"}," Type ",-1),Me=a("br",null,null,-1),je=a("small",null,"(DD/MM/YY)",-1),qe=a("th",{class:"text-right text-capitalize"},null,-1),Je={class:"d-flex align-center justify-end"},Ze={__name:"List",setup(Ye){const H=o({status:!1,type:"primary",text:null}),d=ue(),S=ce(),w=re(),p=o({loading:!1,data:[]}),z=o(0),Q=o(0),h=o(""),W=o([10,20,50,100]),I=o(10),c=o({}),X=()=>{f()},C=()=>{u.value==1?f():u.value=1},L=()=>{localStorage.setItem("incident-search",Re(h.value)),f()},Z=()=>{h.value="",localStorage.setItem("incident-search",""),f()},u=o(w.params&&w.params.page?w.params.page:1),b=o([]),U=o(""),$=o(0),y=e=>{p.value.loading=!0,b.value[0]=e,$.value%2?b.value[1]="DESC":b.value[1]="ASC",$.value++,U.value=JSON.stringify(b.value),f()},B=o([]),ee=async()=>{await _(d.token).get("/api/fetch/companies").then(e=>{B.value=e.data}).catch(e=>{})},T=o([]),te=async()=>{await _(d.token).get("/api/fetch/locations/non-paginated/data").then(e=>{T.value=e.data}).catch(e=>{})},F=o([]),ae=async()=>{await _(d.token).get("/api/fetch-global/incident-types/active").then(e=>{F.value=e.data}).catch(e=>{})},P=o([]),le=async()=>{await _(d.token).get("/api/fetch-global/incident-status/active").then(e=>{P.value=e.data}).catch(e=>{})},se=e=>e==1?"Normal":e==2?"Medium":"High",f=async()=>{console.log("objFIlter",c.value),p.value.loading=!0,await _(d.token).get("/api/fetch/incidents-by/users?userid="+d.user.profile.id+"&role="+d.user.profile.role+"&page="+u.value+"&show="+I.value+"&search="+h.value+"&sort="+U.value+"&filter="+JSON.stringify(c.value)).then(e=>{z.value=e.data.last_page?e.data.last_page:e.data.length,u.value=e.data.current_page?e.data.current_page:u.value,Q.value=e.data.total?e.data.total:e.data.length,p.value.data=e.data.data?e.data.data:e.data,p.value.loading=!1}).catch(e=>{p.value.loading=!1,console.log(e)})};pe(u,(e,t)=>{u.value&&e!=t&&(S.push({name:"PaginatedIncidents",params:{page:u.value}}).catch(l=>{}),f(u.value))});const oe=e=>{S.push({name:"EditIncident",params:{id:e},query:{type:"details"}}).catch(t=>{console.log(t)})},ne=e=>{console.log("delete",e)},ie=()=>{S.push({name:"NewIncident",query:{type:"details"}}).catch(e=>{console.log(e)})},de=(e,t=5)=>{let l="0000"+e;return l.substring(l.length-t)};return me(()=>{let e=localStorage.getItem("incident-search");e&&(h.value=Ne(e)),f().then(()=>{ee(),te(),ae().then(()=>{le()})})}),(e,t)=>(v(),g(ve,null,{default:i(()=>[s(Ie,{title:"Incident list page"}),s(D,{class:"mb-3"},{default:i(()=>[s(N,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:i(()=>{var l;return[m(d).user.role=="superadmin"||(l=m(d).capabilities)!=null&&l.includes("add")?(v(),g(ye,{key:0,size:"small",color:"primary",onClick:ie},{default:i(()=>[k("Report New Incident")]),_:1})):x("",!0),s(R,{class:"px-5 mb-1"},{default:i(()=>[s(fe,null,{default:i(()=>[s(D,null,{default:i(()=>[Ue,a("div",$e,[s(V,{items:B.value,modelValue:c.value.company_id,"onUpdate:modelValue":[t[0]||(t[0]=n=>c.value.company_id=n),C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),a("div",Be,[s(V,{items:T.value,modelValue:c.value.location_id,"onUpdate:modelValue":[t[1]||(t[1]=n=>c.value.location_id=n),C],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),a("div",Te,[s(V,{items:F.value,modelValue:c.value.type_id,"onUpdate:modelValue":[t[2]||(t[2]=n=>c.value.type_id=n),C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Type"},null,8,["items","modelValue"])]),a("div",Fe,[s(V,{items:P.value,modelValue:c.value.status_id,"onUpdate:modelValue":[t[3]||(t[3]=n=>c.value.status_id=n),C],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])])]),_:1})]),_:1})]),_:1}),s(R,{class:"px-5"},{default:i(()=>[s(D,null,{default:i(()=>[s(N,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:i(()=>[Pe,s(V,{items:W.value,modelValue:I.value,"onUpdate:modelValue":[t[4]||(t[4]=n=>I.value=n),X],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),s(he),s(N,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:i(()=>[s(ge,{modelValue:h.value,"onUpdate:modelValue":t[5]||(t[5]=n=>h.value=n),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"","onClick:appendOuter":L,onKeydown:_e(L,["enter"]),"onClick:clear":t[6]||(t[6]=n=>Z("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]}),_:1}),a("div",Ae,[s(R,{loading:p.value.loading},{default:i(()=>[s(xe,null,{default:i(()=>[a("thead",null,[a("tr",null,[Oe,Ee,Ke,a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[7]||(t[7]=l=>y("company_id"))}," Company "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[8]||(t[8]=l=>y("location_id"))}," Location "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[9]||(t[9]=l=>y("asset_id"))}," Asset "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[10]||(t[10]=l=>y("asset_id"))}," AssetCode "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[11]||(t[11]=l=>y("profile_id"))}," ReportedBy "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[12]||(t[12]=l=>y("status_id"))}," Status "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[13]||(t[13]=l=>y("created_at"))},[k(" D.Created"),Me,je]),qe])]),a("tbody",null,[(v(!0),Y(Se,null,Ve(p.value.data,l=>{var n,A,O,E,K,M,j,q;return v(),Y("tr",{key:l.id},[a("td",null,"ISR-2"+r(de(l.id)),1),a("td",null,r(se(l.urgency)),1),a("td",null,r((n=l.type)==null?void 0:n.title),1),a("td",null,r((A=l.company)==null?void 0:A.title),1),a("td",null,r((O=l.location)==null?void 0:O.title),1),a("td",null,r(l.asset?l.asset.asset_name:l.title),1),a("td",null,r((E=l.asset)==null?void 0:E.asset_code),1),a("td",null,r((K=l.profile)==null?void 0:K.display_name),1),a("td",null,[s(Ce,{class:"text-uppercase",size:"small",color:`${((M=l.status)==null?void 0:M.title.toLowerCase())=="completed"?"success":"error"}`},{default:i(()=>{var J;return[k(r((J=l.status)==null?void 0:J.title),1)]}),_:2},1032,["color"])]),a("td",null,r(m(Le)(l.created_at)),1),a("td",null,[a("div",Je,[m(d).user.role=="superadmin"||(j=m(d).capabilities)!=null&&j.includes("edit")?(v(),g(G,{key:0,size:"small",onClick:()=>oe(l.id),icon:m(be),class:"mx-1"},null,8,["onClick","icon"])):x("",!0),m(d).user.role=="superadmin"||(q=m(d).capabilities)!=null&&q.includes("delete")?(v(),g(G,{key:1,size:"small",onClick:()=>ne(l.id),icon:m(ke),class:"mx-1"},null,8,["onClick","icon"])):x("",!0)])])])}),128))])]),_:1}),p.value.data.length==0?(v(),g(we,{key:0,class:"pa-3 text-center w-100"},{default:i(()=>[k("No records found")]),_:1})):x("",!0)]),_:1},8,["loading"]),z.value>1?(v(),g(ze,{key:0,modelValue:u.value,"onUpdate:modelValue":t[14]||(t[14]=l=>u.value=l),class:"my-4",length:z.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:p.value.loading},null,8,["modelValue","length","disabled"])):x("",!0)])]),_:1}),s(De,{options:H.value},null,8,["options"])]),_:1}))}};export{Ze as default};
