import{r as n,a as ie,u as re,G as ce,H as ue,I as de,c as h,w as m,m as me,n as k,o as p,d as o,b as l,k as pe,V as ve,i as fe,h as ge,s as H,J as b,x as ye,e as $,p as G,q as he,t as r,K as xe,C as v,B as N,L as _e,b2 as Se,M as Ve,y as L,F as Ce,N as ke,O as be}from"./app-eb6651a2.js";import{_ as we}from"./ApppageHeader-d09ce1d0.js";import{d as S,e as V}from"./encrypt-675dc7c1.js";import{_ as Ie}from"./AppSnackBar-2bc96fcb.js";import{u as ze}from"./formatDate-b9aad8c5.js";const Be={class:"v-col-12"},$e=l("div",{class:"mr-auto"},"Maintenance",-1),Ne={class:"v-col-12 v-col-md"},Le={class:"v-col-12 v-col-md"},Re={class:"v-col-12 v-col-md"},De={class:"v-col-12 v-col-md"},Me=l("th",{class:"text-left text-capitalize"},"ISR No.",-1),Pe=l("th",{class:"text-left text-capitalize"},"Urgency",-1),Fe=l("th",{class:"text-left text-capitalize"},"Priority",-1),Ke=l("br",null,null,-1),Oe=l("small",null,"(DD/MM/YY)",-1),Ue=l("th",{class:"text-right text-capitalize"},null,-1),Ae={class:"d-flex align-center justify-end"},He={__name:"List",setup(Ee){const W=n({status:!1,type:"primary",text:null}),c=ie(),R=re(),w=ce(),u=n({loading:!1,data:[]}),I=n(0),X=n(0),g=n(""),Q=n([10,20,50,100]),x=n(10),s=n({}),Z=()=>{localStorage.setItem("maintenance-filter-row",V(x.value)),f()},z=a=>{B.value="",i.value==1?(a=="company"?s.value.company_id==""?localStorage.setItem("maintenance-filter-company",""):localStorage.setItem("maintenance-filter-company",V(s.value.company_id)):a=="location"?s.value.location_id==""?localStorage.setItem("maintenance-filter-location",""):localStorage.setItem("maintenance-filter-location",V(s.value.location_id)):a=="status"&&(s.value.location_id==""?localStorage.setItem("maintenance-filter-status",""):localStorage.setItem("maintenance-filter-status",V(s.value.status_id))),f()):i.value=1},D=()=>{localStorage.setItem("maintenance-search",V(g.value)),f()},ee=()=>{g.value="",localStorage.setItem("maintenance-search",""),f()},i=n(w.params&&w.params.page?w.params.page:1),te=a=>a?a==1?"Normal":a==2?"Medium":"High":"",C=n([]),B=n(""),M=n(0),d=a=>{u.value.loading=!0,C.value[0]=a,M.value%2?C.value[1]="DESC":C.value[1]="ASC",M.value++,B.value=JSON.stringify(C.value),f()},P=n([]),ae=async()=>{await k(c.token).get("/api/fetch/companies").then(a=>{P.value=a.data}).catch(a=>{})},F=n([]),le=async()=>{await k(c.token).get("/api/fetch/locations/non-paginated/data").then(a=>{F.value=a.data}).catch(a=>{})},K=n([]),se=async()=>{await k(c.token).get("/api/fetch-global/incident-status/active").then(a=>{K.value=a.data}).catch(a=>{})},f=async()=>{u.value.loading=!0,await k(c.token).get("/api/fetch/maintenance-assets/data?userid="+c.user.profile.id+"&role="+c.user.profile.role+"&page="+i.value+"&show="+x.value+"&search="+g.value+"&sort="+B.value+"&filter="+JSON.stringify(s.value)).then(a=>{I.value=a.data.last_page?a.data.last_page:a.data.length,i.value=a.data.current_page?a.data.current_page:i.value,X.value=a.data.total?a.data.total:a.data.length,u.value.data=a.data.data?a.data.data:a.data,u.value.loading=!1}).catch(a=>{u.value.loading=!1,localStorage.setItem("maintenance-filter-company",null),localStorage.setItem("maintenance-filter-location",null),localStorage.setItem("maintenance-filter-status",null),localStorage.setItem("maintenance-filter-row",10)})};ue(i,(a,t)=>{i.value&&a!=t&&(R.push({name:"PaginatedMaintenance",params:{page:i.value}}).catch(e=>{}),f(i.value))});const O=(a,t)=>{let e={type:"details"};t=="view"&&(e={type:"details",pd:"ox2rKaIYFhBOQW31j6kkiMrJ4KfnYpLmwJhMzBFwPBlVjgGR4g",v:1,vv:"xK2sX1sDL1BBAvmuoPpWoNRgc4wzbdZ9F2OXAKrS3N2g65xNgy"}),R.push({name:"EditMaintenance",params:{id:a},query:e}).catch(y=>{})},ne=a=>{console.log("delete",a)},oe=(a,t=5)=>{let e="0000"+a;return e.substring(e.length-t)};return de(()=>{let a=localStorage.getItem("maintenance-search"),t=localStorage.getItem("maintenance-filter-company"),e=localStorage.getItem("maintenance-filter-location"),y=localStorage.getItem("maintenance-filter-status"),_=localStorage.getItem("maintenance-filter-row");a&&(g.value=S(a)),t&&(s.value.company_id=S(t)),e&&(s.value.location_id=S(e)),y&&(s.value.status_id=S(y)),_&&(x.value=S(_)),f().then(()=>{ae(),le(),se()})}),(a,t)=>(p(),h(me,null,{default:m(()=>[o(we,{title:"Maintenance list page"}),o(H,{class:"mb-3"},{default:m(()=>[l("div",Be,[o(pe,{loading:u.value.loading},{default:m(()=>[o(ve,{class:"d-flex align-center mb-3 pa-3"},{default:m(()=>[$e,o(fe,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),variant:"outlined",density:"compact",clearable:"",label:"Search (ex. ISR-100035 )",type:"text","hide-details":"",style:{"max-width":"300px"},"onClick:appendOuter":D,onKeydown:ge(D,["enter"]),"onClick:clear":t[1]||(t[1]=e=>ee("search"))},null,8,["modelValue","onKeydown"])]),_:1}),o(H,{class:"px-3"},{default:m(()=>[l("div",Ne,[o(b,{items:P.value,modelValue:s.value.company_id,"onUpdate:modelValue":[t[2]||(t[2]=e=>s.value.company_id=e),t[3]||(t[3]=e=>z("company"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company"},null,8,["items","modelValue"])]),l("div",Le,[o(b,{items:F.value,modelValue:s.value.location_id,"onUpdate:modelValue":[t[4]||(t[4]=e=>s.value.location_id=e),t[5]||(t[5]=e=>z("location"))],variant:"outlined",density:"compact","hide-details":"",label:"Location","item-value":"id",clearable:"","item-title":"title"},null,8,["items","modelValue"])]),l("div",Re,[o(b,{items:K.value,modelValue:s.value.status_id,"onUpdate:modelValue":[t[6]||(t[6]=e=>s.value.status_id=e),t[7]||(t[7]=e=>z("status"))],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Status"},null,8,["items","modelValue"])]),l("div",De,[o(b,{items:Q.value,modelValue:x.value,"onUpdate:modelValue":[t[8]||(t[8]=e=>x.value=e),Z],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])])]),_:1}),o(ye,null,{default:m(()=>[l("thead",null,[l("tr",null,[Me,Pe,Fe,l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[9]||(t[9]=e=>d("company_id"))}," Company "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[10]||(t[10]=e=>d("location_id"))}," Location "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[11]||(t[11]=e=>d("asset_id"))}," Asset "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[12]||(t[12]=e=>d("asset_id"))}," AssetCode "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[13]||(t[13]=e=>d("profile_id"))}," ReportedBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[14]||(t[14]=e=>d("handled_by"))}," HandledBy "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[15]||(t[15]=e=>d("status_id"))}," Status "),l("th",{class:"text-left text-capitalize cursor-pointer",onClick:t[16]||(t[16]=e=>d("created_at"))},[$(" D.Created"),Ke,Oe]),Ue])]),l("tbody",null,[(p(!0),G(Ce,null,he(u.value.data,e=>{var y,_,U,A,E,J,T,j,Y;return p(),G("tr",{key:e.id},[l("td",null,"ISR-2"+r(oe(e.id)),1),l("td",null,r((y=e.urgency)==null?void 0:y.title),1),l("td",null,r(te(e.priority)),1),l("td",null,r((_=e.company)==null?void 0:_.title),1),l("td",null,r((U=e.location)==null?void 0:U.title),1),l("td",null,r(e.asset?e.asset.asset_name:e.title),1),l("td",null,r((A=e.asset)==null?void 0:A.asset_code),1),l("td",null,r((E=e.profile)==null?void 0:E.display_name),1),l("td",null,r((J=e.handled_by)==null?void 0:J.display_name),1),l("td",null,[o(xe,{class:"text-uppercase",size:"small",color:`${((T=e.status)==null?void 0:T.title.toLowerCase())=="completed"?"success":"error"}`},{default:m(()=>{var q;return[$(r((q=e.status)==null?void 0:q.title),1)]}),_:2},1032,["color"])]),l("td",null,r(v(ze)(e.created_at)),1),l("td",null,[l("div",Ae,[v(c).user.role=="superadmin"||(j=v(c).capabilities)!=null&&j.includes("edit")?(p(),h(N,{key:0,size:"small",onClick:()=>O(e.id,"edit"),icon:v(_e),class:"mx-1"},null,8,["onClick","icon"])):(p(),h(N,{key:1,size:"small",onClick:()=>O(e.id,"view"),icon:v(Se),class:"mx-1"},null,8,["onClick","icon"])),v(c).user.role=="superadmin"||(Y=v(c).capabilities)!=null&&Y.includes("delete")?(p(),h(N,{key:2,size:"small",onClick:()=>ne(e.id),icon:v(Ve),class:"mx-1"},null,8,["onClick","icon"])):L("",!0)])])])}),128))])]),_:1}),u.value.data.length==0?(p(),h(ke,{key:0,class:"pa-3 text-center w-100"},{default:m(()=>[$("No records found")]),_:1})):L("",!0)]),_:1},8,["loading"]),I.value>1?(p(),h(be,{key:0,modelValue:i.value,"onUpdate:modelValue":t[17]||(t[17]=e=>i.value=e),class:"my-4",length:I.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:u.value.loading},null,8,["modelValue","length","disabled"])):L("",!0)])]),_:1}),o(Ie,{options:W.value},null,8,["options"])]),_:1}))}};export{He as default};
