import{a as L,r,u as J,G as K,I as M,o as w,c as R,w as l,d as a,v as X,b as o,j as f,ad as $,e as y,k as Y,y as h,V as H,t as Q,f as W,s as _,i as q,X as Z,ac as ee,a5 as ae,E as te,p as se,q as le,J as E,av as oe,af as ie,F as de,z as ne,m as re,n as T,A as ue,B as ce}from"./app-8f2f9082.js";import{_ as ve}from"./AppPageHeader-13cae549.js";import{_ as pe}from"./AppSnackBar-7162348a.js";import{c as me,a as fe,F as _e,b as ge}from"./index.esm-7f5a3c98.js";import{_ as ye}from"./_plugin-vue_export-helper-c27b6911.js";const c=b=>(ue("data-v-1707008e"),b=b(),ce(),b),he={class:"mb-3"},be={class:"v-col-12 my-0 pb-0 d-flex my-auto"},Ve={class:"v-col-12 my-0 py-0 d-flex my-auto"},xe={class:"v-col-12 px-6 pt-0 my-auto"},Se={class:"v-col-12 px-6 pt-3"},Ce=c(()=>o("div",{class:"v-col-1 font-weight-bold"},null,-1)),ke=c(()=>o("div",{class:"v-col-3 font-weight-bold"}," TYPES ",-1)),Ae=c(()=>o("div",{class:"v-col-5 font-weight-bold"}," SIGNATORIES ",-1)),we=c(()=>o("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),Te=c(()=>o("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Requestor ",-1)),De=c(()=>o("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Auto ",-1)),Re={class:"v-col-12 v-col-md-1"},je={class:"v-col-12 v-col-md-3"},Fe={class:"v-col-12 v-col-md-6 d-flex my-auto"},Ie={class:"v-col-12 v-col-md-2 d-flex my-auto"},Ue=c(()=>o("div",{class:"v-col-1 v-col-md-1 my-2 font-weight-bold"},null,-1)),$e=c(()=>o("div",{class:"v-col-3 v-col-md-3 my-2 font-weight-bold"}," Receiver ",-1)),qe=c(()=>o("div",{class:"v-col-8 v-col-md-8 my-2 font-weight-bold"}," Requestor ",-1)),Ee={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(b,{emit:Ne}){const m=b,v=L(),g=r([]),V=r({}),C=r(!1),u=r({title:m.objectdata.title}),x=r([{id:"approve",value:"Approval"},{id:"releasing",value:"Asset Releasing"},{id:"receiver",value:"Asset Receiving"},{id:"reviewer",value:"Reviewer"},{id:"transport",value:"Transport Arrangement"},{id:"verify",value:"Verify"}]),j=r([]),F=J(),p=K(),S=r(p.params.type);let N=me({Title:fe().required()});const D=s=>{S.value=s,F.push({path:"/approval-setup/"+s}),s=="transfer-asset"&&(x.value=x.value.filter(e=>e.id!=="releasing"))},k=r(0),z=()=>{let s={id:p.params.id,sort:k.value,profile_id:v.user.profile.id,class:"new"};T(v.token).post("/api/approval-setups/store-signatory/update-data",s).then(e=>{g.value.push({id:e.data.id,sort:k.value,types:null,signatories:[]}),k.value+=1,V.value={status:!0,type:"success",text:"New Signatory has been added"}}).catch(e=>{u.value.loading=!1})},B=async()=>{await T(v.token).get("/api/user/fetch/signatories").then(s=>{j.value=s.data}).catch(s=>{u.value.loading=!1,console.log(s)})},A=r(!1),O=r(!!p.params.id),P=(s,e)=>{let i={id:p.params.id,profile_id:v.user.profile.id,stageID:s,class:"deleted"};g.value.splice(e,1),T(v.token).post("/api/approval-setups/store-signatory/update-data",i).then(t=>{V.value={status:!0,type:"success",text:"Signatory has been deleted."}}).catch(t=>{u.value.loading=!1})},I=s=>{A.value=!0,V.value={status:!0,type:"info",text:"Please wait..."};let e="transfer";S.value=="request-asset"&&(e="request");let i=null;p.params.id&&(i=p.params.id);let t={id:i,type:e,signatories:s,profile_id:v.user.profile.id,class:"update"},d="/api/approval-setups/store-signatory/update-data";s=="title"&&(d="/api/approval-setups/store-update/data",t={id:i,type:e,title:u.value.title,signatories:g.value,profile_id:v.user.profile.id,enable_attachment:C.value?1:0}),T(v.token).post(d,t).then(n=>{V.value={status:!0,type:"success",text:"Data has been saved."},A.value=!1,g.value.sort((U,G)=>U.sort-G.sort),p.params.id||setTimeout(()=>{F.push({name:"EditApproval",params:{id:n.data.id}}).catch(U=>{})},800)}).catch(n=>{u.value.loading=!1})};return M(()=>{if(B(),p.params.id&&(S.value=="transfer-asset"&&(x.value=x.value.filter(s=>s.id!=="releasing")),m.objectdata.stages.length>0)){let s=m.objectdata.stages[m.objectdata.stages.length-1].sort;C.value=!!m.objectdata.enable_attachment,m.objectdata.stages.map((e,i)=>{let t=[];e.signatures.map(d=>{d.profile_id!=0&&t.push(d.profile_id)}),g.value.push({id:e.id,sort:e.sort,types:e.types,signatories:t})}),k.value=s+1}}),(s,e)=>(w(),R(re,null,{default:l(()=>[a(ve,{title:"Global Approval Setup"}),a(_,{class:"mb-3"},{default:l(()=>[a(X,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:l(()=>[o("div",he,[a(f,{class:$(`${S.value=="request-asset"?"tab-active":""}  v-col-12 v-col-md-3 mx-2`),onClick:e[0]||(e[0]=i=>D("request-asset"))},{default:l(()=>[y("Request Asset Approvals")]),_:1},8,["class"]),a(f,{class:$(`${S.value=="transfer-asset"?"tab-active":""}   v-col-12 v-col-md-3 mx-2`),onClick:e[1]||(e[1]=i=>D("transfer-asset"))},{default:l(()=>[y("Transfer Asset Approvals")]),_:1},8,["class"]),a(f,{class:"v-col-12 v-col-md-3 mx-2",color:"primary",onClick:e[2]||(e[2]=i=>D("change-approval"))},{default:l(()=>[y("Change / Assign Approvals")]),_:1})]),a(Y,null,{default:l(()=>[a(h(_e),{as:"v-form","validation-schema":h(N)},{default:l(({meta:i})=>[a(H,{class:"my-3 ml-3 text-uppercase"},{default:l(()=>[y(Q(m.headertitle),1)]),_:1}),a(W,null,{default:l(()=>[a(_,null,{default:l(()=>[o("div",be,[a(h(ge),{name:"Title",modelValue:u.value.title,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.title=t)},{default:l(({field:t,errors:d})=>[a(q,Z({modelValue:u.value.title,"onUpdate:modelValue":e[3]||(e[3]=n=>u.value.title=n)},t,{"error-messages":d,label:"Title here*",variant:"outlined","hide-details":"auto",density:"compact",class:"v-col-10 pt-0 pb-0"}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"]),a(f,{size:"small",class:"mt-1",color:"primary",disabled:!i.valid,loading:A.value,onClick:e[5]||(e[5]=t=>I("title"))},{default:l(()=>[y("Save")]),_:2},1032,["disabled","loading"])]),o("div",Ve,[a(ee,{label:"Enable Additional attachment",modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=t=>C.value=t)},null,8,["modelValue"])])]),_:2},1024),O.value?(w(),R(_,{key:0},{default:l(()=>[o("div",xe,[a(f,{onClick:z,color:"primary",size:"x-small",icon:h(ae)},null,8,["icon"]),y(" Add Signatories ")]),o("div",Se,[a(_,null,{default:l(()=>[Ce,ke,Ae]),_:1}),a(te),a(_,{class:"mt-0"},{default:l(()=>[we,Te,De]),_:1}),(w(!0),se(de,null,le(g.value,(t,d)=>(w(),R(_,{class:"mt-0",key:d},{default:l(()=>[o("div",Re,[a(q,{modelValue:t.sort,"onUpdate:modelValue":n=>t.sort=n,label:"Sort*",variant:"outlined","hide-details":"auto",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),o("div",je,[a(E,{label:"Select Type",modelValue:t.types,"onUpdate:modelValue":n=>t.types=n,"hide-details":"auto",variant:"outlined","item-value":"id","item-title":"value",density:"compact",items:x.value},null,8,["modelValue","onUpdate:modelValue","items"])]),o("div",Fe,[a(E,{label:"Select Signatory",modelValue:t.signatories,"onUpdate:modelValue":n=>t.signatories=n,"hide-details":"auto",variant:"outlined",density:"compact",multiple:"","item-value":"id","item-title":"display_name",items:j.value},null,8,["modelValue","onUpdate:modelValue","items"])]),o("div",Ie,[a(f,{disabled:!t.types||t.signatories.length==0,size:"x-small",onClick:()=>I(t),icon:h(oe),loading:A.value,color:"success",class:"mx-1 ml-3 my-auto",title:"Save Signatory"},null,8,["disabled","onClick","icon","loading"]),a(f,{size:"x-small",onClick:()=>P(t.id,d),icon:h(ie),color:"error",class:"mx-1 ml-3 my-auto",title:"Delete Signatory"},null,8,["onClick","icon"])])]),_:2},1024))),128)),a(_,{class:"mt-0"},{default:l(()=>[Ue,$e,qe]),_:1})])]),_:1})):ne("",!0)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})]),_:1})]),_:1}),a(pe,{options:V.value},null,8,["options"])]),_:1}))}},Le=ye(Ee,[["__scopeId","data-v-1707008e"]]);export{Le as D};
