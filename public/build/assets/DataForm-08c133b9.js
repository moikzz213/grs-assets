import{i as ue,r as v,L as ie,u as ne,o as re,M as G,b as i,j as _,k as o,l as a,N as ce,A as N,V as pe,f as d,t as y,c as w,a0 as Y,I as h,G as n,J as L,q as P,D as f,z as S,m as A,O as x,y as k,d as K,F as B,C as ve,K as T,E as Q,W as me,aL as _e,aM as fe,aN as ye,aO as he,aP as Ve}from"./app-2d02e8bb.js";import{_ as ge}from"./AppPageHeader-352d3f5b.js";import{_ as be}from"./AppSnackBar-9a57ef75.js";import{u as J}from"./formatDate-e2fbee14.js";const ke={key:1,class:"v-col-8 text-right"},Ae={class:"v-col-12 v-col-md-6"},qe={class:"v-col-12 v-col-md-6"},Ce={class:"v-col-12 v-col-md-6"},we={class:"v-col-12 v-col-md-6"},Te={class:"v-col-12"},Ue={class:"v-col-12"},je=d("div",{class:"v-col-12 v-col-md-1"},null,-1),Se={class:"v-col-12 v-col-md-3"},xe={class:"v-col-12 v-col-md-2"},Oe={class:"v-col-12 v-col-md-1"},Ee={class:"v-col-12 v-col-md-1"},De={class:"v-col-12 v-col-md-1"},Re={class:"v-col-12 v-col-md-3 d-flex"},Ne=d("div",{class:"v-col-12 font-weight-bold text-uppercase"}," APPROVAL SETUP ",-1),Le=d("div",{class:"v-col-12 v-col-md-2"},"Requestor",-1),Pe={class:"v-col-12 v-col-md-6"},Be={class:"v-col-12 v-col-md-2"},Fe={class:"v-col-12 v-col-md-7 d-flex"},Ie={class:"my-auto"},ze={class:"v-col-12"},Me=d("div",{class:"v-col-12 text-error"}," Administrator needs to setup signatories first. ",-1),$e=d("div",{class:"v-col-12 v-col-md-12 text-info"},[A(" Note: Once submitted and approval is on-going, you will no longer allowed to update the request."),d("br"),A(" Only Asset Supervisor - Projects can update the data specially the asset code. ")],-1),Je={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["deleted"],setup(W,{emit:H}){const V=W,r=ue(),E=v(!1),q=ie(),X=ne(),s=v({}),g=v(!1),b=v([{qty:1}]),Z=v(new Date),F=t=>{if(t=="approve")return"Approval By";if(t=="reviewer")return"Review By";if(t=="receiver")return"Receiver";if(t=="verify")return"Verify By"},I=v([]),ee=async()=>{await T(r.token).get("/api/fetch/approval-setups/non-paginated/data/request").then(t=>{I.value=t.data}).catch(t=>{})},O=v({}),z=v([]),te=async()=>{await T(r.token).get("/api/fetch/companies").then(t=>{z.value=t.data}).catch(t=>{})},D=v([]),ae=async()=>{await T(r.token).get("/api/fetch/locations/non-paginated/data").then(t=>{D.value=t.data}).catch(t=>{})},le=()=>{b.value.push({qty:1}),U()},se=(t,l)=>{b.value.splice(l,1),U()},oe=()=>{O.value={status:!0,type:"info",text:"Please wait..."};let t=b.value.map((e,u)=>(delete e.assets,delete e.updated_at,delete e.created_at,delete e.id,e)),l={data:s.value,assets:t,approval:C.value,profile_id:r.user.profile.id,type:"request"};T(r.token).post("/api/request-asset/store-update/data",l).then(e=>{let u="",p="";e.data.message?(u=e.data.message,p="success"):e.data.error&&(u=e.data.error,p="error"),O.value={status:!0,type:p,text:u},q.params.id||setTimeout(()=>{X.push({name:"EditRequestAsset",params:{id:e.data.id}}).catch(m=>{})},800)}).catch(e=>{console.log(e)})},C=v([]),R=v(!0),M=async()=>{await T(r.token).get("/api/fetch/request-asset/approval-setup-fetch/"+s.value.request_type_id).then(t=>{var l,e;C.value=(l=t.data)==null?void 0:l.stages,q.params.id&&C.value.length>0&&C.value.map((u,p)=>(u.profile_id=j.value[p].profile_id,u.status=j.value[p].status,u.date_approved=j.value[p].date_approved,u.reason_rejected=j.value[p].reason_rejected,u)),((e=t.data)==null?void 0:e.stages.length)>0?R.value=!0:R.value=!1}).catch(t=>{})},U=()=>{let t=!1;E.value=!1,s.value.company_id&&s.value.request_type_id&&s.value.subject&&s.value.transferred_from&&s.value.transferred_to&&(t=!0);let l=!0;b.value.map(u=>{u.item_description||(l=!1)});let e=!0;C.value.map(u=>{u.profile_id||(e=!1)}),e&&l&&t&&(E.value=!0)},$=t=>{let l={status:t,profile_id:r.user.profile.id,ID:c.value.id};T(r.token).post("/api/request-asset/change-request/data",l).then(e=>{O.value={status:!0,type:"success",text:e.data.message},H("saved",e.data.message)}).catch(e=>{})},de=(t,l=6)=>{let e="00000"+t;return e.substring(e.length-l)},j=v([]),c=v({});return re(()=>{if(ee().then(()=>{te().then(()=>{ae()})}),q.params.id){g.value=!0;let t=V.objectdata;c.value=t,s.value.company_id=t.company_id,s.value.request_type_id=t.request_type_id,s.value.subject=t.subject,s.value.transferred_from=t.transferred_from,s.value.transferred_to=t.transferred_to,s.value.id=t.id,s.value.requestor_id=t.profile_id,j.value=t.request_approvals,b.value=t.items,M()}else s.value.company_id=r.user.profile.company_id}),G(s.value,async(t,l)=>{U()}),G(b.value,async(t,l)=>{U()}),(t,l)=>(i(),_(ve,null,{default:o(()=>[a(ge,{title:V.headertitle},null,8,["title"]),a(f,{class:"mb-3"},{default:o(()=>[a(ce,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:o(()=>[a(N,null,{default:o(()=>[a(pe,{class:"my-0 ml-3 text-uppercase text-h6 d-flex justify-space-between font-weight-bold"},{default:o(()=>[d("div",null,y(V.headertitle),1),g.value?(i(),w("div",{key:0,class:Y(c.value.status=="cancelled"?"text-error":c.value.status=="complete"?"text-success":"")}," STATUS ("+y(c.value.status)+") ",3)):h("",!0),d("div",null,"DATE: "+y(n(J)(Z.value)),1)]),_:1}),a(L),a(P,null,{default:o(()=>[a(f,null,{default:o(()=>[g.value?(i(),w("div",{key:0,class:Y(`${c.value.status=="complete"?"v-col-12":"v-col-4"}`)}," REQUEST NO: SN-5"+y(de(c.value.id)),3)):h("",!0),g.value&&(c.value.status=="pending"||c.value.status=="cancelled")?(i(),w("div",ke,[c.value.status=="pending"?(i(),_(S,{key:0,onClick:l[0]||(l[0]=e=>$("cancelled")),size:"small",color:"warning"},{default:o(()=>[A("Cancel request")]),_:1})):h("",!0),c.value.status=="cancelled"?(i(),_(S,{key:1,onClick:l[1]||(l[1]=e=>$("pending")),size:"small",color:"info"},{default:o(()=>[A("Change status to Pending")]),_:1})):h("",!0)])):h("",!0),d("div",Ae,[a(x,{items:I.value,modelValue:s.value.request_type_id,"onUpdate:modelValue":[l[2]||(l[2]=e=>s.value.request_type_id=e),M],variant:"outlined",density:"compact","hide-details":"","item-value":"id",disabled:g.value,"item-title":"title",label:"TYPE OF REQUEST*"},null,8,["items","modelValue","disabled"])]),d("div",qe,[a(x,{items:z.value,modelValue:s.value.company_id,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.company_id=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"COMPANY*"},null,8,["items","modelValue"])]),d("div",Ce,[a(x,{items:D.value,modelValue:s.value.transferred_from,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.transferred_from=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION FROM*"},null,8,["items","modelValue"])]),d("div",we,[a(x,{items:D.value,modelValue:s.value.transferred_to,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.transferred_to=e),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",label:"LOCATION TO*"},null,8,["items","modelValue"])]),d("div",Te,[a(k,{modelValue:s.value.subject,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.subject=e),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"SUBJECT*"},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),a(N,{class:"my-2"},{default:o(()=>[a(P,null,{default:o(()=>[a(f,null,{default:o(()=>{var e;return[d("div",Ue,[c.value.status!="complete"&&(!n(q).params.id||((e=V.objectdata)==null?void 0:e.status)=="pending"||n(r).user.profile.role=="superadmin"||n(r).user.profile.role=="administrator")?(i(),_(S,{key:0,size:"small",color:"primary",onClick:le},{default:o(()=>[A("Add")]),_:1})):h("",!0)])]}),_:1}),(i(!0),w(B,null,K(b.value,(e,u)=>(i(),_(f,{key:u},{default:o(()=>{var p;return[je,d("div",Se,[a(k,{modelValue:e.item_description,"onUpdate:modelValue":m=>e.item_description=m,variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"ITEM DESC*"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",xe,[a(k,{modelValue:e.asset_code,"onUpdate:modelValue":m=>e.asset_code=m,variant:"outlined",density:"compact","hide-details":"",label:"ASSET CODE"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Oe,[a(k,{type:"number",modelValue:e.qty,"onUpdate:modelValue":m=>e.qty=m,variant:"outlined",density:"compact","hide-details":"",label:"QTY"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Ee,[a(k,{type:"number",modelValue:e.weight,"onUpdate:modelValue":m=>e.weight=m,variant:"outlined",density:"compact","hide-details":"",label:"WEIGHT(KG)"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",De,[a(k,{type:"number",modelValue:e.item_value,"onUpdate:modelValue":m=>e.item_value=m,variant:"outlined",density:"compact","hide-details":"",label:"ITEM VALUE"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Re,[a(k,{modelValue:e.reason_for_request,"onUpdate:modelValue":m=>e.reason_for_request=m,variant:"outlined",density:"compact","hide-details":"",label:"REASON"},null,8,["modelValue","onUpdate:modelValue"]),!g.value||g.value&&n(r).user.profile.id==V.objectdata.profile_id&&((p=V.objectdata)==null?void 0:p.status)=="pending"?(i(),_(Q,{key:0,size:"small",onClick:()=>se(e.id,u),icon:n(me),class:"my-auto ml-2",color:"error"},null,8,["onClick","icon"])):h("",!0)])]}),_:2},1024))),128))]),_:1})]),_:1}),a(N,{class:"my-2"},{default:o(()=>[a(P,null,{default:o(()=>[a(f,null,{default:o(()=>[Ne,a(L)]),_:1}),a(f,null,{default:o(()=>{var e,u;return[Le,d("div",Pe,y((u=(e=c.value)==null?void 0:e.profile)==null?void 0:u.display_name),1)]}),_:1}),R.value?(i(),w(B,{key:0},[(i(!0),w(B,null,K(C.value,(e,u)=>(i(),_(f,{key:e.id},{default:o(()=>[d("div",Be,y(e.types?F(e.types):F(e.approval_type)),1),d("div",Fe,[a(x,{items:e.signatures,modelValue:e.profile_id,"onUpdate:modelValue":[p=>e.profile_id=p,U],variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",label:"SELECT SIGNATORY*",disabled:e.status=="done"},null,8,["items","modelValue","onUpdate:modelValue","disabled"]),a(S,{variant:"text",size:"x-small"},{default:o(()=>[e.status?(i(),_(Q,{key:0,class:"mx-2 my-auto",icon:e.status=="awaiting-approval"?n(_e):e.status=="pending"?n(fe):e.status=="reject"?n(ye):n(he),color:e.status=="awaiting-approval"?"info":e.status=="pending"?"":e.status=="reject"?"error":"success"},null,8,["icon","color"])):h("",!0),a(Ve,{activator:"parent",location:"top","max-width":"400"},{default:o(()=>[A(y(e.status=="awaiting-approval"?"Awaiting Approval":e.status=="pending"?"Pending":e.status=="reject"?e.reason_rejected:"Already Signed"),1)]),_:2},1024)]),_:2},1024)]),d("div",Ie,y(e.date_approved?n(J)(e.date_approved):""),1)]),_:2},1024))),128)),a(f,null,{default:o(()=>{var e;return[a(L),d("div",ze,[(!n(q).params.id||((e=V.objectdata)==null?void 0:e.status)=="pending"||n(r).user.profile.role=="asset-supervisor"||n(r).user.profile.role=="superadmin"||n(r).user.profile.role=="administrator")&&c.value.status!="complete"?(i(),_(S,{key:0,size:"small",disabled:!E.value,onClick:oe,color:"primary"},{default:o(()=>[A(y(n(q).params.id?"Update Request":"Submit For Approval"),1)]),_:1},8,["disabled"])):h("",!0)])]}),_:1})],64)):(i(),_(f,{key:1},{default:o(()=>[Me]),_:1})),a(f,null,{default:o(()=>[$e]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(be,{options:O.value},null,8,["options"])]),_:1}))}};export{Je as _};
