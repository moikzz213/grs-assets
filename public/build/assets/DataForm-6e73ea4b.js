import{a as oe,r as p,P as je,I as ie,H as Z,o as r,p as N,b as s,c as y,w as a,d as t,s as V,y as w,F as ee,q as te,j as x,C as u,Q as we,k as U,R as me,S as fe,T as Se,U as Ce,N as De,e as m,n as A,f as L,t as h,J as le,W as ye,E as se,G as Ie,u as $e,V as xe,X,Y as H,i as pe,Z as Ae,B as Re,D as Te,v as S,_ as Ue,$ as Ne,m as Ee,z as Fe,A as Le}from"./app-d1935eb8.js";import{_ as Oe}from"./ApppageHeader-f49c0e20.js";import{_ as Be}from"./AppSnackBar-2c62fc3c.js";import{c as Ye,a as G,F as Me,b as J}from"./index.esm-3264aad7.js";import{S as Pe}from"./StreamBarcodeReader-738e2b66.js";import{_ as We}from"./_plugin-vue_export-helper-c27b6911.js";import{u as K,a as qe}from"./formatDate-b9aad8c5.js";import{u as ze}from"./status-1e468e42.js";import{_ as He}from"./Studio-94553438.js";import{d as _e}from"./dayjs.min-c428a01a.js";const Ge={class:"v-col-12 pt-5"},Je={class:"v-col-12 pb-2"},Ke={style:{height:"680px",width:"100%"},class:"d-flex align-center justify-center"},Qe={class:"v-col-12 pt-0 pb-2"},Xe={class:"v-col-12"},Ze={__name:"Attachment",props:{objectdata:{type:Object,default:{}},incidentId:{type:Number,default:0},attachment:{type:Array,default:[]}},emits:["save"],setup(C,{emit:P}){const o=C,v=oe(),e=p(window.location.origin),R=i=>{let g=null;i.map(_=>{g=b.value.find(F=>F.id==_.id),g||b.value.push(_)})},D=p(!1),E=p(1),B=i=>{E.value=i,D.value=!0},Y=i=>{b.value=b.value.filter(g=>g.id!==i)},b=p([]),M=je(()=>b.value.map(i=>i.id)),n=()=>{let i={id:parseInt(o.incidentId),file_ids:M.value,profile_id:o.objectdata.profile_id};A(v.token).post("/api/incident/sync-images/store-update",i).then(g=>{let _="Attachment has been updated";M.value.length==0&&(_="Attachment has been deleted"),P("save",_)}).catch(g=>{})},f=p(v.user.profile.id);return ie(()=>{b.value=o.attachment}),Z(()=>o.objectdata.attachment,(i,g)=>{b.value=i},{deep:!0}),(i,g)=>(r(),N("div",null,[s("div",Ge,[o.objectdata.profile_id==f.value?(r(),y(V,{key:0},{default:a(()=>[s("div",Je,[t(He,{options:{multiSelect:!0,type:"incident"},onSelect:R})])]),_:1})):w("",!0),b.value.length>0?(r(),y(V,{key:1,class:"px-1"},{default:a(()=>[(r(!0),N(ee,null,te(b.value,(_,F)=>(r(),N("div",{key:_.id,class:"v-col-12 v-col-md-2 pa-2",style:{position:"relative"}},[o.objectdata.profile_id==f.value?(r(),y(x,{key:0,style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:u(we),size:"26px",color:"error",onClick:()=>Y(_.id)},null,8,["icon","onClick"])):w("",!0),t(U,{onClick:()=>B(F)},{default:a(()=>[t(me,{src:e.value+"/file/"+_.path,cover:"","aspect-ratio":"1"},null,8,["src"])]),_:2},1032,["onClick"])]))),128)),t(fe,{modelValue:D.value,"onUpdate:modelValue":g[1]||(g[1]=_=>D.value=_),width:"95%","max-width":"900"},{default:a(()=>[t(U,{class:"bg-black"},{default:a(()=>[t(Se,{"hide-delimiter-background":"","show-arrows":"hover",height:"680px",modelValue:E.value,"onUpdate:modelValue":g[0]||(g[0]=_=>E.value=_)},{default:a(()=>[(r(!0),N(ee,null,te(b.value,(_,F)=>(r(),y(Ce,{key:F,"reverse-transition":"fade",transition:"fade"},{default:a(()=>[s("div",Ke,[t(me,{src:e.value+"/file/"+_.path},null,8,["src"])])]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):(r(),y(V,{key:2},{default:a(()=>[s("div",Qe,[t(De,{color:"grey-lighten-4",class:"pa-6 text-center"},{default:a(()=>[m(" Attachment is empty at the moment. ")]),_:1})])]),_:1})),o.objectdata.profile_id==f.value?(r(),y(V,{key:3},{default:a(()=>[s("div",Xe,[t(x,{color:"primary",onClick:n},{default:a(()=>[m("Save")]),_:1})])]),_:1})):w("",!0)])]))}},et={class:"v-col-12 v-col-md-12 d-flex justify-space-between"},tt={class:"font-weight-bold"},at={class:"reported-by"},lt={class:"reported-by"},st={class:"v-col-12"},ot={class:"v-col-12 v-col-md-4 pb-0"},it={class:"v-col-12 v-col-md-8"},dt={class:"v-col-12"},nt={class:"v-col-12"},ut={class:"v-col-12",style:{"max-height":"400px",overflow:"auto"}},rt={class:"v-col-12 d-flex justify-space-between"},ct={__name:"Facility",props:{objectdata:{type:Object,default:{}}},emits:["saved"],setup(C,{emit:P}){const o=C,v=oe(),e=p({}),R=p([{id:1,title:"1. Normal"},{id:2,title:"2. Medium"},{id:3,title:"3. High"}]),D=p([]),E=async()=>{await A(v.token).get("/api/fetch/profile-facility/team").then(n=>{D.value=n.data}).catch(n=>{})},B=()=>{e.value.profile_id=v.user.profile.id,A(v.token).post("/api/incident/update-facility-team",e.value).then(n=>{e.value.remarks_data="",P("saved",n.data.message)}).catch(n=>{})},Y=p([]),b=async()=>{await A(v.token).get("/api/fetch-global/incident-status/active").then(n=>{Y.value=n.data}).catch(n=>{})},M=(n,f=6)=>{let i="00000"+n;return i.substring(i.length-f)};return ie(()=>{E(),b(),e.value=o.objectdata,e.value.prev_handled_by=o.objectdata.handled_by,e.value.priority=o.objectdata.priority?parseInt(o.objectdata.priority):null}),Z(()=>o.objectdata.remarks,(n,f)=>{e.value.remarks=n},{deep:!0}),(n,f)=>(r(),N("div",null,[t(U,null,{default:a(()=>[t(L,null,{default:a(()=>[t(V,null,{default:a(()=>{var i;return[s("div",et,[s("div",tt," SN: ISR-"+h(M(e.value.id)),1),s("div",at," REPORTED BY: "+h((i=e.value.profile)==null?void 0:i.display_name),1),s("div",lt," DATE REPORTED: "+h(u(K)(e.value.created_at)),1)])]}),_:1}),t(V,null,{default:a(()=>[s("div",st,[t(V,null,{default:a(()=>[s("div",ot,[t(le,{items:R.value,modelValue:e.value.priority,"onUpdate:modelValue":f[0]||(f[0]=i=>e.value.priority=i),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"my-2",label:"Priority*"},null,8,["items","modelValue"]),t(le,{items:D.value,modelValue:e.value.handled_by,"onUpdate:modelValue":f[1]||(f[1]=i=>e.value.handled_by=i),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"display_name",class:"my-2",label:"Handled By*"},null,8,["items","modelValue"]),t(le,{items:Y.value,modelValue:e.value.status_id,"onUpdate:modelValue":f[2]||(f[2]=i=>e.value.status_id=i),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",class:"mt-2",label:"Status*"},null,8,["items","modelValue"])]),s("div",it,[t(ye,{class:"my-2",variant:"outlined",density:"compact",label:"Add some remarks",modelValue:e.value.remarks_data,"onUpdate:modelValue":f[3]||(f[3]=i=>e.value.remarks_data=i)},null,8,["modelValue"])])]),_:1})]),t(se,{class:"mt-3"}),s("div",dt,[t(x,{class:"",size:"small",disabled:!e.value.priority||!e.value.handled_by||!e.value.status_id,onClick:B,color:"primary"},{default:a(()=>[m("Submit")]),_:1},8,["disabled"])])]),_:1}),t(V,null,{default:a(()=>[s("div",nt,[m(" Remarks "),t(se)]),s("div",ut,[(r(!0),N(ee,null,te(e.value.remarks,i=>(r(),y(V,{key:n.id},{default:a(()=>{var g;return[s("div",rt,[s("div",null,[s("pre",null,h(i.remarks),1)]),s("div",null,[m(h((g=i.profile)==null?void 0:g.display_name)+" - ",1),s("small",null,h(u(qe)(i.created_at)),1)])]),t(se)]}),_:2},1024))),128))])]),_:1})]),_:1})]),_:1})]))}};const O=C=>(Fe("data-v-86a19f70"),C=C(),Le(),C),vt={class:"v-col py-0"},mt={class:"v-col py-0"},pt={class:"v-col-12 v-col-md-4"},_t=O(()=>s("div",{class:"font-weight-bold"},"SN:",-1)),ft={class:"v-col-12 v-col-md-4"},yt=O(()=>s("div",{class:"font-weight-bold"},"Reported by:",-1)),ht={class:"v-col-12 v-col-md-4"},bt=O(()=>s("div",{class:"font-weight-bold"},"Status",-1)),gt={class:"v-col-12 v-col-md-4"},Vt=O(()=>s("div",{class:"font-weight-bold"},"Date Reported",-1)),kt={class:"v-col-12 v-col-md-4"},jt=O(()=>s("div",{class:"font-weight-bold"},"Date Closed",-1)),wt={class:"v-col-12 v-col-md-4"},St={class:"v-col-12 v-col-md-4"},Ct={class:"v-col-12 v-col-md-4 d-flex"},Dt={class:"v-col-12"},It={class:"v-col-12 v-col-md-6"},$t={class:"v-col-12 v-col-md-6"},xt={class:"v-col-12"},At={class:"v-col-12"},Rt={key:1},Tt=O(()=>s("h4",{class:"headline mb-0 text-center"},"WARRANTY INFORMATION",-1)),Ut={class:"v-col-12 v-col-md-12"},Nt=O(()=>s("h5",{class:"headline mb-0 text-center"},[m(" NO WARRANTY FOUND. "),s("br"),m("HAVING THE CORRECT ASSET CODE IN DETAILS SECTION WILL SHOW IT'S CORRESPONDING WARRANTY ")],-1)),Et={__name:"DataForm",props:{objectdata:{type:Object,default:{}},headertitle:{type:String,default:null}},emits:["saved"],setup(C,{emit:P}){const o=C,v=oe(),e=p({}),R=p({}),D=d=>{R.value={status:!0,type:"success",text:d},P("saved")},E=p(v.user.profile.id),B=p([]),Y=async()=>{await A(v.token).get("/api/fetch-global/incident-types/active").then(d=>{B.value=d.data}).catch(d=>{})},b=Ie(),M=$e(),n=p(b.query.type),f=ze(),i=p([]);i.value=Object.assign([],f.urgencies_active_list),f.list.length==0&&f.getStatuses(v.token).then(()=>{i.value=Object.assign([],f.urgencies_active_list)});let g=Ye({Type:G().required(),Urgency:G().required(),Title:G().required(),Company:G().required(),Location:G().required()});const _=p(!1),F=()=>{ae.value=!1,_.value=!0},de=async d=>{e.value.asset_code=d,await A(v.token).get("/api/fetch/asset-info/by/asset-code/"+d).then(l=>{e.value.title=l.data.asset_name,e.value.company_id=l.data.company_id,e.value.location_id=l.data.location_id,e.value.asset_id=l.data.id,_.value=!1}).catch(l=>{})},ae=p(!1),he=()=>{ae.value=!0},ne=new URL(window.location),Q=d=>{n.value=d,ue("type",d)},W=p(!1),q=p(v.user.profile.role),be=async()=>{W.value=!0,R.value={status:!0,type:"info",text:"Please wait..."},e.value.profile_id=v.user.profile.id,await A(v.token).post("/api/store-update/incident",e.value).then(d=>{R.value={status:!0,type:"success",text:d.data.message},b.params.id?W.value=!1:setTimeout(()=>{M.push({name:"EditIncident",params:{id:d.data.id},query:{type:"details"}}).catch(l=>{}),W.value=!1},800)}).catch(d=>{console.log("save incident error: ",d),W.value=!1})},j=p(!1),ue=(d,l)=>{ne.searchParams.set(d,l),window.history.pushState({},"",ne)},re=p([]),ge=async()=>{await A(v.token).get("/api/fetch/companies").then(d=>{re.value=d.data}).catch(d=>{})},ce=p([]),Ve=async()=>{await A(v.token).get("/api/fetch/locations/non-paginated/data").then(d=>{ce.value=d.data}).catch(d=>{})},ke=(d,l=5)=>{let k="0000"+d;return k.substring(k.length-l)};return ie(()=>{b.params.id&&(j.value=!0),n.value||(n.value="details",ue("type","details")),Y().then(()=>{ge().then(()=>{Ve()})}),j.value&&(e.value=o.objectdata,e.value.asset_code=o.objectdata.asset?o.objectdata.asset.asset_code:o.objectdata.asset_code,e.value.title=o.objectdata.asset?o.objectdata.asset.asset_name:o.objectdata.title,e.value.company_id=o.objectdata.company_id,e.value.location_id=o.objectdata.location_id,e.value.asset_id=o.objectdata.asset_id,e.value.profile_id=o.objectdata.profile_id,e.value.type_id=parseInt(o.objectdata.type_id),e.value.urgency=parseInt(o.objectdata.urgency),e.value.description=o.objectdata.description)}),Z(()=>o.objectdata.remarks,(d,l)=>{e.value=o.objectdata},{deep:!0}),Z(()=>o.objectdata.attachment,(d,l)=>{e.value=o.objectdata,e.value.attachment=d},{deep:!0}),(d,l)=>(r(),y(Ee,null,{default:a(()=>[t(Oe,{title:"Incident detail page"}),t(V,{class:"mt-5"},{default:a(()=>[s("div",vt,[t(x,{onClick:l[0]||(l[0]=k=>Q("details")),class:"mr-3 mb-3",color:`${n.value=="details"?"primary":"white"}`},{default:a(()=>[m("Details")]),_:1},8,["color"]),j.value?(r(),y(x,{key:0,class:"mr-3 mb-3",color:`${n.value=="attachment"?"primary":"white"}`,onClick:l[1]||(l[1]=k=>Q("attachment"))},{default:a(()=>[m("Attachments")]),_:1},8,["color"])):w("",!0),j.value&&(u(v).user.profile.role=="facility"||u(v).user.profile.role=="admin"||u(v).user.profile.role=="superadmin"||u(v).user.profile.role=="technical-operation")?(r(),y(x,{key:1,class:"mr-3 mb-3",color:`${n.value=="warranty"?"primary":"white"}`,onClick:l[2]||(l[2]=k=>Q("warranty"))},{default:a(()=>[m("Warranty")]),_:1},8,["color"])):w("",!0),j.value&&(u(v).user.profile.role=="facility"||u(v).user.profile.role=="admin"||u(v).user.profile.role=="superadmin"||u(v).user.profile.role=="technical-operation")?(r(),y(x,{key:2,class:"mr-3 mb-3",color:`${n.value=="facility"?"primary":"white"}`,onClick:l[3]||(l[3]=k=>Q("facility"))},{default:a(()=>[m("Facility Team")]),_:1},8,["color"])):w("",!0)])]),_:1}),t(V,{class:"mb-10"},{default:a(()=>{var k,ve;return[s("div",mt,[n.value=="details"?(r(),y(U,{key:0},{default:a(()=>[t(u(Me),{as:"v-form","validation-schema":u(g)},{default:a(({meta:T})=>[t(xe,{class:"text-capitalize my-1"},{default:a(()=>[m(h(o.headertitle),1)]),_:1}),t(L,null,{default:a(()=>[j.value?(r(),y(V,{key:0,class:"bg-background-darken-1 ma-0 rounded"},{default:a(()=>{var z,c;return[s("div",pt,[_t,s("div",null,"ISR-2"+h(ke(e.value.id)),1)]),s("div",ft,[yt,s("div",null,h((z=e.value.profile)==null?void 0:z.display_name),1)]),s("div",ht,[bt,s("div",null,h((c=e.value.status)==null?void 0:c.title),1)]),s("div",gt,[Vt,s("div",null,h(e.value.created_at?u(_e)(e.value.created_at).format("MMM. DD, YYYY"):"-"),1)]),s("div",kt,[jt,s("div",null,h(e.value.date_closed?u(_e)(e.value.date_closed).format("MMM. DD, YYYY"):"-"),1)])]}),_:1})):w("",!0),t(V,null,{default:a(()=>{var z;return[s("div",wt,[t(u(J),{name:"Type",modelValue:e.value.type_id,"onUpdate:modelValue":l[5]||(l[5]=c=>e.value.type_id=c)},{default:a(({field:c,errors:I})=>[t(X,H({items:B.value,modelValue:e.value.type_id,"onUpdate:modelValue":l[4]||(l[4]=$=>e.value.type_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Incident Type*"},c,{"error-messages":I}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",St,[t(u(J),{name:"Urgency",modelValue:e.value.urgency_id,"onUpdate:modelValue":l[7]||(l[7]=c=>e.value.urgency_id=c)},{default:a(({field:c,errors:I})=>[t(X,H({items:i.value,modelValue:e.value.urgency_id,"onUpdate:modelValue":l[6]||(l[6]=$=>e.value.urgency_id=$),variant:"outlined",density:"compact","hide-details":"",clearable:"",label:"Urgency*","item-value":"id","item-title":"title"},c,{"error-messages":I}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",Ct,[t(pe,{modelValue:e.value.asset_code,"onUpdate:modelValue":l[8]||(l[8]=c=>e.value.asset_code=c),variant:"outlined",density:"compact","hide-details":"",label:"Asset Code","append-inner-icon":u(Ae),"onClick:appendInner":l[9]||(l[9]=c=>de(e.value.asset_code))},null,8,["modelValue","append-inner-icon"]),t(Re,{onClick:F,class:"ml-2 my-auto",size:"large",icon:u(Te)},null,8,["icon"])]),s("div",Dt,[t(u(J),{name:"Title",modelValue:e.value.title,"onUpdate:modelValue":l[11]||(l[11]=c=>e.value.title=c)},{default:a(({field:c,errors:I})=>[t(pe,H({modelValue:e.value.title,"onUpdate:modelValue":l[10]||(l[10]=$=>e.value.title=$),variant:"outlined",density:"compact","hide-details":"",label:"Asset Name*"},c,{"error-messages":I}),null,16,["modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",It,[t(u(J),{name:"Company",modelValue:e.value.company_id,"onUpdate:modelValue":l[13]||(l[13]=c=>e.value.company_id=c)},{default:a(({field:c,errors:I})=>[t(X,H({items:re.value,modelValue:e.value.company_id,"onUpdate:modelValue":l[12]||(l[12]=$=>e.value.company_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Company*"},c,{"error-messages":I}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",$t,[t(u(J),{name:"Location",modelValue:e.value.location_id,"onUpdate:modelValue":l[15]||(l[15]=c=>e.value.location_id=c)},{default:a(({field:c,errors:I})=>[t(X,H({items:ce.value,modelValue:e.value.location_id,"onUpdate:modelValue":l[14]||(l[14]=$=>e.value.location_id=$),variant:"outlined",density:"compact","hide-details":"","item-value":"id","item-title":"title",clearable:"",label:"Location*"},c,{"error-messages":I}),null,16,["items","modelValue","error-messages"])]),_:1},8,["modelValue"])]),s("div",xt,[t(ye,{rows:"3",variant:"outlined",density:"compact",label:"Incident Description","hide-details":"auto",modelValue:e.value.description,"onUpdate:modelValue":l[16]||(l[16]=c=>e.value.description=c)},null,8,["modelValue"])]),s("div",At,[((z=e.value)==null?void 0:z.status_id)!=8&&(!j.value||j.value&&(o.objectdata.profile_id==E.value||q.value=="asset-supervisor"))?(r(),y(x,{key:0,color:"primary",onClick:be,disabled:!T.valid,loading:W.value},{default:a(()=>[m(h(j.value?"update":"submit"),1)]),_:2},1032,["disabled","loading"])):w("",!0)])]}),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"])]),_:1})):w("",!0),n.value=="warranty"?(r(),N("div",Rt,[t(U,null,{default:a(()=>[t(L,null,{default:a(()=>[Tt]),_:1})]),_:1}),((ve=(k=e.value.asset)==null?void 0:k.pivot_warranties)==null?void 0:ve.length)>0?(r(),y(V,{key:0},{default:a(()=>[s("div",Ut,[(r(!0),N(ee,null,te(e.value.asset.pivot_warranties,T=>(r(),y(U,{class:"my-3 px-5",key:T.id},{default:a(()=>[t(L,null,{default:a(()=>[t(V,null,{default:a(()=>[t(S,{cols:"4"},{default:a(()=>[m("Vendor")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(T.vendor.title),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("Warranty Start Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(u(K)(T.warranty_start_date)),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("Warranty End Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(u(K)(T.warranty_end_date)),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("AMC Start Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(u(K)(T.amc_start_date)),1)]),_:2},1024),t(S,{cols:"4"},{default:a(()=>[m("AMC End Date")]),_:1}),t(S,{cols:"8"},{default:a(()=>[m(h(u(K)(T.amc_end_date)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))])]),_:1})):(r(),y(U,{key:1,class:"mt-2"},{default:a(()=>[t(L,null,{default:a(()=>[Nt]),_:1})]),_:1}))])):j.value&&n.value=="attachment"?(r(),y(Ze,{key:2,"incident-id":parseInt(u(b).params.id),attachment:e.value.attachment,onSave:D,objectdata:e.value},null,8,["incident-id","attachment","objectdata"])):(q.value=="superadmin"||q.value=="admin"||q.value=="technical-operation"||q.value=="facility")&&j.value&&n.value=="facility"?(r(),y(ct,{key:3,objectdata:e.value,onSaved:D},null,8,["objectdata"])):w("",!0)])]}),_:1}),t(Be,{options:R.value},null,8,["options"]),t(fe,{width:"500",modelValue:_.value,"onUpdate:modelValue":l[18]||(l[18]=k=>_.value=k)},{default:a(()=>[t(U,null,{default:a(()=>[t(L,null,{default:a(()=>[t(u(Pe),{onDecode:de,onLoaded:he})]),_:1}),ae.value?w("",!0):(r(),y(L,{key:0},{default:a(()=>[m("Please wait...")]),_:1})),t(Ue,null,{default:a(()=>[t(Ne),t(x,{text:"Close",onClick:l[17]||(l[17]=k=>_.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ht=We(Et,[["__scopeId","data-v-86a19f70"]]);export{Ht as D};
