import{r as n,a as ue,u as re,G as de,H as ce,I as pe,c as V,w as i,m as ve,n as K,o as m,d as t,v as O,k as T,s as j,J as Y,$ as P,i as Z,h as F,b as a,x as me,C as _,j as M,e as b,y as U,p as X,q as fe,t as u,K as ye,B as ge,L as he,F as xe,N as Ve,O as _e,V as Ce,f as ke,Z as we,E as Se,_ as be,S as Ue,l as Ne}from"./app-f3958e63.js";import{_ as ze}from"./ApppageHeader-6d4c5de1.js";import{d as De,e as Pe}from"./encrypt-5c8471fd.js";import{_ as Re}from"./AppSnackBar-77751115.js";const $e=a("div",{class:"mt-2 mr-2"},"Show",-1),Be={class:"v-col-12"},Ae={class:"text-right text-capitalize"},Ee={class:"d-flex align-center justify-end"},Ie={class:"text-error"},Ke={class:"v-col-12 v-col-md-6"},Oe={class:"v-col-12 v-col-md-6 text-caption"},Te={class:"v-col-12 v-col-md-6 text-caption py-1"},je={class:"v-col-12 v-col-md-6 text-caption my-auto py-1"},Fe={class:"v-col-12 v-col-md-6 text-caption py-1"},Me={class:"v-col-12 text-caption py-1"},Ge={__name:"Users",setup(Le){const R=n({status:!1,type:"primary",text:null}),p=ue(),L=re(),$=de(),d=n({loading:!1,data:[]}),B=n(0),ee=n(0),g=n(""),ae=n([10,20,50,100]),A=n(10),le=n([{title:"Administrator",value:"admin"},{title:"Asset Supervisor-Project",value:"asset-supervisor"},{title:"Commercial Manager-Project",value:"commercial-manager"},{title:"Facility Team",value:"facility"},{title:"Normal",value:"normal"},{title:"Technical Operation",value:"technical-operation"}]),te=()=>{y()},J=()=>{localStorage.setItem("user-search",Pe(g.value)),y()},oe=()=>{g.value="",localStorage.setItem("user-search",""),y()},c=n($.params&&$.params.page?$.params.page:1),N=n([]),W=n(""),q=n(0),f=l=>{d.value.loading=!0,N.value[0]=l,q.value%2?N.value[1]="DESC":N.value[1]="ASC",q.value++,W.value=JSON.stringify(N.value),y()},y=async()=>{d.value.loading=!0,await K(p.token).get("/api/user/all?page="+c.value+"&show="+A.value+"&search="+g.value+"&sort="+W.value).then(l=>{B.value=l.data.last_page?l.data.last_page:l.data.length,c.value=l.data.current_page?l.data.current_page:c.value,ee.value=l.data.total?l.data.total:l.data.length,d.value.data=l.data.data?l.data.data:l.data,d.value.loading=!1}).catch(l=>{d.value.loading=!1,console.log(l)})};ce(c,(l,e)=>{c.value&&l!=e&&(L.push({name:"PaginatedUsers",params:{page:c.value}}).catch(s=>{}),y(c.value))});const se=l=>{L.push({name:"EditUser",params:{id:l}}).catch(e=>{console.log(e)})},C=n(!1),ne=()=>{C.value=!0},z=n(!1),Q=n(!1),h=n(""),x=n(""),k=n(""),D=n(""),r=n({}),G=()=>{r.value={},z.value=!1,h.value&&(D.value="",K(p.token).get("/api/admin/add-new/profile-by/ecode/"+h.value).then(l=>{if(l.data.id){D.value="Profile already registered.";return}Ne.post("/api/fetch-user/other-application",{ecode:h.value,key:"SFFjUDI2S1p0bUpWcit2Y21wNlJhQ1p5WndyQUR2Mnpoc0hERmt0RVBUMD0",user:"TW9pa3p6q",app:"grs-asset-wvukt"}).then(e=>{var s;Q.value=!1,x.value=e.data,(s=e.data)!=null&&s.id?(k.value=e.data.role,z.value=!0,r.value=e.data):D.value="Profile not found. Contact IT department."})}))},ie=async()=>{var s,o;R.value={status:!0,type:"info",text:"Please wait..."};let l=r.value.profile.fullname.split(" "),e={display_name:r.value.profile.fullname,email:r.value.email,first_name:l[0],last_name:l.slice(-1)[0],role:k.value,company_id:r.value.profile.company_id,ecode:r.value.profile.ecode,username:r.value.profile.ecode,designation:r.value.profile.position,profile_id:p.user.profile.id,company:(o=(s=r.value.profile)==null?void 0:s.company)==null?void 0:o.title};await K(p.token).post("/api/account/create-new/profile",e).then(v=>{C.value=!1,R.value={status:!0,type:"success",text:v.data.message},E(),y()}).catch(v=>{})},E=()=>{C.value=!1,k.value="",z.value=!1,x.value={},h.value="",r.value={}};return pe(()=>{let l=localStorage.getItem("user-search");l&&(g.value=De(l)),y()}),(l,e)=>(m(),V(ve,null,{default:i(()=>[t(ze,{title:"Users List"}),t(j,{class:"mb-3"},{default:i(()=>[t(O,{class:"v-col-12 mt-1 col-sm-12 py-0"},{default:i(()=>[t(T,{class:"px-5"},{default:i(()=>[t(j,null,{default:i(()=>[t(O,{class:"v-col-6 v-col-md-2 v-col-sm-6 d-flex my-2"},{default:i(()=>[$e,t(Y,{items:ae.value,modelValue:A.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>A.value=s),te],variant:"outlined",density:"compact","hide-details":"",label:"Entry"},null,8,["items","modelValue"])]),_:1}),t(P),t(O,{class:"v-col-6 v-col-md-3 v-col-sm-6 my-2"},{default:i(()=>[t(Z,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),variant:"outlined",density:"compact",clearable:"",label:"Search",type:"text","hide-details":"","onClick:appendOuter":J,onKeydown:F(J,["enter"]),"onClick:clear":e[2]||(e[2]=s=>oe("search"))},null,8,["modelValue","onKeydown"])]),_:1})]),_:1})]),_:1})]),_:1}),a("div",Be,[t(T,{loading:d.value.loading},{default:i(()=>[t(me,null,{default:i(()=>{var s;return[a("thead",null,[a("tr",null,[a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[3]||(e[3]=o=>f("company_id"))}," Company "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[4]||(e[4]=o=>f("location_id"))}," Location "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[5]||(e[5]=o=>f("display_name"))}," Name "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[6]||(e[6]=o=>f("username"))}," Username "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[7]||(e[7]=o=>f("email"))}," Email "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[8]||(e[8]=o=>f("role"))}," Role "),a("th",{class:"text-left text-capitalize cursor-pointer",onClick:e[9]||(e[9]=o=>f("status"))}," Status "),a("th",Ae,[_(p).user.role=="superadmin"||(s=_(p).capabilities)!=null&&s.includes("add")?(m(),V(M,{key:0,size:"small",color:"primary",onClick:ne},{default:i(()=>[b("Add New")]),_:1})):U("",!0)])])]),a("tbody",null,[(m(!0),X(xe,null,fe(d.value.data,o=>{var v,w,S;return m(),X("tr",{key:o.id},[a("td",null,u((v=o.company)==null?void 0:v.title),1),a("td",null,u((w=o.location)==null?void 0:w.title),1),a("td",null,u(o.display_name),1),a("td",null,u(o.username),1),a("td",null,u(o.email),1),a("td",null,u(o.role),1),a("td",null,[t(ye,{class:"text-uppercase",size:"small",color:`${o.status=="active"?"success":"error"}`},{default:i(()=>[b(u(o.status),1)]),_:2},1032,["color"])]),a("td",null,[a("div",Ee,[_(p).user.role=="superadmin"||(S=_(p).capabilities)!=null&&S.includes("edit")?(m(),V(ge,{key:0,size:"small",onClick:()=>se(o.id),icon:_(he),class:"mx-1"},null,8,["onClick","icon"])):U("",!0)])])])}),128))])]}),_:1}),d.value.data.length==0?(m(),V(Ve,{key:0,class:"pa-3 text-center w-100"},{default:i(()=>[b("No records found")]),_:1})):U("",!0)]),_:1},8,["loading"]),B.value>1?(m(),V(_e,{key:0,modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=s=>c.value=s),class:"my-4",length:B.value,"total-visible":8,variant:"elevated","active-color":"primary",density:"comfortable",disabled:d.value.loading},null,8,["modelValue","length","disabled"])):U("",!0)])]),_:1}),t(Ue,{width:"600",persistent:"",modelValue:C.value,"onUpdate:modelValue":e[13]||(e[13]=s=>C.value=s),onKeydown:F(E,["esc"])},{default:i(()=>[t(T,{class:"pt-3"},{default:i(()=>[t(Ce,{class:"text-h6 d-flex"},{default:i(()=>[b("New User "),t(P),a("small",Ie,u(D.value),1),t(P)]),_:1}),t(ke,null,{default:i(()=>[t(j,null,{default:i(()=>{var s,o,v,w,S,H;return[a("div",Ke,[t(Z,{loading:Q.value,density:"compact",variant:"outlined",autofocus:"",label:"Search Employee ID","append-inner-icon":_(we),"hide-details":"",modelValue:h.value,"onUpdate:modelValue":e[11]||(e[11]=I=>h.value=I),onKeydown:F(G,["enter"]),"onClick:appendInner":G},null,8,["loading","append-inner-icon","modelValue","onKeydown"])]),a("div",Oe,[t(Y,{density:"compact",variant:"outlined",label:"Role",items:le.value,"hide-details":"",modelValue:k.value,"onUpdate:modelValue":e[12]||(e[12]=I=>k.value=I)},null,8,["items","modelValue"])]),a("div",Te," Name: "+u((o=(s=x.value)==null?void 0:s.profile)==null?void 0:o.fullname),1),a("div",je," Status: "+u(x.value.status),1),a("div",Fe," Email:"+u((v=x.value)==null?void 0:v.email),1),a("div",Me," Company: "+u((H=(S=(w=x.value)==null?void 0:w.profile)==null?void 0:S.company)==null?void 0:H.title),1)]}),_:1})]),_:1}),t(Se,{class:"mt-2"}),t(be,null,{default:i(()=>[t(P),t(M,{size:"small",text:"cancel",onClick:E}),z.value?(m(),V(M,{key:0,size:"small",color:"secondary",onClick:ie},{default:i(()=>[b("Confirm")]),_:1})):U("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"]),t(Re,{options:R.value},null,8,["options"])]),_:1}))}};export{Ge as default};
