import{a as de,r as c,T as ie,J as q,a$ as re,o,p,d as s,w as u,k as B,s as k,b as _,ag as ce,E as w,V as ve,e as h,t as x,a3 as I,f as A,F as K,q as z,c as m,i as pe,a0 as me,h as Y,y as v,L as G,_ as fe,H as ye,j as D,v as he,D as _e,O as be,U as ge,W as L,X as Q,ae as Ve,n as R}from"./app-4dcf91a4.js";import{a as ke,c as we,F as xe,b as Ce}from"./index.esm-2f265776.js";import{_ as je}from"./Studio-6f6b678b.js";const Se={class:"text-error"},Fe={class:"d-flex pa-3"},Ae={key:0,class:"v-col-4",style:{"border-left":"1px solid #ccc","border-right":"1px solid #ccc"}},De=_("h5",null,"LINK ASSET",-1),Ue={key:1,class:"v-col-4 text-center",style:{"border-left":"1px solid #ccc","background-color":"#e0e0e0"}},$e={key:0,class:"d-flex mb-5 justify-center"},Oe=["data"],Ne={key:0,class:"mb-5",style:{position:"absolute",bottom:"0"}},Te=_("br",null,null,-1),qe=_("br",null,null,-1),ze={__name:"DialogForm",props:{dataObject:{type:Object,default:{}},addNewDialog:{type:Boolean,default:!1},title:{type:String,default:""},isView:{type:Boolean,default:!0},freeForm:{type:Array,default:[]}},emits:["savedResponse","fileSave","save"],setup(Z,{emit:U}){const r=Z,C=de(),$=c(""),y=c([]),ee=a=>{let t=null;a.map(i=>{t=y.value.find(n=>n.id==i.id),t||y.value.push(i)})},E=c([]),j=c(""),O=c(!1),N=c(1),b=c("image"),ae=a=>{let t=a.path.split(".");b.value=t[t.length-1],N.value=a,O.value=!0},te=a=>{y.value=y.value.filter(t=>t.id!==a)},W=ie(()=>y.value.map(a=>a.id)),le=()=>{let a={id:parseInt(P.value),file_ids:W.value,profile_id:C.user.profile.id};R(C.token).post("/api/warranty/sync-images/store-update",a).then(t=>{let i="Attachment has been updated";W.value.length==0&&(i="Attachment has been deleted"),U("fileSave",i)}).catch(t=>{})},se=a=>{let t=l.value.display_assets,i=l.value.assets;t.splice(a,1),l.value.display_assets=[...t],i.splice(a,1),l.value.assets=[...i]},g=c(!1),l=c({}),T=c(r.freeForm);q(()=>r.freeForm,a=>{T.value=[...a]});const H=()=>{g.value=!1,l.value={},U("cancelled",g.value)},J=()=>{g.value=!1,U("save",l.value),l.value={}},M=c({});T.value.map((a,t)=>{a.required&&(M.value[a.name]=ke().required())});let oe=we(M.value);const V=c(!1),ue=a=>{y.value=[],a&&R(C.token).post("/api/fetch/warranty/by/id/"+a).then(t=>{var i,n,e,d,f;((e=(n=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:n.pivot_assets)==null?void 0:e.length)>0&&t.data.data.pivot_assets.map((F,X)=>{l.value.assets.push(F.id),l.value.display_assets.push(F)}),y.value=(f=(d=t.data)==null?void 0:d.data)==null?void 0:f.attachment}).catch(t=>{})},S=c(window.location.origin),P=c(0);q(()=>r.addNewDialog,a=>{V.value=!1,l.value={},g.value=a,$.value="New "+r.title,r.dataObject.type&&(l.value=r.dataObject,$.value="Edit "+r.title),r.title=="Warranty"&&(l.value.assets=[],l.value.display_assets=[],l.value.pivot_assets=[],ue(l.value.id),P.value=l.value.id,V.value=!0)});const ne=a=>{a.length<4||R(C.token).get("/api/search-assets/warranty/"+a).then(t=>{let i=[];t.data&&t.data.length>0&&t.data.map((n,e)=>{i[e]=n,i[e].new_title=n.asset_name+" ("+n.asset_code+")"}),E.value=i}).catch(t=>{})};return q(()=>j.value,a=>{a&&(l.value.assets.includes(a.id)||(l.value.assets.push(a.id),l.value.display_assets.push(a)),j.value=""),console.log("dataObj.value",a)}),(a,t)=>{const i=re("v-card-action");return o(),p("div",null,[s(Q,{width:V.value?1200:600,persistent:"",modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=n=>g.value=n),onKeydown:Y(H,["esc"]),class:"d-flex",style:{overflow:"auto"}},{default:u(()=>[s(B,{class:"py-3"},{default:u(()=>[s(k,null,{default:u(()=>[_("div",{class:ce(`${V.value?"v-col-4":"v-col-12"}`)},[s(w(xe),{as:"v-form","validation-schema":w(oe)},{default:u(({meta:n})=>[s(ve,{class:"text-h6 d-flex"},{default:u(()=>[h(x($.value),1),s(I),_("small",Se,x(a.errorMessage),1),s(I)]),_:1}),s(A,null,{default:u(()=>[s(k,null,{default:u(()=>[(o(!0),p(K,null,z(T.value,(e,d)=>(o(),p("div",{class:"v-col-12",key:d},[s(w(Ce),{name:e.name,modelValue:l.value[e.name],"onUpdate:modelValue":f=>l.value[e.name]=f},{default:u(({field:f,errors:F})=>[e.type=="text"||e.type=="number"||e.type=="date"||e.type=="email"?(o(),m(pe,me({key:0,type:e.type,autofocus:d===0,modelValue:l.value[e.name],"onUpdate:modelValue":X=>l.value[e.name]=X,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,"hide-details":""},f,{onKeydown:Y(J,["enter"]),"error-messages":F}),null,16,["type","autofocus","modelValue","onUpdate:modelValue","label","onKeydown","error-messages"])):v("",!0)]),_:2},1032,["name","modelValue","onUpdate:modelValue"]),e.type=="select"?(o(),m(G,{key:0,autofocus:d===0,modelValue:l.value[e.name],"onUpdate:modelValue":f=>l.value[e.name]=f,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":""}`,items:e.data,"hide-details":"","item-value":"id","item-title":"title"},null,8,["autofocus","modelValue","onUpdate:modelValue","label","items"])):v("",!0),e.type=="textarea"?(o(),m(fe,{key:1,autofocus:d===0,modelValue:l.value[e.name],"onUpdate:modelValue":f=>l.value[e.name]=f,density:"compact",variant:"outlined",label:`${e.label}${e.required?"*":" (Optional)"}`,items:e.data,"hide-details":""},null,8,["autofocus","modelValue","onUpdate:modelValue","label","items"])):v("",!0)]))),128))]),_:1})]),_:1}),s(ye,{class:"mt-2"}),_("div",Fe,[s(I),s(D,{size:"small",text:"cancel",onClick:H,class:"mx-1"}),r.isView?v("",!0):(o(),m(D,{key:0,size:"small",color:"primary",onClick:J,disabled:!n.valid},{default:u(()=>[h("Save")]),_:2},1032,["disabled"]))])]),_:1},8,["validation-schema"])],2),V.value?(o(),p("div",Ae,[s(A,null,{default:u(()=>[De,s(k,{class:"mt-1"},{default:u(()=>[s(he,null,{default:u(()=>[s(G,{density:"compact",label:"Search asset name or code",variant:"outlined",items:E.value,"onUpdate:search":ne,"item-value":"id","item-title":"new_title",modelValue:j.value,"onUpdate:modelValue":t[0]||(t[0]=n=>j.value=n),"hide-details":"",clearable:"","return-object":""},null,8,["items","modelValue"])]),_:1})]),_:1}),s(k,{style:{"max-height":"460px",overflow:"auto"}},{default:u(()=>[(o(!0),p(K,null,z(l.value.display_assets,(n,e)=>(o(),p("div",{class:"v-col-12 v-col-md-12 text-caption py-1",key:e},[h(" - "+x(n.asset_name)+" ",1),_("b",null,"("+x(n.asset_code)+")",1),s(_e,{onClick:d=>se(e),class:"ml-2 cursor-pointer",color:"error",icon:w(be)},null,8,["onClick","icon"])]))),128))]),_:1})]),_:1}),r.isView?v("",!0):(o(),m(i,{key:0,class:"mb-5",style:{position:"absolute",bottom:"0"}},{default:u(()=>[h(" Note: Dont forget to click the save button ")]),_:1}))])):v("",!0),V.value?(o(),p("div",Ue,[r.dataObject.type?(o(),m(A,{key:0},{default:u(()=>{var n,e;return[r.isView?v("",!0):(o(),p("div",$e,[s(je,{options:{multiSelect:!0,type:"warranty"},onSelect:ee}),s(D,{color:"primary",onClick:le,disabled:((n=y.value)==null?void 0:n.length)==0},{default:u(()=>[h("Save Files")]),_:1},8,["disabled"])])),((e=y.value)==null?void 0:e.length)>0?(o(),m(k,{key:1,class:"px-1"},{default:u(()=>[(o(!0),p(K,null,z(y.value,(d,f)=>(o(),p("div",{key:d.id,class:"v-col-12 v-col-md-4 pa-2",style:{position:"relative"}},[r.isView?v("",!0):(o(),m(D,{key:0,style:{position:"absolute",top:"0",right:"0","z-index":"1"},icon:w(ge),size:"20px",color:"error",onClick:()=>te(d.id)},null,8,["icon","onClick"])),h(" "+x(d.mime)+" ",1),s(B,{onClick:()=>ae(d)},{default:u(()=>[d.mime=="image/jpeg"||d.mime=="image/png"?(o(),m(L,{key:0,src:S.value+"/file/"+d.path,cover:"","aspect-ratio":"1"},null,8,["src"])):(o(),m(L,{key:1,src:S.value+"/assets/images/pdf-image.png",cover:"","aspect-ratio":"1"},null,8,["src"]))]),_:2},1032,["onClick"])]))),128)),s(Q,{modelValue:O.value,"onUpdate:modelValue":t[1]||(t[1]=d=>O.value=d),width:"95%","max-width":"900"},{default:u(()=>[s(B,{class:"bg-black"},{default:u(()=>[_("div",{style:Ve(`${b.value=="pdf"?"height: 980px;":"height: 680px;"} 
                                                        width: 100%;
                                                        `),class:"d-flex align-center justify-center"},[b.value=="jpg"||b.value=="jpeg"||b.value=="png"?(o(),m(L,{key:0,src:S.value+"/file/"+N.value.path},null,8,["src"])):v("",!0),b.value=="pdf"?(o(),p("object",{key:1,data:S.value+"/file/"+N.value.path,type:"application/pdf",width:"100%",height:"800px"},null,8,Oe)):v("",!0)],4)]),_:1})]),_:1},8,["modelValue"])]),_:1})):v("",!0),s(k,null,{default:u(()=>[r.isView?v("",!0):(o(),p("div",Ne," Note: Dont forget to click the save button at the top "))]),_:1})]}),_:1})):(o(),m(A,{key:1},{default:u(()=>[h(" You can upload files on update only."),Te,qe,h(" kindly create new warranty first then click update/edit. ")]),_:1}))])):v("",!0)]),_:1})]),_:1})]),_:1},8,["width","modelValue","onKeydown"])])}}};export{ze as _};
